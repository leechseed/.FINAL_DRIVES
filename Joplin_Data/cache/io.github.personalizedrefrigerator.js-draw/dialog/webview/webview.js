/*! For license information please see webview.js.LICENSE.txt */
(()=>{var e={2877:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Check=void 0,t.Check='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M378-246 154-470l43-43 181 181 384-384 43 43-427 427Z"/></svg>',t.default=t.Check},3905:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Close=void 0,t.Close='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m249-207-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"/></svg>',t.default=t.Close},2701:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUpload=void 0,t.CloudUpload='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M250-160q-86 0-148-62T40-370q0-78 49.5-137.5T217-579q20-97 94-158.5T482-799q113 0 189.5 81.5T748-522v24q72-2 122 46.5T920-329q0 69-50 119t-119 50H510q-24 0-42-18t-18-42v-258l-83 83-43-43 156-156 156 156-43 43-83-83v258h241q45 0 77-32t32-77q0-45-32-77t-77-32h-63v-84q0-89-60.5-153T478-739q-89 0-150 64t-61 153h-19q-62 0-105 43.5T100-371q0 62 43.929 106.5Q187.857-220 250-220h140v60H250Zm230-290Z"/></svg>',t.default=t.CloudUpload},4221:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentCopy=void 0,t.ContentCopy='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M180-81q-24 0-42-18t-18-42v-603h60v603h474v60H180Zm120-120q-24 0-42-18t-18-42v-560q0-24 18-42t42-18h440q24 0 42 18t18 42v560q0 24-18 42t-42 18H300Zm0-60h440v-560H300v560Zm0 0v-560 560Z"/></svg>',t.default=t.ContentCopy},7545:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPaste=void 0,t.ContentPaste='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 0 24 24" width="48"><path style="fill: var(--icon-color);" d="M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>',t.default=t.ContentPaste},966:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Delete=void 0,t.Delete='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M261-120q-24.75 0-42.375-17.625T201-180v-570h-41v-60h188v-30h264v30h188v60h-41v570q0 24-18 42t-42 18H261Zm438-630H261v570h438v-570ZM367-266h60v-399h-60v399Zm166 0h60v-399h-60v399ZM261-750v570-570Z"/></svg>',t.default=t.Delete},7979:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Draw=void 0,t.Draw='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M560-120q-12 0-21-9t-9-21q0-13 9-21.5t21-8.5q59 0 99.5-24t40.5-56q0-23-29.5-45T591-339l47-47q63 19 92.5 52.5T760-260q0 67-61 103.5T560-120ZM240-414q-64-14-92-44t-28-62q0-35 26-63t120-62q66-24 85-39t19-35q0-25-22-43t-68-18q-27 0-46 7t-34 22q-8 8-20.5 9.5T157-748q-11-8-11.5-20t7.5-21q17-22 51-36.5t76-14.5q68 0 109 32.5t41 88.5q0 41-28.5 69.5T290-590q-67 25-88.5 39.5T180-520q0 16 27 30.5t81 27.5l-48 48Zm496-154L608-696l45-45q18-18 40-18t40 18l48 48q18 18 18 40t-18 40l-45 45ZM220-180h42l345-345-42-42-345 345v42Zm-60 60v-128l405-405 128 128-405 405H160Zm405-447 42 42-42-42Z"/></svg>',t.default=t.Draw},1673:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Edit=void 0,t.Edit='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M180-180h44l443-443-44-44-443 443v44Zm614-486L666-794l42-42q17-17 42-17t42 17l44 44q17 17 17 42t-17 42l-42 42Zm-42 42L248-120H120v-128l504-504 128 128Zm-107-21-22-22 44 44-22-22Z"/></svg>',t.default=t.Edit},6384:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditDocument=void 0,t.EditDocument='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M220-80q-24 0-42-18t-18-42v-680q0-24 18-42t42-18h340l240 240v156h-60v-116H520v-220H220v680h300v60H220Zm0-60v-680 680Zm536-223 28 28-164 164v51h51l164-164 28 28L687-80H580v-107l176-176Zm107 107L756-363l61-61q9-9 21-9t21 9l65 65q9 9 9 21t-9 21l-61 61Z"/></svg>',t.default=t.EditDocument},9068:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpandMore=void 0,t.ExpandMore='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M480-339.5 234.261-585.239 283-633.978l197 198 197-197 48.739 48.739L480-339.5Z"/></svg>',t.default=t.ExpandMore},1916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Imagesmode=void 0,t.Imagesmode='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M182.152-114.022q-27.599 0-47.865-20.265-20.265-20.266-20.265-47.865v-595.696q0-27.697 20.265-48.033 20.266-20.337 47.865-20.337h595.696q27.697 0 48.033 20.337 20.337 20.336 20.337 48.033v595.696q0 27.599-20.337 47.865-20.336 20.265-48.033 20.265H182.152Zm0-68.13h595.696v-595.696H182.152v595.696Zm50.739-92.696h495.218L578-476.587l-132 171-93-127-120.109 157.739Zm-50.739 92.696v-595.696 595.696Zm157.966-383.783q22.576 0 38.262-15.803 15.685-15.803 15.685-38.38 0-22.576-15.803-38.262-15.803-15.685-38.38-15.685-22.576 0-38.262 15.803-15.685 15.803-15.685 38.38 0 22.576 15.803 38.262 15.803 15.685 38.38 15.685Z"/></svg>',t.default=t.Imagesmode},4273:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InkEraser=void 0,t.InkEraser='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M687.805-222.152h203v68.13h-271.37l68.37-68.13Zm-515.501 68.13-81.478-84.239q-20.431-19.622-19.792-47.235.64-27.613 19.031-47.004l456.326-494.413q18.391-19.391 46.314-19.272 27.923.12 47.404 19.511L841.283-615.5q19.63 19.622 20.63 47.855 1 28.232-18.63 47.623l-341.957 366H172.304Zm302.695-68.13 322.305-349.37-203.413-213.413-452.848 499.174 61.37 63.609h272.586ZM480-480Z"/></svg>',t.default=t.InkEraser},696:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InkEraserOff=void 0,t.InkEraserOff='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M813-61 605-269 503-160H179l-81-84q-18-17-17.5-41.5T97-327l216-234L61-813l43-43 752 752-43 43ZM206-220h274l83-91-209-209-212 234 64 66Zm482-138-42-42 158-172-207-217-161 179-41-41 160-174q16-17 40.567-17 24.566 0 41.433 17l205 215q17 17 18 42t-16 42L688-358ZM541-505Zm-82 89Z"/></svg>',t.default=t.InkEraserOff},1050:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InkHighlighter=void 0,t.InkHighlighter='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M545.63-401.022 431.587-515.065 217.478-301.196l114.283 114.283L545.63-401.022Zm-65.304-163.021 114.283 114.282 214.674-214.674-114.044-114.282-214.913 214.674Zm-72.848-23.87 211 211L389.5-147.935q-21.152 21.153-58.359 21.153-37.206 0-58.119-21.153l-10.761-10.521-44.913 44.674h-155L184.26-235.456l-3.761-4q-24.391-24.153-23.891-61.12.5-36.968 24.891-61.359l225.978-225.978Zm0 0 241.783-241.783q19.63-19.63 48.859-19.63 29.228 0 49.098 19.63l111.043 111.283q19.63 19.63 19.13 51.478-.5 31.848-20.13 51.479L618.478-376.913l-211-211Z"/></svg>',t.default=t.InkHighlighter},2486:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InkPen=void 0,t.InkPen='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m480-522 42 42 249-249-42-42-249 249ZM180-180h42l258-258-42-42-258 258v42Zm362-238L418-542l198-198-30-30-234 234-43-43 228-228q25-25 49.5-25.5T637-807l23 23 45-45q11-11 25-11t25 11l73 73q11 11 11 26t-11 26L542-418ZM244-120H120v-124l298-298 124 124-298 298Z"/></svg>',t.default=t.InkPen},583:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LassoSelect=void 0,t.LassoSelect='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m141-518-60-6q5-46 20-90t40-82l51 33q-19 34-32 70.5T141-518Zm55 317q-32-31-56.5-69T101-353l58-19q13 37 33 69t47 59l-43 43Zm102-568-33-51q40-25 82.5-39.5T438-880l6 60q-41 5-75.5 17.5T298-769ZM488-82q-38 0-74-6t-68-17l22-58q27 10 59 15t61 6v60Zm232-635q-29-29-62-50.5T587-802l21-57q47 16 85.5 41.5T763-760l-43 43Zm93 600L682-248v130h-60v-232h232v60H724l131 131-42 42Zm6-367q-1-29-5.5-59T797-600l58-18q12 32 18 65.5t6 68.5h-60Z"/></svg>',t.default=t.LassoSelect},5839:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineWeight=void 0,t.LineWeight='<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px"><path style="fill: var(--icon-color);" d="M3 17h18v-2H3v2zm0 3h18v-1H3v1zm0-7h18v-3H3v3zm0-9v4h18V4H3z"/></svg>\n',t.default=t.LineWeight},3888:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PanTool=void 0,t.PanTool='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M402.097-34.022q-27.578 0-52.794-12.858-25.216-12.859-40.216-36.337L53.044-468.24l20.928-16q17.985-15 41.322-19 23.336-4 47.801 14.383l114.514 87.312v-411.804q0-13.641 9.439-23.016 9.439-9.375 23.174-9.375t22.952 9.375q9.217 9.375 9.217 23.016v533.978L172.935-404.022l189.934 284.373q6.805 10.323 16.699 15.584 9.893 5.26 22.432 5.26h291.826q37.1 0 62.355-25.254 25.254-25.254 25.254-62.354v-587.413q0-13.641 9.439-23.016 9.439-9.376 23.174-9.376T837-796.842q9.218 9.375 9.218 23.016v587.413q0 63.957-44.218 108.174-44.217 44.217-108.174 44.217H402.097Zm43.946-443.587v-417.174q0-13.641 9.274-23.016 9.273-9.375 23.008-9.375t22.998 9.375q9.264 9.375 9.264 23.016v417.174h-64.544Zm168.196 0v-376.217q0-13.641 9.426-23.016 9.426-9.376 23.141-9.376 13.614 0 22.795 9.376 9.182 9.375 9.182 23.016v376.217h-64.544ZM477.065-288.326Z"/></svg>',t.default=t.PanTool},3879:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='`@js-draw/material-icons`: Material icon integration for `js-draw`.\n\nAll icons in `@js-draw/material-icons` were found using [Google WebFonts search](https://fonts.google.com/icons) and downloaded from there.\n\nA copy of the license for these icons is included below:\n\n```\n\n                                 Apache License\n                           Version 2.0, January 2004\n                        http://www.apache.org/licenses/\n\n   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n   1. Definitions.\n\n      "License" shall mean the terms and conditions for use, reproduction,\n      and distribution as defined by Sections 1 through 9 of this document.\n\n      "Licensor" shall mean the copyright owner or entity authorized by\n      the copyright owner that is granting the License.\n\n      "Legal Entity" shall mean the union of the acting entity and all\n      other entities that control, are controlled by, or are under common\n      control with that entity. For the purposes of this definition,\n      "control" means (i) the power, direct or indirect, to cause the\n      direction or management of such entity, whether by contract or\n      otherwise, or (ii) ownership of fifty percent (50%) or more of the\n      outstanding shares, or (iii) beneficial ownership of such entity.\n\n      "You" (or "Your") shall mean an individual or Legal Entity\n      exercising permissions granted by this License.\n\n      "Source" form shall mean the preferred form for making modifications,\n      including but not limited to software source code, documentation\n      source, and configuration files.\n\n      "Object" form shall mean any form resulting from mechanical\n      transformation or translation of a Source form, including but\n      not limited to compiled object code, generated documentation,\n      and conversions to other media types.\n\n      "Work" shall mean the work of authorship, whether in Source or\n      Object form, made available under the License, as indicated by a\n      copyright notice that is included in or attached to the work\n      (an example is provided in the Appendix below).\n\n      "Derivative Works" shall mean any work, whether in Source or Object\n      form, that is based on (or derived from) the Work and for which the\n      editorial revisions, annotations, elaborations, or other modifications\n      represent, as a whole, an original work of authorship. For the purposes\n      of this License, Derivative Works shall not include works that remain\n      separable from, or merely link (or bind by name) to the interfaces of,\n      the Work and Derivative Works thereof.\n\n      "Contribution" shall mean any work of authorship, including\n      the original version of the Work and any modifications or additions\n      to that Work or Derivative Works thereof, that is intentionally\n      submitted to Licensor for inclusion in the Work by the copyright owner\n      or by an individual or Legal Entity authorized to submit on behalf of\n      the copyright owner. For the purposes of this definition, "submitted"\n      means any form of electronic, verbal, or written communication sent\n      to the Licensor or its representatives, including but not limited to\n      communication on electronic mailing lists, source code control systems,\n      and issue tracking systems that are managed by, or on behalf of, the\n      Licensor for the purpose of discussing and improving the Work, but\n      excluding communication that is conspicuously marked or otherwise\n      designated in writing by the copyright owner as "Not a Contribution."\n\n      "Contributor" shall mean Licensor and any individual or Legal Entity\n      on behalf of whom a Contribution has been received by Licensor and\n      subsequently incorporated within the Work.\n\n   2. Grant of Copyright License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      copyright license to reproduce, prepare Derivative Works of,\n      publicly display, publicly perform, sublicense, and distribute the\n      Work and such Derivative Works in Source or Object form.\n\n   3. Grant of Patent License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      (except as stated in this section) patent license to make, have made,\n      use, offer to sell, sell, import, and otherwise transfer the Work,\n      where such license applies only to those patent claims licensable\n      by such Contributor that are necessarily infringed by their\n      Contribution(s) alone or by combination of their Contribution(s)\n      with the Work to which such Contribution(s) was submitted. If You\n      institute patent litigation against any entity (including a\n      cross-claim or counterclaim in a lawsuit) alleging that the Work\n      or a Contribution incorporated within the Work constitutes direct\n      or contributory patent infringement, then any patent licenses\n      granted to You under this License for that Work shall terminate\n      as of the date such litigation is filed.\n\n   4. Redistribution. You may reproduce and distribute copies of the\n      Work or Derivative Works thereof in any medium, with or without\n      modifications, and in Source or Object form, provided that You\n      meet the following conditions:\n\n      (a) You must give any other recipients of the Work or\n          Derivative Works a copy of this License; and\n\n      (b) You must cause any modified files to carry prominent notices\n          stating that You changed the files; and\n\n      (c) You must retain, in the Source form of any Derivative Works\n          that You distribute, all copyright, patent, trademark, and\n          attribution notices from the Source form of the Work,\n          excluding those notices that do not pertain to any part of\n          the Derivative Works; and\n\n      (d) If the Work includes a "NOTICE" text file as part of its\n          distribution, then any Derivative Works that You distribute must\n          include a readable copy of the attribution notices contained\n          within such NOTICE file, excluding those notices that do not\n          pertain to any part of the Derivative Works, in at least one\n          of the following places: within a NOTICE text file distributed\n          as part of the Derivative Works; within the Source form or\n          documentation, if provided along with the Derivative Works; or,\n          within a display generated by the Derivative Works, if and\n          wherever such third-party notices normally appear. The contents\n          of the NOTICE file are for informational purposes only and\n          do not modify the License. You may add Your own attribution\n          notices within Derivative Works that You distribute, alongside\n          or as an addendum to the NOTICE text from the Work, provided\n          that such additional attribution notices cannot be construed\n          as modifying the License.\n\n      You may add Your own copyright statement to Your modifications and\n      may provide additional or different license terms and conditions\n      for use, reproduction, or distribution of Your modifications, or\n      for any such Derivative Works as a whole, provided Your use,\n      reproduction, and distribution of the Work otherwise complies with\n      the conditions stated in this License.\n\n   5. Submission of Contributions. Unless You explicitly state otherwise,\n      any Contribution intentionally submitted for inclusion in the Work\n      by You to the Licensor shall be under the terms and conditions of\n      this License, without any additional terms or conditions.\n      Notwithstanding the above, nothing herein shall supersede or modify\n      the terms of any separate license agreement you may have executed\n      with Licensor regarding such Contributions.\n\n   6. Trademarks. This License does not grant permission to use the trade\n      names, trademarks, service marks, or product names of the Licensor,\n      except as required for reasonable and customary use in describing the\n      origin of the Work and reproducing the content of the NOTICE file.\n\n   7. Disclaimer of Warranty. Unless required by applicable law or\n      agreed to in writing, Licensor provides the Work (and each\n      Contributor provides its Contributions) on an "AS IS" BASIS,\n      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n      implied, including, without limitation, any warranties or conditions\n      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\n      PARTICULAR PURPOSE. You are solely responsible for determining the\n      appropriateness of using or redistributing the Work and assume any\n      risks associated with Your exercise of permissions under this License.\n\n   8. Limitation of Liability. In no event and under no legal theory,\n      whether in tort (including negligence), contract, or otherwise,\n      unless required by applicable law (such as deliberate and grossly\n      negligent acts) or agreed to in writing, shall any Contributor be\n      liable to You for damages, including any direct, indirect, special,\n      incidental, or consequential damages of any character arising as a\n      result of this License or out of the use or inability to use the\n      Work (including but not limited to damages for loss of goodwill,\n      work stoppage, computer failure or malfunction, or any and all\n      other commercial damages or losses), even if such Contributor\n      has been advised of the possibility of such damages.\n\n   9. Accepting Warranty or Additional Liability. While redistributing\n      the Work or Derivative Works thereof, You may choose to offer,\n      and charge a fee for, acceptance of support, warranty, indemnity,\n      or other liability obligations and/or rights consistent with this\n      License. However, in accepting such obligations, You may act only\n      on Your own behalf and on Your sole responsibility, not on behalf\n      of any other Contributor, and only if You agree to indemnify,\n      defend, and hold each Contributor harmless for any liability\n      incurred by, or claims asserted against, such Contributor by reason\n      of your accepting any such warranty or additional liability.\n\n   END OF TERMS AND CONDITIONS\n\n   APPENDIX: How to apply the Apache License to your work.\n\n      To apply the Apache License to your work, attach the following\n      boilerplate notice, with the fields enclosed by brackets "[]"\n      replaced with your own identifying information. (Don\'t include\n      the brackets!)  The text should be enclosed in the appropriate\n      comment syntax for the file format. We also recommend that a\n      file or class name and description of purpose be included on the\n      same "printed page" as the copyright notice for easier\n      identification within third-party archives.\n\n   Copyright [yyyy] [name of copyright owner]\n\n   Licensed under the Apache License, Version 2.0 (the "License");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an "AS IS" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n```\n'},4157:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Redo=void 0,t.Redo='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M388.174-194.022q-96.196 0-165.174-65.674-68.978-65.674-68.978-161.347 0-95.435 68.978-161.229 68.978-65.793 165.174-65.793h288.261L566.022-758.478l47.739-47.74L806.218-614 613.761-422.022l-47.739-47.739 110.413-110.174H387.174q-67.848 0-116.435 45.783-48.587 45.782-48.587 113.109 0 67.326 48.587 113.108 48.587 45.783 116.435 45.783h311.674v68.13H388.174Z"/></svg>',t.default=t.Redo},7929:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resize=void 0,t.Resize='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M120-439v-83h60v83h-60Zm0-170v-83h60v83h-60Zm0-171v-60h60v60h-60Zm148 0v-60h83v60h-83Zm171 660v-60h83v60h-83Zm0-660v-60h83v60h-83Zm170 660v-60h83v60h-83Zm171 0v-60h60v60h-60Zm0-148v-83h60v83h-60Zm0-171v-83h60v83h-60Zm0-170v-171H609v-60h231v231h-60ZM120-120v-231h60v171h171v60H120Z"/></svg>',t.default=t.Resize},4043:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RotateLeft=void 0,t.RotateLeft='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M435-80q-48-7-93-25t-85-48l43-44q32 24 66 37.5t69 19.5v60Zm90 0v-60q110-21 182.5-103.5T780-443q0-127-86.5-213.5T480-743h-20l79 79-44 44-153-153 153-153 44 44-79 79h20q75 0 140.5 28T735-698q49 49 77 114.5T840-443q0 140-89 241T525-80ZM194-216q-28-38-46.5-84.5T122-398h61q5 38 18.5 73t36.5 65l-44 44Zm-72-272q7-50 25-95.5t47-85.5l44 43q-23 33-36.5 68T183-488h-61Z"/></svg>',t.default=t.RotateLeft},1032:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenLockRotation=void 0,t.ScreenLockRotation='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m724.391-486.891 48.979-48.739 52.521 52.521q21.631 21.746 21.631 52.156t-21.631 52.04L672.087-226.348q-22.746 22.631-52.155 22.631-29.41 0-52.041-22.631L249.587-544.891q-22.391-22.152-22.511-51.739-.119-29.588 22.511-52.218l153.565-152.565q22.63-22.63 52.098-22.63 29.467 0 52.098 22.63l47.282 47.522-47.739 48.5-51.521-51.522L295.087-596.63l325.022 325.782 160.043-160.043-55.761-56ZM533.574-30.761q-98.76 0-186.047-37.5-87.288-37.5-152.168-102.88-64.881-65.381-102.38-152.638-37.5-87.257-37.5-185.982h62.63q0 78.565 28.163 148.75t76.967 124.587q48.804 54.402 115.272 89.663 66.467 35.261 142.554 43.978L355.848-228 401-273.152 631.152-43.053Q608.253-37 585.237-33.88t-51.663 3.12ZM664.63-602.63q-15 0-27.5-12.5t-12.5-27.5v-120q0-15 12.5-27.5t27.5-12.5h1v-42q0-33 22.5-55.5t55.5-22.5q33 0 55.5 22.5t22.5 55.5v42h2q15 0 27.5 12.5t12.5 27.5v120q0 15-12.5 27.5t-27.5 12.5h-159Zm39-200h80v-42.106q0-17.894-11-28.894t-29-11q-18 0-29 11t-11 28.894v42.106ZM540.239-513.761Z"/></svg>',t.default=t.ScreenLockRotation},4821:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0,t.Select='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M180-120q-24 0-42-18t-18-42h60v60Zm-60-120v-125h60v125h-60Zm0-185v-111h60v111h-60Zm0-171v-124h60v124h-60Zm0-184q0-24 18-42t42-18v60h-60Zm120 660v-60h125v60H240Zm0-660v-60h125v60H240Zm185 660v-60h111v60H425Zm0-660v-60h111v60H425Zm171 660v-60h124v60H596Zm0-660v-60h124v60H596Zm184 660v-60h60q0 24-18 42t-42 18Zm0-120v-125h60v125h-60Zm0-185v-111h60v111h-60Zm0-171v-124h60v124h-60Zm0-184v-60q24 0 42 18t18 42h-60Z"/></svg>',t.default=t.Select},3345:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shapes=void 0,t.Shapes='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M600-360Zm-280 98q10 2 19.5 2H360q5.5 0 10.25-.25T380-261v121h440v-440H699q.5-5 .75-9.75T700-600v-20.5q0-9.5-2-19.5h122q24.75 0 42.375 17.625T880-580v440q0 24.75-17.625 42.375T820-80H380q-24.75 0-42.375-17.625T320-140v-122Zm40-58q-117 0-198.5-81.5T80-600q0-117 81.5-198.5T360-880q117 0 198.5 81.5T640-600q0 117-81.5 198.5T360-320Zm-.212-60Q451-380 515.5-444.288q64.5-64.288 64.5-155.5T515.712-755.5q-64.288-64.5-155.5-64.5T204.5-755.712q-64.5 64.288-64.5 155.5T204.288-444.5q64.288 64.5 155.5 64.5ZM360-600Z"/></svg>',t.default=t.Shapes},6203:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Title=void 0,t.Title='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M425.935-154.022v-544.065H194.022v-108.131h572.196v108.131H534.304v544.065H425.935Z"/></svg>',t.default=t.Title},7091:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TouchApp=void 0,t.TouchApp='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M439.5-74.022q-32.2 0-61.652-13.247-29.452-13.248-49.153-38.535L109.543-404.913l27.218-27.065q15.888-15.545 38.194-18.773 22.306-3.227 42.219 7.49l93.978 49.652v-357.348q0-13.915 9.653-23.512 9.653-9.596 23.66-9.596 14.008 0 23.456 9.596 9.449 9.597 9.449 23.512v467.631l-150.935-80.348 156.478 197.761q10.486 12.622 25.085 19.028 14.599 6.407 31.024 6.407H652.87q36.463 0 61.677-25.04t25.214-61.692v-163.942q0-27.891-19.091-46.815-19.092-18.924-46.888-18.924H457.37v-66.457h216.058q55.15 0 93.97 38.647t38.82 93.549v164.022q0 64.195-44.577 108.652-44.576 44.456-108.664 44.456H439.5ZM191.761-662.609q-11.535-19.444-17.746-41.981-6.211-22.538-6.211-46.401 0-73.357 51.604-124.77 51.603-51.413 124.818-51.413t124.853 51.635q51.638 51.635 51.638 124.895 0 23.799-6.211 46.238t-17.745 41.797l-57.5-33.108q7-12 11-26t4-29.478q0-45.522-32.118-77.522-32.118-32-78-32t-77.882 32.083q-32 32.083-32 77.917 0 15 4 29t11 26l-57.5 33.108Zm291.456 330.696Z"/></svg>',t.default=t.TouchApp},1431:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Undo=void 0,t.Undo='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M261.152-194.022v-68.13h311.674q67.848 0 116.435-45.783 48.587-45.782 48.587-113.108 0-67.087-48.587-112.99-48.587-45.902-116.435-45.902H283.805l110.173 110.174-47.739 47.739L154.022-614l192.217-192.218 47.739 47.74-110.173 110.413h288.021q96.196 0 165.294 65.674 69.098 65.674 69.098 161.348 0 95.434-69.098 161.228-69.098 65.793-165.294 65.793H261.152Z"/></svg>',t.default=t.Undo},5219:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeMaterialIconProviderClass=t.MaterialIconProvider=void 0;const i=o(7950),r=n(o(6197));t.makeMaterialIconProviderClass=r.default;const s=(0,r.default)({IconProvider:i.IconProvider,EraserMode:i.EraserMode,SelectionMode:i.SelectionMode});t.MaterialIconProvider=s,t.default=s},6197:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(7950),r=n(o(3879)),s=n(o(9068)),a=n(o(1431)),l=n(o(4157)),c=n(o(4273)),d=n(o(696)),h=n(o(3888)),u=n(o(7091)),p=n(o(1032)),f=n(o(1916)),m=n(o(6203)),g=n(o(7929)),b=n(o(966)),v=n(o(4221)),y=n(o(6384)),w=n(o(2877)),x=n(o(1050)),S=n(o(1673)),T=n(o(2701)),C=n(o(4043)),P=n(o(4821)),k=n(o(3905)),E=n(o(3345)),z=n(o(7979)),_=n(o(2486)),M=n(o(7545)),I=n(o(583)),R=n(o(5839)),L=e=>{const t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]};t.default=({IconProvider:e,EraserMode:t})=>class extends e{makeUndoIcon(){return L(a.default)}makeRedoIcon(){return L(l.default)}makeDropdownIcon(){return L(s.default)}makeEraserIcon(e,o){return L(o===t.PartialStroke?d.default:c.default)}makeSelectionIcon(e){return L(e===i.SelectionMode.Lasso?I.default:P.default)}makeRotateIcon(){return L(C.default)}makeHandToolIcon(){return L(h.default)}makeTouchPanningIcon(){return L(u.default)}makeRotationLockIcon(){return L(p.default)}makeInsertImageIcon(){return L(f.default)}makeUploadFileIcon(){return L(T.default)}makeTextIcon(e){return L(m.default)}makePenIcon(e){let t=this.isRoundedTipPen(e)?S.default:x.default;this.isPolylinePen(e)&&(t=_.default);const o=L(t);o.setAttribute("viewBox","0 -880 960 1000");const n=document.createElementNS("http://www.w3.org/2000/svg","path");if(n.setAttribute("d","\n\t\t\tM110,-25 L850,-25\n\t\t"),n.style.stroke=e.color.toHexString(),n.style.strokeWidth=""+20*Math.sqrt(e.thickness),this.isRoundedTipPen(e)?n.style.strokeLinecap="round":n.style.strokeLinecap="square",o.insertAdjacentElement("afterbegin",n),e.color.a<1){const e=this.makeCheckerboardPattern(),t=document.createElementNS("http://www.w3.org/2000/svg","defs");t.appendChild(e.patternDefElement),o.appendChild(t);const i=n.cloneNode();i.style.stroke=e.patternRef,o.insertAdjacentElement("afterbegin",i)}return o}makeShapeAutocorrectIcon(){return L(E.default)}makeStrokeSmoothingIcon(){return L(z.default)}makePressureSensitivityIcon(){return L(R.default)}makeResizeImageToSelectionIcon(){return L(g.default)}makeDuplicateSelectionIcon(){return L(v.default)}makeCopyIcon(){return L(v.default)}makePasteIcon(){return L(M.default)}makeDeleteSelectionIcon(){return L(b.default)}makeCloseIcon(){return L(k.default)}makeSaveIcon(){return L(w.default)}makeConfigureDocumentIcon(){return L(y.default)}licenseInfo(){return r.default}}},9283:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Color4=void 0;const i=n(o(6797));class r{constructor(e,t,o,n){this.r=e,this.g=t,this.b=o,this.a=n,this.hexString=null}static ofRGB(e,t,o){return r.ofRGBA(e,t,o,1)}static ofRGBA(e,t,o,n){return e=Math.max(0,Math.min(e,1)),t=Math.max(0,Math.min(t,1)),o=Math.max(0,Math.min(o,1)),n=Math.max(0,Math.min(n,1)),new r(e,t,o,n)}static fromRGBArray(e,t=255){const o=e[0],n=e[1]??o,i=e[2]??o;let s=255;return 3<e.length&&(s=e[3]),r.ofRGBA(o/t,n/t,i/t,s/t)}static fromHex(e){if(!(e=(e=(e.match(/^[#]?(.*)$/)??[])[1]).toUpperCase()).match(/^[0-9A-F]+$/))throw new Error(`${e} is not in a valid format.`);if(3===e.length||4===e.length){const t=e.split("");e=t.map((e=>`${e}0`)).join("")}6===e.length&&(e+="FF");const t=[];for(let o=2;o<=e.length;o+=2){const n=e.substring(o-2,o);t.push(parseInt(n,16)/255)}if(4!==t.length)throw new Error(`Unable to parse ${e}: Wrong number of components.`);return r.ofRGBA(t[0],t[1],t[2],t[3])}static fromString(e){if(e.startsWith("#"))return r.fromHex(e);if("none"===e||"transparent"===e)return r.transparent;if(""===e)return r.black;const t=e.replace(/\s*/g,"").match(/^rgba?\(([,0-9.]+)\)$/i);if(t){const o=t[1],n=JSON.parse(`[ ${o} ]`);if(3===n.length)return r.ofRGB(n[0]/255,n[1]/255,n[2]/255);if(4===n.length)return r.ofRGBA(n[0]/255,n[1]/255,n[2]/255,n[3]);throw new Error(`RGB string, ${e}, has wrong number of components: ${n.length}`)}const o=document.createElement("canvas");o.width=1,o.height=1;const n=o.getContext("2d");if(!n)return r.black;n.fillStyle=e,n.fillRect(0,0,1,1);const i=n.getImageData(0,0,1,1),s=i.data[0]/255,a=i.data[1]/255,l=i.data[2]/255,c=i.data[3]/255;return r.ofRGBA(s,a,l,c)}eq(e){return null!=e&&(0===this.a&&0===e.a||this.toHexString()===e.toHexString())}mix(e,t){const o=1-(t=Math.min(Math.max(t,0),1));return new r(this.r*o+e.r*t,this.g*o+e.g*t,this.b*o+e.b*t,this.a*o+e.a*t)}withAlpha(e){return new r(this.r,this.g,this.b,e)}get rgb(){return i.default.of(this.r,this.g,this.b)}relativeLuminance(){const e=[this.r,this.g,this.b].map((e=>e<.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)));return.2126*e[0]+.7152*e[1]+.0722*e[2]}static contrastRatio(e,t){const o=e.relativeLuminance(),n=t.relativeLuminance();return(Math.max(o,n)+.05)/(Math.min(o,n)+.05)}static average(e){let t=0,o=0,n=0,i=0;for(const r of e)t+=r.a,o+=r.r,n+=r.g,i+=r.b;return e.length>0&&(t/=e.length,o/=e.length,n/=e.length,i/=e.length),new r(o,n,i,t)}asHSV(){const e=Math.min(this.r,this.g,this.b),t=Math.max(this.r,this.g,this.b),o=t-e;let n;n=0===o?0:this.r>=this.g&&this.r>=this.b?(this.g-this.b)/o%6:this.g>=this.r&&this.g>=this.b?(this.b-this.r)/o+2:(this.r-this.g)/o+4,n*=60,n*=Math.PI/180,n<0&&(n+=2*Math.PI);const r=t,s=r>0?o/r:0;return i.default.of(n,s,r)}static fromHSV(e,t,o){e<0&&(e+=2*Math.PI),e%=2*Math.PI;const n=(o=Math.max(0,Math.min(1,o)))*(t=Math.max(0,Math.min(1,t))),i=e/(Math.PI/3),s=n*(1-Math.abs(i%2-1));let a;a=i<1?[n,s,0]:i<2?[s,n,0]:i<3?[0,n,s]:i<4?[0,s,n]:i<5?[s,0,n]:[n,0,s];const l=o-n;return r.ofRGB(a[0]+l,a[1]+l,a[2]+l)}static fromRGBVector(e,t){return r.ofRGBA(e.x,e.y,e.z,t??1)}toHexString(){if(this.hexString)return this.hexString;const e=e=>{const t=Math.round(255*e).toString(16);return 1===t.length?`0${t}`:t},t=e(this.a),o=e(this.r),n=e(this.g),i=e(this.b);return"ff"===t?`#${o}${n}${i}`:(this.hexString=`#${o}${n}${i}${t}`,this.hexString)}toString(){return this.toHexString()}}t.Color4=r,r.transparent=r.ofRGBA(0,0,0,0),r.red=r.ofRGB(1,0,0),r.orange=r.ofRGB(1,.65,0),r.green=r.ofRGB(0,1,0),r.blue=r.ofRGB(0,0,1),r.purple=r.ofRGB(.5,.2,.5),r.yellow=r.ofRGB(1,1,.1),r.clay=r.ofRGB(.8,.4,.2),r.black=r.ofRGB(0,0,0),r.gray=r.ofRGB(.5,.5,.5),r.white=r.ofRGB(1,1,1),t.default=r},4432:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Mat33=void 0;const i=o(7134),r=n(o(6797));class s{constructor(e,t,o,n,i,s,a,l,c){this.a1=e,this.a2=t,this.a3=o,this.b1=n,this.b2=i,this.b3=s,this.c1=a,this.c2=l,this.c3=c,this.cachedInverse=void 0,this.rows=[r.default.of(e,t,o),r.default.of(n,i,s),r.default.of(a,l,c)]}static ofRows(e,t,o){return new s(e.x,e.y,e.z,t.x,t.y,t.z,o.x,o.y,o.z)}inverse(){return this.computeInverse()??s.identity}invertable(){return null!==this.computeInverse()}computeInverse(){if(void 0!==this.cachedInverse)return this.cachedInverse;const e=[this.rows[0],this.rows[1],this.rows[2]],t=[r.default.unitX,r.default.unitY,r.default.unitZ];for(let o=0;o<3;o++){let n=e[o].at(o);const i=1e-10;if(Math.abs(n)<i){let r=-1;for(let t=1;t<=2;t++){const n=(o+t)%3;if(Math.abs(e[n].at(o))>=i){r=n;break}}if(-1===r)return this.cachedInverse=null,null;const s=e[o],a=t[o];e[o]=e[r],t[o]=t[r],e[r]=s,t[r]=a,n=e[o].at(o)}let r=1/n;e[o]=e[o].times(r),t[o]=t[o].times(r);const s=e[o],a=t[o];for(let n=1;n<=2;n++){const i=(o+n)%3;r=-e[i].at(o),e[i]=e[i].plus(s.times(r)),t[i]=t[i].plus(a.times(r))}}const o=s.ofRows(t[0],t[1],t[2]);return this.cachedInverse=o,o}transposed(){return new s(this.a1,this.b1,this.c1,this.a2,this.b2,this.c2,this.a3,this.b3,this.c3)}rightMul(e){e=e.transposed();const t=(t,o)=>this.rows[t].dot(e.rows[o]);return new s(t(0,0),t(0,1),t(0,2),t(1,0),t(1,1),t(1,2),t(2,0),t(2,1),t(2,2))}transformVec2(e){let t=r.default.of(e.x,e.y,1);return t=this.transformVec3(t),i.Vec2.of(t.x,t.y)}transformVec3(e){return r.default.of(this.rows[0].dot(e),this.rows[1].dot(e),this.rows[2].dot(e))}isIdentity(){return this===s.identity||this.eq(s.identity)}eq(e,t=0){for(let o=0;o<3;o++)if(!this.rows[o].eq(e.rows[o],t))return!1;return!0}toString(){let e="";const t=[0,0,0];for(const e of this.rows)for(let o=0;o<3;o++)t[o]=Math.max(t[0],`${e.at(o)}`.length);for(let o=0;o<3;o++){e+=0===o?"⎡ ":1===o?"⎢ ":"⎣ ";for(let n=0;n<3;n++){const i=this.rows[o].at(n).toString();let r="";for(let e=i.length;e<t[n];e++)r+=" ";e+=i+", "+r}e+=0===o?" ⎤":1===o?" ⎥":" ⎦",e+="\n"}return e.trimEnd()}toArray(){return[this.a1,this.a2,this.a3,this.b1,this.b2,this.b3,this.c1,this.c2,this.c3]}mapEntries(e){return new s(e(this.a1,[0,0]),e(this.a2,[0,1]),e(this.a3,[0,2]),e(this.b1,[1,0]),e(this.b2,[1,1]),e(this.b3,[1,2]),e(this.c1,[2,0]),e(this.c2,[2,1]),e(this.c3,[2,2]))}getScaleFactor(){return Math.hypot(this.a1,this.a2)}getColumn(e){return r.default.of(this.rows[0].at(e),this.rows[1].at(e),this.rows[2].at(e))}maximumEntryMagnitude(){let e=Math.abs(this.a1);for(const t of this.toArray())e=Math.max(e,Math.abs(t));return e}static translation(e){return new s(1,0,e.x,0,1,e.y,0,0,1)}static zRotation(e,t=i.Vec2.zero){if(0===e)return s.identity;const o=Math.cos(e),n=Math.sin(e);let r=s.translation(t);return r=r.rightMul(new s(o,-n,0,n,o,0,0,0,1)),r.rightMul(s.translation(t.times(-1)))}static scaling2D(e,t=i.Vec2.zero){let o,n,r=s.translation(t);return"number"==typeof e?(o=e,n=e):(o=e.x,n=e.y),r=r.rightMul(new s(o,0,0,0,n,0,0,0,1)),r.rightMul(s.translation(t.times(-1)))}toCSSMatrix(){return`matrix(${this.a1},${this.b1},${this.a2},${this.b2},${this.a3},${this.b3})`}static fromCSSMatrix(e){if(""===e||"none"===e)return s.identity;e=e.trim().replace(/\s+/g," ");const t=e=>e.split(/[, \t\n]+/g).map((t=>{if(""===t.trim())return null;let o=!1;if(t.endsWith("%")&&(o=!0,t=t.substring(0,t.length-1)),t=t.replace(/px$/gi,""),!/^[-]?\d*(?:\.\d*)?(?:[eE][-+]?\d+)?$/i.exec(t))throw new Error(`All arguments to transform functions must be numeric (state: ${JSON.stringify({currentArgument:t,allArguments:e})})`);let n=parseFloat(t);return o&&(n/=100),n})).filter((e=>null!==e)),o={matrix:e=>{if(6!==e.length)throw new Error(`Invalid matrix argument: ${e}. Must have length 6`);const t=e[0],o=e[1],n=e[2],i=e[3],r=e[4],a=e[5];return new s(t,n,r,o,i,a,0,0,1)},scale:e=>{let t,o;if(1===e.length)t=e[0],o=e[0];else{if(2!==e.length)throw new Error(`The scale() function only supports two arguments. Given: ${e}`);t=e[0],o=e[1]}return s.scaling2D(i.Vec2.of(t,o))},translate:e=>{let t=0,o=0;if(1===e.length)t=e[0];else{if(2!==e.length)throw new Error(`The translate() function requires either 1 or 2 arguments. Given ${e}`);t=e[0],o=e[1]}return s.translation(i.Vec2.of(t,o))}},n=/(?:^|\W)(\w+)\s?\(([^)]*)\)/gi;let r,a=null;for(;null!==(r=n.exec(e));){const e=r[1].toLowerCase();if(!(e in o))throw new Error(`Unsupported CSS transform action: ${e}`);const n=t(r[2]),i=o[e](n);a=a?a.rightMul(i):i}return a??s.identity}}t.Mat33=s,s.identity=new s(1,0,0,0,1,0,0,0,1),t.default=s},7134:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vec2=t.Vec3=void 0;const n=o(6797);Object.defineProperty(t,"Vec3",{enumerable:!0,get:function(){return n.Vec3}}),Object.defineProperty(t,"Vec2",{enumerable:!0,get:function(){return n.Vec2}}),t.default=n.Vec2},6797:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vec3=t.Vec2=void 0;class o{constructor(e,t,o){this.x=e,this.y=t,this.z=o}get xy(){return{x:this.x,y:this.y}}at(e){if(0===e)return this.x;if(1===e)return this.y;if(2===e)return this.z;throw new Error(`${e} out of bounds!`)}length(){return this.magnitude()}magnitude(){return Math.sqrt(this.magnitudeSquared())}magnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}squareDistanceTo(e){const t=this.x-e.x,o=this.y-e.y,n=this.z-e.z;return t*t+o*o+n*n}distanceTo(e){return Math.sqrt(this.squareDistanceTo(e))}maximumEntryMagnitude(){return Math.max(Math.abs(this.x),Math.max(Math.abs(this.y),Math.abs(this.z)))}angle(){return Math.atan2(this.y,this.x)}normalized(){const e=this.magnitude();return r.of(this.x/e,this.y/e,this.z/e)}normalizedOrZero(){return this.eq(r.zero)?r.zero:this.normalized()}times(e){return r.of(this.x*e,this.y*e,this.z*e)}plus(e){return r.of(this.x+e.x,this.y+e.y,this.z+e.z)}minus(e){return r.of(this.x-e.x,this.y-e.y,this.z-e.z)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return r.of(this.y*e.z-e.y*this.z,e.x*this.z-this.x*e.z,this.x*e.y-e.x*this.y)}scale(e){return"number"==typeof e?this.times(e):r.of(this.x*e.x,this.y*e.y,this.z*e.z)}orthog(){return 0===this.dot(r.unitX)&&0===this.dot(r.unitY)?0===this.dot(r.unitX)?r.unitX:this.cross(r.unitX).normalized():this.cross(r.unitZ.times(-1)).normalized()}extend(e,t){return this.plus(t.normalized().times(e))}lerp(e,t){return this.times(1-t).plus(e.times(t))}zip(e,t){return r.of(t(e.x,this.x),t(e.y,this.y),t(e.z,this.z))}map(e){return r.of(e(this.x,0),e(this.y,1),e(this.z,2))}asArray(){return[this.x,this.y,this.z]}eq(e,t=1e-10){return Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t&&Math.abs(e.z-this.z)<=t}toString(){return`Vec(${this.x}, ${this.y}, ${this.z})`}}class n{constructor(e,t){this.x=e,this.y=t}get z(){return 0}get xy(){return{x:this.x,y:this.y}}at(e){if(0===e)return this.x;if(1===e)return this.y;if(2===e)return 0;throw new Error(`${e} out of bounds!`)}length(){return this.magnitude()}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}magnitudeSquared(){return this.x*this.x+this.y*this.y}squareDistanceTo(e){const t=this.x-e.x,o=this.y-e.y;return t*t+o*o+e.z*e.z}distanceTo(e){return Math.sqrt(this.squareDistanceTo(e))}maximumEntryMagnitude(){return Math.max(Math.abs(this.x),Math.abs(this.y))}angle(){return Math.atan2(this.y,this.x)}normalized(){const e=this.magnitude();return i.of(this.x/e,this.y/e)}normalizedOrZero(){return this.eq(r.zero)?r.zero:this.normalized()}times(e){return i.of(this.x*e,this.y*e)}plus(e){return r.of(this.x+e.x,this.y+e.y,e.z)}minus(e){return r.of(this.x-e.x,this.y-e.y,-e.z)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return r.of(this.y*e.z,-this.x*e.z,this.x*e.y-e.x*this.y)}scale(e){return"number"==typeof e?this.times(e):i.of(this.x*e.x,this.y*e.y)}orthog(){return 0===this.dot(r.unitX)&&0===this.dot(r.unitY)?0===this.dot(r.unitX)?r.unitX:this.cross(r.unitX).normalized():this.cross(r.unitZ.times(-1)).normalized()}extend(e,t){return this.plus(t.normalized().times(e))}lerp(e,t){return this.times(1-t).plus(e.times(t))}zip(e,t){return r.of(t(e.x,this.x),t(e.y,this.y),t(e.z,0))}map(e){return r.of(e(this.x,0),e(this.y,1),e(0,2))}asArray(){return[this.x,this.y,0]}eq(e,t=1e-10){return Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t&&Math.abs(e.z)<=t}toString(){return`Vec(${this.x}, ${this.y})`}}var i,r;!function(e){e.of=(e,t)=>new n(e,t),e.ofXY=({x:t,y:o})=>e.of(t,o),e.unitX=e.of(1,0),e.unitY=e.of(0,1),e.zero=e.of(0,0)}(i||(t.Vec2=i={})),function(e){e.of=(e,t,n)=>0===n?i.of(e,t):new o(e,t,n),e.unitX=i.unitX,e.unitY=i.unitY,e.zero=i.zero,e.unitZ=e.of(0,0,1)}(r||(t.Vec3=r={})),t.default=r},3755:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),t.Color4=t.Vec3=t.Vec2=t.Mat33=t.Abstract2DShape=t.QuadraticBezier=t.Parameterized2DShape=t.Rect2=t.PathCommandType=t.comparePathIndices=t.stepPathIndexBy=t.Path=t.LineSegment2=void 0;var r=o(472);Object.defineProperty(t,"LineSegment2",{enumerable:!0,get:function(){return r.LineSegment2}});var s=o(5372);Object.defineProperty(t,"Path",{enumerable:!0,get:function(){return s.Path}}),Object.defineProperty(t,"stepPathIndexBy",{enumerable:!0,get:function(){return s.stepCurveIndexBy}}),Object.defineProperty(t,"comparePathIndices",{enumerable:!0,get:function(){return s.compareCurveIndices}}),Object.defineProperty(t,"PathCommandType",{enumerable:!0,get:function(){return s.PathCommandType}});var a=o(4243);Object.defineProperty(t,"Rect2",{enumerable:!0,get:function(){return a.Rect2}});var l=o(535);Object.defineProperty(t,"Parameterized2DShape",{enumerable:!0,get:function(){return l.Parameterized2DShape}});var c=o(4634);Object.defineProperty(t,"QuadraticBezier",{enumerable:!0,get:function(){return c.QuadraticBezier}});var d=o(2102);Object.defineProperty(t,"Abstract2DShape",{enumerable:!0,get:function(){return d.Abstract2DShape}});var h=o(4432);Object.defineProperty(t,"Mat33",{enumerable:!0,get:function(){return h.Mat33}});var u=o(7134);Object.defineProperty(t,"Vec2",{enumerable:!0,get:function(){return u.Vec2}});var p=o(6797);Object.defineProperty(t,"Vec3",{enumerable:!0,get:function(){return p.Vec3}});var f=o(9283);Object.defineProperty(t,"Color4",{enumerable:!0,get:function(){return f.Color4}}),i(o(5822),t)},9044:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,o)=>{if(0===e){let e;return e=0===t?0===o?0:NaN:-o/t,[e,e]}const n=t*t-4*e*o;if(n<0)return[NaN,NaN];const i=Math.sqrt(n),r=(-t+i)/(2*e),s=(-t-i)/(2*e);return r>s?[r,s]:[s,r]}},2472:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUpNumber=void 0,t.cleanUpNumber=e=>{if(e.indexOf("e")>0&&e.match(/[eE][-]\d{2,}$/))return"0";const t=e.charAt(e.length-1);"0"!==t&&"."!==t||(e=(e=(e=e.replace(/([.]\d*[^0])0+$/,"$1")).replace(/[.]0+$/,".")).replace(/[.]$/,""));const o=e.charAt(0);return"0"!==o&&"-"!==o||(e=(e=(e=e.replace(/^(0+)[.]/,".")).replace(/^-(0+)[.]/,"-.")).replace(/^(-?)0+$/,"$10")),"-0"===e?"0":e},t.default=t.cleanUpNumber},284:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.numberRegex=void 0,t.numberRegex=/^([-]?)(\d*)[.](\d+)$/},9003:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLenAfterDecimal=void 0;const n=o(284);t.getLenAfterDecimal=e=>{const t=n.numberRegex.exec(e);return t?t[3].length:-1!==e.search(/[eE]/)||/^[a-zA-Z]+$/.exec(e)?-1:0},t.default=t.getLenAfterDecimal},5822:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toRoundedString=void 0;var n=o(7330);Object.defineProperty(t,"toRoundedString",{enumerable:!0,get:function(){return n.toRoundedString}})},7330:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toRoundedString=void 0;const i=n(o(2472));t.toRoundedString=e=>{let t=e.toString(10);if(-1===t.indexOf("."))return t;const o=/^([-]?)(\d*)\.(\d{3,}9{4,})\d{1,4}$/.exec(t);if(o){const e=o[1],n=o[3],i=parseInt(n.charAt(n.length-1),10),r=parseInt(n,10),s=parseInt(o[2],10),a=o[3];let l=(r+10-i).toString(),c=0;for(l.length>r.toString().length&&(l=l.substring(1),c=1);l.length<a.length;)l=c.toString(10)+l,c=0;t=`${e+(s+c).toString()}.${l}`}return t=t.replace(/^([-]?\d*\.\d{3,})0{4,}\d{1,4}$/,"$1"),(0,i.default)(t)},t.default=t.toRoundedString},4400:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toStringOfSamePrecision=void 0;const i=n(o(2472)),r=o(284),s=n(o(9003)),a=n(o(7330));t.toStringOfSamePrecision=(e,...t)=>{const o=e.toString(10),n=r.numberRegex.exec(o);if(!n)return o;let l=-1;for(const e of t)l=Math.max((0,s.default)(e),l);if(-1===l)return(0,a.default)(e);let c=n[3].substring(0,l),d=n[2];const h=n[3].charAt(l);if(""!==h&&parseInt(h,10)>=5){if(c.length>0){const e=/^(0+)(\d*)$/.exec(c);let t="",o=c;e&&(t=e[1],o=e[2]),c=(parseInt(c)+1).toString(),c.length>o.length&&t.length>0&&(t=t.substring(1)),c=t+c}(0===c.length||c.length>l)&&(d=(parseInt(d)+1).toString(),c=c.substring(1))}const u=n[1];return(0,i.default)(`${u}${d}.${c}`)},t.default=t.toStringOfSamePrecision},2102:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Abstract2DShape=void 0;class o{distance(e){return Math.abs(this.signedDistance(e))}containsPoint(e,t=o.smallValue){return this.signedDistance(e)<t}getLooseBoundingBox(){return this.getTightBoundingBox()}}t.Abstract2DShape=o,o.smallValue=1e-12,t.default=o},52:function(e,t,o){"use strict";var n,i=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},r=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BezierJSWrapper=void 0;const a=o(1434),l=o(7134),c=s(o(472)),d=s(o(4243)),h=s(o(535));class u extends h.default{constructor(e){super(),n.set(this,null),e&&i(this,n,e,"f")}getBezier(){return r(this,n,"f")||i(this,n,new a.Bezier(this.getPoints().map((e=>e.xy))),"f"),r(this,n,"f")}signedDistance(e){return this.nearestPointTo(e).point.distanceTo(e)}distance(e){return this.signedDistance(e)}at(e){return l.Vec2.ofXY(this.getBezier().get(e))}derivativeAt(e){return l.Vec2.ofXY(this.getBezier().derivative(e))}secondDerivativeAt(e){return l.Vec2.ofXY(this.getBezier().dderivative(e))}normal(e){return l.Vec2.ofXY(this.getBezier().normal(e))}normalAt(e){return this.normal(e)}tangentAt(e){return this.derivativeAt(e).normalized()}getTightBoundingBox(){const e=this.getBezier().bbox(),t=e.x.max-e.x.min,o=e.y.max-e.y.min;return new d.default(e.x.min,e.y.min,t,o)}argIntersectsLineSegment(e){const t=c.default.ofSmallestContainingPoints(this.getPoints());return t?t.intersectsLineSegment(e).map((e=>this.nearestPointTo(e).parameterValue)):this.getBezier().intersects(e).map((t=>{"string"==typeof t&&(t=parseFloat(t));const o=l.Vec2.ofXY(this.at(t));return o.distanceTo(e.p1)>e.length||o.distanceTo(e.p2)>e.length?null:t})).filter((e=>null!==e))}splitAt(e){if(e<=0||e>=1)return[this];const t=this.getBezier().split(e);return[new p(t.left.points.map((e=>l.Vec2.ofXY(e))),t.left),new p(t.right.points.map((e=>l.Vec2.ofXY(e))),t.right)]}nearestPointTo(e){const t=t=>e.squareDistanceTo(this.at(t)),o=t(0);let n=0,i=o;for(let e=0;e<4;e++){const o=e/3,r=t(o);r<i&&(n=o,i=r)}const r=t=>{const o=this.at(t),n=this.derivativeAt(t),i=this.secondDerivativeAt(t);return 2*n.x*n.x+2*o.x*i.x-2*e.x*i.x+2*n.y*n.y+2*o.y*i.y-2*e.y*i.y},s=t=>{const o=this.at(t),n=this.derivativeAt(t);return 2*o.x*n.x-2*e.x*n.x+2*o.y*n.y-2*e.y*n.y},a=()=>{const e=r(n);if(0===e)return;const t=(0-s(n))/e+n;n=t,n>1?n=1:n<0&&(n=0)};for(let e=0;e<12;e++)a();return{parameterValue:n,point:this.at(n)}}intersectsBezier(e){const t=this.getBezier().intersects(e.getBezier());if(!t||0===t.length)return[];const o=[];for(const e of t){const n=/^([-0-9.eE]+)\/([-0-9.eE]+)$/.exec(e);if(!n)throw new Error(`Incorrect format returned by .intersects: ${t} should be array of "number/number"!`);const i=parseFloat(n[1]);o.push({parameterValue:i,point:this.at(i)})}return o}toString(){return`Bézier(${this.getPoints().map((e=>e.toString())).join(", ")})`}}t.BezierJSWrapper=u,n=new WeakMap;class p extends u{constructor(e,t){super(t),this.controlPoints=e}getPoints(){return this.controlPoints}}t.default=u},2770:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(52)),r=n(o(4243));class s extends i.default{constructor(e,t,o,n){super(),this.p0=e,this.p1=t,this.p2=o,this.p3=n}getPoints(){return[this.p0,this.p1,this.p2,this.p3]}getLooseBoundingBox(){return r.default.bboxOf([this.p0,this.p1,this.p2,this.p3])}}t.default=s},472:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LineSegment2=void 0;const i=n(o(4243)),r=o(7134),s=n(o(535));class a extends s.default{constructor(e,t){super(),this.point1=e,this.point2=t,this.bbox=i.default.bboxOf([e,t]),this.direction=t.minus(e),this.length=this.direction.magnitude(),this.length>0&&(this.direction=this.direction.times(1/this.length))}static ofSmallestContainingPoints(e){if(e.length<=1)return null;const t=[...e].sort(((e,t)=>e.x!==t.x?e.x-t.x:e.y-t.y)),o=new a(t[0],t[t.length-1]);for(const e of t)if(!o.containsPoint(e))return null;return o}get p1(){return this.point1}get p2(){return this.point2}get center(){return this.point1.lerp(this.point2,.5)}get(e){return this.point1.plus(this.direction.times(e))}at(e){return this.get(e*this.length)}normalAt(e){return this.direction.orthog()}tangentAt(e){return this.direction}splitAt(e){return e<=0||e>=1?[this]:[new a(this.point1,this.at(e)),new a(this.at(e),this.point2)]}intersection(e){let t,o;if(Math.abs(this.direction.x)<4e-13){if(0===e.direction.x||0===this.direction.y)return null;const n=this.point1.x,i=(this.point1.x-e.point1.x)*e.direction.y/e.direction.x+e.point1.y;t=r.Vec2.of(n,i),o=(i-this.point1.y)/this.direction.y}else{const n=(this.point1.y-e.point1.y)*this.direction.x*e.direction.x+this.direction.x*e.direction.y*e.point1.x-this.direction.y*e.direction.x*this.point1.x,i=e.direction.y*this.direction.x-this.direction.y*e.direction.x;if(0===i)return null;const s=n/i,a=(s-this.point1.x)/this.direction.x,l=this.point1.y+this.direction.y*a;t=r.Vec2.of(s,l),o=(s-this.point1.x)/this.direction.x}const n=t.distanceTo(this.point1),i=t.distanceTo(this.point2),s=t.distanceTo(e.point1),a=t.distanceTo(e.point2);return n>this.length||i>this.length||s>e.length||a>e.length?null:{point:t,t:o}}intersects(e){return null!==this.intersection(e)}argIntersectsLineSegment(e){const t=this.intersection(e);return t?[t.t/this.length]:[]}intersectsLineSegment(e){const t=this.intersection(e);return t?[t.point]:[]}closestPointTo(e){return this.nearestPointTo(e).point}nearestPointTo(e){const t=e.minus(this.p1).dot(this.direction),o=this.length-t,n=this.p1.plus(this.direction.times(t));return t>0&&t<this.length?{point:n,parameterValue:t/this.length}:Math.abs(o)<Math.abs(t)?{point:this.p2,parameterValue:1}:{point:this.p1,parameterValue:0}}signedDistance(e){return this.closestPointTo(e).minus(e).magnitude()}transformedBy(e){return new a(e.transformVec2(this.p1),e.transformVec2(this.p2))}getTightBoundingBox(){return this.bbox}toString(){return`LineSegment(${this.p1.toString()}, ${this.p2.toString()})`}eq(e,t){if(!(e instanceof a))return!1;const o=t?.tolerance,n=t?.ignoreDirection??!0;return e.p1.eq(this.p1,o)&&e.p2.eq(this.p2,o)||n&&e.p1.eq(this.p2,o)&&e.p2.eq(this.p1,o)}}t.LineSegment2=a,t.default=a},535:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameterized2DShape=void 0;const i=n(o(2102));class r extends i.default{intersectsLineSegment(e){return this.argIntersectsLineSegment(e).map((e=>this.at(e)))}}t.Parameterized2DShape=r,t.default=r},5372:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Path=t.stepCurveIndexBy=t.compareCurveIndices=t.PathCommandType=void 0;const i=n(o(472)),r=n(o(4243)),s=o(7134),a=n(o(2770)),l=n(o(4634)),c=n(o(3598)),d=n(o(7330)),h=n(o(4400)),u=n(o(4973));var p;!function(e){e[e.LineTo=0]="LineTo",e[e.MoveTo=1]="MoveTo",e[e.CubicBezierTo=2]="CubicBezierTo",e[e.QuadraticBezierTo=3]="QuadraticBezierTo"}(p||(t.PathCommandType=p={})),t.compareCurveIndices=(e,t)=>{const o=e.curveIndex-t.curveIndex;return 0===o?e.parameterValue-t.parameterValue:o},t.stepCurveIndexBy=(e,t)=>e.parameterValue+t>1?{curveIndex:e.curveIndex+1,parameterValue:e.parameterValue+t-1}:e.parameterValue+t<0?0===e.curveIndex?{curveIndex:0,parameterValue:0}:{curveIndex:e.curveIndex-1,parameterValue:e.parameterValue+t+1}:{curveIndex:e.curveIndex,parameterValue:e.parameterValue+t};class f{constructor(e,t){this.startPoint=e,this.cachedGeometry=null,this.cachedPolylineApproximation=null,this.cachedStringVersion=null,this.parts=t,this.bbox=r.default.bboxOf([e]);for(const t of this.parts)this.bbox=this.bbox.union(f.computeBBoxForSegment(e,t))}getExactBBox(){const e=[];for(const t of this.geometry)e.push(t.getTightBoundingBox());return r.default.union(...e)}get geometry(){if(this.cachedGeometry)return this.cachedGeometry;let e=this.startPoint;const t=[];for(const o of this.parts){let n;switch(o.kind){case p.CubicBezierTo:t.push(new a.default(e,o.controlPoint1,o.controlPoint2,o.endPoint)),e=o.endPoint;break;case p.QuadraticBezierTo:t.push(new l.default(e,o.controlPoint,o.endPoint)),e=o.endPoint;break;case p.LineTo:t.push(new i.default(e,o.point)),e=o.point;break;case p.MoveTo:t.push(new c.default(o.point)),e=o.point;break;default:return n=o,n}}return this.cachedGeometry=t,this.cachedGeometry}*startEndPoints(){yield this.startPoint;for(const e of this.parts){let t;switch(e.kind){case p.CubicBezierTo:case p.QuadraticBezierTo:yield e.endPoint;break;case p.LineTo:case p.MoveTo:yield e.point;break;default:return t=e,t}}}polylineApproximation(){if(this.cachedPolylineApproximation)return this.cachedPolylineApproximation;const e=[];for(const t of this.parts)switch(t.kind){case p.CubicBezierTo:e.push(t.controlPoint1,t.controlPoint2,t.endPoint);break;case p.QuadraticBezierTo:e.push(t.controlPoint,t.endPoint);break;case p.MoveTo:case p.LineTo:e.push(t.point)}const t=[];let o=this.startPoint;for(const n of e)t.push(new i.default(o,n)),o=n;return t}static computeBBoxForSegment(e,t){const o=[e];let n;switch(t.kind){case p.MoveTo:case p.LineTo:o.push(t.point);break;case p.CubicBezierTo:o.push(t.controlPoint1,t.controlPoint2,t.endPoint);break;case p.QuadraticBezierTo:o.push(t.controlPoint,t.endPoint);break;default:return n=t,n}return r.default.bboxOf(o)}signedDistance(e,t){let o=1/0;for(const n of this.geometry){const i=n.signedDistance(e)-t;i<o&&(o=i)}return o}raymarchIntersectionWith(e,t,o=[]){if(!e.bbox.intersects(this.bbox.grownBy(t)))return[];const n=e.length,i=[];for(const o of this.geometry){const r=o.getTightBoundingBox().grownBy(t);if(!r.intersects(e.bbox))continue;const s=e=>o.signedDistance(e),a=e=>s(e)-t;a(e.p1)>n&&a(e.p2)>n||i.push({part:o,distFn:s,bbox:r})}if(0===i.length)return[];const r=e=>{let o=1/0,n=null;const r=[];for(const t of i){const{part:i,distFn:s,bbox:a}=t;if(!a.containsPoint(e)){r.push(t);continue}const l=s(e);l<=o&&(o=l,n=i)}for(const{part:t,distFn:i,bbox:s}of r){if(isFinite(o)&&!s.grownBy(o).containsPoint(e))continue;const r=i(e);r<=o&&(o=r,n=t)}return[n,o-t]},s=[e.p1,...o,e.p2],a=t=>t.minus(e.p1).dot(e.direction);s.sort(((e,t)=>a(e)-a(t)));const l=[],c=t/1e3,d=(o,i,s)=>{let d=o,[h,u]=r(d),p=a(d);if(u>n)return p;const f=e.direction.times(i);for(let e=0;e<8;e++){const e=u;if(d=d.plus(f.times(e)),p=a(d),p<=s)return p;const[t,o]=r(d);if(Math.abs(o)>Math.abs(u))return null;if(u=o,h=t,Math.abs(u)<c)break}if(h&&p>=0&&p<=n&&Math.abs(u)<c){l.push({point:d,parameterValue:h.nearestPointTo(d).parameterValue,curve:h,curveIndex:this.geometry.indexOf(h)});const o=t/20/e.length;p+=isFinite(o)?o:0}return p};let h=0;for(let e=0;e<s.length;e++){const t=s[e];h=Math.max(h,d(t,1,h)??h),h=Math.max(h,d(t,-1,h)??h)}return l}intersection(e,t){let o=[];if(!e.bbox.intersects(this.bbox.grownBy(t??0)))return[];if(0===this.parts.length)return new f(this.startPoint,[{kind:p.MoveTo,point:this.startPoint}]).intersection(e,t);let n=0;for(const t of this.geometry){const i=t.argIntersectsLineSegment(e);for(const e of i)o.push({curve:t,curveIndex:n,point:t.at(e),parameterValue:e});n++}if(t&&t>1e-8){const n=o.map((e=>e.point));o=this.raymarchIntersectionWith(e,t,n)}return o}nearestPointTo(e){let t=1/0,o=0,n=0,i=this.startPoint;for(let r=0;r<this.geometry.length;r++){const s=this.geometry[r].nearestPointTo(e),a=s.point.squareDistanceTo(e);(0===r||a<t)&&(o=r,t=a,n=s.parameterValue,i=s.point)}return{curve:this.geometry[o],curveIndex:o,parameterValue:n,point:i}}at(e){return 0===e.curveIndex&&0===e.parameterValue?this.startPoint:this.geometry[e.curveIndex].at(e.parameterValue)}tangentAt(e){return this.geometry[e.curveIndex].tangentAt(e.parameterValue)}splitNear(e,t){const o=this.nearestPointTo(e);return this.splitAt(o,t)}spliced(e,t,o,n){if(r=t,(i=e).curveIndex<r.curveIndex||i.curveIndex===r.curveIndex&&i.parameterValue<=r.parameterValue){const i=this.splitAt(e,n),r=this.splitAt(t,n),s=i[0],a=r[r.length-1];return o?s.union(o).union(a):s.union(a)}{const i=this.splitAt([e],n)[0].splitNear(this.at(t),n),r=i[i.length-1];return o?r.union(o):r}var i,r}splitAt(e,o){for(Array.isArray(e)||(e=[e]),(e=[...e]).sort(t.compareCurveIndices);e.length>0&&e[e.length-1].curveIndex>=this.parts.length-1&&e[e.length-1].parameterValue>=1;)e.pop();for(e.reverse();e.length>0&&e[e.length-1].curveIndex<=0&&e[e.length-1].parameterValue<=0;)e.pop();if(0===e.length||0===this.parts.length)return[this];const n=e.length+1,i=o?.mapNewPoint??(e=>e),r=[];let s=this.startPoint,a=[],{curveIndex:l,parameterValue:c}=e.pop();for(let t=0;t<this.parts.length;t++)if(t!==l)a.push(this.parts[t]);else{let o=this.parts[t],n=this.geometry[t];for(;t===l;){let d;const h=[];switch(o.kind){case p.MoveTo:a.push({kind:o.kind,point:o.point}),d=o.point;break;case p.LineTo:{const e=n.splitAt(c);a.push({kind:o.kind,point:i(e[0].p2)}),d=e[0].p2,e.length>1&&(console.assert(2===e.length),h.push({kind:o.kind,point:e[1].p2}),n=e[1])}break;case p.QuadraticBezierTo:case p.CubicBezierTo:{const e=n.splitAt(c);let t=2===e.length;for(const r of e){n=r;const e=t?a:h,s=r.getPoints();o.kind===p.CubicBezierTo?e.push({kind:o.kind,controlPoint1:i(s[1]),controlPoint2:i(s[2]),endPoint:i(s[3])}):e.push({kind:o.kind,controlPoint:i(s[1]),endPoint:i(s[2])}),t||(d=s[0]),t=!1}}break;default:return o}r.push(new f(s,[...a])),s=i(d),console.assert(!!s,"should have a start point"),a=h,o=h[h.length-1]??o;const u=e.pop();if(!u)break;if(l=u.curveIndex,t===l){const e=this.at(u);c=n.nearestPointTo(e).parameterValue,a=[]}else c=u.parameterValue}}return r.push(new f(s,a)),console.assert(r.length===n,`should split into splitAt.length + 1 splits (was ${r.length}, expected ${n})`),r}asClosed(){const e=[];let t=!1;for(const o of this.parts)o.kind===p.MoveTo?(e.push({kind:p.LineTo,point:o.point}),t=!0):e.push(o);if(this.getEndPoint().eq(this.startPoint)||(e.push({kind:p.LineTo,point:this.startPoint}),t=!0),!t)return this;const o=new f(this.startPoint,e);return console.assert(o.getEndPoint().eq(o.startPoint)),o}static mapPathCommand(e,t){switch(e.kind){case p.MoveTo:case p.LineTo:return{kind:e.kind,point:t(e.point)};case p.CubicBezierTo:return{kind:e.kind,controlPoint1:t(e.controlPoint1),controlPoint2:t(e.controlPoint2),endPoint:t(e.endPoint)};case p.QuadraticBezierTo:return{kind:e.kind,controlPoint:t(e.controlPoint),endPoint:t(e.endPoint)}}return e}mapPoints(e){const t=e(this.startPoint),o=[];for(const t of this.parts)o.push(f.mapPathCommand(t,e));return new f(t,o)}transformedBy(e){return e.isIdentity()?this:this.mapPoints((t=>e.transformVec2(t)))}closedContainsPoint(e){const t=this.getExactBBox();if(!t.containsPoint(e))return!1;const o=e.plus(s.Vec2.of(t.width,0)),n=this.asClosed(),r=new i.default(e,o),a=n.intersection(r);return a.filter(((e,t)=>0===t||!(a[t-1].parameterValue>=1&&e.parameterValue<=0))).length%2==1}closedContainsRect(e){if(!this.bbox.containsRect(e))return!1;if(!e.corners.every((e=>this.closedContainsPoint(e))))return!1;for(const t of e.getEdges())if(this.intersection(t).length)return!1;return!0}union(e,t={allowReverse:!0}){if(!e)return this;if(Array.isArray(e))return new f(this.startPoint,[...this.parts,...e]);let o=[];if(this.getEndPoint().eq(e.startPoint))o=this.parts.concat(e.parts);else{if(t.allowReverse&&this.startPoint.eq(e.getEndPoint()))return e.union(this,{allowReverse:!1});if(t.allowReverse&&this.startPoint.eq(e.startPoint))return this.union(e.reversed(),{allowReverse:!1});o=[...this.parts,{kind:p.MoveTo,point:e.startPoint},...e.parts]}return new f(this.startPoint,o)}reversed(){const e=this.getEndPoint(),t=[];let o=this.startPoint;for(const e of this.parts)switch(e.kind){case p.LineTo:case p.MoveTo:t.push({kind:e.kind,point:o}),o=e.point;break;case p.CubicBezierTo:t.push({kind:e.kind,controlPoint1:e.controlPoint2,controlPoint2:e.controlPoint1,endPoint:o}),o=e.endPoint;break;case p.QuadraticBezierTo:t.push({kind:e.kind,controlPoint:e.controlPoint,endPoint:o}),o=e.endPoint;break;default:return e}return t.reverse(),new f(e,t)}getEndPoint(){if(0===this.parts.length)return this.startPoint;const e=this.parts[this.parts.length-1];return e.kind===p.QuadraticBezierTo||e.kind===p.CubicBezierTo?e.endPoint:e.point}roughlyIntersects(e,t=0){if(0===this.parts.length)return e.containsPoint(this.startPoint);if(this.startPoint.eq(this.getEndPoint())&&0===t)return this.closedRoughlyIntersects(e);if(e.containsRect(this.bbox))return!0;let o=this.startPoint;for(const n of this.parts){const i=f.computeBBoxForSegment(o,n).grownBy(t);if(o=n.kind===p.LineTo||n.kind===p.MoveTo?n.point:n.endPoint,e.intersects(i))return!0}return!1}closedRoughlyIntersects(e){if(e.containsRect(this.bbox))return!0;const t=this.bbox.topLeft.minus(s.Vec2.of(1,1)),o=e.corners,n=this.polylineApproximation();for(const e of o){const o=new i.default(e,t);let r=0;for(const e of n)e.intersects(o)&&r++;if(r%2==1)return!0}const r=e.grownBy(Math.min(e.size.x,e.size.y)),a=[];for(const e of r.divideIntoGrid(4,4))a.push(...e.getEdges());for(const e of a)for(const t of n)if(e.intersects(t))return!0;return!1}eq(e,t){if(e.parts.length!==this.parts.length)return!1;for(let o=0;o<this.parts.length;o++){const n=this.parts[o],i=e.parts[o];switch(n.kind){case p.LineTo:case p.MoveTo:if(n.kind!==i.kind)return!1;if(!n.point.eq(i.point,t))return!1;break;case p.CubicBezierTo:if(n.kind!==i.kind)return!1;if(!n.controlPoint1.eq(i.controlPoint1,t)||!n.controlPoint2.eq(i.controlPoint2,t)||!n.endPoint.eq(i.endPoint,t))return!1;break;case p.QuadraticBezierTo:if(n.kind!==i.kind)return!1;if(!n.controlPoint.eq(i.controlPoint,t)||!n.endPoint.eq(i.endPoint,t))return!1;break;default:return n}}return!0}static fromRect(e,t=null){const o=[];let n,i;if(null!==t){const o=s.Vec2.of(t,t).times(.5),a=r.default.fromCorners(e.topLeft.plus(o),e.bottomRight.minus(o)),l=r.default.fromCorners(e.topLeft.minus(o),e.bottomRight.plus(o));n=[a.corners[3],...a.corners,...l.corners.reverse()],i=l.corners[3]}else n=e.corners.slice(1),i=e.corners[0];for(const e of n)o.push({kind:p.LineTo,point:e});return o.push({kind:p.LineTo,point:i}),new f(i,o)}toString(e,t=!1){if(this.cachedStringVersion&&!t)return this.cachedStringVersion;void 0===e&&(e=Math.abs(this.bbox.topLeft.x)>10&&Math.abs(this.bbox.topLeft.y)>10);const o=f.toString(this.startPoint,this.parts,!e);return this.cachedStringVersion=o,o}serialize(){return this.toString()}static toString(e,t,o){const n=[];let i;const r=(e,...t)=>{const r=[],s=[],a=!i||o,l=i?(0,d.default)(i.x):"",c=i?(0,d.default)(i.y):"";for(const e of t){const t=(0,d.default)(e.x),o=(0,d.default)(e.y);if(a)r.push(`${t},${o}`);else{const n=(0,h.default)(e.x-i.x,t,l,c),r=(0,h.default)(e.y-i.y,o,l,c);"-"===r.charAt(0)?s.push(`${n}${r}`):s.push(`${n},${r}`)}}let u;u=a?`${e}${r.join(" ")}`:`${e.toLowerCase()}${s.join(" ")}`,"l0,0"!==u&&"m0,0"!==u&&(n.push(u),t.length>0&&(i=t[t.length-1]))};let s;t[0]?.kind!==p.MoveTo&&r("M",e);for(let e=0;e<t.length;e++){const o=t[e];switch(o.kind){case p.MoveTo:r("M",o.point);break;case p.LineTo:r("L",o.point);break;case p.CubicBezierTo:r("C",o.controlPoint1,o.controlPoint2,o.endPoint);break;case p.QuadraticBezierTo:r("Q",o.controlPoint,o.endPoint);break;default:return s=o,s}}return n.join("")}static fromString(e){e=e.split("\n").join(" ");let t=s.Vec2.zero,o=null,n=null,i=!0;const r=[],a=e=>{i?i=!1:r.push({kind:p.LineTo,point:e})},l={m:1,l:1,c:3,q:2,z:0,h:1,v:1},c=/([MZLHVCSQTA])\s*([^MZLHVCSQTA]*)/gi;let d;for(;null!==(d=c.exec(e));){const e=d[2].trim().split(/[^0-9Ee.-]/).filter((e=>e.length>0)).reduce(((e,t)=>{const o=(t=t.replace(/([^eE])[-]/g,"$1 -")).split(" -");return""!==o[0]&&e.push(o[0]),e.push(...o.slice(1).map((e=>`-${e}`))),e}),[]);let c=e.map((e=>parseFloat(e))),f=d[1].toLowerCase(),y=d[1]!==f;if("v"===f||"h"===f)c=c.reduce(((e,o)=>"v"===f?e.concat(y?t.x:0,o):e.concat(o,y?t.y:0)),[]),f="l";else if("z"===f){if(!o)continue;c=[o.x,o.y],o=t,y=!0,f="l"}const w=l[f]??0,x=c.reduce(((e,t,o,n)=>{if(o%2!=0){const i=t,r=n[o-1];return e.concat(s.Vec2.of(r,i))}return e}),[]).map(((e,o)=>{let n;return n=y?e:t.plus(e),(o+1)%w==0&&(t=n),n}));if(x.length%w!=0)throw new Error([`Incorrect number of arguments: got ${JSON.stringify(x)} with a length of ${x.length} ≠ ${w}k, k ∈ ℤ.`,`The number of arguments to ${f} must be a multiple of ${w}!`,`Command: ${d[0]}`].join("\n"));for(let e=0;e<x.length;e+=w){const t=x.slice(e,e+w);switch(f.toLowerCase()){case"m":0===e?(v=t[0],i?i=!1:r.push({kind:p.MoveTo,point:v})):a(t[0]);break;case"l":a(t[0]);break;case"c":m=t[0],g=t[1],b=t[2],r.push({kind:p.CubicBezierTo,controlPoint1:m,controlPoint2:g,endPoint:b});break;case"q":h=t[0],u=t[1],r.push({kind:p.QuadraticBezierTo,controlPoint:h,endPoint:u});break;default:throw new Error(`Unknown path command ${f}`)}i=!1}x.length>0&&(o??=x[0],n??=o,t=x[x.length-1])}var h,u,m,g,b,v;const y=new f(n??s.Vec2.zero,r);return y.cachedStringVersion=e,y}static fromConvexHullOf(e){if(0===e.length)return f.empty;const t=(0,u.default)(e),o=t.slice(1).map((e=>({kind:p.LineTo,point:e})));return o.push({kind:p.LineTo,point:t[0]}),new f(t[0],o)}}t.Path=f,f.empty=new f(s.Vec2.zero,[]),t.default=f},3598:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(7134),r=n(o(535)),s=n(o(4243));class a extends r.default{constructor(e){super(),this.p=e}signedDistance(e){return this.p.distanceTo(e)}argIntersectsLineSegment(e,t){return e.containsPoint(this.p,t)?[0]:[]}getTightBoundingBox(){return new s.default(this.p.x,this.p.y,0,0)}at(e){return this.p}normalAt(e){return i.Vec2.unitY}tangentAt(e){return i.Vec2.unitX}splitAt(e){return[this]}nearestPointTo(e){return{point:this.p,parameterValue:0}}}t.default=a},4634:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.QuadraticBezier=void 0;const i=o(7134),r=n(o(9044)),s=n(o(52)),a=n(o(4243));class l extends s.default{constructor(e,t,o){super(),this.p0=e,this.p1=t,this.p2=o}static componentAt(e,t,o,n){return t+e*(-2*t+2*o)+e*e*(t-2*o+n)}static derivativeComponentAt(e,t,o,n){return-2*t+2*o+2*e*(t-2*o+n)}static secondDerivativeComponentAt(e,t,o,n){return 2*(t-2*o+n)}at(e){if(0===e)return this.p0;if(1===e)return this.p2;const t=this.p0,o=this.p1,n=this.p2;return i.Vec2.of(l.componentAt(e,t.x,o.x,n.x),l.componentAt(e,t.y,o.y,n.y))}derivativeAt(e){const t=this.p0,o=this.p1,n=this.p2;return i.Vec2.of(l.derivativeComponentAt(e,t.x,o.x,n.x),l.derivativeComponentAt(e,t.y,o.y,n.y))}secondDerivativeAt(e){const t=this.p0,o=this.p1,n=this.p2;return i.Vec2.of(l.secondDerivativeComponentAt(e,t.x,o.x,n.x),l.secondDerivativeComponentAt(e,t.y,o.y,n.y))}normal(e){return this.derivativeAt(e).orthog().normalized()}getLooseBoundingBox(){return a.default.bboxOf([this.p0,this.p1,this.p2])}approximateDistance(e){const t=this.p0.x-e.x,o=-2*this.p0.x+2*this.p1.x,n=this.p0.x-2*this.p1.x+this.p2.x,i=this.p0.y-e.y,s=-2*this.p0.y+2*this.p1.y,a=this.p0.y-2*this.p1.y+this.p2.y,l=2*t*o+2*i*s-e.x*o-e.y*s,c=2*o*o+2*s*s+2*n*t+2*a*i-e.x*n-e.y*a,d=2*(2*s*a+2*o*n+2*n*o+2*a*s);let[h,u]=(0,r.default)(d/2,c,l);isNaN(h)&&(h=.25),isNaN(u)&&(u=.75);const p=this.at(h),f=this.at(u),m=p.squareDistanceTo(e),g=f.squareDistanceTo(e),b=this.at(0).squareDistanceTo(e),v=this.at(1).squareDistanceTo(e);return Math.sqrt(Math.min(m,g,b,v))}getPoints(){return[this.p0,this.p1,this.p2]}}t.QuadraticBezier=l,t.default=l},4243:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Rect2=void 0;const i=n(o(472)),r=n(o(4432)),s=o(7134),a=n(o(2102));class l extends a.default{constructor(e,t,o,n){super(),this.x=e,this.y=t,this.w=o,this.h=n,o<0&&(this.x+=o,this.w=Math.abs(o)),n<0&&(this.y+=n,this.h=Math.abs(n)),this.topLeft=s.Vec2.of(this.x,this.y),this.size=s.Vec2.of(this.w,this.h),this.area=this.w*this.h}translatedBy(e){return new l(e.x+this.x,e.y+this.y,this.w,this.h)}resizedTo(e){return new l(this.x,this.y,e.x,e.y)}containsPoint(e){return this.x<=e.x&&this.y<=e.y&&this.x+this.w>=e.x&&this.y+this.h>=e.y}containsRect(e){return this.x<=e.x&&this.y<=e.y&&this.x+this.w>=e.x+e.w&&this.y+this.h>=e.y+e.h}intersects(e){const t=this.x,o=t+this.w,n=e.x,i=e.x+e.w;if(o<n||t>i)return!1;const r=this.y,s=r+this.h,a=e.y,l=e.y+e.h;return!(s<a||r>l)}intersection(e){if(!this.intersects(e))return null;const t=this.topLeft.zip(e.topLeft,Math.max),o=this.bottomRight.zip(e.bottomRight,Math.min);return l.fromCorners(t,o)}union(e){return l.union(this,e)}divideIntoGrid(e,t){const o=[];if(e<=0||t<=0)return o;const n=this.w/e,i=this.h/t;0===n&&(e=1),0===i&&(t=1);for(let r=0;r<t;r++)for(let t=0;t<e;t++){const e=n*t+this.x,s=i*r+this.y;o.push(new l(e,s,n,i))}return o}grownToPoint(e,t=0){const o=new l(e.x-t,e.y-t,2*t,2*t);return this.union(o)}grownBy(e){if(0===e)return this;if(e<0){const t=-Math.min(-e,this.w/2),o=-Math.min(-e,this.h/2);return new l(this.x-t,this.y-o,this.w+2*t,this.h+2*o)}return new l(this.x-e,this.y-e,this.w+2*e,this.h+2*e)}grownToSize(e){if(this.width>=e.x&&this.height>=e.y)return this;const t=Math.max(0,e.x-this.width),o=Math.max(0,e.y-this.height);return new l(this.x-t/2,this.y-o/2,this.width+t,this.height+o)}getClosestPointOnBoundaryTo(e){const t=this.getEdges().map((t=>t.closestPointTo(e)));let o=null,n=null;for(const i of t){const t=i.distanceTo(e);(null===n||t<n)&&(o=i,n=t)}return o}isWithinRadiusOf(e,t){if(this.maxDimension>e)return!1;const o=e*e;return this.corners.every((e=>e.minus(t).magnitudeSquared()<o))}get corners(){return[this.bottomRight,this.topRight,this.topLeft,this.bottomLeft]}get maxDimension(){return Math.max(this.w,this.h)}get minDimension(){return Math.min(this.w,this.h)}get bottomRight(){return this.topLeft.plus(this.size)}get topRight(){return this.bottomRight.plus(s.Vec2.of(0,-this.h))}get bottomLeft(){return this.topLeft.plus(s.Vec2.of(0,this.h))}get width(){return this.w}get height(){return this.h}get center(){return s.Vec2.of(this.x+this.w/2,this.y+this.h/2)}getEdges(){const e=this.corners;return[new i.default(e[0],e[1]),new i.default(e[1],e[2]),new i.default(e[2],e[3]),new i.default(e[3],e[0])]}intersectsLineSegment(e){const t=[];for(const o of this.getEdges())o.intersectsLineSegment(e).forEach((e=>t.push(e)));return t}signedDistance(e){const t=this.getClosestPointOnBoundaryTo(e),o=e.minus(t).magnitude();return this.containsPoint(e)?-o:o}getTightBoundingBox(){return this}transformedBoundingBox(e){return e===r.default.identity?this:l.bboxOf(this.corners.map((t=>e.transformVec2(t))))}eq(e,t=0){return this.topLeft.eq(e.topLeft,t)&&this.size.eq(e.size,t)}toString(){return`Rect(point(${this.x}, ${this.y}), size(${this.w}, ${this.h}))`}static fromCorners(e,t){return new l(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.abs(e.x-t.x),Math.abs(e.y-t.y))}static bboxOf(e,t=0){let o=0,n=0,i=0,r=0,a=!0;for(const t of e)a&&(o=t.x,n=t.y,i=t.x,r=t.y,a=!1),o=Math.min(o,t.x),n=Math.min(n,t.y),i=Math.max(i,t.x),r=Math.max(r,t.y);return l.fromCorners(s.Vec2.of(o-t,n-t),s.Vec2.of(i+t,r+t))}static union(...e){if(0===e.length)return l.empty;const t=e[0];let o=t.x,n=t.y,i=t.x+t.w,r=t.y+t.h;for(let t=1;t<e.length;t++){const s=e[t];o=Math.min(o,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x+s.w),r=Math.max(r,s.y+s.h)}return new l(o,n,i-o,r-n)}static of(e){const t=e.width??e.w??0,o=e.height??e.h??0;return new l(e.x,e.y,t,o)}}t.Rect2=l,l.empty=new l(0,0,0,0),l.unitSquare=new l(0,0,1,1),t.default=l},4973:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(7134);t.default=e=>{if(0===e.length)return[];const t=e.reduce(((e,t)=>t.y<e.y?t:e),e[0]),o=[t];let i=[...e.filter((e=>!e.eq(t)))],r=n.Vec2.of(-1,0);for(;i.length>0;){const e=o[o.length-1];let n=r.dot(t.minus(e).normalizedOrZero()),s=t;for(const t of i){const o=r.dot(t.minus(e).normalizedOrZero());o<=n&&(s=t,n=o)}i=i.filter((e=>!e.eq(s)));const a=s.minus(e).normalized();if(1===Math.abs(a.dot(r))&&o.length>1&&o.pop(),s.eq(t))break;o.push(s),r=e.minus(s).normalized()}return o}},6450:()=>{"use strict";(()=>{if(typeof document<"u"&&"function"==typeof document.createElement){let e=document.createElement("style");e.textContent='\ufeff:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content>div>div{padding:5px}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content>div{min-height:0}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content .insert-image-image-status-view{display:flex;justify-content:space-between;padding-bottom:0}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content .action-button-row{margin-top:4px;display:flex;flex-direction:row;justify-content:flex-end;padding-bottom:0;margin-bottom:0}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content .action-button-row>button{flex-grow:1;text-align:end;max-width:50%;min-width:min(100%,40px)}.toolbar-overflow-widget-overflow-list{display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center}.toolbar-overflow-widget-overflow-list>.toolbar-toolContainer>.toolbar-button{height:var(--toolbar-button-height)}.toolbar-overflow-widget.horizontal .toolbar-overflow-widget-overflow-list{flex-direction:row}.toolbar-overflow-widget.horizontal>.toolbar-dropdown{max-width:100%;left:15px;right:15px;margin-left:0 !important;translate:none !important;padding:4px}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons{display:flex;flex-wrap:wrap;justify-content:stretch;padding-top:0;padding-bottom:5px;gap:5px;direction:ltr}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>*{flex-grow:1;text-align:start;width:min-content}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>*>.icon{margin-inline-start:6px;margin-inline-end:10px}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>:nth-child(2){text-align:center}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>:nth-child(3){direction:rtl}.toolbar-zoomLevelEditor{display:flex;flex-direction:row;align-items:center}.toolbar-zoomLevelEditor .zoomDisplay{flex-grow:1}.toolbar-zoomLevelEditor button{min-width:48px}.selection-format-menu.disabled{opacity:.5}.toolbar-document-properties-widget button.about-button{width:100%;text-align:end}.toolbar-document-properties-widget>*{--align-items-to-x: 120px}.toolbar-document-properties-widget .js-draw-size-input-row.js-draw-size-input-row{display:flex}.toolbar-document-properties-widget .js-draw-size-input-row.js-draw-size-input-row.size-input-row--automatic-size{display:none}.toolbar-thicknessSliderContainer{display:flex;flex-direction:row}.toolbar-thicknessSliderContainer input{flex-grow:1}.toolbar-element .clr-field *{cursor:pointer}.toolbar-element .clr-field button{width:1.2em;height:1.2em;top:50%;left:0;border-radius:50%;margin-left:0;margin-right:0}.toolbar-element .clr-field input{opacity:0}.color-input-container{display:inline-flex;flex-direction:row}.color-input-container .coloris_input{height:calc(100% - 6px)}.color-input-container.picker-open .clr-field{pointer-events:none}:root .color-input-container>button.pipetteButton{width:30px;height:30px;padding:0;display:inline-flex}.color-input-container>.color-input-wrapper{display:flex;justify-content:stretch}.color-input-container .pipetteButton>svg{width:100%}.color-input-container .pipetteButton .pickColorInstructions{display:none;font-size:1em;position:absolute;margin-left:30px;background-color:var(--background-color-1);border-radius:30px;padding:4px;opacity:0;transition:.2s ease opacity}@media(prefers-reduced-motion: reduce){.color-input-container .pipetteButton .pickColorInstructions{transition:none}}.color-input-container .pipetteButton.active{background-color:var(--selection-background-color);--icon-color: var(--selection-foreground-color)}.color-input-container .pipetteButton.active .pickColorInstructions{display:block;opacity:.8}.tool-dropdown-separator{--border-color: rgba(100, 100, 100, 0.2);--border-color: color-mix(in srgb, var(--foreground-color-1), rgba(0, 0, 0, 0) 80%);border-top:1px solid var(--border-color);padding-left:2px;margin-top:10px;margin-bottom:10px}.toolbar-element .toolbar--file-input-container{display:flex}.toolbar-element .toolbar--file-input-container.-loading{opacity:.8}.toolbar-element .toolbar--file-input-container>input.file-input{opacity:0;width:0;min-width:0 !important;max-width:0;height:0;overflow:hidden;padding:0;margin:0}.toolbar-element .toolbar--file-input-container>label{display:block;flex-grow:1;padding:0 !important;padding-bottom:5px;--active-border-color: rgba(100, 100, 100, 0.5);--active-border-color: color-mix(in srgb, var(--foreground-color-1), transparent)}.toolbar-element .toolbar--file-input-container>label .cancel-button{padding-left:3px;padding-right:3px}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description{background-color:var(--background-color-3);color:var(--foreground-color-3);border:1px dashed var(--active-border-color);padding:10px;margin-top:10px;display:flex;flex-direction:column;align-items:center;text-align:center;--action-color: var(--primary-action-foreground-color);--icon-color: var(--action-color)}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description>span{white-space:pre-wrap}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description>span>b{color:var(--action-color);cursor:pointer}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description>.icon{width:min(50vw,42px);height:min(50vw,42px);margin-bottom:8px;display:block}.toolbar-element .toolbar--file-input-container>label:active,.toolbar-element .toolbar--file-input-container>label:hover,.toolbar-element .toolbar--file-input-container>label.drag-target{--active-border-color: var(--foreground-color-1)}.toolbar-element .toolbar--file-input-container>label.drag-target>.toolbar--file-input-description{border-width:2px}.toolbar-grid-selector{position:relative}.toolbar-grid-selector>div{display:flex;flex-direction:row;max-width:350px;flex-wrap:wrap;--button-size: 48px}.toolbar-grid-selector .choice-button{display:flex;flex-direction:column-reverse;box-sizing:border-box;cursor:pointer;flex-shrink:1;margin:2px}.toolbar-grid-selector .choice-button.focus-visible{outline:2px solid var(--foreground-color-1)}.toolbar-grid-selector .choice-button input{opacity:0;height:0}.toolbar-grid-selector .choice-button label{display:flex;flex-direction:column;box-sizing:border-box;width:var(--button-size);height:var(--button-size);font-size:.7rem;align-items:center;justify-content:center;padding:4px;user-select:none;-webkit-user-select:none}.toolbar-grid-selector .choice-button .icon{flex-grow:1;flex-shrink:1;width:100%}.toolbar-grid-selector .choice-button.checked{background-color:var(--selection-background-color);color:var(--selection-foreground-color);--icon-color: var(--selection-foreground-color)}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list{height:min(200px,50vh);position:relative;display:flex;align-items:center}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.scroller{display:flex;flex-direction:column;overflow-y:auto;scroll-snap-type:y mandatory;height:100%;width:100%;flex-grow:1}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.scroller>.item{height:100%;width:100%;flex-shrink:0;display:flex;justify-content:center;align-items:center;scroll-snap-align:start;scroll-snap-stop:always;box-sizing:border-box}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.-empty{display:none}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers{overflow:hidden;display:flex;flex-direction:column;align-items:center;max-height:100%;min-height:0}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers.-one-element{visibility:hidden}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers>.marker{padding:2px;opacity:.1;cursor:pointer;left:0;transition:left .2s ease}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers>.marker>.content{background-color:var(--foreground-color-1);border-radius:2px;padding:2px}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers>.marker.-active{position:relative;left:2px;opacity:.2}.toolbar-button-grid{display:grid;grid-template-columns:repeat(var(--column-count), 1fr);justify-items:center;--button-size: 30px}.toolbar-button-grid>.button{font-size:1em;width:min-content}.toolbar-button-grid>.button>.icon{max-width:var(--button-size);max-height:var(--button-size);width:48px;height:48px}.toolbar-button-grid>.button>label{display:block;font-weight:normal}.toolbar-root{background-color:var(--background-color-1);--icon-color: var(--foreground-color-1);--toolbar-button-height: min(20vh, 60px);flex-wrap:wrap;box-sizing:border-box;width:100%;display:flex;flex-direction:row;justify-content:center}.toolbar-element{z-index:1;font-family:system-ui,-apple-system,sans-serif}.toolbar-element details>summary{cursor:pointer}.toolbar-element>.toolbar-toolContainer>.toolbar-button,.toolbar-element>.toolbar-toolContainer>*>button,.toolbar-element>.toolbar-buttonGroup>button,.toolbar-element>.toolbar-button{white-space:pre;height:var(--toolbar-button-height)}.toolbar-dropdown .toolbar-button>.toolbar-icon{max-width:50px;width:100%}.toolbar-button.disabled{filter:sepia(0.2);opacity:.45;cursor:unset}.toolbar-button,.toolbar-element button{cursor:pointer;text-align:center;border-radius:6px;border:none;box-shadow:0px 0px 2px var(--shadow-color);user-select:none;-webkit-user-select:none;transition:background-color .15s ease,box-shadow .25s ease,opacity .2s ease}.toolbar-button,.toolbar-buttonGroup>button,.toolbar-toolContainer>*>button,.toolbar-root>button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding-left:3px;padding-right:3px;min-width:40px;max-width:105px;width:min-content;font-size:1em}.toolbar-button>label{cursor:inherit;user-select:none;-webkit-user-select:none}.toolbar-root>.toolbar-toolContainer>.toolbar-button>label.long-label{font-size:.75em}.toolbar-dropdown>.toolbar-toolContainer>button,.toolbar-dropdown>.toolbar-toolContainer>.toolbar-button{width:6em}.toolbar-button:not(.disabled):hover,.toolbar-root button:not(:disabled):hover{box-shadow:0px 2px 4px var(--shadow-color)}.toolbar-root button:disabled{cursor:inherit;opacity:.5}.toolbar-root .toolbar-icon{flex-shrink:1;user-select:none;width:100%;min-width:20px;min-height:20px}.toolbar-toolContainer.selected>.toolbar-button{background-color:var(--selection-background-color);color:var(--selection-foreground-color);--icon-color: var(--selection-foreground-color)}.toolbar-toolContainer:not(.selected):not(.dropdownShowable)>.toolbar-button>.toolbar-showHideDropdownIcon{display:none}.toolbar-toolContainer>.toolbar-button>.toolbar-showHideDropdownIcon{height:15px;transition:transform .25s ease}.toolbar-toolContainer.dropdownVisible>.toolbar-button>.toolbar-showHideDropdownIcon{transform:rotate(180deg)}.toolbar-dropdown.hidden,.toolbar-toolContainer:not(.selected):not(.dropdownShowable)>.toolbar-dropdown:not(.hiding){display:none}.toolbar-dropdown{position:absolute;padding:15px;padding-top:5px;display:flex;flex-wrap:wrap;flex-direction:column;max-height:80vh;max-width:fit-content;z-index:2;background-color:var(--background-color-1);box-shadow:0px 3px 3px var(--shadow-color)}@keyframes dropdown-transition-in{0%{opacity:0;transform:scale(1, 0)}100%{opacity:1;transform:scale(1, 1)}}@keyframes dropdown-transition-out{0%{opacity:1;transform:scale(1, 1)}100%{opacity:0;transform:scale(1, 0)}}.toolbar-dropdown{transform-origin:top left;--dropdown-show-animation: dropdown-transition-in;--dropdown-hide-animation: dropdown-transition-out}@media(prefers-reduced-motion: reduce){.toolbar-dropdown{--dropdown-show-animation: none;--dropdown-hide-animation: none}.toolbar-dropdown.hiding{display:none}.toolbar-toolContainer>.toolbar-button>.toolbar-showHideDropdownIcon{transition:none}:root .toolbar-button,.toolbar-root button{transition:none}}.toolbar-buttonGroup{display:flex;flex-direction:row;justify-content:center}.toolbar-element .toolbar--toggle-button{color:var(--foreground-color-1);font-weight:normal}.toolbar-element .toolbar--toggle-button[aria-checked=true]{background:var(--selection-background-color);color:var(--selection-foreground-color)}.toolbar-element .toolbar--toggle-button>.icon{width:25px;height:25px;margin:0 5px}.toolbar-element .toolbar--toggle-button>*{vertical-align:middle}.toolbar-closeColorPickerOverlay{display:none;position:fixed;top:0;left:0;bottom:0;right:0;touch-action:none;background-color:var(--background-color-1);opacity:.3;z-index:2}.toolbar-spacedList>*{padding-bottom:5px;padding-top:5px}.toolbar-indentedList{padding-left:10px}@media print{.toolbar-element{display:none}}@keyframes rehide-label{0%{opacity:.8}80%{opacity:.8}100%{opacity:.1}}@keyframes show-label-delayed{0%{opacity:0}80%{opacity:0}100%{opacity:.8}}@keyframes show-label-now{0%{opacity:0}5%{opacity:0}100%{opacity:.8}}@keyframes keep-label-hidden{0%{opacity:0}100%{opacity:0}}@keyframes toolbar--edgemenu-transition-in{from{transform:translate(0, 100%)}to{transform:translate(0, 0)}}@keyframes toolbar--edgemenu-transition-in-reduce-motion{from{opacity:0}to{opacity:1}}@keyframes toolbar--edgemenu-transition-out{to{transform:translate(0, 100%)}}@keyframes toolbar--edgemenu-transition-out-reduce-motion{from{opacity:1}to{opacity:0}}@keyframes toolbar--edgemenu-container-transition-in{from{overflow-y:hidden}to{overflow-y:hidden}}@keyframes toolbar--edgemenu-container-transition-out{from{overflow-y:hidden}to{overflow-y:hidden}}.toolbar-edge-toolbar{--toolbar-button-height: min(20vh, 48px);--toolbar-button-size: var(--toolbar-button-height);--label-hover-offset-size: calc(14px + var(--toolbar-button-height));box-sizing:border-box;flex-direction:row;justify-content:space-around;--button-label-hover-offset-y: var(--label-hover-offset-size);--button-label-hover-offset-x: 0}@media screen and (min-width: 540px){.toolbar-edge-toolbar{flex-wrap:nowrap}.toolbar-edge-toolbar>.toolbar-action-row{max-width:50vw;flex-grow:0;flex-shrink:0}}@media screen and (max-width: 700px){.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline{font-size:.9em}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button{width:var(--toolbar-button-size)}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button label{opacity:0;animation:.2s linear hide-initially}@keyframes hide-initially{from{opacity:0}to{opacity:0}}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label,.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button.has-long-press-or-hover>label{opacity:.8}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:focus-visible>label,.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button.focus-visible>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:has(:focus-visible)>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button>label{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}}@media screen and (max-width: 700px)and (prefers-reduced-motion: reduce){.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button>label{transition:none}}@media screen and (max-width: 700px){.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button>.toolbar-icon.toolbar-icon{margin-left:0;margin-right:0}}.toolbar-edge-toolbar>div.toolbar-element{flex-direction:row;display:flex;flex-grow:1;justify-content:center;background-color:var(--background-color-2);color:var(--foreground-color-2);--icon-color: var(--foreground-color-2);--extra-left-right-padding: 0px}.toolbar-edge-toolbar>div.toolbar-element::-webkit-scrollbar{width:3px;height:3px}.toolbar-edge-toolbar>div.toolbar-element::-webkit-scrollbar-thumb{background-color:var(--shadow-color)}.toolbar-edge-toolbar>div.toolbar-element.toolbar-tool-row{overflow-x:auto;overflow-y:hidden;flex-grow:100}.toolbar-edge-toolbar>div.toolbar-element.toolbar-action-row{z-index:2;background-color:var(--background-color-3);color:var(--foreground-color-3);--icon-color: var(--foreground-color-3)}.toolbar-edge-toolbar>div.toolbar-element.has-scroll{justify-content:start;position:relative;--button-label-hover-offset-y: 0;--button-label-hover-offset-x: calc(0px - var(--label-hover-offset-size))}.toolbar-edge-toolbar>div.toolbar-element.has-scroll>:nth-child(1){--button-label-hover-offset-x: var(--label-hover-offset-size)}.toolbar-edge-toolbar .toolbar-toolContainer.selected>.toolbar-button{background-color:var(--selection-background-color);color:var(--selection-foreground-color);--icon-color: var(--selection-foreground-color)}.toolbar-edge-toolbar .toolbar-button{box-sizing:border-box;background-color:rgba(0,0,0,0)}.toolbar-edge-toolbar .toolbar-button .toolbar-showHideDropdownIcon{flex-shrink:.01;height:12px}.toolbar-edge-toolbar .toolbar-toolContainer{order:1}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline{flex-grow:1;display:flex;--button-flex-direction: row}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline.label-left{justify-content:end;--button-flex-direction: row-reverse;order:100}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline.label-left>.toolbar-button>.toolbar-icon{margin-left:7px;margin-right:0}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline.label-right{order:-1}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline>.toolbar-button{width:auto;flex-direction:var(--button-flex-direction)}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline>.toolbar-button>.toolbar-icon{height:100%;margin-right:7px;margin-left:0;width:22px}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button{width:calc(var(--toolbar-button-size) + var(--extra-left-right-padding));height:var(--toolbar-button-size)}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label,.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button.has-long-press-or-hover>label{opacity:.8}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:focus-visible>label,.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button.focus-visible>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:has(:focus-visible)>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button>label{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}@media(prefers-reduced-motion: reduce){.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button>label{transition:none}}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline).dropdownVisible>.toolbar-button>label{opacity:.8;animation:1.5s ease rehide-label .3s,1s ease keep-label-hidden 1.8s infinite}.toolbar-edge-toolbar>div>.toolbar-toolContainer:not(.selected):not(.dropdownShowable)>.toolbar-button>.toolbar-showHideDropdownIcon{display:block;visibility:hidden}.toolbar-edge-toolbar .toolbar-toolContainer>.toolbar-button{margin:0;border-radius:0;padding:8px;box-shadow:none}.toolbar-edge-toolbar .toolbar-toolContainer>.toolbar-button.has-dropdown{padding-left:8px;padding-right:8px;padding-top:8px;padding-bottom:0px}.imageEditorContainer.pipette--color-selection-in-progress .toolbar-edgemenu-container{height:0;background-color:rgba(0,0,0,0);opacity:.9}.imageEditorContainer.pipette--color-selection-in-progress .toolbar-edgemenu-container .toolbar-edgemenu{position:absolute}.toolbar-edgemenu-container{background-color:var(--background-color-transparent);transition:.15s ease-in-out height,.15s ease-in-out background-color,.2s ease-in-out opacity;position:absolute;width:var(--editor-current-width-px);height:var(--editor-current-height-px);box-sizing:border-box;display:flex;flex-direction:column-reverse;align-items:center;z-index:2}@media(prefers-reduced-motion: reduce){.toolbar-edgemenu-container{transition:.15s ease-in-out background-color,.2s ease-in-out opacity}}.toolbar-edgemenu-container.dropdown-below-edge{overflow-y:hidden}.toolbar-edgemenu-container button{font-size:1.2em;box-shadow:none;border:none;padding:10px;transition:.2s ease box-shadow;font-weight:bold;color:var(--primary-action-foreground-color)}.toolbar-edgemenu-container button:not(:disabled):hover{box-shadow:0 0px 2px var(--shadow-color)}.toolbar-edgemenu-container button:disabled{opacity:.5;font-weight:unset;cursor:unset;color:var(--foreground-color-1)}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button{--button-label-hover-offset-y: var(--button-size)}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label>.button-label-text,.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label>.button-label-text{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button.has-long-press-or-hover>label>.button-label-text{opacity:.8}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:focus-visible>label>.button-label-text,.toolbar-edgemenu-container .toolbar-grid-selector .choice-button.focus-visible>label>.button-label-text{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:has(:focus-visible)>label>.button-label-text{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button>label>.button-label-text{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}@media(prefers-reduced-motion: reduce){.toolbar-edgemenu-container .toolbar-grid-selector .choice-button>label>.button-label-text{transition:none}}.toolbar-edgemenu-container .toolbar-button-grid button{--button-label-hover-offset-y: 0}.toolbar-edgemenu-container .toolbar-button-grid button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label,.toolbar-edgemenu-container .toolbar-button-grid button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edgemenu-container .toolbar-button-grid button.has-long-press-or-hover>label{opacity:.8}.toolbar-edgemenu-container .toolbar-button-grid button:focus-visible>label,.toolbar-edgemenu-container .toolbar-button-grid button.focus-visible>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-button-grid button:has(:focus-visible)>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-button-grid button>label{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}@media(prefers-reduced-motion: reduce){.toolbar-edgemenu-container .toolbar-button-grid button>label{transition:none}}.toolbar-edgemenu-container .toolbar-help-overlay-button{align-items:last baseline}.toolbar-edgemenu-container .toolbar-edgemenu{--toolbar-button-height: 48px;touch-action:none;user-select:none;-webkit-user-select:none;background-color:var(--background-color-2);color:var(--foreground-color-2);--icon-color: var(--foreground-color-2);box-shadow:0px 0px 1px var(--shadow-color);padding-left:10px;padding-right:10px;width:min(400px,100vw);box-sizing:border-box;border-top-left-radius:30px;border-top-right-radius:30px;transition:transform .1s ease,padding-bottom .1s ease}.toolbar-edgemenu-container .toolbar-edgemenu input,.toolbar-edgemenu-container .toolbar-edgemenu textarea{user-select:auto;-webkit-user-select:auto}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer{display:inline-block}.toolbar-edgemenu-container .toolbar-edgemenu button{background-color:rgba(0,0,0,0)}.toolbar-edgemenu-container .toolbar-edgemenu>button.drag-elem{height:40px;display:block;cursor:ns-resize;position:relative;margin-top:-15px;margin-bottom:10px;width:100%;border:none;box-shadow:none;background:rgba(0,0,0,0)}.toolbar-edgemenu-container .toolbar-edgemenu>button.drag-elem::before{content:"";background-color:var(--icon-color);opacity:.2;display:block;position:relative;top:10px;height:5px;border-radius:5px;width:min(80%,40px);margin-left:auto;margin-right:auto}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer{display:block}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button{flex-direction:row;max-width:unset;width:100%;box-sizing:border-box;justify-content:flex-start;box-shadow:none;padding:2px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button>.toolbar-icon{width:25px;height:25px;padding:13px;margin-right:15px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button label,.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button>label.long-label{font-size:1em}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-nonbutton-controls-main-list{padding-left:10px;padding-right:10px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList{box-sizing:border-box;--align-items-to-x: 105px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div{display:flex;align-items:center;margin-top:5px;min-height:35px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div:first-child{margin-top:0}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div>label{padding-right:35px;min-width:var(--align-items-to-x);flex-shrink:1;box-sizing:border-box}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div>input[type=checkbox]{width:20px;height:20px;margin-left:0}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div>input:not([type=checkbox]){flex-grow:1;min-width:48px;flex-shrink:1}.toolbar-dropdown-toolbar button,.toolbar-dropdown-toolbar .toolbar-button{background-color:var(--background-color-2);color:var(--foreground-color-2);--icon-color: var(--foreground-color-2)}.toolbar-dropdown-toolbar,.toolbar-dropdown-toolbar .toolbar-dropdown{background-color:var(--background-color-3);color:var(--foreground-color-3)}.toolbar-dropdown-toolbar .toolbar-spacedList>div>label{padding-right:10px;min-width:50px}.toolbar-dropdown-toolbar .clr-field button{width:100%;height:100%;top:50%;left:0;border-radius:5px}.toolbar-dropdown-toolbar .toolbar-grid-selector>div{--button-size: 57px}.toolbar-dropdown-toolbar .toolbar-dropdown>div>.toolbar-toolContainer{display:inline-block}.toolbar-help-overlay{width:100%;height:100%;max-width:none;max-height:none;border:none;margin:0;padding:0;z-index:5;touch-action:none;overflow:hidden;color:#fff;--icon-color: white;background-color:rgba(0,0,0,0);display:flex;flex-direction:column;transition:.3s ease transform}.toolbar-help-overlay::backdrop{background-color:rgba(0,0,0,.8);backdrop-filter:blur(1px);-webkit-backdrop-filter:blur(1px)}.toolbar-help-overlay,.toolbar-help-overlay::backdrop{animation:.25s ease transition-in}@keyframes transition-in{0%{opacity:0}100%{opacity:1}}@keyframes transition-out{0%{opacity:1}100%{opacity:0}}.toolbar-help-overlay.-hiding,.toolbar-help-overlay.-hiding::backdrop{animation:.25s ease transition-out;opacity:0}.toolbar-help-overlay.-dragging{transition:none}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay{transition:none}}@media screen and (min-width: 800px){.toolbar-help-overlay>.navigation-buttons{order:1;margin-top:auto}}.toolbar-help-overlay .with-text-shadow,.toolbar-help-overlay .help-page-container>.label,.toolbar-help-overlay button{text-shadow:0 0 3px rgba(20,20,20,.9);filter:drop-shadow(0px 0px 2px rgba(0, 0, 0, 0.5))}.toolbar-help-overlay button:not(:disabled){cursor:pointer}.toolbar-help-overlay button{background:rgba(0,0,0,0);border:none;color:var(--help-overlay-foreground);border-radius:15px}.toolbar-help-overlay .close-button{align-self:flex-start;width:48px;height:48px;z-index:1}.toolbar-help-overlay .close-button>svg{width:100%}.toolbar-help-overlay .navigation-content{flex-grow:1;display:flex}.toolbar-help-overlay .help-page-container{display:flex;align-items:center;flex-grow:1;touch-action:none}.toolbar-help-overlay .help-page-container>.label{flex-grow:1;text-align:center;font-size:18.5pt;margin-left:15px;margin-right:15px;margin-top:0px;z-index:1;transition:.5s ease margin-top}.toolbar-help-overlay .help-page-container>.label.-large-space-below{margin-top:0;margin-bottom:auto}.toolbar-help-overlay .help-page-container>.label.-small-space-above{margin-top:40px;margin-bottom:auto}.toolbar-help-overlay .help-page-container>.label.-large-space-above{margin-top:auto;margin-bottom:10px}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay .help-page-container>.label{transition:none}}.toolbar-help-overlay .help-page-container>.cloned-element-container{position:absolute;z-index:0;user-select:none;-webkit-user-select:none;border-radius:10px;opacity:.01;background-color:rgba(100,100,100,.01);box-shadow:none;transition:.5s ease opacity,.5s ease background-color}.toolbar-help-overlay .help-page-container>.cloned-element-container *{pointer-events:none !important}.toolbar-help-overlay .help-page-container>.cloned-element-container>*{margin:0;opacity:.01 !important;transition:.3s ease opacity !important}.toolbar-help-overlay .help-page-container>.cloned-element-container:not(.-clickable) *{cursor:unset !important}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable,.toolbar-help-overlay .help-page-container>.cloned-element-container.-background{z-index:1;touch-action:none}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable{cursor:pointer;z-index:2}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable.has-long-press-or-hover{opacity:.5 !important}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable.has-long-press-or-hover,.toolbar-help-overlay .help-page-container>.cloned-element-container.-active{background-color:var(--background-color-1)}.toolbar-help-overlay .help-page-container>.cloned-element-container.-active{opacity:1;background-color:var(--background-color-1);box-shadow:0 0 3px rgba(100,100,100,.5)}.toolbar-help-overlay .help-page-container>.cloned-element-container.-active>*{opacity:1 !important}.toolbar-help-overlay .navigation-buttons{display:flex;flex-direction:row;justify-content:space-between;direction:ltr}.toolbar-help-overlay .navigation-buttons>button:disabled{opacity:.5}.toolbar-help-overlay .navigation-buttons>.next,.toolbar-help-overlay .navigation-buttons>.previous{font-size:1em;padding:10px;transition:.2s ease font-size;z-index:3}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay .navigation-buttons>.next,.toolbar-help-overlay .navigation-buttons>.previous{transition:none}}.toolbar-help-overlay .navigation-buttons:not(.-has-previous)>.next:not(:disabled){animation:.5s ease highlight-button .5s}@keyframes highlight-button{0%{transform:scale(1)}50%{transform:scale(1.2)}55%{transform:scale(1.2) rotate(2deg)}65%{transform:scale(1.2) rotate(-2deg)}100%{transform:scale(1)}}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay .navigation-buttons:not(.-has-previous)>.next:not(:disabled){animation:none}}.toolbar-help-overlay .navigation-buttons>.next::after{content:"❯";margin-left:3px}.toolbar-help-overlay .navigation-buttons>.previous::before{content:"❮";margin-right:3px}.toolbar-help-overlay .navigation-buttons.-has-next>.next{font-size:1.4em}.toolbar-help-overlay .navigation-buttons.-has-previous>.previous{font-size:1.4em}.toolbar-help-overlay .navigation-buttons.-highlight-next>.next,.toolbar-help-overlay .navigation-buttons.-highlight-previous>.previous{font-weight:bold;font-size:1.4em}.toolbar-help-overlay .navigation-buttons.-highlight-next>.next,.toolbar-help-overlay .navigation-buttons.-highlight-previous>.previous,.toolbar-help-overlay .navigation-buttons .next:hover,.toolbar-help-overlay .navigation-buttons .previous:hover{background-color:rgba(200,200,200,.1)}.toolbar-help-overlay .navigation-help{margin-top:1em;font-size:.7em}.toolbar-element .toolbar-help-overlay-button{height:0;position:relative;display:flex;justify-content:end}.toolbar-element .toolbar-help-overlay-button>.button{margin:0;padding:5px;padding-top:0;padding-bottom:0;box-shadow:none;text-align:center;opacity:.5}.toolbar-element .toolbar-help-overlay-button>.button>.icon{width:1.18em;height:1.18em;transition:.2s ease filter}.toolbar-element .toolbar-help-overlay-button>.button:focus-visible>.icon,.toolbar-element .toolbar-help-overlay-button>.button:hover>.icon{filter:drop-shadow(0px 0px 1px var(--shadow-color))}.ScrollbarTool-overlay{width:0;height:0;overflow:visible;opacity:.2;pointer-events:none;--fade-out-animation: 1s ease 0s fade-out;--scrollbar-size: 3px}@media(prefers-reduced-motion: reduce){.ScrollbarTool-overlay{--fade-out-animation: none !important}}@keyframes fade-out{from{opacity:.2}to{opacity:0}}.ScrollbarTool-overlay:not(.just-updated){animation:var(--fade-out-animation);opacity:0}.ScrollbarTool-overlay .vertical-scrollbar,.ScrollbarTool-overlay .horizontal-scrollbar{width:var(--scrollbar-size);height:var(--scrollbar-size);min-width:var(--scrollbar-size);min-height:var(--scrollbar-size);background-color:var(--foreground-color-1);border-radius:var(--scrollbar-size);position:absolute}.ScrollbarTool-overlay .vertical-scrollbar.represents-no-scroll,.ScrollbarTool-overlay .horizontal-scrollbar.represents-no-scroll{animation:var(--fade-out-animation);opacity:0}.ScrollbarTool-overlay:not(.scrollbar-left) .vertical-scrollbar{margin-left:calc(var(--editor-current-display-width-px) - var(--scrollbar-size))}.ScrollbarTool-overlay:not(.scrollbar-top) .horizontal-scrollbar{margin-top:calc(var(--editor-current-display-height-px) - var(--scrollbar-size))}.clipboard-error-dialog details>summary{cursor:pointer}.clipboard-error-dialog details[open]{margin-bottom:12px}.clipboard-error-dialog textarea{width:100%;box-sizing:border-box}.selection-tool-selection-background{background-color:var(--selection-background-color);opacity:.5;overflow:visible}.selection-tool-handle{position:absolute;box-sizing:border-box;display:flex;align-items:center;justify-content:center;--max-size: 17px}.selection-tool-handle .selection-tool-content{border:1px solid var(--foreground-color-1);background:var(--background-color-1);box-sizing:border-box;max-width:var(--max-size);max-height:var(--max-size);width:100%;height:100%;display:flex;justify-content:center;align-items:center;padding:3px}.selection-tool-handle .selection-tool-content .icon{width:100%;height:100%}.selection-tool-handle.selection-tool-circle .selection-tool-content{border-radius:100%}.selection-tool-handle.selection-tool-rotate{--max-size: 28px;cursor:grab}.selection-tool-handle.selection-tool-resize-x{cursor:ew-resize}.selection-tool-handle.selection-tool-resize-y{cursor:ns-resize}.selection-tool-handle.selection-tool-resize-xy{cursor:nwse-resize}.selection-tool-rotated-near-perpendicular .selection-tool-handle.selection-tool-resize-x{cursor:ns-resize}.selection-tool-rotated-near-perpendicular .selection-tool-handle.selection-tool-resize-y{cursor:ew-resize}.selection-tool-rotated-near-perpendicular .selection-tool-handle.selection-tool-resize-xy{cursor:nesw-resize}.selection-tool-selection-menu>button{max-height:var(--vertical-offset);background-color:var(--background-color-1);width:24px;height:24px;padding:6px;font-size:14px;user-select:none;-webkit-user-select:none;color:var(--foreground-color-1);border:.5px solid var(--foreground-color-1);border-radius:3px;opacity:.8;transition:.2s ease opacity}.selection-tool-selection-menu>button:hover,.selection-tool-selection-menu>button:focus-visible{background-color:var(--background-color-2);color:var(--foreground-color-2);cursor:pointer;opacity:1}.selection-tool-selection-menu>button>.icon{width:100%;height:100%}.overlay.handleOverlay{touch-action:none;direction:ltr}.overlay.handleOverlay,.overlay.handleOverlay .selection-tool-selection-outer-container{height:0;overflow:visible}.overlay.handleOverlay .selection-tool-selection-inner-container{width:var(--editor-current-display-width-px);height:var(--editor-current-display-height-px);overflow:hidden;pointer-events:none}.overlay.handleOverlay .selection-tool-selection-inner-container>*{pointer-events:all}.overlay.handleOverlay .selection-tool-selection-inner-container.-empty{opacity:0;display:none}.overlay.handleOverlay .selection-tool-selection-inner-container.-hide-handles .selection-tool-handle{display:none}@keyframes selection-duplicated-animation{0%{scale:1 1}50%{scale:1.02 1.02}100%{scale:1 1}}@media(prefers-reduced-motion: reduce){@keyframes selection-duplicated-animation{}}.find-tool-overlay{order:-1;position:absolute}.js-draw-sound-ui-toggle{width:0px;height:0px;overflow:hidden;user-select:none;-webkit-user-select:none}.js-draw-sound-ui-toggle button{margin-top:1px}.js-draw-sound-ui-toggle:focus-within,.js-draw-sound-ui-toggle.sound-ui-tool-enabled{overflow:visible;z-index:5}.js-draw-sound-ui-toggle:not(:focus-within):not(:hover).sound-ui-tool-enabled{opacity:.5}@keyframes show-popup-menu-animation{from{opacity:0}to{opacity:1}}.editor-popup-menu{width:100%;height:100%;background-color:rgba(0,0,0,0);border:none;animation:var(--hide-menu-animation-timeout) ease show-popup-menu-animation;opacity:1;transition:var(--hide-menu-animation-timeout) ease opacity;overflow:hidden}.editor-popup-menu.-hide{opacity:0}.editor-popup-menu>.content{position:absolute;left:var(--anchor-x);top:var(--anchor-y);display:flex;flex-direction:column;overflow:clip;border-radius:6px;box-shadow:0px 0px 2px var(--shadow-color);background-color:var(--background-color-1)}.editor-popup-menu::backdrop{background:rgba(0,0,0,0)}.editor-popup-menu-option{display:flex;justify-content:start;cursor:pointer;padding:5px;padding-top:6px;padding-bottom:6px;background-color:rgba(0,0,0,0);color:var(--foreground-color-1);--icon-color: currentColor;border:none;font-size:1em}.editor-popup-menu-option:hover,.editor-popup-menu-option:focus-visible{background-color:var(--background-color-2);color:var(--foreground-color-2)}.editor-popup-menu-option>:first-child{width:1em;height:1em;flex-shrink:0;align-self:center;margin-inline-start:0em;margin-inline-end:.32em}.about-dialog-content>.scroll{white-space:pre-wrap;font-family:monospace}.about-dialog-content>.scroll>details>summary{cursor:pointer}.about-dialog-content>.scroll>h2,.about-dialog-content>.scroll>details>summary{margin-top:15px;font-size:1.2em;font-weight:bold}.about-dialog-content>.scroll>h2 a,.about-dialog-content>.scroll>details>summary a{color:var(--foreground-color-1);text-decoration:underline}@keyframes fade-in{from{opacity:0}to{opacity:1}}.message-dialog-container dialog{display:flex}.message-dialog-container dialog.-closing{opacity:0}.message-dialog-container dialog.-closing::backdrop{opacity:0}.message-dialog-container dialog,.message-dialog-container dialog::backdrop{transition:opacity .2s ease;animation:fade-in .2s ease}.message-dialog-content{display:flex;flex-direction:column;flex-grow:1}.message-dialog-content>.close{display:block;margin-left:auto;margin-right:auto}.message-dialog-content>.scroll{flex-grow:1;flex-shrink:1;overflow-y:auto;margin-left:20px;margin-right:20px;padding-bottom:20px}.dialog-container>dialog{background-color:var(--background-color-1);color:var(--foreground-color-1);border:none;outline:none;box-shadow:0 0 2px var(--shadow-color);border-radius:8px;max-height:90vh;width:min(100%,500px);box-sizing:border-box}.dialog-container>dialog::backdrop{backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);background-color:var(--background-color-transparent)}#clr-picker{--clr-slider-size: 30px}#clr-picker #clr-color-area,#clr-picker .clr_hue{touch-action:none}#clr-picker .clr-alpha{margin-top:15px;margin-bottom:15px}#clr-picker.clr-picker input[type=range]::-moz-range-thumb{width:var(--clr-slider-size);height:var(--clr-slider-size)}#clr-picker.clr-picker input[type=range]::-webkit-slider-thumb{width:var(--clr-slider-size);height:var(--clr-slider-size)}#clr-picker.clr-picker input[type=range]::-webkit-slider-runnable-track{height:var(--clr-slider-size)}#clr-picker.clr-picker input[type=range]::-moz-range-track{height:var(--clr-slider-size)}.imageEditorContainer{--background-color-1: white;--foreground-color-1: black;--background-color-2: #f5f5f5;--foreground-color-2: #2c303a;--background-color-3: #e5e5e5;--foreground-color-3: #1c202a;--selection-background-color: #cbdaf1;--selection-foreground-color: #2c303a;--background-color-transparent: rgba(105, 100, 100, 0.5);--shadow-color: rgba(0, 0, 0, 0.5);--primary-action-foreground-color: #15b}@media(prefers-color-scheme: dark){.imageEditorContainer{--background-color-1: #151515;--foreground-color-1: white;--background-color-2: #222;--foreground-color-2: #efefef;--background-color-3: #272627;--foreground-color-3: #eee;--selection-background-color: #607;--selection-foreground-color: white;--shadow-color: rgba(250, 250, 250, 0.5);--background-color-transparent: rgba(50, 50, 50, 0.5);--primary-action-foreground-color: #7ae}}.imageEditorContainer{--icon-color: var(--foreground-color-1)}.imageEditorContainer{color:var(--foreground-color-1);font-family:system-ui,-apple-system,sans-serif;background-color:var(--background-color-1);width:100%;height:400px;min-height:220px;min-width:100px;writing-mode:horizontal-tb;box-sizing:border-box;display:flex;flex-direction:column-reverse}.imageEditorContainer input{accent-color:var(--primary-action-foreground-color)}.imageEditorContainer .imageEditorRenderArea{display:grid;grid-template-columns:1fr;flex-grow:2;flex-shrink:1;min-height:100px;min-width:0;width:100%;height:100%}.imageEditorContainer .imageEditorRenderArea canvas{grid-row:1/1;grid-column:1/1;touch-action:none;box-sizing:border-box;width:100%;height:100%;min-width:0;max-width:inherit;min-height:0px;max-height:inherit;user-select:none;-webkit-user-select:none;-webkit-user-drag:none}.imageEditorContainer .loadingMessage{position:fixed;text-align:center;font-size:2em;text-shadow:0px 0px 1px var(--background-color-1);bottom:0;left:0;right:0}.imageEditorContainer .accessibilityAnnouncement{opacity:0;width:0;height:0;overflow:hidden;pointer-events:none;user-select:none;-webkit-user-select:none}.imageEditorContainer .textRendererOutputContainer{width:.001px;height:.001px;overflow:hidden;-webkit-user-select:none;user-select:none}.imageEditorContainer .textRendererOutputContainer:focus-within{overflow:visible;z-index:5}.imageEditorContainer .anchored-element-overlay{overflow:visible;height:0}.imageEditorContainer .anchored-element-overlay>.content-wrapper{width:var(--editor-current-display-width-px);height:var(--editor-current-display-height-px);overflow:hidden;position:relative;pointer-events:none}.imageEditorContainer .anchored-element-overlay>.content-wrapper>.content{position:absolute;left:var(--position-x);top:var(--position-y);transform:scale(var(--scale)) rotate(var(--rotation));transform-origin:left top;margin:0;pointer-events:all}@media print{.imageEditorContainer .loadingMessage{display:none}.imageEditorContainer .imageEditorRenderArea canvas{width:100%;height:initial}}',document.head.appendChild(e)}})(),(()=>{if(typeof document<"u"&&"function"==typeof document.createElement){let e=document.createElement("style");e.textContent='.clr-picker{display:none;flex-wrap:wrap;position:absolute;width:200px;z-index:1000;border-radius:10px;background-color:#fff;justify-content:flex-end;direction:ltr;box-shadow:0 0 5px rgba(0, 0, 0, 0.05),0 5px 20px rgba(0, 0, 0, 0.1);-moz-user-select:none;-webkit-user-select:none;user-select:none}.clr-picker.clr-open,.clr-picker[data-inline=true]{display:flex}.clr-picker[data-inline=true]{position:relative}.clr-gradient{position:relative;width:100%;height:100px;margin-bottom:15px;border-radius:3px 3px 0 0;background-image:linear-gradient(rgba(0, 0, 0, 0), #000),linear-gradient(90deg, #fff, currentColor);cursor:pointer}.clr-marker{position:absolute;width:12px;height:12px;margin:-6px 0 0 -6px;border:1px solid #fff;border-radius:50%;background-color:currentColor;cursor:pointer}.clr-picker input[type=range]::-webkit-slider-runnable-track{width:100%;height:16px}.clr-picker input[type=range]::-webkit-slider-thumb{width:16px;height:16px;-webkit-appearance:none}.clr-picker input[type=range]::-moz-range-track{width:100%;height:16px;border:0}.clr-picker input[type=range]::-moz-range-thumb{width:16px;height:16px;border:0}.clr-hue{background-image:linear-gradient(to right, #f00 0%, #ff0 16.66%, #0f0 33.33%, #0ff 50%, #00f 66.66%, #f0f 83.33%, #f00 100%)}.clr-hue,.clr-alpha{position:relative;width:calc(100% - 40px);height:8px;margin:5px 20px;border-radius:4px}.clr-alpha span{display:block;height:100%;width:100%;border-radius:inherit;background-image:linear-gradient(90deg, rgba(0, 0, 0, 0), currentColor)}.clr-hue input,.clr-alpha input{position:absolute;width:calc(100% + 32px);height:16px;left:-16px;top:-4px;margin:0;background-color:transparent;opacity:0;cursor:pointer;appearance:none;-webkit-appearance:none}.clr-hue div,.clr-alpha div{position:absolute;width:16px;height:16px;left:0;top:50%;margin-left:-8px;transform:translateY(-50%);border:2px solid #fff;border-radius:50%;background-color:currentColor;box-shadow:0 0 1px #888;pointer-events:none}.clr-alpha div:before{content:"";position:absolute;height:100%;width:100%;left:0;top:0;border-radius:50%;background-color:currentColor}.clr-format{display:none;order:1;width:calc(100% - 40px);margin:0 20px 20px}.clr-segmented{display:flex;position:relative;width:100%;margin:0;padding:0;border:1px solid #ddd;border-radius:15px;box-sizing:border-box;color:#999;font-size:12px}.clr-segmented input,.clr-segmented legend{position:absolute;width:100%;height:100%;margin:0;padding:0;border:0;left:0;top:0;opacity:0;pointer-events:none}.clr-segmented label{flex-grow:1;margin:0;padding:4px 0;font-size:inherit;font-weight:normal;line-height:initial;text-align:center;cursor:pointer}.clr-segmented label:first-of-type{border-radius:10px 0 0 10px}.clr-segmented label:last-of-type{border-radius:0 10px 10px 0}.clr-segmented input:checked+label{color:#fff;background-color:#666}.clr-swatches{order:2;width:calc(100% - 32px);margin:0 16px}.clr-swatches div{display:flex;flex-wrap:wrap;padding-bottom:12px;justify-content:center}.clr-swatches button{position:relative;width:20px;height:20px;margin:0 4px 6px 4px;padding:0;border:0;border-radius:50%;color:inherit;text-indent:-1000px;white-space:nowrap;overflow:hidden;cursor:pointer}.clr-swatches button:after{content:"";display:block;position:absolute;width:100%;height:100%;left:0;top:0;border-radius:inherit;background-color:currentColor;box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}input.clr-color{order:1;width:calc(100% - 80px);height:32px;margin:15px 20px 20px auto;padding:0 10px;border:1px solid #ddd;border-radius:16px;color:#444;background-color:#fff;font-family:sans-serif;font-size:14px;text-align:center;box-shadow:none}input.clr-color:focus{outline:none;border:1px solid #1e90ff}.clr-close,.clr-clear{display:none;order:2;height:24px;margin:0 20px 20px;padding:0 20px;border:0;border-radius:12px;color:#fff;background-color:#666;font-family:inherit;font-size:12px;font-weight:400;cursor:pointer}.clr-close{display:block;margin:0 20px 20px auto}.clr-preview{position:relative;width:32px;height:32px;margin:15px 0 20px 20px;border-radius:50%;overflow:hidden}.clr-preview:before,.clr-preview:after{content:"";position:absolute;height:100%;width:100%;left:0;top:0;border:1px solid #fff;border-radius:50%}.clr-preview:after{border:0;background-color:currentColor;box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.clr-preview button{position:absolute;width:100%;height:100%;z-index:1;margin:0;padding:0;border:0;border-radius:50%;outline-offset:-2px;background-color:transparent;text-indent:-9999px;cursor:pointer;overflow:hidden}.clr-marker,.clr-hue div,.clr-alpha div,.clr-color{box-sizing:border-box}.clr-field{display:inline-block;position:relative;color:transparent}.clr-field input{margin:0;direction:ltr}.clr-field.clr-rtl input{text-align:right}.clr-field button{position:absolute;width:30px;height:100%;right:0;top:50%;transform:translateY(-50%);margin:0;padding:0;border:0;color:inherit;text-indent:-1000px;white-space:nowrap;overflow:hidden;pointer-events:none}.clr-field.clr-rtl button{right:auto;left:0}.clr-field button:after{content:"";display:block;position:absolute;width:100%;height:100%;left:0;top:0;border-radius:inherit;background-color:currentColor;box-shadow:inset 0 0 1px rgba(0, 0, 0, 0.5)}.clr-alpha,.clr-alpha div,.clr-swatches button,.clr-preview:before,.clr-field button{background-image:repeating-linear-gradient(45deg, #aaa 25%, transparent 25%, transparent 75%, #aaa 75%, #aaa),repeating-linear-gradient(45deg, #aaa 25%, #fff 25%, #fff 75%, #aaa 75%, #aaa);background-position:0 0,4px 4px;background-size:8px 8px}.clr-marker:focus{outline:none}.clr-keyboard-nav .clr-marker:focus,.clr-keyboard-nav .clr-hue input:focus+div,.clr-keyboard-nav .clr-alpha input:focus+div,.clr-keyboard-nav .clr-segmented input:focus+label{outline:none;box-shadow:0 0 0 2px #1e90ff,0 0 2px 2px #fff}.clr-picker[data-alpha=false] .clr-alpha{display:none}.clr-picker[data-minimal=true]{padding-top:16px}.clr-picker[data-minimal=true] .clr-gradient,.clr-picker[data-minimal=true] .clr-hue,.clr-picker[data-minimal=true] .clr-alpha,.clr-picker[data-minimal=true] .clr-color,.clr-picker[data-minimal=true] .clr-preview{display:none}.clr-dark{background-color:#444}.clr-dark .clr-segmented{border-color:#777}.clr-dark .clr-swatches button:after{box-shadow:inset 0 0 0 1px rgba(255, 255, 255, 0.3)}.clr-dark input.clr-color{color:#fff;border-color:#777;background-color:#555}.clr-dark input.clr-color:focus{border-color:#1e90ff}.clr-dark .clr-preview:after{box-shadow:inset 0 0 0 1px rgba(255, 255, 255, 0.5)}.clr-dark .clr-alpha,.clr-dark .clr-alpha div,.clr-dark .clr-swatches button,.clr-dark .clr-preview:before{background-image:repeating-linear-gradient(45deg, #666 25%, transparent 25%, transparent 75%, #888 75%, #888),repeating-linear-gradient(45deg, #888 25%, #444 25%, #444 75%, #888 75%, #888)}.clr-picker.clr-polaroid{border-radius:6px;box-shadow:0 0 5px rgba(0, 0, 0, 0.1),0 5px 30px rgba(0, 0, 0, 0.2)}.clr-picker.clr-polaroid:before{content:"";display:block;position:absolute;width:16px;height:10px;left:20px;top:-10px;border:solid transparent;border-width:0 8px 10px 8px;border-bottom-color:currentColor;box-sizing:border-box;color:#fff;filter:drop-shadow(0 -4px 3px rgba(0, 0, 0, 0.1));pointer-events:none}.clr-picker.clr-polaroid.clr-dark:before{color:#444}.clr-picker.clr-polaroid.clr-left:before{left:auto;right:20px}.clr-picker.clr-polaroid.clr-top:before{top:auto;bottom:-10px;transform:rotateZ(180deg)}.clr-polaroid .clr-gradient{width:calc(100% - 20px);height:120px;margin:10px;border-radius:3px}.clr-polaroid .clr-hue,.clr-polaroid .clr-alpha{width:calc(100% - 30px);height:10px;margin:6px 15px;border-radius:5px}.clr-polaroid .clr-hue div,.clr-polaroid .clr-alpha div{box-shadow:0 0 5px rgba(0, 0, 0, 0.2)}.clr-polaroid .clr-format{width:calc(100% - 20px);margin:0 10px 15px}.clr-polaroid .clr-swatches{width:calc(100% - 12px);margin:0 6px}.clr-polaroid .clr-swatches div{padding-bottom:10px}.clr-polaroid .clr-swatches button{width:22px;height:22px}.clr-polaroid input.clr-color{width:calc(100% - 60px);margin:10px 10px 15px auto}.clr-polaroid .clr-clear{margin:0 10px 15px 10px}.clr-polaroid .clr-close{margin:0 10px 15px auto}.clr-polaroid .clr-preview{margin:10px 0 15px 10px}.clr-picker.clr-large{width:275px}.clr-large .clr-gradient{height:150px}.clr-large .clr-swatches button{width:22px;height:22px}.clr-picker.clr-pill{width:380px;padding-left:180px;box-sizing:border-box}.clr-pill .clr-gradient{position:absolute;width:180px;height:100%;left:0;top:0;margin-bottom:0;border-radius:3px 0 0 3px}.clr-pill .clr-hue{margin-top:20px}',document.head.appendChild(e)}})()},5036:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;const l=a(o(2709)),c=a(o(5819)),d=o(2572),h=o(4892),u=a(o(1955)),p=a(o(4287)),f=a(o(9168)),m=o(3755),g=s(o(488)),b=a(o(5466)),v=a(o(7372)),y=a(o(9389)),w=a(o(6573)),x=a(o(1842)),S=a(o(2560)),T=a(o(1583)),C=a(o(8522)),P=a(o(3538)),k=s(o(4569)),E=a(o(4459)),z=a(o(2451)),_=a(o(2878)),M=a(o(8058)),I=a(o(2862)),R=a(o(8348)),L=a(o(2749)),O=o(159),D=s(o(5786)),B=a(o(724)),A=a(o(8107)),j=a(o(6682)),V=a(o(7214));class F{constructor(e,t={}){if(this.eventListenerTargets=[],this.previousAccessibilityAnnouncement="",this.pointers={},this.announceUndoCallback=e=>{this.announceForAccessibility(this.localization.undoAnnouncement(e.description(this,this.localization)))},this.announceRedoCallback=e=>{this.announceForAccessibility(this.localization.redoAnnouncement(e.description(this,this.localization)))},this.nextRerenderListeners=[],this.rerenderQueued=!1,this.closeAboutDialog=null,this.localization={...(0,y.default)(),...t.localization},this.settings={wheelEventsEnabled:t.wheelEventsEnabled??!0,renderingMode:t.renderingMode??g.RenderingMode.CanvasRenderer,localization:this.localization,minZoom:t.minZoom??2e-10,maxZoom:t.maxZoom??1e12,keyboardShortcutOverrides:t.keyboardShortcutOverrides??{},iconProvider:t.iconProvider??new w.default,notices:t.notices??[],appInfo:t.appInfo?{...t.appInfo}:null,pens:{additionalPenTypes:t.pens?.additionalPenTypes??[],filterPenTypes:t.pens?.filterPenTypes??(()=>!0)},text:{fonts:t.text?.fonts??["sans-serif","serif","monospace"]},image:{showImagePicker:t.image?.showImagePicker??void 0},svg:{loaderPlugins:t.svg?.loaderPlugins??[]},clipboardApi:t.clipboardApi??null},this.settings.minZoom>this.settings.maxZoom)throw new Error("Minimum zoom must be lesser than maximum zoom!");this.readOnly=D.MutableReactiveValue.fromInitialValue(!1),this.icons=this.settings.iconProvider,this.shortcuts=new z.default(this.settings.keyboardShortcutOverrides),this.container=document.createElement("div"),this.renderingRegion=document.createElement("div"),this.container.appendChild(this.renderingRegion),this.container.classList.add("imageEditorContainer","js-draw"),this.loadingWarning=document.createElement("div"),this.loadingWarning.classList.add("loadingMessage"),this.loadingWarning.ariaLive="polite",this.container.appendChild(this.loadingWarning),this.accessibilityControlArea=document.createElement("textarea"),this.accessibilityControlArea.setAttribute("placeholder",this.localization.accessibilityInputInstructions),this.accessibilityControlArea.style.opacity="0",this.accessibilityControlArea.style.width="0",this.accessibilityControlArea.style.height="0",this.accessibilityControlArea.style.position="absolute",this.accessibilityAnnounceArea=document.createElement("div"),this.accessibilityAnnounceArea.setAttribute("aria-live","assertive"),this.accessibilityAnnounceArea.className="accessibilityAnnouncement",this.container.appendChild(this.accessibilityAnnounceArea),this.renderingRegion.style.touchAction="none",this.renderingRegion.className="imageEditorRenderArea",this.renderingRegion.appendChild(this.accessibilityControlArea),this.renderingRegion.setAttribute("tabIndex","0"),this.renderingRegion.setAttribute("alt",""),this.notifier=new f.default,this.viewport=new p.default(((e,t)=>{this.notifier.dispatch(d.EditorEventType.ViewportChanged,{kind:d.EditorEventType.ViewportChanged,newTransform:t,oldTransform:e})})),this.display=new g.default(this,this.settings.renderingMode,this.renderingRegion),this.image=new l.default,this.history=new u.default(this,this.announceRedoCallback,this.announceUndoCallback),this.toolController=new c.default(this,this.localization),this.toolController.addInputMapper(M.default.fromEditor(this)),this.toolController.addInputMapper(new V.default),e.appendChild(this.container),this.viewport.updateScreenSize(m.Vec2.of(this.display.width,this.display.height)),this.registerListeners(),this.queueRerender(),this.hideLoadingWarning(),this.notifier.on(d.EditorEventType.ViewportChanged,(e=>{if(e.kind!==d.EditorEventType.ViewportChanged)return;const t=e=>e.transformVec3(m.Vec2.unitX).length(),o=t(e.newTransform);if(o>this.settings.maxZoom||o<this.settings.minZoom){const o=t(e.oldTransform);let n=m.Mat33.identity;n=o<=this.settings.maxZoom&&o>=this.settings.minZoom?e.oldTransform:m.Mat33.scaling2D((this.settings.minZoom+this.settings.maxZoom)/2),this.viewport.resetTransform(n)}else isFinite(o)||(console.warn(`Non-finite zoom (${o}) detected. Resetting the viewport. This was likely caused by division by zero.`),isFinite(t(e.oldTransform))?this.viewport.resetTransform(e.oldTransform):this.viewport.resetTransform())}))}getCurrentSettings(){return{...this.settings}}getRootElement(){return this.container}getOutputBBoxInDOM(){return m.Rect2.of(this.renderingRegion.getBoundingClientRect())}showLoadingWarning(e){const t=Math.round(100*e);this.loadingWarning.innerText=this.localization.loading(t),this.loadingWarning.style.display="block"}hideLoadingWarning(){this.loadingWarning.style.display="none",this.announceForAccessibility(this.localization.doneLoading)}announceForAccessibility(e){e===this.previousAccessibilityAnnouncement&&(e+=". "),this.accessibilityAnnounceArea.innerText=e,this.previousAccessibilityAnnouncement=e}addToolbar(e=!0){const t=new _.default(this,this.container,this.localization);return e&&t.addDefaults(),t}registerListeners(){this.handlePointerEventsFrom(this.renderingRegion),this.handleKeyEventsFrom(this.renderingRegion),this.handlePointerEventsFrom(this.accessibilityAnnounceArea);const e=[this.renderingRegion,this.accessibilityAnnounceArea,this.accessibilityControlArea,this.loadingWarning];for(const t of e)t.addEventListener("drag",(e=>(e.preventDefault(),!1))),t.addEventListener("dragstart",(e=>(e.preventDefault(),!1)));this.container.addEventListener("wheel",(e=>{this.handleHTMLWheelEvent(e)}));const t=()=>{this.viewport.updateScreenSize(m.Vec2.of(this.display.width,this.display.height)),this.rerender(),this.updateEditorSizeVariables()};if("ResizeObserver"in window){const e=new ResizeObserver(t);e.observe(this.renderingRegion),e.observe(this.container)}else addEventListener("resize",t);this.accessibilityControlArea.addEventListener("input",(()=>{this.accessibilityControlArea.value=""}));const o=new j.default(this);document.addEventListener("copy",(async e=>{this.isEventSink(document.querySelector(":focus"))&&o.copy(e)})),document.addEventListener("paste",(e=>{this.handlePaste(e)}))}updateEditorSizeVariables(){this.container.style.setProperty("--editor-current-width-px",`${this.container.clientWidth}px`),this.container.style.setProperty("--editor-current-height-px",`${this.container.clientHeight}px`),this.container.style.setProperty("--editor-current-display-width-px",`${this.renderingRegion.clientWidth}px`),this.container.style.setProperty("--editor-current-display-height-px",`${this.renderingRegion.clientHeight}px`)}handleHTMLWheelEvent(e){let t=m.Vec3.of(e.deltaX,e.deltaY,e.deltaZ);if(!e.ctrlKey&&!e.metaKey){if(!this.settings.wheelEventsEnabled)return;if("only-if-focused"===this.settings.wheelEventsEnabled&&!this.container.querySelector(":focus"))return}e.deltaMode===WheelEvent.DOM_DELTA_LINE?t=t.times(15):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t=t.times(100)),(e.ctrlKey||e.metaKey)&&(t=m.Vec3.of(0,0,e.deltaY));const o=this.getOutputBBoxInDOM(),n=m.Vec2.of(e.clientX,e.clientY).minus(o.topLeft);return!!this.toolController.dispatchInputEvent({kind:h.InputEvtType.WheelEvt,delta:t,screenPos:n})&&(e.preventDefault(),!0)}getPointerList(){const e=performance.now(),t=[];for(const o in this.pointers){const n=2e3;this.pointers[o]&&e-this.pointers[o].timeStamp<n&&t.push(this.pointers[o])}return t}setPointerCapture(e,t){if(!("__mockEvent"in t))try{e.setPointerCapture(t.pointerId)}catch(e){console.warn("Failed to setPointerCapture",e)}}releasePointerCapture(e,t){if(!("__mockEvent"in t))try{e.releasePointerCapture(t.pointerId)}catch(e){console.warn("Failed to releasePointerCapture",e)}}handleHTMLPointerEvent(e,t){const o=this.renderingRegion,n=t.target??this.renderingRegion;if(this.display.onPointerEvent(t),"pointerdown"===e){const e=v.default.ofEvent(t,!0,this.viewport,o);this.pointers[e.id]=e,this.setPointerCapture(n,t);const i={kind:h.InputEvtType.PointerDownEvt,current:e,allPointers:this.getPointerList()};return this.toolController.dispatchInputEvent(i),!0}if("pointermove"===e){const e=v.default.ofEvent(t,this.pointers[t.pointerId]?.down??!1,this.viewport,o);if(e.down){const o=this.pointers[e.id];if(o&&e.screenPos.distanceTo(o.screenPos)<2)return!1;this.pointers[e.id]=e,this.toolController.dispatchInputEvent({kind:h.InputEvtType.PointerMoveEvt,current:e,allPointers:this.getPointerList()})&&t.preventDefault()}return!0}if("pointercancel"===e||"pointerup"===e){const e=v.default.ofEvent(t,!1,this.viewport,o);return!!this.pointers[e.id]&&(this.pointers[e.id]=e,this.releasePointerCapture(n,t),this.toolController.dispatchInputEvent({kind:h.InputEvtType.PointerUpEvt,current:e,allPointers:this.getPointerList()})&&t.preventDefault(),delete this.pointers[e.id],!0)}return e}isEventSink(e){let t=e;for(;null!==t;){for(const e of this.eventListenerTargets)if(e===t)return!0;t=t.parentElement}return!1}async handleDrop(e){e.preventDefault(),await this.handlePaste(e)}async handlePaste(e){const t=document.querySelector(":focus")??e.target;if(this.isEventSink(t))return await new j.default(this).paste(e)}handlePointerEventsFrom(e,t,o){const n={touchstart:e=>{o&&!o("touchstart",e)||e.preventDefault()},contextmenu:e=>{o&&!o("contextmenu",e)||e.preventDefault()}},i=["pointerdown","pointermove","pointerup","pointercancel"];for(const e of i)n[e]=o=>{const n=o;if(!t||t(e,n))return this.handleHTMLPointerEvent(e,n)};for(const t in n)e.addEventListener(t,n[t]);return{remove:()=>{for(const t in n)e.removeEventListener(t,n[t])}}}handlePointerEventsExceptClicksFrom(e,t,o){const n=Object.create(null);return this.handlePointerEventsFrom(e,((o,i)=>{if(t&&!t(o,i))return!1;const r=m.Vec2.of(i.pageX??i.clientX,i.pageY??i.clientY),s=i.pointerId??0;let a=!0;if("pointerdown"===o)n[s]={eventBuffer:[[o,i]],startPoint:r,hasMovedSignificantly:!1},this.setPointerCapture(e,i),a=!1;else if("pointermove"===o&&n[s]){const e=n[s].startPoint,t=n[s].eventBuffer,l=10;if(e&&r.distanceTo(e)<l&&!n[s].hasMovedSignificantly)t.push([o,i]),a=!1;else{for(const[e,o]of t)this.handleHTMLPointerEvent(e,o);n[s].eventBuffer=[],n[s].hasMovedSignificantly=!0,a=!0}}else"pointermove"===o?a=!0:("pointerup"===o||"pointercancel"===o)&&n[s]&&n[s].eventBuffer.length>0&&(this.releasePointerCapture(e,i),a=!1,delete n[s]);return a}),o)}handleHTMLKeyDownEvent(e){console.assert("keydown"===e.type,`handling a keydown event with type ${e.type}`);const t=(0,h.keyPressEventFromHTMLEvent)(e);return this.toolController.dispatchInputEvent(t)?(e.preventDefault(),!0):"t"===t.key||"T"===t.key?(e.preventDefault(),this.display.rerenderAsText(),!0):"Escape"===t.key&&(this.renderingRegion.blur(),!0)}handleHTMLKeyUpEvent(e){console.assert("keyup"===e.type,`Handling a keyup event with type ${e.type}`);const t=(0,h.keyUpEventFromHTMLEvent)(e);return!!this.toolController.dispatchInputEvent(t)&&(e.preventDefault(),!0)}handleKeyEventsFrom(e,t=()=>!0){(0,B.default)(e,{filter:t,handleKeyDown:e=>{this.handleHTMLKeyDownEvent(e)},handleKeyUp:e=>{this.handleHTMLKeyUpEvent(e)},getHandlesKeyEventsFrom:e=>this.eventListenerTargets.includes(e)}),e.ondragover=e=>{e.preventDefault()},e.ondrop=e=>{this.handleDrop(e)},this.eventListenerTargets.push(e)}setReadOnly(e){e!==this.readOnly.get()&&(this.readOnly.set(e),this.notifier.dispatch(d.EditorEventType.ReadOnlyModeToggled,{kind:d.EditorEventType.ReadOnlyModeToggled,editorIsReadOnly:e}))}isReadOnlyReactiveValue(){return this.readOnly}isReadOnly(){return this.readOnly}dispatch(e,t=!0){const o=this.dispatchNoAnnounce(e,t),n=e.description(this,this.localization);return this.announceForAccessibility(n),o}dispatchNoAnnounce(e,t=!1){const o=e.apply(this);if(t){const t=!1;this.history.push(e,t)}return o}async asyncApplyOrUnapplyCommands(e,t,o){console.assert(o>0),this.display.setDraftMode(!0);for(let n=0;n<e.length;n+=o){this.showLoadingWarning(n/e.length);for(let i=n;i<e.length&&i<n+o;i++){const o=e[i];t?o.apply(this):o.unapply(this)}n+o<e.length&&await new Promise((e=>{this.rerender(),requestAnimationFrame(e)}))}this.display.setDraftMode(!1),this.hideLoadingWarning()}asyncApplyCommands(e,t){return this.asyncApplyOrUnapplyCommands(e,!0,t)}asyncUnapplyCommands(e,t,o=!1){return o&&(e=[...e]).reverse(),this.asyncApplyOrUnapplyCommands(e,!1,t)}queueRerender(){return this.rerenderQueued||(this.rerenderQueued=!0,requestAnimationFrame((()=>{this.rerenderQueued&&(this.rerender(),this.rerenderQueued=!1)}))),new Promise((e=>{this.nextRerenderListeners.push((()=>e()))}))}isRerenderQueued(){return this.rerenderQueued}rerender(e=!0){if(this.display.startRerender(),0===this.display.width||0===this.display.height)return;const t=this.display.getDryInkRenderer();if(this.image.renderWithCache(t,this.display.getCache(),this.viewport),e&&!this.image.getAutoresizeEnabled()){const e={fill:m.Color4.fromHex("#44444455")},o=5*this.viewport.getSizeOfPixelOnCanvas();t.drawRect(this.getImportExportRect(),o,e)}this.rerenderQueued=!1,this.nextRerenderListeners.forEach((e=>e())),this.nextRerenderListeners=[]}drawWetInk(...e){for(const t of e)this.display.getWetInkRenderer().drawPath(t)}clearWetInk(){this.display.getWetInkRenderer().clear()}focus(){this.renderingRegion.focus()}createHTMLOverlay(e){return e.classList.add("overlay","js-draw-editor-overlay"),this.container.appendChild(e),{remove:()=>e.remove()}}anchorElementToCanvas(e,t){t instanceof m.Mat33&&(t=D.default.fromImmutable(t));const o=document.createElement("div");o.classList.add("anchored-element-overlay");const n=document.createElement("div");n.classList.add("content-wrapper"),e.classList.add("content");const i=()=>{const e=t.get().transformVec3(m.Vec2.unitX).angle()+this.viewport.getRotationAngle(),n=this.viewport.canvasToScreenTransform.rightMul(t.get());o.style.setProperty("--full-transform",n.toCSSMatrix());const i=n.transformVec2(m.Vec2.zero);o.style.setProperty("--position-x",`${i.x}px`),o.style.setProperty("--position-y",`${i.y}px`),o.style.setProperty("--rotation",180*e/Math.PI+"deg"),o.style.setProperty("--scale",`${n.getScaleFactor()}`)};i();const r=t.onUpdate(i),s=this.notifier.on(d.EditorEventType.ViewportChanged,i);return n.appendChild(e),o.appendChild(n),o.classList.add("overlay","js-draw-editor-overlay"),this.renderingRegion.insertAdjacentElement("afterend",o),{remove:()=>{o.remove(),r.remove(),s.remove()}}}addStyleSheet(e){const t=document.createElement("style");return t.innerText=e,this.container.appendChild(t),t}sendKeyboardEvent(e,t,o=!1,n=!1,i=void 0){i??=t.toUpperCase()===t&&t.toLowerCase()!==t,this.toolController.dispatchInputEvent({kind:e,key:t,code:(0,I.default)(t),ctrlKey:o,altKey:n,shiftKey:i})}sendPenEvent(e,t,o){(0,E.default)(this,e,t,o)}async addAndCenterComponents(e,t=!0,o){let n=null;for(const t of e)n=n?n.union(t.getBBox()):t.getBBox();if(!n)return;const i=this.viewport.visibleRect,r=i.width/n.width,s=i.height/n.height;let a=r;(n.width*a>i.width||n.height*a>i.height)&&(a=s),a*=2/3,a=p.default.roundScaleRatio(a);const c=m.Mat33.translation(i.center.minus(n.center)).rightMul(m.Mat33.scaling2D(a,n.center)),d=[];for(const t of e)d.push(l.default.addComponent(t)),d.push(t.transformBy(c));if(await this.dispatch((0,T.default)(d,{applyChunkSize:100,description:o}),!0),t)for(const t of this.toolController.getMatchingTools(C.default))t.setEnabled(!0),t.setSelection(e)}toDataURL(e="image/png",t){const{element:o,renderer:n}=x.default.fromViewport(this.image.getImportExportViewport(),{canvasSize:t});return this.image.renderAll(n),o.toDataURL(e)}toSVG(e){return(0,O.editorImageToSVGSync)(this.image,e??{})}async toSVGAsync(e={}){const t=e.pauseAfterCount??100;return await(0,O.editorImageToSVGAsync)(this.image,(async(o,n,i)=>(!e.onProgress||!1!==await e.onProgress(n,i))&&(n%t==0&&await(0,S.default)(),!0)),{minDimension:e.minDimension})}async loadFrom(e){this.showLoadingWarning(0),this.display.setDraftMode(!0);const t=this.image.getBackgroundComponents(),o=new P.default(t);await e.start((async e=>{await this.dispatchNoAnnounce(l.default.addComponent(e))}),((e,t)=>e%500==0?(this.showLoadingWarning(e/t),this.rerender(),(0,S.default)()):null),((e,t)=>{this.dispatchNoAnnounce(this.setImportExportRect(e),!1),this.dispatchNoAnnounce(this.viewport.zoomTo(e),!1),t&&this.dispatchNoAnnounce(this.image.setAutoresizeEnabled(t.autoresize),!1)})),this.image.getBackgroundComponents().length!==t.length&&await this.dispatchNoAnnounce(o),this.hideLoadingWarning(),this.display.setDraftMode(!1),this.queueRerender()}getTopmostBackgroundComponent(){let e=null;for(const t of this.image.getBackgroundComponents())t instanceof k.default&&(e=t);return e}setBackgroundStyle(e){const t=this.getTopmostBackgroundComponent(),o=[];t&&o.push(new P.default([t]));const n=t?.getBackgroundType?.()??k.BackgroundType.None,i=t?.getStyle?.().color??m.Color4.transparent,r=this.image.getAutoresizeEnabled(),s=e.color&&n===k.BackgroundType.None?k.BackgroundType.SolidColor:n,a=e.type??s,c=e.color??i,d=e.autoresize??r;if(a!==k.BackgroundType.None){const e=new k.default(a,c);o.push(l.default.addComponent(e))}return d!==r&&(o.push(this.image.setAutoresizeEnabled(d)),d||0!==this.image.getImportExportRect().maxDimension||o.push(this.image.setImportExportRect(this.image.getImportExportRect().resizedTo(m.Vec2.of(500,500))))),(0,T.default)(o)}setBackgroundColor(e){let t=this.getTopmostBackgroundComponent();if(t)return t.updateStyle({color:e});{const o=e.eq(m.Color4.transparent)?k.BackgroundType.None:k.BackgroundType.SolidColor;return t=new k.default(o,e),this.image.addComponent(t)}}estimateBackgroundColor(){const e=[];for(const t of this.image.getBackgroundComponents())t instanceof k.default&&e.push(t.getStyle().color??m.Color4.transparent);return m.Color4.average(e)}getImportExportRect(){return this.image.getImportExportViewport().visibleRect}setImportExportRect(e){return this.image.setImportExportRect(e)}async loadFromSVG(e,t=!1){const o=b.default.fromString(e,{sanitize:t,plugins:this.getCurrentSettings().svg?.loaderPlugins});await this.loadFrom(o)}showAboutDialog(){const e=this.icons.licenseInfo(),t=[];if(this.settings.appInfo){const e=[];this.settings.appInfo.version&&e.push(`v${this.settings.appInfo.version}`,""),this.settings.appInfo.description?e.push(this.settings.appInfo.description+"\n"):e.push(`js-draw v${L.default.number}`),t.push({heading:`${this.settings.appInfo.name}`,text:e.join("\n")})}else t.push({heading:"js-draw",text:`v${L.default.number}`});const o=this.viewport.getScreenRectSize();t.push({heading:this.localization.developerInformation,text:["Image debug information (from when this dialog was opened):",`    ${this.viewport.getScaleFactor()}x zoom, ${180/Math.PI*this.viewport.getRotationAngle()}° rotation`,`    ${this.image.estimateNumElements()} components`,"    auto-resize: "+(this.image.getAutoresizeEnabled()?"enabled":"disabled"),`    image size: ${this.getImportExportRect().w}x${this.getImportExportRect().h}`,`    screen size: ${o.x}x${o.y}`,`    device pixel ratio: ${this.display.getDevicePixelRatio()}`,"    cache:",`        ${this.display.getCache().getDebugInfo().replace(/([\n])/g,"\n        ")}`].join("\n"),minimized:!0}),t.push({heading:this.localization.softwareLibraries,text:[`This image editor is powered by js-draw v${L.default.number}.`,"","At runtime, js-draw uses"," - The Coloris color picker: https://github.com/mdbassit/Coloris"," - The bezier.js Bézier curve library: https://github.com/Pomax/bezierjs","","Both are licensed under the MIT license:","","","== Coloris ==",(0,A.default)("2021 Mohammed Bassit"),"","","== Bezier.js ==",(0,A.default)('2023 Mike "Pomax" Kamermans'),"","","== js-draw ==",(0,A.default)("2023-2025 Henry Heino"),""].join("\n"),minimized:!0}),e&&t.push({heading:"Icon Pack",text:e,minimized:!0}),t.push(...this.settings.notices),this.closeAboutDialog?.(),this.closeAboutDialog=(0,R.default)(this,t).close}remove(){this.container.remove(),this.toolController.onEditorDestroyed()}}t.Editor=F,t.default=F},9168:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.listeners={}}dispatch(e,t){const o=this.listeners[e];if(o)for(let e=0;e<o.length;e++)o[e](t)}on(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),{remove:()=>{const o=this.listeners[e];return this.off(e,t),o.length!==this.listeners[e].length}}}off(e,t){const o=this.listeners[e];o&&(this.listeners[e]=o.filter((e=>e!==t)))}}},7372:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointerDevice=void 0;const n=o(3755);var i;!function(e){e[e.Pen=0]="Pen",e[e.Eraser=1]="Eraser",e[e.Touch=2]="Touch",e[e.PrimaryButtonMouse=3]="PrimaryButtonMouse",e[e.RightButtonMouse=4]="RightButtonMouse",e[e.Other=5]="Other"}(i||(t.PointerDevice=i={}));class r{constructor(e,t,o,n,i,r,s,a){this.screenPos=e,this.canvasPos=t,this.pressure=o,this.isPrimary=n,this.down=i,this.device=r,this.id=s,this.timeStamp=a}snappedToGrid(e){const t=e.snapToGrid(this.canvasPos);return this.withCanvasPosition(t,e)}lockedToXYAxesScreen(e,t){const o=this.screenPos.minus(e),i=n.Vec2.unitX.times(o.x),r=n.Vec2.unitY.times(o.y);let s;return s=o.dot(i)>o.dot(r)?i:r,s=s.plus(e),this.withScreenPosition(s,t)}withScreenPosition(e,t){const o=t.screenToCanvas(e);return this.withCanvasPosition(o,t)}withTimestamp(e){return new r(this.screenPos,this.canvasPos,this.pressure,this.isPrimary,this.down,this.device,this.id,e)}withCanvasPosition(e,t){const o=t.canvasToScreen(e);return new r(o,e,this.pressure,this.isPrimary,this.down,this.device,this.id,this.timeStamp)}static ofEvent(e,t,o,s){let a=n.Vec2.of(e.clientX,e.clientY);if(s){const e=s.getBoundingClientRect();a=a.minus(n.Vec2.of(e.left,e.top))}let l={mouse:i.PrimaryButtonMouse,pen:i.Pen,touch:i.Touch}[e.pointerType]??i.Other;l===i.Pen&&32&e.buttons&&(l=i.Eraser);const c=e.timeStamp,d=o.roundPoint(o.screenToCanvas(a));return l===i.PrimaryButtonMouse&&2&e.buttons&&(l=i.RightButtonMouse),new r(a,d,e.pressure??null,e.isPrimary,t,l,e.pointerId,c)}static ofCanvasPoint(e,t,o,n=0,s=i.Pen,a=!0,l=null,c=null){const d=o.canvasToScreen(e);return c??=performance.now(),new r(d,e,l,a,t,s,n,c)}static ofScreenPoint(e,t,o,n=0,s=i.Pen,a=!0,l=null,c=null){const d=o.screenToCanvas(e);return c??=performance.now(),new r(e,d,l,a,t,s,n,c)}}t.default=r},5466:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SVGLoaderLoadMethod=t.svgLoaderAutoresizeClassName=t.svgLoaderAttributeContainerID=t.svgStyleAttributesDataKey=t.svgAttributesDataKey=t.defaultSVGViewRect=void 0;const l=o(3755),c=s(o(4569)),d=a(o(2192)),h=a(o(332)),u=a(o(7177)),p=s(o(3332)),f=a(o(7983)),m=o(2956),g=o(1712),b=a(o(4188));var v;t.defaultSVGViewRect=new l.Rect2(0,0,500,500),t.svgAttributesDataKey="svgAttrs",t.svgStyleAttributesDataKey="svgStyleAttrs",t.svgLoaderAttributeContainerID="svgContainerID",t.svgLoaderAutoresizeClassName="js-draw--autoresize",function(e){e.IFrame="iframe",e.DOMParser="domparser"}(v||(t.SVGLoaderLoadMethod=v={}));const y=["stroke","fill","stroke-width"];class w{constructor(e,t,o){this.source=e,this.onFinish=t,this.onAddComponent=null,this.onProgress=null,this.onDetermineExportRect=null,this.processedCount=0,this.totalToProcess=0,this.containerGroupIDs=[],this.encounteredIDs=[],this.plugins=o.plugins??[],this.storeUnknown=!o.sanitize,this.disableUnknownObjectWarnings=!!o.disableUnknownObjectWarnings}getStyle(e,t){let o,n=l.Color4.transparent;const i=e.getAttribute("fill")??(t?.fill||e.style?.fill);if(i)try{n=l.Color4.fromString(i)}catch{console.error("Unknown fill color,",i)}const r=e.getAttribute("stroke")??t?.stroke??e.style?.stroke??"",s=e.getAttribute("stroke-width")??t?.strokeWidth??e.style?.strokeWidth??"";if(r&&s)try{let e=parseFloat(s??"1");isFinite(e)||(e=0);const t=l.Color4.fromString(r);t.a>0&&(o={width:e,color:t})}catch(e){console.error("Error parsing stroke data:",e)}return{fill:n,stroke:o}}strokeDataFromElem(e){const t=[],o=e.getAttribute("d")??"",n=this.getStyle(e),i=o.split("M");let r=!0;for(const e of i){const o=/^[0-9., \t\n]+$/.exec(e);if(""!==e&&!o){const o=r?e:`M${e}`,i=l.Path.fromString(o),s=(0,m.pathToRenderable)(i,n);t.push(s)}r=!1}return t}attachUnrecognisedAttrs(e,o,n,i){if(this.storeUnknown){for(const r of o.getAttributeNames())n.has(r)||"style"===r&&i||e.attachLoadSaveData(t.svgAttributesDataKey,[r,o.getAttribute(r)]);if(i&&o.style)for(let n=0;n<o.style.length;n++){const r=o.style[n];""!==r&&r&&(i.has(r)||e.attachLoadSaveData(t.svgStyleAttributesDataKey,{key:r,value:o.style.getPropertyValue(r),priority:o.style.getPropertyPriority(r)}))}}}async addPath(e){let t;try{const o=this.strokeDataFromElem(e);t=new h.default(o),this.attachUnrecognisedAttrs(t,e,new Set([...y,"d"]),new Set(y))}catch(o){if(console.error("Invalid path in node",e,"\nError:",o,"\nAdding as an unknown object."),!this.storeUnknown)return;t=new f.default(e)}await this.addComponent(t)}async addBackground(e){if(e.classList.contains(c.backgroundTypeToClassNameMap[c.BackgroundType.Grid])){let t,o,n,i,r;if("g"===e.tagName.toLowerCase()){if(2!==e.children.length)return void await this.addUnknownNode(e);const i=e.children[0],r=e.children[1];o=i.getAttribute("fill"),t=r.getAttribute("stroke"),n=r.getAttribute("stroke-width")}else o=e.getAttribute("fill"),t=e.getAttribute("stroke"),n=e.getAttribute("stroke-width");if(o??=l.Color4.transparent.toHexString(),!t)return void await this.addUnknownNode(e);for(const t of e.classList)if(t.startsWith(c.imageBackgroundGridSizeCSSPrefix)){const e=t.substring(c.imageBackgroundGridSizeCSSPrefix.length);i=parseFloat(e.replace(/p/g,"."))}n&&(r=parseFloat(n));const s=l.Color4.fromString(o);let a=l.Color4.fromString(t);e.classList.contains(c.imageBackgroundNonAutomaticSecondaryColorCSSClassName)||(a=void 0);const d=c.default.ofGrid(s,i,a,r);await this.addComponent(d)}else if("path"===e.tagName.toLowerCase()){const t=l.Color4.fromString(e.getAttribute("fill")??e.style.fill??"black"),o=new c.default(c.BackgroundType.SolidColor,t);await this.addComponent(o)}else await this.addUnknownNode(e)}getComputedStyle(e){try{return window.getComputedStyle(e)}catch(e){return void console.warn("Error computing style",e)}}getTransform(e,t,o){const n="data-highp-transform",i=e.getAttribute(n);let r;if(i)try{r=l.Mat33.fromCSSMatrix(i),t?.push(n)}catch(e){console.warn(`Unable to parse raw transform data, ${i}. Falling back to CSS data. Error:`,e)}if(!r){o??=this.getComputedStyle(e);let n=o?.transform;n&&"none"!==n||(n=e.style?.transform||"none");try{r=l.Mat33.fromCSSMatrix(e.style.transform)}catch(e){console.warn("matrix parse error",e),r=l.Mat33.fromCSSMatrix(n)}const i=e.getAttribute("x"),s=e.getAttribute("y");if(i||s){const e=parseFloat(i??"0"),o=parseFloat(s??"0");isNaN(e)||isNaN(o)||(t?.push("x","y"),r=r.rightMul(l.Mat33.translation(l.Vec2.of(e,o))))}}return r}makeText(e){const t=[];for(const o of e.childNodes)if(o.nodeType===Node.TEXT_NODE)t.push(o.nodeValue??"");else{if(o.nodeType!==Node.ELEMENT_NODE)throw new Error(`Unrecognized text child node: ${o}.`);{const e=o;if("tspan"!==e.tagName.toLowerCase())throw new Error(`Unrecognized text child element: ${e}`);t.push(this.makeText(e))}}0===t.length&&t.push("");const o=this.getComputedStyle(e),n=new Set(["fontFamily","transform",...y]),i={size:(0,b.default)(e,o,n),fontFamily:o?.fontFamily||e.style?.fontFamily||"sans-serif",fontWeight:o?.fontWeight||e.style?.fontWeight||void 0,fontStyle:o?.fontStyle||e.style?.fontStyle||void 0,renderingStyle:this.getStyle(e,o)},r=[];let s=this.getTransform(e,r,o),a=p.TextTransformMode.ABSOLUTE_XY;const c=e.getAttribute("dx");c&&(a=p.TextTransformMode.RELATIVE_X_ABSOLUTE_Y,s=s.rightMul(l.Mat33.translation(l.Vec2.of(parseFloat(c),0))),r.push("dx"));const d=e.getAttribute("dy");d&&(a=a===p.TextTransformMode.RELATIVE_X_ABSOLUTE_Y?p.TextTransformMode.RELATIVE_XY:p.TextTransformMode.RELATIVE_Y_ABSOLUTE_X,s=s.rightMul(l.Mat33.translation(l.Vec2.of(0,parseFloat(d)))),r.push("dy"));const h=new p.default(t,s,i,a);return this.attachUnrecognisedAttrs(h,e,new Set(r),new Set(n)),h}async addText(e){try{const t=this.makeText(e);await this.addComponent(t)}catch(t){console.error("Invalid text object in node",e,". Continuing.... Error:",t),this.addUnknownNode(e)}}async addImage(e){const t=new Image;t.src=e.getAttribute("xlink:href")??e.href.baseVal,t.setAttribute("alt",e.getAttribute("aria-label")??"");try{const o=[],n=this.getTransform(e,o),i=await d.default.fromImage(t,n);this.attachUnrecognisedAttrs(i,e,new Set(o),new Set(["transform"])),await this.addComponent(i)}catch(t){console.error("Error loading image:",t,". Element: ",e,". Continuing..."),await this.addUnknownNode(e)}}async addUnknownNode(e){if(this.storeUnknown){const t=new f.default(e);await this.addComponent(t)}}async startGroup(e){let t=(e=e.cloneNode(!1)).id||`id-${this.encounteredIDs.length}`,o=0,n="";for(;this.encounteredIDs.includes(t+n);)o++,n="--"+o;t+=n,e.replaceChildren(),e.id=t;const i=new f.default(e);this.addComponent(i),this.containerGroupIDs.push(e.id),this.encounteredIDs.push(e.id)}async endGroup(){this.containerGroupIDs.pop()}async addComponent(e){this.containerGroupIDs.length>0&&e.attachLoadSaveData(t.svgLoaderAttributeContainerID,[...this.containerGroupIDs]),await(this.onAddComponent?.(e))}updateViewBox(e){const o=e.getAttribute("viewBox");if(this.rootViewBox||!o)return;const n=o.split(/[ \t\n,]+/),i=parseFloat(n[0]),r=parseFloat(n[1]),s=parseFloat(n[2]),a=parseFloat(n[3]);if(isNaN(i)||isNaN(r)||isNaN(s)||isNaN(a))return void console.warn(`node ${e} has an unparsable viewbox. Viewbox: ${o}. Match: ${n}.`);const c=e.classList.contains(t.svgLoaderAutoresizeClassName);this.rootViewBox=new l.Rect2(i,r,s,a),this.onDetermineExportRect?.(this.rootViewBox,{autoresize:c})}async updateSVGAttrs(e){this.storeUnknown&&await(this.onAddComponent?.(new u.default(this.getSourceAttrs(e))))}async visit(e){this.totalToProcess+=e.childElementCount;let t=!0;if(await(async()=>{for(const o of this.plugins)if(await o.visit(e,{addComponent:e=>this.onAddComponent?.(e)}))return t=!1,!0;return!1})()?t=!1:await(async()=>{switch(e.tagName.toLowerCase()){case"g":e.classList.contains(c.imageBackgroundCSSClassName)?(await this.addBackground(e),t=!1):await this.startGroup(e);break;case"path":e.classList.contains(c.imageBackgroundCSSClassName)?await this.addBackground(e):await this.addPath(e);break;case"text":await this.addText(e),t=!1;break;case"image":await this.addImage(e),t=!1;break;case"svg":this.updateViewBox(e),this.updateSVGAttrs(e);break;case"style":e.getAttribute("id")!==g.renderedStylesheetId&&await this.addUnknownNode(e);break;default:return this.disableUnknownObjectWarnings||(console.warn("Unknown SVG element,",e,e.tagName),e instanceof SVGElement||console.warn("Element",e,"is not an SVGElement!",this.storeUnknown?"Continuing anyway.":"Skipping.")),void await this.addUnknownNode(e)}})(),t){for(const t of e.children)await this.visit(t);"g"===e.tagName.toLowerCase()&&await this.endGroup()}this.processedCount++,await(this.onProgress?.(this.processedCount,this.totalToProcess))}getSourceAttrs(e){return e.getAttributeNames().map((t=>[t,e.getAttribute(t)]))}async start(e,o,n=null){this.onAddComponent=e,this.onProgress=o,this.onDetermineExportRect=n,this.totalToProcess=this.source.childElementCount,this.processedCount=0,this.rootViewBox=null,await this.visit(this.source),this.rootViewBox||this.onDetermineExportRect?.(t.defaultSVGViewRect),this.onFinish?.(),this.onFinish=null}static fromString(e,t=!1){const o="boolean"!=typeof t&&t?.loadMethod===v.DOMParser,{svgElem:n,cleanUp:i}=(()=>{if(!o)try{const t=document.createElement("iframe");if(t.src="about:blank",t.setAttribute("sandbox","allow-same-origin"),t.setAttribute("csp","default-src 'about:blank'"),t.style.display="none",document.body.appendChild(t),!t.hasAttribute("sandbox"))throw t.remove(),new Error("SVG loading iframe is not sandboxed.");const o=t.contentWindow?.document??t.contentDocument;if(null==o)throw new Error("Unable to open a sandboxed iframe!");o.open(),o.write("\n\t\t\t\t\t\t<!DOCTYPE html>\n\t\t\t\t\t\t<html>\n\t\t\t\t\t\t\t<head>\n\t\t\t\t\t\t\t\t<title>SVG Loading Sandbox</title>\n\t\t\t\t\t\t\t\t<meta name='viewport' conent='width=device-width,initial-scale=1.0'/>\n\t\t\t\t\t\t\t\t<meta charset='utf-8'/>\n\t\t\t\t\t\t\t</head>\n\t\t\t\t\t\t\t<body style='font-size: 12px;'>\n\t\t\t\t\t\t\t\t<script>\n\t\t\t\t\t\t\t\t\tconsole.error('JavaScript should not be able to run here!');\n\t\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t\t'The SVG sandbox is broken! Please double-check the sandboxing setting.'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t<\/script>\n\t\t\t\t\t\t\t</body>\n\t\t\t\t\t\t</html>\n\t\t\t\t\t"),o.close();const n=o.createElementNS("http://www.w3.org/2000/svg","svg");n.innerHTML=e,o.body.appendChild(n);const i=()=>{n.remove(),t.remove(),t.src=""};return{svgElem:n,cleanUp:i}}catch(e){console.warn("Failed loading SVG via a sandboxed iframe. Some styles may not be loaded correctly. Error: ",e)}const t=(new DOMParser).parseFromString(`<svg xmlns="http://www.w3.org/2000/svg">${e}</svg>`,"text/html"),n=t.querySelector("svg"),i=t.querySelector("parsererror");if(i)throw new Error("Parse error: "+i.textContent);return{svgElem:n,cleanUp:()=>{}}})();let r,s,a;return"boolean"==typeof t?(r=t,s=!1,a=[]):(r=t.sanitize??!1,s=t.disableUnknownObjectWarnings??!1,a=t.plugins),new w(n,i,{sanitize:r,disableUnknownObjectWarnings:s,plugins:a})}}t.default=w},4188:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,o)=>{const n=/^([-0-9.e]+)px/i;let i=n.exec(e.style?.fontSize??"");!i&&"tspan"===e.tagName.toLowerCase()&&e.parentElement&&(i=n.exec(e.parentElement.style?.fontSize??"")),!i&&t&&(i=n.exec(t.fontSize));let r=12;return i&&(o.add("fontSize"),r=parseFloat(i[1])),r}},1955:function(e,t,o){"use strict";var n,i,r=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},s=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});const a=o(2572);n=new WeakMap,i=new WeakMap,t.default=class{constructor(e,t,o){this.editor=e,this.announceRedoCallback=t,this.announceUndoCallback=o,n.set(this,void 0),i.set(this,void 0),this.maxUndoRedoStackSize=700,r(this,n,[],"f"),r(this,i,[],"f")}fireUpdateEvent(e,t){this.editor.notifier.dispatch(a.EditorEventType.UndoRedoStackUpdated,{kind:a.EditorEventType.UndoRedoStackUpdated,undoStackSize:s(this,n,"f").length,redoStackSize:s(this,i,"f").length,command:t,stackUpdateType:e})}push(e,t=!0){t&&e.apply(this.editor),s(this,n,"f").push(e);for(const e of s(this,i,"f"))e.onDrop(this.editor);if(r(this,i,[],"f"),s(this,n,"f").length>this.maxUndoRedoStackSize){const e=Math.ceil(this.maxUndoRedoStackSize/100);s(this,n,"f").splice(0,e).forEach((e=>e.onDrop(this.editor)))}this.fireUpdateEvent(a.UndoEventType.CommandDone,e),this.editor.notifier.dispatch(a.EditorEventType.CommandDone,{kind:a.EditorEventType.CommandDone,command:e})}undo(){const e=s(this,n,"f").pop();if(e){s(this,i,"f").push(e);const t=e.unapply(this.editor);return this.announceUndoCallback(e),this.fireUpdateEvent(a.UndoEventType.CommandUndone,e),this.editor.notifier.dispatch(a.EditorEventType.CommandUndone,{kind:a.EditorEventType.CommandUndone,command:e}),t}}redo(){const e=s(this,i,"f").pop();if(e){s(this,n,"f").push(e);const t=e.apply(this.editor);return this.announceRedoCallback(e),this.fireUpdateEvent(a.UndoEventType.CommandRedone,e),this.editor.notifier.dispatch(a.EditorEventType.CommandDone,{kind:a.EditorEventType.CommandDone,command:e}),t}}get undoStackSize(){return s(this,n,"f").length}get redoStackSize(){return s(this,i,"f").length}}},4287:function(e,t,o){"use strict";var n,i,r=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},s=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=t.ViewportTransform=void 0;const l=a(o(1217)),c=o(3755),d=a(o(2832));class h extends l.default{}t.ViewportTransform=h;class u{constructor(e){this.onTransformChangeCallback=e,this.resetTransform(c.Mat33.identity),this.screenRect=c.Rect2.empty}getTemporaryClone(){const e=new u((()=>{}));return e.transform=this.transform,e.inverseTransform=this.inverseTransform,e.screenRect=this.screenRect,e}updateScreenSize(e){this.screenRect=this.screenRect.resizedTo(e)}get visibleRect(){return this.screenRect.transformedBoundingBox(this.inverseTransform)}screenToCanvas(e){return this.inverseTransform.transformVec2(e)}canvasToScreen(e){return this.transform.transformVec2(e)}static transformBy(e){return new u.ViewportTransform(e)}resetTransform(e=c.Mat33.identity){const t=this.transform;this.transform=e,this.inverseTransform=e.inverse(),this.onTransformChangeCallback?.(t,e)}get screenToCanvasTransform(){return this.inverseTransform}get canvasToScreenTransform(){return this.transform}getScreenRectSize(){return this.screenRect.size}getResolution(){return this.getScreenRectSize()}getScaleFactor(){return this.transform.transformVec3(c.Vec3.unitX).magnitude()}getScaleFactorToNearestPowerOfTen(){return this.getScaleFactorToNearestPowerOf(10)}getScaleFactorToNearestPowerOf(e){const t=this.getScaleFactor();return Math.pow(e,Math.round(Math.log(t)/Math.log(e)))}static getGridSize(e){return 50/e}snapToGrid(e){const t=this.getScaleFactorToNearestPowerOf(2),o=e=>{const o=1/u.getGridSize(t);return Math.round(e*o)/o};return c.Vec2.of(o(e.x),o(e.y))}getSizeOfPixelOnCanvas(){return 1/this.getScaleFactor()}getRotationAngle(){return this.transform.transformVec3(c.Vec3.unitX).angle()}static roundPoint(e,t){const o=10**Math.floor(Math.log10(t)),n=e=>Math.round(e/o)*o;return"number"==typeof e?n(e):e.map(n)}roundPoint(e){return u.roundPoint(e,1/this.getScaleFactor())}static roundScaleRatio(e,t=1){if(Math.abs(e)<=1e-12)return 0;const o=10**Math.floor(Math.log10(Math.abs(e))),n=2**t;return Math.round(e/o*n)/n*o}computeZoomToTransform(e,t=!0,o=!0){let n=c.Mat33.identity;if(0===e.w||0===e.h){let n=Math.max(e.w,e.h);0===n&&(n=50,t=!1,o=!1),e=new c.Rect2(e.x,e.y,n,n)}if(isNaN(e.size.magnitude()))throw new Error(`${e.toString()} rectangle has NaN size! Cannot zoom to!`);const i=()=>{const e=this.visibleRect.transformedBoundingBox(n.inverse());return e.transformedBoundingBox(c.Mat33.scaling2D(.8,e.center))};let r=i();const s=r.w<e.w||r.h<e.h,a=e.maxDimension/r.maxDimension<1/3;if(s&&o||a&&t){const t=Math.max(e.w/r.w,e.h/r.h),o=c.Mat33.scaling2D(t,r.topLeft).inverse();n=n.rightMul(o)}if(r=i(),!r.containsRect(e)){const t=e.center.minus(r.center),o=c.Mat33.translation(t).inverse();n=n.rightMul(o)}return n.invertable()||(console.warn("Unable to zoom to ",e,"! Computed transform",n,"is singular."),n=c.Mat33.identity),n}zoomTo(e,t=!0,o=!0){const n=this.computeZoomToTransform(e,t,o);return new u.ViewportTransform(n)}}t.Viewport=u,u.ViewportTransform=(i=class extends h{constructor(e){super(),this.transform=e,n.set(this,void 0),r(this,n,e.inverse(),"f")}apply(e){const t=e.viewport;t.resetTransform(t.transform.rightMul(this.transform)),e.queueRerender()}unapply(e){const t=e.viewport;t.resetTransform(t.transform.rightMul(s(this,n,"f"))),e.queueRerender()}description(e,t){return(0,d.default)(e.viewport.visibleRect.center,this.transform,!0,t)}},n=new WeakMap,i),t.default=u},1217:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Command=void 0;class o{onDrop(e){}static union(e,t){return new class extends o{apply(o){e.apply(o),t.apply(o)}unapply(o){t.unapply(o),e.unapply(o)}description(o,n){const i=e.description(o,n),r=t.description(o,n);return i===r?i:`${i}, ${r}`}}}}t.Command=o,o.empty=new class extends o{description(e,t){return""}apply(e){}unapply(e){}},t.default=o},7005:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(4167)),r=o(5673),s=n(o(3538)),a=n(o(8164));class l extends a.default{constructor(e,t){super("duplicate"),this.toDuplicate=e,this.duplicates=e.map(((e,o)=>t&&t[o]?e.cloneWithId(t[o]):e.clone())),this.reverse=new s.default(this.duplicates)}apply(e){this.reverse.unapply(e)}unapply(e){this.reverse.apply(e)}onDrop(e){this.reverse.onDrop(e)}description(e,t){return 0===this.duplicates.length?t.duplicatedNoElements:t.duplicateAction((0,i.default)(t,this.duplicates)??t.elements,this.duplicates.length)}serializeToJSON(){return{originalIds:this.toDuplicate.map((e=>e.getId())),cloneIds:this.duplicates.map((e=>e.getId()))}}}a.default.register("duplicate",((e,t)=>{let o,n;Array.isArray(e)?(o=e,n=[]):(o=e.originalIds,n=e.cloneIds),(0,r.assertIsStringArray)(o),(0,r.assertIsStringArray)(n);const i=[],s=[];for(let e=0;e<o.length;e++){const r=o[e],a=t.image.lookupElement(r);a?(s.push(n[e]),i.push(a)):console.warn("Duplicate command: Could not find element with ID",r)}return new l(i,s)})),t.default=l},3538:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(6583)),r=n(o(4167)),s=n(o(2709)),a=n(o(8164));class l extends a.default{constructor(e){super("erase"),this.toRemove=e.map((e=>e)),this.applied=!1}apply(e){for(const t of this.toRemove){const o=e.image.findParent(t);o&&(o.remove(),e.image.onDestroyElement(t))}this.applied=!0,e.queueRerender()}unapply(e){for(const t of this.toRemove)e.image.findParent(t)||s.default.addComponent(t).apply(e);this.applied=!1,e.queueRerender()}onDrop(e){if(this.applied)for(const t of this.toRemove)e.image.onDestroyElement(t)}description(e,t){if(0===this.toRemove.length)return t.erasedNoElements;const o=(0,r.default)(t,this.toRemove)??t.elements;return t.eraseAction(o,this.toRemove.length)}serializeToJSON(){return this.toRemove.map((e=>e.serialize()))}}a.default.register("erase",((e,t)=>{if(!Array.isArray(e))throw new Error("seralized erase data must be an array");const o=e.map((e=>{const o="string"==typeof e?e:`${e.id}`;return t.image.lookupElement(o)??i.default.deserialize(e)}));return new l(o)})),t.default=l},8164:function(e,t,o){"use strict";var n,i=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},r=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(o(1217));class l extends a.default{constructor(e){if(super(),n.set(this,void 0),!(e in l.deserializationCallbacks))throw new Error(`Command ${e} must have a registered deserialization callback. To do this, call SerializableCommand.register.`);i(this,n,e,"f")}serialize(){return{data:this.serializeToJSON(),commandType:r(this,n,"f")}}static deserialize(e,t){const o="string"==typeof e?JSON.parse(e):e,n=o.commandType;if(!(n in l.deserializationCallbacks))throw new Error(`Unrecognised command type ${n}!`);return l.deserializationCallbacks[n](o.data,t)}static register(e,t){l.deserializationCallbacks[e]=t}}n=new WeakMap,l.deserializationCallbacks={},t.default=l},6620:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(8164));class r extends i.default{constructor(e,t,o){super(e),this.component=o??null,this.componentID=t}resolveComponent(e){if(this.component)return;const t=e.lookupElement(this.componentID);if(!t)throw new Error(`Unable to resolve component with ID ${this.componentID}`);this.component=t}}t.default=r},7365:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(1217)),r=n(o(8164)),s=e=>e instanceof r.default?new class extends r.default{constructor(){super(...arguments),this._command=e}serializeToJSON(){return e.serialize()}apply(t){e.unapply(t)}unapply(t){e.apply(t)}onDrop(t){e.onDrop(t)}description(t,o){return o.inverseOf(e.description(t,o))}}("inverse"):new class extends i.default{apply(t){e.unapply(t)}unapply(t){e.apply(t)}onDrop(t){e.onDrop(t)}description(t,o){return o.inverseOf(e.description(t,o))}};r.default.register("inverse",((e,t)=>s(r.default.deserialize(e,t)))),t.default=s},4671:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.uniteCommands=t.invertCommand=t.SerializableCommand=t.Erase=t.Duplicate=t.Command=void 0;const i=n(o(1217));t.Command=i.default;const r=n(o(7005));t.Duplicate=r.default;const s=n(o(3538));t.Erase=s.default;const a=n(o(7365));t.invertCommand=a.default;const l=n(o(8164));t.SerializableCommand=l.default;const c=n(o(1583));t.uniteCommands=c.default},2939:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultCommandLocalization=void 0,t.defaultCommandLocalization={updatedViewport:"Transformed Viewport",transformedElements:(e,t)=>`Transformed ${e} element${1===e?"":"s"} (${t})`,resizeOutputCommand:e=>`Resized image to ${e.w}x${e.h}`,enabledAutoresizeOutputCommand:"Enabled output autoresize",disabledAutoresizeOutputCommand:"Disabled output autoresize",addComponentAction:e=>`Added ${e}`,eraseAction:(e,t)=>`Erased ${t} ${e}`,duplicateAction:(e,t)=>`Duplicated ${t} ${e}`,unionOf:(e,t)=>`Union: ${t} ${e}`,inverseOf:e=>`Inverse of ${e}`,elements:"Elements",erasedNoElements:"Erased nothing",duplicatedNoElements:"Duplicated nothing",rotatedBy:e=>`Rotated by ${Math.abs(e)} degrees ${e<0?"clockwise":"counter-clockwise"}`,movedLeft:"Moved left",movedUp:"Moved up",movedDown:"Moved down",movedRight:"Moved right",zoomedOut:"Zoomed out",zoomedIn:"Zoomed in",andNMoreCommands:e=>`And ${e} more commands.`,selectedElements:e=>`Selected ${e} element${1===e?"":"s"}`}},1583:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(6507)),r=n(o(1217)),s=n(o(8164));class a extends r.default{constructor(e,t,o){super(),this.commands=e,this.applyChunkSize=t,this.descriptionOverride=o}apply(e){if(void 0===this.applyChunkSize){const t=this.commands.map((t=>t.apply(e)));return(0,i.default)(t)}return e.asyncApplyCommands(this.commands,this.applyChunkSize)}unapply(e){const t=[...this.commands];if(t.reverse(),void 0===this.applyChunkSize){const o=t.map((t=>t.unapply(e)));return(0,i.default)(o)}return e.asyncUnapplyCommands(t,this.applyChunkSize,!1)}onDrop(e){this.commands.forEach((t=>t.onDrop(e)))}description(e,t){if(this.descriptionOverride)return this.descriptionOverride;const o=[];let n=null,i=0,r=0;for(const s of this.commands){const a=s.description(e,t);a!==n&&null!==n&&(o.push(t.unionOf(n,i)),n=null,i=0),i++,r++,n??=a;const l=12;if(o.length>l)break}return i>1?o.push(t.unionOf(n,i)):1===i&&o.push(n),r<this.commands.length&&o.push(t.andNMoreCommands(this.commands.length-r)),o.join(", ")}}class l extends s.default{constructor(e,t,o){super("union"),this.commands=e,this.applyChunkSize=t,this.descriptionOverride=o,this.nonserializableCommand=new a(e,t,o)}serializeToJSON(){return this.serializedData?this.serializedData:{applyChunkSize:this.applyChunkSize,data:this.commands.map((e=>e.serialize())),description:this.descriptionOverride}}apply(e){return this.serializedData=this.serializeToJSON(),this.nonserializableCommand.apply(e)}unapply(e){return this.nonserializableCommand.unapply(e)}onDrop(e){this.nonserializableCommand.onDrop(e)}description(e,t){return this.nonserializableCommand.description(e,t)}}const c=(e,t)=>{let o,n,i=!0;for(const t of e)if(!(t instanceof s.default)){i=!1;break}return"number"==typeof t?o=t:(o=t?.applyChunkSize,n=t?.description),i?new l(e,o,n):new a(e,o,n)};s.default.register("union",((e,t)=>{if("number"!=typeof e.data.length)throw new Error("Unions of commands must serialize to lists of serialization data.");const o=e.applyChunkSize;if("number"!=typeof o&&void 0!==o)throw new Error("serialized applyChunkSize is neither undefined nor a number.");const n="string"==typeof e.description?e.description:void 0,i=[];for(const o of e.data)i.push(s.default.deserialize(o,t));return c(i,{applyChunkSize:o,description:n})})),t.default=c},6583:function(e,t,o){"use strict";var n,i=this&&this.__setFunctionName||function(e,t,o){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:o?"".concat(o," ",t):t})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentSizingMode=void 0;const s=r(o(8164)),a=r(o(2709)),l=o(3755),c=r(o(6620)),d=r(o(2832)),h=o(5673);var u;!function(e){e[e.BoundingBox=0]="BoundingBox",e[e.FillScreen=1]="FillScreen",e[e.Anywhere=2]="Anywhere"}(u||(t.ComponentSizingMode=u={}));class p{constructor(e,t){if(this.componentKind=e,this.loadSaveData={},this.lastChangedTime=(new Date).getTime(),this.zIndex=void 0!==t?t:p.zIndexCounter++,this.id=`${(new Date).getTime()}-${Math.random()}`,void 0===p.deserializationCallbacks[e])throw new Error(`Component ${e} has not been registered using AbstractComponent.registerComponent`)}getId(){return this.id}static registerComponent(e,t){this.deserializationCallbacks[e]=t??null}attachLoadSaveData(e,t){this.loadSaveData[e]||(this.loadSaveData[e]=[]),this.loadSaveData[e].push(t)}getLoadSaveData(){return this.loadSaveData}getZIndex(){return this.zIndex}getBBox(){return this.contentBBox}getExactBBox(){return this.getBBox()}getSizingMode(){return u.BoundingBox}occludesEverythingBelowWhenRenderedInRect(e){return!1}onAddToImage(e){}onRemoveFromImage(){}intersectsRect(e){return!!e.containsRect(this.getExactBBox())||e.getEdges().some((e=>this.intersects(e)))}keyPoints(){return[this.getBBox().center]}isSelectable(){return!0}isBackground(){return!1}getProportionalRenderingTime(){return 1}transformBy(e){return new p.TransformElementCommand(e,this.getId(),this)}setZIndex(e){return new p.TransformElementCommand(l.Mat33.identity,this.getId(),this,e)}setZIndexAndTransformBy(e,t,o){return new p.TransformElementCommand(e,this.getId(),this,t,o)}clone(){const e=this.createClone();for(const t in this.loadSaveData)for(const o of this.loadSaveData[t])e.attachLoadSaveData(t,o);return e}cloneWithId(e){const t=this.clone();return t.id=e,t}serialize(){const e=this.serializeToJSON();if(null===e)throw new Error(`${this} cannot be serialized.`);return{name:this.componentKind,zIndex:this.zIndex,id:this.id,loadSaveData:this.loadSaveData,data:e}}static isNotDeserializable(e){return"string"==typeof e&&(e=JSON.parse(e)),"object"!=typeof e||!this.deserializationCallbacks[e?.name]||!e.data}static deserialize(e){if("string"==typeof e&&(e=JSON.parse(e)),p.isNotDeserializable(e))throw new Error(`Element with data ${e} cannot be deserialized.`);const t=this.deserializationCallbacks[e.name](e.data);return e.id&&((0,h.assertIsString)(e.id),t.id=e.id),isFinite(e.zIndex)&&(t.zIndex=e.zIndex,p.zIndexCounter=Math.max(p.zIndexCounter,t.zIndex+1)),t}}p.zIndexCounter=0,p.deserializationCallbacks={},p.transformElementCommandId="transform-element",p.TransformElementCommand=(i(n=class extends c.default{constructor(e,t,o,n,i){super(p.transformElementCommandId,t,o),this.affineTransfm=e,this.origZIndex=i,this.targetZIndex=n??p.zIndexCounter++,this.targetZIndex>=p.zIndexCounter&&(p.zIndexCounter=this.targetZIndex+1),o&&void 0===i&&(this.origZIndex=o.getZIndex())}resolveComponent(e){this.component||(super.resolveComponent(e),this.origZIndex??=this.component.getZIndex())}updateTransform(e,t,o){if(!this.component)throw new Error("this.component is undefined or null!");const n=e.image.findParent(this.component);let i=!1;n&&(n.remove(),i=!0),this.component.applyTransformation(t),this.component.zIndex=o,this.component.lastChangedTime=(new Date).getTime(),o>=p.zIndexCounter&&(p.zIndexCounter=o+1),i&&a.default.addComponent(this.component).apply(e)}apply(e){this.resolveComponent(e.image),this.updateTransform(e,this.affineTransfm,this.targetZIndex),e.queueRerender()}unapply(e){this.resolveComponent(e.image),this.updateTransform(e,this.affineTransfm.inverse(),this.origZIndex),e.queueRerender()}description(e,t){return t.transformedElements(1,(0,d.default)(l.Vec2.zero,this.affineTransfm,!1,t))}serializeToJSON(){return{id:this.componentID,transfm:this.affineTransfm.toArray(),targetZIndex:this.targetZIndex,origZIndex:this.origZIndex}}},"TransformElementCommand"),s.default.register(p.transformElementCommandId,((e,t)=>{const o=t.image.lookupElement(e.id)??void 0,n=new l.Mat33(...e.transfm),i=e.targetZIndex,r=e.origZIndex??void 0;return new p.TransformElementCommand(n,e.id,o,i,r)})),n),t.default=p},4569:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.backgroundTypeToClassNameMap=t.imageBackgroundNonAutomaticSecondaryColorCSSClassName=t.imageBackgroundGridSizeCSSPrefix=t.imageBackgroundCSSClassName=t.BackgroundType=void 0;const l=o(2709),c=o(3755),d=s(o(6583)),h=o(3048),u=a(o(4287)),p=o(2956);var f;!function(e){e[e.SolidColor=0]="SolidColor",e[e.Grid=1]="Grid",e[e.None=2]="None"}(f||(t.BackgroundType=f={})),t.imageBackgroundCSSClassName="js-draw-image-background",t.imageBackgroundGridSizeCSSPrefix="js-draw-image-background-grid-",t.imageBackgroundNonAutomaticSecondaryColorCSSClassName="js-draw-image-background-non-automatic-secondary-color",t.backgroundTypeToClassNameMap={[f.Grid]:"js-draw-image-background-grid",[f.SolidColor]:t.imageBackgroundCSSClassName,[f.None]:""};class m extends d.default{constructor(e,t){super("image-background",0),this.backgroundType=e,this.mainColor=t,this.viewportSizeChangeListener=null,this.autoresizeChangedListener=null,this.fillsScreen=!1,this.gridSize=u.default.getGridSize(2),this.gridStrokeWidth=.7,this.secondaryColor=null,this.isRestylableComponent=!0,this.contentBBox=c.Rect2.empty}static ofGrid(e,t,o,n){const i=new m(f.Grid,e);return void 0!==t&&(i.gridSize=t),void 0!==o&&(i.secondaryColor=o),void 0!==n&&(i.gridStrokeWidth=n),i}getBackgroundType(){return this.backgroundType}getMainColor(){return this.mainColor}getSecondaryColor(){return this.secondaryColor}getGridSize(){return this.gridSize}getStyle(){let e=this.mainColor;return this.backgroundType===f.None&&(e=void 0),{color:e}}updateStyle(e){return(0,h.createRestyleComponentCommand)(this.getStyle(),e,this)}forceStyle(e,t){const o=e.color;o&&(this.mainColor=o,o.eq(c.Color4.transparent)&&this.backgroundType===f.SolidColor?this.backgroundType=f.None:this.backgroundType===f.None&&(this.backgroundType=f.SolidColor),t&&(t.image.queueRerenderOf(this),t.queueRerender()))}onAddToImage(e){this.viewportSizeChangeListener&&(console.warn("onAddToImage called when background is already in an image"),this.onRemoveFromImage()),this.viewportSizeChangeListener=e.notifier.on(l.EditorImageEventType.ExportViewportChanged,(()=>{this.recomputeBBox(e)})),this.autoresizeChangedListener=e.notifier.on(l.EditorImageEventType.AutoresizeModeChanged,(()=>{this.recomputeBBox(e)})),this.recomputeBBox(e)}onRemoveFromImage(){this.viewportSizeChangeListener?.remove(),this.autoresizeChangedListener?.remove(),this.viewportSizeChangeListener=null,this.autoresizeChangedListener=null}recomputeBBox(e){const t=e.getImportExportViewport().visibleRect;let o=!1;this.contentBBox.eq(t)||(this.contentBBox=t,o||=!this.fillsScreen);const n=e.getAutoresizeEnabled();n!==this.fillsScreen&&(this.fillsScreen=n,o=!0),o&&e.queueRerenderOf(this)}generateGridPath(e){const t=this.getFullBoundingBox(e),o=(e?.intersection(t)??t).grownBy(this.gridStrokeWidth/2),n=e=>Math.floor(e/this.gridSize)*this.gridSize,i=e=>Math.ceil(e/this.gridSize)*this.gridSize,r=i(o.y),s=n(o.y+o.h),a=i(o.x),l=n(o.x+o.w),d=[],h=(s-r)/this.gridSize,u=(l-a)/this.gridSize;if(h>1e3||u>1e3)return c.Path.empty;const p=c.Vec2.of(o.x,r);for(let e=r;e<=s;e+=this.gridSize)d.push({kind:c.PathCommandType.MoveTo,point:c.Vec2.of(o.x,e)}),d.push({kind:c.PathCommandType.LineTo,point:c.Vec2.of(o.x+o.w,e)});for(let e=a;e<=l;e+=this.gridSize)d.push({kind:c.PathCommandType.MoveTo,point:c.Vec2.of(e,o.y)}),d.push({kind:c.PathCommandType.LineTo,point:c.Vec2.of(e,o.y+o.h)});return new c.Path(p,d)}getFullBoundingBox(e){return(this.fillsScreen?e:this.contentBBox)??this.contentBBox}render(e,o){if(this.backgroundType===f.None)return;const n=!o;this.fillsScreen&&(o??=e.getVisibleRect());const i=this.backgroundType===f.Grid,r=this.getFullBoundingBox(o);if(e.startObject(r,i),this.backgroundType===f.SolidColor||this.backgroundType===f.Grid){const t=o?.intersection(r);t?e.fillRect(t,this.mainColor):n&&e.fillRect(r,this.mainColor)}if(this.backgroundType===f.Grid){let t=this.secondaryColor;t??=c.Color4.ofRGBA(1-this.mainColor.r,1-this.mainColor.g,1-this.mainColor.b,.2),0===this.mainColor.a&&(t=c.Color4.ofRGBA(.5,.5,.5,.2));const n={fill:c.Color4.transparent,stroke:{width:this.gridStrokeWidth,color:t}};e.drawPath((0,p.pathToRenderable)(this.generateGridPath(o),n))}const s=t.backgroundTypeToClassNameMap[this.backgroundType],a=[t.imageBackgroundCSSClassName];if(s!==t.imageBackgroundCSSClassName){a.push(s);const e=(0,c.toRoundedString)(this.gridSize).replace(/[.]/g,"p");a.push(t.imageBackgroundGridSizeCSSPrefix+e)}null!==this.secondaryColor&&a.push(t.imageBackgroundNonAutomaticSecondaryColorCSSClassName),e.endObject(this.getLoadSaveData(),a)}intersects(e){return this.contentBBox.getEdges().some((t=>t.intersects(e)))}isSelectable(){return!1}isBackground(){return!0}getSizingMode(){return this.fillsScreen?d.ComponentSizingMode.FillScreen:d.ComponentSizingMode.BoundingBox}serializeToJSON(){return{mainColor:this.mainColor.toHexString(),secondaryColor:this.secondaryColor?.toHexString(),backgroundType:this.backgroundType,gridSize:this.gridSize,gridStrokeWidth:this.gridStrokeWidth}}applyTransformation(e){}description(e){return this.backgroundType===f.SolidColor?e.filledBackgroundWithColor(this.mainColor.toString()):this.backgroundType===f.None?e.emptyBackground:this.backgroundType===f.Grid?e.gridBackground:this.backgroundType}createClone(){return new m(this.backgroundType,this.mainColor)}static deserializeFromJSON(e){if("string"==typeof e&&(e=JSON.parse(e)),"string"!=typeof e.mainColor)throw new Error("Error deserializing — mainColor must be of type string.");let t;const o=e.backgroundType;if(o!==f.None&&o!==f.Grid&&o!==f.SolidColor)return o;t=o;const n=c.Color4.fromHex(e.mainColor),i=e.secondaryColor?c.Color4.fromHex(e.secondaryColor):null,r=e.gridSize??void 0,s=e.gridStrokeWidth??void 0,a=new m(t,n);return a.secondaryColor=i,r&&(a.gridSize=r),s&&(a.gridStrokeWidth=s),a}}t.default=m,d.default.registerComponent("image-background",m.deserializeFromJSON)},2192:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=o(5673),s=n(o(6583)),a=n(o(3560));class l extends s.default{constructor(e){super("image-component"),this.image={...e,label:e.label??e.image.getAttribute("alt")??e.image.getAttribute("aria-label")??void 0},void 0===e.image.getAttribute("src")||e.image.complete||(e.image.onload=()=>this.recomputeBBox()),this.recomputeBBox()}getImageRect(){return new i.Rect2(0,0,this.image.image.width,this.image.image.height)}recomputeBBox(){this.contentBBox=this.getImageRect(),this.contentBBox=this.contentBBox.transformedBoundingBox(this.image.transform)}static async fromImage(e,t){let o,n,i;await(0,a.default)(e),"number"==typeof e.width&&"number"==typeof e.height&&0!==e.width&&0!==e.height?(o=e.width,n=e.height):(o=e.clientWidth,n=e.clientHeight);let r=e.src??"";if(r.startsWith("data:image/"))i=new Image,i.src=r,i.width=o,i.height=n;else{const t=document.createElement("canvas");t.width=o,t.height=n,t.getContext("2d").drawImage(e,0,0,t.width,t.height),r=t.toDataURL(),i=t}return i.setAttribute("alt",e.getAttribute("alt")??""),i.setAttribute("aria-label",e.getAttribute("aria-label")??""),new l({image:i,base64Url:r,transform:t})}render(e,t){e.startObject(this.contentBBox),e.drawImage(this.image),e.endObject(this.getLoadSaveData())}getProportionalRenderingTime(){return 10}intersects(e){const t=this.getImageRect().getEdges().map((e=>e.transformedBy(this.image.transform)));for(const o of t)if(o.intersects(e))return!0;return!1}applyTransformation(e){this.image.transform=e.rightMul(this.image.transform),this.recomputeBBox()}description(e){return this.image.label?e.imageNode(this.image.label):e.unlabeledImageNode}getAltText(){return this.image.label}getURL(){return this.image.base64Url}getTransformation(){return this.image.transform}createClone(){return new l({...this.image})}serializeToJSON(){return{src:this.image.base64Url,label:this.image.label,width:this.image.image.width,height:this.image.image.height,transform:this.image.transform.toArray()}}static deserializeFromJSON(e){if("string"!=typeof e.src)throw new Error(`${e} has invalid format! Expected src property.`);(0,r.assertIsNumberArray)(e.transform),(0,r.assertIsNumber)(e.width),(0,r.assertIsNumber)(e.height);const t=new Image;t.src=e.src,t.width=e.width,t.height=e.height;const o=new i.Mat33(...e.transform);return new l({image:t,base64Url:e.src,label:e.label,transform:o})}}t.default=l,s.default.registerComponent("image-component",l.deserializeFromJSON)},3048:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isRestylableComponent=t.createRestyleComponentCommand=void 0;const i=o(3755),r=n(o(8164)),s=n(o(6620)),a=o(6154),l=e=>{const t={};return e.color&&(t.color=e.color.toHexString()),e.textStyle&&(t.textStyle=(0,a.textStyleToJSON)(e.textStyle)),t},c=e=>({color:e.color?i.Color4.fromHex(e.color):void 0,textStyle:e.textStyle?(0,a.textStyleFromJSON)(e.textStyle):void 0});t.createRestyleComponentCommand=(e,t,o)=>new h(e,t,o.getId(),o),t.isRestylableComponent=e=>!!("getStyle"in e&&"updateStyle"in e&&"forceStyle"in e)&&!(!("isRestylableComponent"in e)||!e.isRestylableComponent);const d="default-restyle-element";class h extends s.default{constructor(e,t,o,n){super(d,o,n),this.originalStyle=e,this.newStyle=t}getComponent(e){this.resolveComponent(e.image);const t=this.component;if(!t||!t.forceStyle||!t.updateStyle)throw new Error("this.component is missing forceStyle and/or updateStyle methods!");return t}apply(e){this.getComponent(e).forceStyle(this.newStyle,e)}unapply(e){this.getComponent(e).forceStyle(this.originalStyle,e)}description(e,t){return t.restyledElement(this.getComponent(e).description(t))}serializeToJSON(){return{id:this.componentID,originalStyle:l(this.originalStyle),newStyle:l(this.newStyle)}}}r.default.register(d,((e,t)=>{const o=c(e.originalStyle),n=c(e.newStyle),i=e.id;if("string"!=typeof e.id)throw new Error(`json.id is of type ${typeof e.id}, not string.`);return new h(o,n,i)}))},7177:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(3755),c=a(o(1712)),d=s(o(6583)),h="svg-global-attributes";class u extends d.default{constructor(e){super(h),this.contentBBox=l.Rect2.empty;const t=["viewBox","width","height"];this.attrs=e.filter((([e,o])=>!t.includes(e)))}render(e,t){if(e instanceof c.default)for(const[t,o]of this.attrs)e.setRootSVGAttribute(t,o)}intersects(e){return!1}applyTransformation(e){}isSelectable(){return!1}getSizingMode(){return d.ComponentSizingMode.Anywhere}createClone(){return new u(this.attrs)}description(e){return e.svgObject}serializeToJSON(){return JSON.stringify(this.attrs)}static deserializeFromString(e){return new u([])}}t.default=u,d.default.registerComponent(h,u.deserializeFromString)},332:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=o(2293),s=n(o(6583)),a=o(3048),l=o(2956);class c extends s.default{constructor(e,t){super("stroke",t),this.isRestylableComponent=!0,this.simplifiedPath=null,this.approximateRenderingTime=0,this.parts=[];for(const t of e){const e=(0,l.pathFromRenderable)(t),o=this.bboxForPart(e.bbox,t.style);this.contentBBox?this.contentBBox=this.contentBBox.union(o):this.contentBBox=o,this.parts.push({path:e,startPoint:e.startPoint,style:t.style,commands:e.parts}),this.approximateRenderingTime+=e.parts.length}this.contentBBox??=i.Rect2.empty}static fromStroked(e,t){return"string"==typeof e&&(e=i.Path.fromString(e)),new c([(0,l.pathToRenderable)(e,{fill:i.Color4.transparent,stroke:t})])}static fromFilled(e,t){return"string"==typeof e&&(e=i.Path.fromString(e)),new c([(0,l.pathToRenderable)(e,{fill:t})])}getStyle(){if(0===this.parts.length)return{};const e=this.parts[0];return void 0===e.style.stroke||0===e.style.stroke.width?{color:e.style.fill}:{color:e.style.stroke.color}}updateStyle(e){return(0,a.createRestyleComponentCommand)(this.getStyle(),e,this)}forceStyle(e,t){e.color&&(this.parts=this.parts.map((t=>{const o={...t.style,stroke:t.style.stroke?{...t.style.stroke}:void 0};return o.stroke&&o.stroke.width>0?o.stroke.color=e.color:o.fill=e.color,{path:t.path,startPoint:t.startPoint,commands:t.commands,style:o}})),t&&(t.image.queueRerenderOf(this),t.queueRerender()))}withRegionErased(e,t){const o=e.polylineApproximation(),n=[];let r=!1;for(const s of this.parts){const a=s.path,d=e=>{if(s.style.fill.a>0){if(e.parts.length<1||1===e.parts.length&&e.parts[0].kind===i.PathCommandType.LineTo)return null;e=e.asClosed()}return isNaN(e.getExactBBox().area)?(console.warn("Prevented creating a stroke with NaN area"),r=!0,null):new c([(0,l.pathToRenderable)(e,s.style)],this.getZIndex())},h=[];for(const e of o)h.push(...a.intersection(e));let u=!1;if(0===h.length&&s.style.stroke&&s.style.stroke.width>.3*e.bbox.minDimension&&s.style.stroke.width<30*e.bbox.maxDimension){for(const e of o)h.push(...a.intersection(e,s.style.stroke.width/2));u=!0}h.sort(i.comparePathIndices);let p=(()=>{if(0===h.length)return!1;if(u)return 0===h[0].curveIndex&&h[0].parameterValue<=0;const t=(0,i.stepPathIndexBy)(h[0],-1e-10);return o=a.at(t),e.closedContainsPoint(o);var o})()?1:0;const f=(t,o)=>{const i=d(t);let s=p%2==1;p++,void 0!==o&&(s=o),void 0===o&&!s&&e.closedContainsPoint(t.getExactBBox().center)&&(s=!s),i&&(r||=s&&t.getExactBBox().maxDimension>2*e.getExactBBox().maxDimension,s||n.push(i))};if(0===s.style.fill.a){if(!(e.getExactBBox().maxDimension/10>a.getExactBBox().maxDimension)){const e=a.splitAt(h,{mapNewPoint:e=>t.roundPoint(e)});for(const t of e)f(t)}}else if(h.length>=2&&h.length%2==0){const e=a.splitAt(h,{mapNewPoint:e=>t.roundPoint(e)});for(let t=0;t<Math.floor(e.length/2);t++)f(e[t].union(e[e.length-t-1]).asClosed());e.length%2!=0&&f(e[Math.floor(e.length/2)].asClosed())}else f(a,!1)}return r?[this]:n}intersects(e){for(const t of this.parts){const o=t.style.stroke?.width,n=o?o/2:void 0;if(t.path.intersection(e,n).length>0)return!0}return!1}keyPoints(){return this.parts.map((e=>e.startPoint)).flat()}intersectsRect(e){if(!e.intersects(this.getBBox()))return!1;for(const t of this.parts){const o=e.grownBy(-(t.style.stroke?.width??0));if(0!==o.area)for(const e of t.path.startEndPoints())if(o.containsPoint(e))return!0}return super.intersectsRect(e)}computeSimplifiedPathFor(e){const t=[];let o=!1,n=!1;for(const i of this.parts){if(n||!i.style.stroke||i.style.stroke.color.a<.99){t.push(i);continue}const r=(0,l.simplifyPathToFullScreenOrEmpty)(i,e);r?(t.push(r.path),r.fullScreen&&(o=!0,n=!0)):t.push(i)}return{forVisibleRect:e,parts:t,occludes:o}}occludesEverythingBelowWhenRenderedInRect(e){return!!this.getBBox().containsRect(e)&&(this.simplifiedPath&&this.simplifiedPath.forVisibleRect.eq(e)||(this.simplifiedPath=this.computeSimplifiedPathFor(e)),this.simplifiedPath.occludes)}render(e,t){e.startObject(this.getBBox());let o=this.parts;t&&this.simplifiedPath?.forVisibleRect?.containsRect(t)?o=this.simplifiedPath.parts:this.simplifiedPath=null;for(const n of o){const o=this.bboxForPart(n.path.bbox,n.style);if(t){if(!o.intersects(t))continue;if((o.size.x>3*t.size.x||o.size.y>3*t.size.y)&&!n.path.roughlyIntersects(t,n.style.stroke?.width??0))continue}e.drawPath(n)}e.endObject(this.getLoadSaveData())}getProportionalRenderingTime(){return this.approximateRenderingTime}bboxForPart(e,t){return t.stroke?e.grownBy(t.stroke.width/2):e}getExactBBox(){let e=null;for(const{path:t,style:o}of this.parts){const n=this.bboxForPart(t.getExactBBox(),o);e??=n,e=e.union(n)}return e??i.Rect2.empty}applyTransformation(e){this.contentBBox=i.Rect2.empty;let t=!0;this.parts=this.parts.map((o=>{const n=o.path.transformedBy(e),i={...o.style,stroke:o.style.stroke?{...o.style.stroke}:void 0};if(i.stroke){const t=e.getScaleFactor();i.stroke.width*=t}const r=this.bboxForPart(n.bbox,i);return t?(this.contentBBox=r,t=!1):this.contentBBox=this.contentBBox.union(r),{path:n,startPoint:n.startPoint,commands:n.parts,style:i}}))}getParts(){return[...this.parts]}getPath(){let e=null;for(const t of this.parts)e?e=e.union(t.path):e??=t.path;return e??i.Path.empty}description(e){return e.stroke}createClone(){return new c(this.parts)}serializeToJSON(){return this.parts.map((e=>({style:(0,r.styleToJSON)(e.style),path:e.path.serialize()})))}static deserializeFromJSON(e){if("string"==typeof e&&(e=JSON.parse(e)),"object"!=typeof e||"number"!=typeof e.length)throw new Error(`${e} is missing required field, parts, or parts is of the wrong type.`);const t=e.map((e=>{const t=(0,r.styleFromJSON)(e.style);return(0,l.pathToRenderable)(i.Path.fromString(e.path),t)}));return new c(t)}}t.default=c,s.default.registerComponent("stroke",c.deserializeFromJSON)},3332:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TextTransformMode=void 0;const i=o(3755),r=o(6154),s=n(o(6583)),a=o(3048),l="text";var c;!function(e){e[e.ABSOLUTE_XY=0]="ABSOLUTE_XY",e[e.RELATIVE_XY=1]="RELATIVE_XY",e[e.RELATIVE_X_ABSOLUTE_Y=2]="RELATIVE_X_ABSOLUTE_Y",e[e.RELATIVE_Y_ABSOLUTE_X=3]="RELATIVE_Y_ABSOLUTE_X"}(c||(t.TextTransformMode=c={}));const d={fontFamily:"sans",size:12,renderingStyle:{fill:i.Color4.purple}};class h extends s.default{constructor(e,t,o=d,n=c.ABSOLUTE_XY){super(l),this.textObjects=e,this.transform=t,this.style=o,this.transformMode=n,this.isRestylableComponent=!0,this.recomputeBBox(),!e.some((e=>"string"==typeof e))&&e.length>0&&(this.style=e[0].getTextStyle())}static applyTextStyles(e,t){const o=t.fontFamily.match(/\s/),n=t.fontFamily.match(/^".*"$/),i=o&&!n?`"${t.fontFamily.replace(/["]/g,'\\"')}"`:t.fontFamily;e.font=[t.fontStyle??"",t.fontWeight??"",(t.size??12)+"px",`${i}`].join(" "),e.textAlign="left"}static estimateTextDimens(e,t){const o=e.length*t.size,n=t.size;return new i.Rect2(0,2*-n/3,o,n)}static getTextMetrics(e,t){if(h.textMeasuringCtx??=document.createElement("canvas").getContext("2d")??null,!h.textMeasuringCtx)return null;const o=h.textMeasuringCtx;return h.applyTextStyles(o,t),o.measureText(e)}static getTextDimens(e,t){const o=this.getTextMetrics(e,t);if(!o)return this.estimateTextDimens(e,t);const n=-o.actualBoundingBoxAscent,r=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;return new i.Rect2(0,n,o.width,r)}static getFontHeight(e){return e.size}computeUntransformedBBoxOfPart(e){return"string"==typeof e?h.getTextDimens(e,this.style):e.contentBBox}recomputeBBox(){let e=null;const t=new h.TextCursor(this.transform,this.style);for(const o of this.textObjects){const n=t.update(o).transform,i=this.computeUntransformedBBoxOfPart(o).transformedBoundingBox(n);e??=i,e=e.union(i)}this.contentBBox=e??i.Rect2.empty}renderInternal(e,t,o=i.Mat33.identity){const n=new h.TextCursor(this.transform,this.style);for(const i of this.textObjects){const{transform:r,bbox:s}=n.update(i);t&&!t.intersects(s.transformedBoundingBox(o))||("string"==typeof i?e.drawText(i,r,this.style):(e.pushTransform(r),i.renderInternal(e,t,o.rightMul(r)),e.popTransform()))}}render(e,t){e.startObject(this.contentBBox),this.renderInternal(e,t),e.endObject(this.getLoadSaveData())}getProportionalRenderingTime(){return this.textObjects.length}intersects(e){const t=new h.TextCursor(this.transform,this.style);for(const o of this.textObjects){const n=t.update(o).transform.inverse(),i=e.transformedBy(n);if("string"==typeof o){if(h.getTextDimens(o,this.style).getEdges().some((e=>null!==i.intersection(e))))return!0}else if(o.intersects(i))return!0}return!1}getStyle(){return{color:this.style.renderingStyle.fill,textStyle:{...this.style,renderingStyle:{...this.style.renderingStyle}}}}updateStyle(e){return(0,a.createRestyleComponentCommand)(this.getStyle(),e,this)}forceStyle(e,t){if(e.textStyle)this.style=(0,r.cloneTextStyle)(e.textStyle);else{if(!e.color)return;this.style={...this.style,renderingStyle:{...this.style.renderingStyle,fill:e.color}}}for(const o of this.textObjects)o instanceof h&&o.forceStyle(e,t);t&&(t.image.queueRerenderOf(this),t.queueRerender())}getTextStyle(){return(0,r.cloneTextStyle)(this.style)}getBaselinePos(){return this.transform.transformVec2(i.Vec2.zero)}getTransform(){return this.transform}applyTransformation(e){this.transform=e.rightMul(this.transform),this.recomputeBBox()}createClone(){const e=this.textObjects.map((e=>"string"==typeof e?e:e.createClone()));return new h(e,this.transform,this.style)}getText(){const e=[];for(const t of this.textObjects)"string"==typeof t?e.push(t):e.push(t.getText());return e.join("\n")}description(e){return e.text(this.getText())}serializeToJSON(){const e=(0,r.textStyleToJSON)(this.style);return{textObjects:this.textObjects.map((e=>"string"==typeof e?{text:e}:{json:e.serializeToJSON()})),transform:this.transform.toArray(),style:e}}static deserializeFromString(e){"string"==typeof e&&(e=JSON.parse(e));const t=(0,r.textStyleFromJSON)(e.style),o=e.textObjects.map((e=>null!==(e.text??null)?e.text:h.deserializeFromString(e.json)));if(e.transform=e.transform.filter((e=>"number"==typeof e)),9!==e.transform.length)throw new Error(`Unable to deserialize transform, ${e.transform}.`);const n=e.transform,s=new i.Mat33(...n);return new h(o,s,t)}static fromLines(e,t,o){let n=null;const r=[],s=Math.round(this.getFontHeight(o));let a=i.Vec2.zero;for(const t of e){n&&(a=a.plus(i.Vec2.unitY.times(s)));const e=new h([t],i.Mat33.translation(a),o);r.push(e),n=e}return new h(r,t,o)}}h.textMeasuringCtx=null,h.TextCursor=class{constructor(e=i.Mat33.identity,t){this.parentTransform=e,this.parentStyle=t,this.transform=i.Mat33.identity}update(e){let t,o=i.Mat33.identity,n=i.Mat33.identity;"string"==typeof e?t=h.getTextDimens(e,this.parentStyle):(n=e.transform,t=e.getBBox());const r="string"==typeof e?c.RELATIVE_XY:e.transformMode;r===c.RELATIVE_XY?o=this.transform.rightMul(o):r!==c.RELATIVE_X_ABSOLUTE_Y&&r!==c.RELATIVE_Y_ABSOLUTE_X||(o=this.transform.mapEntries(((e,[t,o])=>{if(r===c.RELATIVE_X_ABSOLUTE_Y)return 1===t&&2===o?0:e;if(r===c.RELATIVE_Y_ABSOLUTE_X)return 0===t&&2===o?0:e;throw new Error("Unreachable")})).rightMul(o));const s=i.Mat33.translation(i.Vec2.of(t.width,0));this.transform=o.rightMul(n).rightMul(s);const a=this.parentTransform.rightMul(o);return{transform:a,bbox:t.transformedBoundingBox(a)}}},t.default=h,s.default.registerComponent(l,(e=>h.deserializeFromString(e)))},7983:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(3755),c=a(o(1712)),d=s(o(6583)),h="unknown-svg-object";class u extends d.default{constructor(e){super(h),this.svgObject=e,this.contentBBox=l.Rect2.of(e.getBoundingClientRect())}render(e,t){e instanceof c.default&&(e.startObject(this.contentBBox),e.drawSVGElem(this.svgObject),e.endObject(this.getLoadSaveData()))}intersects(e){return this.contentBBox.getEdges().some((t=>null!==t.intersection(e)))}applyTransformation(e){}isSelectable(){return!1}getSizingMode(){return d.ComponentSizingMode.Anywhere}createClone(){return new u(this.svgObject.cloneNode(!0))}description(e){return e.svgObject}serializeToJSON(){return JSON.stringify({html:this.svgObject.outerHTML})}}t.default=u,d.default.registerComponent(h,null)},2731:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeArrowBuilder=void 0;const i=o(3755),r=n(o(332)),s=n(o(6657));t.makeArrowBuilder=(0,s.default)(((e,t)=>new a(e,t)));class a{constructor(e,t){this.startPoint=e,this.viewport=t,this.endPoint=e}getLineWidth(){return Math.max(this.endPoint.width,this.startPoint.width)}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const e=this.startPoint.pos,t=this.endPoint.pos,o=t.minus(e).normalized(),n=t.distanceTo(e),s=Math.min(this.getLineWidth(),n/2),a=this.startPoint.width/2,l=this.endPoint.width/2,c=t.minus(o.times(s)),d=o.orthog(),h=d.times(a),u=d.times(l),p=new i.Path(c.minus(u),[{kind:i.PathCommandType.LineTo,point:e.minus(h)},{kind:i.PathCommandType.LineTo,point:e.plus(h)},{kind:i.PathCommandType.LineTo,point:c.plus(u)},{kind:i.PathCommandType.LineTo,point:c.plus(d.times(s).plus(u))},{kind:i.PathCommandType.LineTo,point:t.plus(o.times(l))},{kind:i.PathCommandType.LineTo,point:c.plus(d.times(-s).minus(u))},{kind:i.PathCommandType.LineTo,point:c.minus(u)}]).mapPoints((e=>this.viewport.roundPoint(e)));return new r.default([{startPoint:p.startPoint,commands:p.parts,style:{fill:this.startPoint.color}}])}build(){return this.buildPreview()}preview(e){this.buildPreview().render(e)}addPoint(e){this.endPoint=e}}t.default=a},7912:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeOutlinedCircleBuilder=void 0;const i=o(3755),r=o(2956),s=n(o(4287)),a=n(o(332)),l=n(o(6657));t.makeOutlinedCircleBuilder=(0,l.default)(((e,t)=>new c(e,t)));class c{constructor(e,t){this.startPoint=e,this.viewport=t,this.endPoint=e}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const e=[],t=2*Math.PI/6,o=s.default.roundPoint(this.endPoint.width,5/this.viewport.getScaleFactor()),n=this.startPoint.pos.lerp(this.endPoint.pos,.5),l=this.endPoint.pos.minus(n).length()-o/2,c=n.plus(i.Vec2.of(l,0));for(let o=t;o<=2*Math.PI;o+=t){const r=i.Vec2.of(l*Math.cos(o),-l*Math.sin(o)).plus(n),s=1.141,a=i.Vec2.of(Math.cos(o-t/2),-Math.sin(o-t/2)).times(l*s).plus(n);e.push({kind:i.PathCommandType.QuadraticBezierTo,controlPoint:a,endPoint:r})}e.push({kind:i.PathCommandType.LineTo,point:c});const d=new i.Path(c,e).mapPoints((e=>this.viewport.roundPoint(e)));return new a.default([(0,r.pathToRenderable)(d,{fill:i.Color4.transparent,stroke:{width:o,color:this.endPoint.color}})])}build(){return this.buildPreview()}preview(e){this.buildPreview().render(e)}addPoint(e){this.endPoint=e}}},8195:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeFreehandLineBuilder=void 0;const i=o(3755),r=n(o(332)),s=n(o(4287)),a=o(6018),l=n(o(2362));t.makeFreehandLineBuilder=(0,l.default)(((e,t)=>{const o=3*t.getSizeOfPixelOnCanvas(),n=t.getSizeOfPixelOnCanvas();return new c(e,n,o,t)}));class c{constructor(e,t,o,n){this.startPoint=e,this.minFitAllowed=t,this.viewport=n,this.isFirstSegment=!0,this.parts=[],this.widthAverageNumSamples=1,this.curveFitter=new a.StrokeSmoother(e,t,o,(e=>this.addCurve(e))),this.averageWidth=e.width,this.bbox=new i.Rect2(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}getRenderingStyle(){return{fill:i.Color4.transparent,stroke:this.inkTrailStyle()}}inkTrailStyle(){return{color:this.startPoint.color,width:this.roundDistance(this.averageWidth)}}previewCurrentPath(){const e=[...this.parts.slice(),...this.curveToPathCommands(this.curveFitter.preview())];return{startPoint:this.startPoint.pos,commands:e,style:this.getRenderingStyle()}}previewFullPath(){const e=this.previewCurrentPath();return e?[e]:null}previewStroke(){const e=this.previewFullPath();return e?new r.default(e):null}preview(e){const t=this.previewFullPath();if(t){const o=this.viewport.visibleRect;e.startObject(o);for(const o of t)e.drawPath(o);e.endObject()}}build(){return this.curveFitter.finalizeCurrentCurve(),this.previewStroke()}getMinFit(){let e=Math.min(this.minFitAllowed,this.averageWidth/3);return e<1e-10&&(e=this.minFitAllowed),e}roundPoint(e){const t=this.getMinFit();return s.default.roundPoint(e,t)}roundDistance(e){const t=this.getMinFit();return s.default.roundPoint(e,t)}curveToPathCommands(e){if(!e){if(!this.isFirstSegment)return[];const e=s.default.roundPoint(this.averageWidth/10,Math.min(this.minFitAllowed,this.averageWidth/10)),t=this.roundPoint(this.startPoint.pos);return[{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(e,e)),endPoint:t.plus(i.Vec2.of(0,e))},{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(-e,e)),endPoint:t.plus(i.Vec2.of(-e,0))},{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(-e,-e)),endPoint:t.plus(i.Vec2.of(0,-e))},{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(e,-e)),endPoint:t.plus(i.Vec2.of(e,0))}]}const t=[];return this.isFirstSegment&&t.push({kind:i.PathCommandType.MoveTo,point:this.roundPoint(e.startPoint)}),t.push({kind:i.PathCommandType.QuadraticBezierTo,controlPoint:this.roundPoint(e.controlPoint),endPoint:this.roundPoint(e.endPoint)}),t}addCurve(e){const t=this.curveToPathCommands(e);this.parts.push(...t),this.isFirstSegment&&(this.isFirstSegment=!1)}addPoint(e){this.curveFitter.addPoint(e),this.widthAverageNumSamples++,this.averageWidth=this.averageWidth*(this.widthAverageNumSamples-1)/this.widthAverageNumSamples+e.width/this.widthAverageNumSamples}}t.default=c},686:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeLineBuilder=void 0;const i=o(3755),r=o(2956),s=n(o(332)),a=n(o(6657));t.makeLineBuilder=(0,a.default)(((e,t)=>new l(e,t)));class l{constructor(e,t){this.startPoint=e,this.viewport=t,this.endPoint=e}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const e=this.startPoint.pos,t=this.endPoint.pos,o=t.minus(e).normalized(),n=this.startPoint.width/2,a=this.endPoint.width/2,l=o.orthog(),c=l.times(n),d=l.times(a),h=e.minus(c),u=new i.Path(h,[{kind:i.PathCommandType.LineTo,point:e.plus(c)},{kind:i.PathCommandType.LineTo,point:t.plus(d)},{kind:i.PathCommandType.LineTo,point:t.minus(d)},{kind:i.PathCommandType.LineTo,point:e.minus(c)}]).mapPoints((e=>this.viewport.roundPoint(e)));return new s.default([(0,r.pathToRenderable)(u,{fill:this.startPoint.color})])}build(){return this.buildPreview()}preview(e){this.buildPreview().render(e)}addPoint(e){this.endPoint=e}}t.default=l},5024:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makePolylineBuilder=void 0;const i=o(3755),r=n(o(332)),s=n(o(4287)),a=n(o(2362));t.makePolylineBuilder=(0,a.default)(((e,t)=>{const o=.65*t.getSizeOfPixelOnCanvas();return new l(e,o,t)}));class l{constructor(e,t,o){this.minFitAllowed=t,this.viewport=o,this.parts=[],this.widthAverageNumSamples=1,this.lastLineSegment=null,this.averageWidth=e.width,this.startPoint={...e,pos:this.roundPoint(e.pos)},this.lastPoint=this.startPoint.pos,this.bbox=new i.Rect2(this.startPoint.pos.x,this.startPoint.pos.y,0,0),this.parts=[{kind:i.PathCommandType.MoveTo,point:this.startPoint.pos}]}getBBox(){return this.bbox.grownBy(this.averageWidth)}getRenderingStyle(){return{fill:i.Color4.transparent,stroke:this.inkTrailStyle()}}inkTrailStyle(){return{color:this.startPoint.color,width:this.roundDistance(this.averageWidth)}}previewCurrentPath(){const e=this.startPoint.pos,t=[...this.parts];return t.length<=1&&t.push({kind:i.PathCommandType.LineTo,point:e.plus(i.Vec2.of(this.averageWidth/4,0))}),{startPoint:e,commands:t,style:this.getRenderingStyle()}}previewFullPath(){return[this.previewCurrentPath()]}preview(e){const t=this.previewFullPath();if(t){const o=this.viewport.visibleRect;e.startObject(o);for(const o of t)e.drawPath(o);e.endObject()}}build(){return new r.default(this.previewFullPath())}getMinFit(){let e=Math.min(this.minFitAllowed,this.averageWidth/4);return e<1e-10&&(e=this.minFitAllowed),e}roundPoint(e){const t=this.getMinFit();return s.default.roundPoint(e,t)}roundDistance(e){const t=this.getMinFit();return s.default.roundPoint(e,t)}addPoint(e){this.widthAverageNumSamples++,this.averageWidth=this.averageWidth*(this.widthAverageNumSamples-1)/this.widthAverageNumSamples+e.width/this.widthAverageNumSamples;const t=this.roundPoint(e.pos);t.eq(this.lastPoint)||(this.lastLineSegment&&this.lastLineSegment.direction.dot(t.minus(this.lastPoint).normalized())>.997&&(this.parts.pop(),this.lastPoint=this.lastLineSegment.p1),this.parts.push({kind:i.PathCommandType.LineTo,point:this.roundPoint(e.pos)}),this.bbox=this.bbox.grownToPoint(t),this.lastLineSegment=new i.LineSegment2(this.lastPoint,t),this.lastPoint=t)}}t.default=l},1664:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makePressureSensitiveFreehandLineBuilder=void 0;const i=o(3755),r=n(o(332)),s=n(o(4287)),a=o(6018),l=n(o(2362));t.makePressureSensitiveFreehandLineBuilder=(0,l.default)(((e,t)=>{const o=3*t.getSizeOfPixelOnCanvas(),n=t.getSizeOfPixelOnCanvas();return new c(e,n,o,t)}));class c{constructor(e,t,o,n){this.startPoint=e,this.minFitAllowed=t,this.viewport=n,this.isFirstSegment=!0,this.pathStartConnector=null,this.mostRecentConnector=null,this.nextCurveStartConnector=null,this.lastUpperBezier=null,this.lastLowerBezier=null,this.parts=[],this.upperSegments=[],this.lowerSegments=[],this.curveFitter=new a.StrokeSmoother(e,t,o,(e=>this.addCurve(e))),this.curveStartWidth=e.width,this.bbox=new i.Rect2(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}getRenderingStyle(){return{fill:this.startPoint.color??null}}previewCurrentPath(e=!0){const t=this.upperSegments.slice(),o=this.lowerSegments.slice();let n,r;const s=this.curveFitter.preview();if(s&&e){const{upperCurveCommand:e,lowerToUpperConnector:i,upperToLowerConnector:a,lowerCurveCommand:l}=this.segmentToPath(s);t.push(e),o.push(l),n=i,r=this.pathStartConnector??[a]}else{if(null===this.mostRecentConnector||null===this.pathStartConnector)return null;n=this.mostRecentConnector,r=this.pathStartConnector}let a;const l=o[o.length-1];return a=l.kind===i.PathCommandType.LineTo||l.kind===i.PathCommandType.MoveTo?l.point:l.endPoint,{startPoint:a,commands:[n,...t.reverse(),...r,...o],style:this.getRenderingStyle()}}previewFullPath(){const e=this.previewCurrentPath();return e?[...this.parts,e]:null}preview(e){const t=this.previewFullPath();if(t){const o=this.viewport.visibleRect;e.startObject(o);for(const o of t)e.drawPath(o);e.endObject()}}build(){return this.curveFitter.finalizeCurrentCurve(),this.isFirstSegment&&this.addCurve(null),new r.default(this.previewFullPath())}roundPoint(e){let t=Math.min(this.minFitAllowed,this.curveStartWidth/3);return t<1e-10&&(t=this.minFitAllowed),s.default.roundPoint(e,t)}shouldStartNewSegment(e,t){if(!this.lastLowerBezier||!this.lastUpperBezier)return!1;const o=(e,t)=>{const o=e.intersectsBezier(t);return o.length?o[0].point:null},n=e=>e.p2.minus(e.p1).normalized(),i=e=>e.p1.minus(e.p0).normalized();if(i(t).dot(n(this.lastUpperBezier))<.35||i(e).dot(n(this.lastLowerBezier))<.35||i(t).dot(n(t))<0||i(e).dot(n(e))<0)return!0;const r=o(e,this.lastUpperBezier),s=o(t,this.lastLowerBezier);return!(!r&&!s)}getCurrentRadius(){return s.default.roundPoint(this.startPoint.width/2.2,Math.min(this.minFitAllowed,this.startPoint.width/4))}addCurve(e){if(!e){if(!this.isFirstSegment)return;const e=this.getCurrentRadius(),t=this.roundPoint(this.startPoint.pos),o=this.startPoint.pos.plus(i.Vec2.of(e,0));this.lowerSegments.push({kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(e,e)),endPoint:t.plus(i.Vec2.of(0,e))},{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(-e,e)),endPoint:t.plus(i.Vec2.of(-e,0))},{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(-e,-e)),endPoint:t.plus(i.Vec2.of(0,-e))},{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:t.plus(i.Vec2.of(e,-e)),endPoint:t.plus(i.Vec2.of(e,0))});const n={kind:i.PathCommandType.LineTo,point:o};return this.pathStartConnector=[n],void(this.mostRecentConnector=n)}const{upperCurveCommand:t,lowerToUpperConnector:o,upperToLowerConnector:n,lowerCurveCommand:r,lowerCurve:s,upperCurve:a,nextCurveStartConnector:l}=this.segmentToPath(e);let c=this.shouldStartNewSegment(s,a);if(c){const e=this.previewCurrentPath(!1);e?(this.parts.push(e),this.upperSegments=[],this.lowerSegments=[]):c=!1}(this.isFirstSegment||c)&&(this.pathStartConnector=this.nextCurveStartConnector??[n],this.isFirstSegment=!1),this.mostRecentConnector=o,this.nextCurveStartConnector=l,this.lowerSegments.push(r),this.upperSegments.push(t),this.lastLowerBezier=s,this.lastUpperBezier=a,this.curveStartWidth=e.startWidth}segmentToPath(e){const t=new i.QuadraticBezier(e.startPoint,e.controlPoint,e.endPoint);let o=t.normal(0),n=t.normal(1);o=o.times(e.startWidth/2),n=n.times(e.endWidth/2),isFinite(o.magnitude())||(console.error("Warning: startVec is NaN or ∞",o,n,e),o=n);const r=e.startPoint,s=e.endPoint,a=e.controlPoint,l=t.nearestPointTo(a).parameterValue,c=t.normal(l).times(e.startWidth/2*l+e.endWidth/2*(1-l)),d=this.roundPoint(r.plus(o)),h=this.roundPoint(a.plus(c)),u=this.roundPoint(s.plus(n)),p=this.roundPoint(a.minus(c)),f=this.roundPoint(s.minus(n)),m=this.roundPoint(r.minus(o)),g={kind:i.PathCommandType.QuadraticBezierTo,controlPoint:h,endPoint:u},b={kind:i.PathCommandType.LineTo,point:d},v={kind:i.PathCommandType.LineTo,point:f},y=[{kind:i.PathCommandType.LineTo,point:f},{kind:i.PathCommandType.LineTo,point:u}];return{upperCurveCommand:{kind:i.PathCommandType.QuadraticBezierTo,controlPoint:p,endPoint:m},upperToLowerConnector:b,lowerToUpperConnector:v,lowerCurveCommand:g,upperCurve:new i.QuadraticBezier(f,p,m),lowerCurve:new i.QuadraticBezier(d,h,u),nextCurveStartConnector:y}}addPoint(e){this.curveFitter.addPoint(e)}}t.default=c},8871:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeOutlinedRectangleBuilder=t.makeFilledRectangleBuilder=void 0;const i=o(3755),r=o(2956),s=n(o(332)),a=n(o(6657));t.makeFilledRectangleBuilder=(0,a.default)(((e,t)=>new l(e,!0,t))),t.makeOutlinedRectangleBuilder=(0,a.default)(((e,t)=>new l(e,!1,t)));class l{constructor(e,t,o){this.startPoint=e,this.filled=t,this.viewport=o,this.endPoint=e}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const e=this.viewport.getRotationAngle(),t=i.Mat33.zRotation(-e),o=t.inverse().transformVec2(this.startPoint.pos),n=t.inverse().transformVec2(this.endPoint.pos),a=i.Rect2.fromCorners(o,n),l=i.Path.fromRect(a,this.filled?null:this.endPoint.width).transformedBy(t).mapPoints((e=>this.viewport.roundPoint(e)));return new s.default([(0,r.pathToRenderable)(l,{fill:this.endPoint.color})])}build(){return this.buildPreview()}preview(e){this.buildPreview().render(e)}addPoint(e){this.endPoint=e}}t.default=l},2362:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755);t.default=e=>(t,o)=>new s(e,t,o);const i=(e,t,o)=>({points:[e,t[t.length-1]]}),r=(e,t,o)=>({points:[...o.corners,o.corners[0]]});class s{constructor(e,t,o){this.sourceFactory=e,this.startPoint=t,this.viewport=o,this.builder=e(t,o),this.points=[t],this.builder.inkTrailStyle&&(this.inkTrailStyle=this.builder.inkTrailStyle.bind(this.builder))}getBBox(){return this.builder.getBBox()}build(){return this.builder.build()}preview(e){this.builder.preview(e)}addPoint(e){this.points.push(e),this.builder.addPoint(e)}async autocorrectShape(){const e=this.viewport.canvasToScreen(this.startPoint.pos),t=this.points.map((e=>this.viewport.canvasToScreen(e.pos))),o=n.Rect2.bboxOf(t),s=this.viewport.canvasToScreen(this.viewport.snapToGrid(this.startPoint.pos)),a=this.points.map((e=>this.viewport.canvasToScreen(this.viewport.snapToGrid(e.pos)))),l=n.Rect2.bboxOf(a);if(o.maxDimension<32)return null;const c=Math.min(30,o.maxDimension/4),d=[{...i(s,a),toleranceMultiplier:.5},i(e,t),{...r(0,0,l),toleranceMultiplier:.6},r(0,0,o)],h=(o=>{for(const i of d){const r=i.points,s=o*o*(i.toleranceMultiplier??1),a=e=>{for(;e<0;)e+=r.length;return e%=r.length,r[e]};let l=null,c=1/0,d=0;for(let t=0;t<r.length;t++){const o=r[t],n=o.squareDistanceTo(e);(!l||n<c)&&(c=n,l=o,d=t)}let h=0,u=d;for(const e of t){let t=1/0,o=u;const i=6;for(let r=-i;r<=i;r++){const i=u+r,s=a(i-1),l=a(i),c=a(i+1),d=new n.LineSegment2(s,l),h=new n.LineSegment2(l,c),p=d.distance(e),f=h.distance(e),m=Math.min(p,f),g=m*m;g<t&&(t=g,o=i)}if(u=o,h=Math.max(t,h),h>s)break}if(h<s)return r}return null})(c);if(!h)return null;const u=this.points[this.points.length-1],p=this.startPoint.width,f=u.width,m=this.startPoint.color,g=u.color,b=this.startPoint.time,v=u.time,y=e=>{const t=h[Math.max(0,Math.floor(e))],o=h[Math.min(Math.ceil(e),h.length-1)],n=t.lerp(o,e-Math.floor(e)),i=e/h.length;return{pos:this.viewport.screenToCanvas(n),width:p*(1-i)+f*i,color:m.mix(g,i),time:b*(1-i)+v*i}},w=this.sourceFactory(y(0),this.viewport),x=h.length<10;for(let e=0;e<h.length;e++)x&&w.addPoint(y(e-.001)),w.addPoint(y(e)),x&&w.addPoint(y(e+.001));return w.build()}}},6657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>(t,n)=>new o(e,t,n);class o{constructor(e,t,o){this.sourceFactory=e,this.startPoint=t,this.viewport=o,this.builder=e(t,o),this.points=[t],this.builder.inkTrailStyle&&(this.inkTrailStyle=this.builder.inkTrailStyle.bind(this.builder))}getBBox(){return this.builder.getBBox()}build(){return this.builder.build()}preview(e){this.builder.preview(e)}addPoint(e){this.points.push(e),this.builder.addPoint(e)}async autocorrectShape(){const e=e=>({...e,pos:this.viewport.snapToGrid(e.pos)}),t=e(this.startPoint),o=this.sourceFactory(t,this.viewport),n=this.points.map((t=>e(t)));for(const e of n)o.addPoint(e);return o.build()}}},2532:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeOutlinedRectangleBuilder=t.makeFilledRectangleBuilder=t.makeLineBuilder=t.makeArrowBuilder=t.makeOutlinedCircleBuilder=t.makePressureSensitiveFreehandLineBuilder=t.makePolylineBuilder=t.makeFreehandLineBuilder=void 0;var n=o(8195);Object.defineProperty(t,"makeFreehandLineBuilder",{enumerable:!0,get:function(){return n.makeFreehandLineBuilder}});var i=o(5024);Object.defineProperty(t,"makePolylineBuilder",{enumerable:!0,get:function(){return i.makePolylineBuilder}});var r=o(1664);Object.defineProperty(t,"makePressureSensitiveFreehandLineBuilder",{enumerable:!0,get:function(){return r.makePressureSensitiveFreehandLineBuilder}});var s=o(7912);Object.defineProperty(t,"makeOutlinedCircleBuilder",{enumerable:!0,get:function(){return s.makeOutlinedCircleBuilder}});var a=o(2731);Object.defineProperty(t,"makeArrowBuilder",{enumerable:!0,get:function(){return a.makeArrowBuilder}});var l=o(686);Object.defineProperty(t,"makeLineBuilder",{enumerable:!0,get:function(){return l.makeLineBuilder}});var c=o(8871);Object.defineProperty(t,"makeFilledRectangleBuilder",{enumerable:!0,get:function(){return c.makeFilledRectangleBuilder}}),Object.defineProperty(t,"makeOutlinedRectangleBuilder",{enumerable:!0,get:function(){return c.makeOutlinedRectangleBuilder}})},1642:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3497:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||i(t,e,o)},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageComponent=t.BackgroundComponentBackgroundType=t.BackgroundComponent=t.StrokeComponent=t.Text=t.TextComponent=t.isRestylableComponent=t.createRestyleComponentCommand=t.Stroke=t.AbstractComponent=t.StrokeSmoother=void 0,s(o(1642),t),s(o(2532),t);var c=o(6018);Object.defineProperty(t,"StrokeSmoother",{enumerable:!0,get:function(){return l(c).default}}),s(o(6583),t);var d=o(6583);Object.defineProperty(t,"AbstractComponent",{enumerable:!0,get:function(){return l(d).default}});const h=l(o(332));t.Stroke=h.default,t.StrokeComponent=h.default;const u=l(o(3332));t.TextComponent=u.default,t.Text=u.default;const p=l(o(2192));t.ImageComponent=p.default;const f=o(3048);Object.defineProperty(t,"createRestyleComponentCommand",{enumerable:!0,get:function(){return f.createRestyleComponentCommand}}),Object.defineProperty(t,"isRestylableComponent",{enumerable:!0,get:function(){return f.isRestylableComponent}});const m=a(o(4569));t.BackgroundComponent=m.default,Object.defineProperty(t,"BackgroundComponentBackgroundType",{enumerable:!0,get:function(){return m.BackgroundType}})},2425:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultComponentLocalization=void 0,t.defaultComponentLocalization={unlabeledImageNode:"Unlabeled image node",stroke:"Stroke",svgObject:"SVG Object",emptyBackground:"Empty background",gridBackground:"Grid background",filledBackgroundWithColor:e=>`Filled background (${e})`,text:e=>`Text object: ${e}`,imageNode:e=>`Image: ${e}`,restyledElement:e=>`Restyled ${e}`}},6018:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StrokeSmoother=void 0;const n=o(3755);class i{constructor(e,t,o,i){this.startPoint=e,this.minFitAllowed=t,this.maxFitAllowed=o,this.onCurveAdded=i,this.isFirstSegment=!0,this.lastExitingVec=null,this.currentCurve=null,this.lastPoint=this.startPoint,this.buffer=[this.startPoint.pos],this.momentum=n.Vec2.zero,this.currentCurve=null,this.curveStartWidth=e.width,this.bbox=new n.Rect2(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}preview(){return this.currentCurve?this.currentSegmentToPath():null}approxCurrentCurveLength(){if(!this.currentCurve)return 0;const e=this.currentCurve.p0,t=this.currentCurve.p1,o=this.currentCurve.p2;return e.distanceTo(t)+o.distanceTo(t)}finalizeCurrentCurve(){if(!this.currentCurve)return;this.onCurveAdded(this.currentSegmentToPath());const e=this.buffer[this.buffer.length-1];this.lastExitingVec=this.currentCurve.p2.minus(this.currentCurve.p1),console.assert(0!==this.lastExitingVec.magnitude(),"lastExitingVec has zero length!"),this.buffer=[this.buffer[this.buffer.length-2],e],this.currentCurve=null,this.isFirstSegment=!1}currentSegmentToPath(){if(null==this.currentCurve)throw new Error("Invalid State: currentCurve is null!");const e=this.currentCurve.normal(0).normalized();if(!isFinite(e.magnitude()))throw new Error(`startVec(${e}) is NaN or ∞`);const t=this.currentCurve.at(0),o=this.currentCurve.at(1);return{startPoint:t,controlPoint:this.currentCurve.p1,endPoint:o,startWidth:this.curveStartWidth,endWidth:this.curveEndWidth}}computeExitingVec(){return this.momentum.normalized().times(this.lastPoint.width/2)}addPoint(e){if(this.lastPoint){const t=1e-10,o=e.time-this.lastPoint.time;if(e.pos.eq(this.lastPoint.pos,t)||0===o)return;if(isNaN(e.pos.magnitude()))return void console.warn("Discarding NaN point.",e);const n=Math.min(this.lastPoint.width,e.width)/3;if(this.startPoint.pos.distanceTo(e.pos)<n&&this.isFirstSegment)return;const i=o/1e3,r=e.pos.minus(this.lastPoint.pos).times(1/i);this.momentum=r}const t=this.lastPoint??e;this.lastPoint=e,this.buffer.push(e.pos);const o=e.width,i=this.curveEndWidth;if(this.curveEndWidth=o,this.bbox=this.bbox.grownToPoint(e.pos,o),null===this.currentCurve){const r=t.pos,s=t.pos.plus(this.lastExitingVec??n.Vec2.unitX),a=e.pos;this.currentCurve=new n.QuadraticBezier(r,s,a),console.assert(!isNaN(r.magnitude())&&!isNaN(s.magnitude())&&!isNaN(a.magnitude()),"Expected !NaN"),this.isFirstSegment?this.curveStartWidth=(this.curveStartWidth+o)/2:this.curveStartWidth=i}let r=this.lastExitingVec;if(!r){let e=Math.ceil(this.buffer.length/2);(0===e||e>=this.buffer.length)&&(e=this.buffer.length-1),r=this.buffer[e].minus(this.buffer[0])}let s=this.computeExitingVec();const a=this.buffer[0],l=e.pos,c=l.distanceTo(a),d=1.7*c;if(0===d||0===s.magnitude()||!isFinite(s.magnitude()))return;console.assert(isFinite(r.magnitude()),"Pre-normalized enteringVec has NaN or ∞ magnitude!"),r=r.normalized(),s=s.normalized(),console.assert(isFinite(r.magnitude()),"Normalized enteringVec has NaN or ∞ magnitude!");const h=new n.LineSegment2(a,a.plus(r.times(d))),u=new n.LineSegment2(l.minus(s.times(d)),l).intersection(h);let p=null;u&&(p=u.point),p||(p=a.lerp(l,.5).lerp(a.plus(r.times(c)),.1)),(a.eq(p)||l.eq(p))&&(p=a.plus(r.times(c/5))),console.assert(!a.eq(p,1e-11),"Start and control points are equal!"),console.assert(!p.eq(l,1e-11),"Control and end points are equal!");const f=this.currentCurve;this.currentCurve=new n.QuadraticBezier(a,p,l),isNaN(this.currentCurve.normal(0).magnitude())&&(console.error("NaN normal at 0. Curve:",this.currentCurve),this.currentCurve=f);return this.buffer.length>3&&this.approxCurrentCurveLength()>this.curveStartWidth/2&&!(e=>{const t=Math.min(Math.max(Math.min(this.curveStartWidth,this.curveEndWidth)/4,this.minFitAllowed),this.maxFitAllowed),o=t;let n=0;for(const i of this.buffer){let r=e.approximateDistance(i);if(r>t&&(r=e.distance(i),n+=Math.max(0,r-t),n>o))return!1}return!0})(this.currentCurve)?(this.currentCurve=f,this.curveEndWidth=i,this.lastPoint=t,void this.finalizeCurrentCurve()):void 0}}t.StrokeSmoother=i,t.default=i},4167:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{if(0===t.length)return null;const o=t[0].description(e);for(const n of t)if(n.description(e)!==o)return null;return o}},8348:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(6414));t.default=(e,t)=>{const o=(0,i.default)(e,{title:e.localization.about,contentClassNames:["about-dialog-content"]});for(const e of t){const t=document.createElement(e.minimized?"details":"div");t.classList.add("about-entry");const n=document.createElement(e.minimized?"summary":"h2");if("string"==typeof e.heading)n.innerText=e.heading;else{const t=document.createElement("a");t.href=e.heading.href.replace(/^javascript:/i,""),t.text=e.heading.text,n.appendChild(t)}if(t.appendChild(n),e.text){const o=document.createElement("div");o.innerText=e.text,t.appendChild(o)}o.appendChild(t)}return{close:()=>o.close()}}},6414:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(3591));t.default=(e,t)=>{const o=document.createElement("div"),{remove:n}=e.createHTMLOverlay(o);o.classList.add("dialog-container","message-dialog-container",...t.classNames??[]);const r=document.createElement("dialog"),s=document.createElement("div");s.classList.add("message-dialog-content",...t.contentClassNames??[]);const a=document.createElement("h1");a.textContent=t.title,a.setAttribute("autofocus","true");const l=document.createElement("button");l.innerText=e.localization.closeDialog,l.classList.add("close");const c=document.createElement("div");c.classList.add("scroll"),c.onwheel=e=>e.stopPropagation(),s.replaceChildren(a,c,l),r.replaceChildren(s),o.replaceChildren(r),r.style.setProperty("--close-delay","300ms");const d=async()=>{r.classList.add("-closing"),await(0,i.default)(300),r.close()};return r.addEventListener("pointerdown",(e=>{e.target===r&&d()})),r.onclose=()=>{n()},l.onclick=()=>d(),r.showModal(),{close:()=>d(),appendChild:e=>{c.appendChild(e)}}}},2709:function(e,t,o){"use strict";var n,i,r,s,a=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),i=0;i<o.length;i++)"default"!==o[i]&&a(t,e,o[i]);return l(t,e),t}),d=this&&this.__setFunctionName||function(e,t,o){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:o?"".concat(o," ",t):t})},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RootImageNode=t.ImageNode=t.computeFirstIndexToRender=t.EditorImageEventType=t.sortLeavesByZIndex=void 0;const u=h(o(4287)),p=c(o(6583)),f=o(3755),m=h(o(8164)),g=h(o(9168)),b=o(5673),v=h(o(1217));var y;t.sortLeavesByZIndex=e=>{e.sort(((e,t)=>e.getContent().getZIndex()-t.getContent().getZIndex()))},function(e){e[e.ExportViewportChanged=0]="ExportViewportChanged",e[e.AutoresizeModeChanged=1]="AutoresizeModeChanged",e[e.ComponentAdded=2]="ComponentAdded",e[e.ComponentRemoved=3]="ComponentRemoved"}(y||(t.EditorImageEventType=y={}));let w=!1;class x{constructor(){this.componentCount=0,this.settingExportRect=!1,this.root=new T,this.background=new T,this.componentsById=new Map,this.notifier=new g.default,this.importExportViewport=new u.default((()=>{this.onExportViewportChanged()})),this.importExportViewport.updateScreenSize(f.Vec2.of(500,500)),this.shouldAutoresizeExportViewport=!1}getBackgroundComponents(){const e=[],o=this.background.getLeaves();(0,t.sortLeavesByZIndex)(o);for(const t of o){const o=t.getContent();o&&e.push(o)}return e}findParent(e){return this.background.getChildWithContent(e)??this.root.getChildWithContent(e)}queueRerenderOf(e){const t=this.findParent(e);t&&(t.remove(),this.addComponentDirectly(e))}renderWithCache(e,t,o){this.background.render(e,o.visibleRect),w?this.root.render(e,o.visibleRect):t.render(e,this.root,o)}render(e,t){this.background.render(e,t?.visibleRect),this.root.render(e,t?.visibleRect)}async renderAllAsync(e,t){return!!await this.background.renderAllAsync(e,t)&&await this.root.renderAllAsync(e,t)}renderAll(e){this.render(e,null)}getAllComponents(){const e=this.root.getLeaves();return(0,t.sortLeavesByZIndex)(e),e.map((e=>e.getContent()))}getAllElements(){return this.getAllComponents()}estimateNumElements(){return this.componentCount}getElementsIntersectingRegion(e,t=!1){return this.getComponentsIntersecting(e,t)}getComponentsIntersecting(e,o=!1){let n=this.root.getLeavesIntersectingRegion(e);return o&&(n=n.concat(this.background.getLeavesIntersectingRegion(e))),(0,t.sortLeavesByZIndex)(n),n.map((e=>e.getContent()))}onDestroyElement(e){this.componentCount--;const t=e.getId();this.componentsById.delete(t),this.notifier.dispatch(y.ComponentRemoved,{kind:y.ComponentRemoved,image:this,componentId:t}),this.autoresizeExportViewport()}onElementAdded(e){this.componentCount++;const t=e.getId();this.componentsById.set(e.getId(),e),this.notifier.dispatch(y.ComponentAdded,{kind:y.ComponentAdded,image:this,componentId:t}),this.autoresizeExportViewport()}lookupElement(e){return this.componentsById.get(e)??null}addComponentDirectly(e){e.onAddToImage(this);const t=(e.isBackground()?this.background:this.root).addLeaf(e);return this.onElementAdded(e),t}removeElementDirectly(e){const t=this.findParent(e);return t?.remove(),!!t&&(this.onDestroyElement(e),!0)}static addComponent(e,t=!1){return new i.AddComponentCommand(e,t)}addComponent(e,t){return i.addComponent(e,t)}addElement(e,t){return this.addComponent(e,t)}static addElement(e,t=!1){return this.addComponent(e,t)}getImportExportViewport(){return this.importExportViewport}getImportExportRect(){return this.getImportExportViewport().visibleRect}setImportExportRect(e){return i.SetImportExportRectCommand.of(this,e,!1)}getAutoresizeEnabled(){return this.shouldAutoresizeExportViewport}setAutoresizeEnabled(e){if(e===this.shouldAutoresizeExportViewport)return v.default.empty;const t=this.root.getBBox();return i.SetImportExportRectCommand.of(this,t,e)}setAutoresizeEnabledDirectly(e){e!==this.shouldAutoresizeExportViewport&&(this.shouldAutoresizeExportViewport=e,this.notifier.dispatch(y.AutoresizeModeChanged,{kind:y.AutoresizeModeChanged,image:this}))}autoresizeExportViewport(){this.shouldAutoresizeExportViewport&&this.setExportRectDirectly(this.root.getBBox())}setExportRectDirectly(e){const t=this.getImportExportViewport(),o=t.getScreenRectSize(),n=t.canvasToScreenTransform,i=f.Mat33.translation(e.topLeft.times(-1));return!(o.eq(e.size)&&n.eq(i)||(this.settingExportRect=!0,t.updateScreenSize(e.size),t.resetTransform(i),this.settingExportRect=!1,this.onExportViewportChanged(),0))}onExportViewportChanged(){this.settingExportRect||this.notifier.dispatch(y.ExportViewportChanged,{kind:y.ExportViewportChanged,image:this})}static setDebugMode(e){w=e}}i=x,x.AddComponentCommand=(d(r=class extends m.default{constructor(e,t=!1){if(super("add-element"),this.element=e,this.applyByFlattening=t,this.serializedElem=null,this.serializedElem=null,isNaN(e.getBBox().area))throw new Error("Elements in the image cannot have NaN bounding boxes")}apply(e){e.image.addComponentDirectly(this.element),this.applyByFlattening?(this.applyByFlattening=!1,e.display.flatten()):e.queueRerender()}unapply(e){e.image.removeElementDirectly(this.element),e.queueRerender()}description(e,t){return t.addComponentAction(this.element.description(t))}serializeToJSON(){return{elemData:this.serializedElem??this.element.serialize()}}},"AddComponentCommand"),m.default.register("add-element",((e,t)=>{const o=e.elemData.id,n=t.image.lookupElement(o)??p.default.deserialize(e.elemData),r=new i.AddComponentCommand(n);return r.serializedElem=e.elemData,r})),r),x.SetImportExportRectCommand=(d(s=class extends m.default{constructor(e,t,o,n,r){super(i.SetImportExportRectCommand.commandId),this.originalSize=e,this.originalTransform=t,this.originalAutoresize=o,this.newExportRect=n,this.newAutoresize=r}static of(e,t,o){const n=e.getImportExportViewport(),r=n.visibleRect.size,s=n.canvasToScreenTransform,a=e.getAutoresizeEnabled();return new i.SetImportExportRectCommand(r,s,a,t,o)}apply(e){e.image.setAutoresizeEnabledDirectly(this.newAutoresize),e.image.setExportRectDirectly(this.newExportRect),e.queueRerender()}unapply(e){const t=e.image.getImportExportViewport();e.image.setAutoresizeEnabledDirectly(this.originalAutoresize),t.updateScreenSize(this.originalSize),t.resetTransform(this.originalTransform),e.queueRerender()}description(e,t){return this.newAutoresize!==this.originalAutoresize?this.newAutoresize?t.enabledAutoresizeOutputCommand:t.disabledAutoresizeOutputCommand:t.resizeOutputCommand(this.newExportRect)}serializeToJSON(){return{originalSize:this.originalSize.xy,originalTransform:this.originalTransform.toArray(),newRegion:{x:this.newExportRect.x,y:this.newExportRect.y,w:this.newExportRect.w,h:this.newExportRect.h},autoresize:this.newAutoresize,originalAutoresize:this.originalAutoresize}}},"SetImportExportRectCommand"),s.commandId="set-import-export-rect",(()=>{const e=s.commandId;m.default.register(e,((e,t)=>{(0,b.assertIsNumber)(e.originalSize.x),(0,b.assertIsNumber)(e.originalSize.y),(0,b.assertIsNumberArray)(e.originalTransform),(0,b.assertIsNumberArray)([e.newRegion.x,e.newRegion.y,e.newRegion.w,e.newRegion.h]),(0,b.assertIsBoolean)(e.autoresize??!1),(0,b.assertIsBoolean)(e.originalAutoresize??!1);const o=f.Vec2.ofXY(e.originalSize),n=new f.Mat33(...e.originalTransform),r=new f.Rect2(e.newRegion.x,e.newRegion.y,e.newRegion.w,e.newRegion.h),s=e.autoresize??!1,a=e.originalAutoresize??!1;return new i.SetImportExportRectCommand(o,n,a,r,s)}))})(),s),t.default=x,t.computeFirstIndexToRender=(e,t)=>{let o=0;if(t)for(let n=e.length-1;n>=1;n--)if(e[n].getBBox().containsRect(t)&&e[n].getContent()?.occludesEverythingBelowWhenRenderedInRect(t)){o=n;break}return o};class S{constructor(e=null){this.parent=e,this.targetChildCount=30,this.children=[],this.bbox=f.Rect2.empty,this.content=null,this.id=S.idCounter++}getId(){return this.id}onContentChange(){this.id=S.idCounter++}getContent(){return this.content}getParent(){return this.parent}getChildrenIntersectingRegion(e,t){return this.children.filter((o=>{const n=o.getBBox();return!t?.(n)&&n.intersects(e)}))}getChildrenOrSelfIntersectingRegion(e,t){return this.content&&this.bbox.intersects(e)&&!t?.(this.bbox)?[this]:this.getChildrenIntersectingRegion(e,t)}getLeavesIntersectingRegion(e,t){const o=[],n=[];for(n.push(this);n.length>0;){const i=n.pop().getChildrenOrSelfIntersectingRegion(e,t);for(const e of i)e.content?o.push(e):n.push(e)}return o}getChildWithContent(e){const t=this.getLeavesIntersectingRegion(e.getBBox());for(const o of t)if(o.getContent()===e)return o;return null}getLeaves(){if(this.content)return[this];const e=[];for(const t of this.children)e.push(...t.getLeaves());return e}addLeaf(e){if(this.onContentChange(),null===this.content&&0===this.children.length)return this.content=e,this.recomputeBBox(!0),this;if(null!==this.content){console.assert(0===this.children.length);const e=new S(this);e.content=this.content,this.content=null,this.children.push(e),e.recomputeBBox(!1)}const t=e.getBBox();if(t.containsRect(this.getBBox())){const t=new S(this);if(this.children.length<this.targetChildCount)this.children.push(t);else{const e=new S(this);e.children=this.children,this.children=[t,e],e.updateParents(),e.recomputeBBox(!0)}return t.addLeaf(e)}const o=this.children.filter((e=>e.getBBox().containsRect(t)));if(o.length>0&&this.children.length>=this.targetChildCount){o.sort(((e,t)=>e.getBBox().area-t.getBBox().area));const t=o[0].addLeaf(e);return t.rebalance(),t}const n=S.createLeafNode(this,e);return this.children.push(n),n.recomputeBBox(!0),this.children.length>=this.targetChildCount&&this.rebalance(),n}static createLeafNode(e,t){const o=new S(e);return o.content=t,o}getBBox(){return this.bbox}recomputeBBox(e){const t=this.bbox;null!==this.content?this.bbox=this.content.getBBox():this.bbox=f.Rect2.union(...this.children.map((e=>e.getBBox()))),e&&!t.eq(this.bbox)&&(this.bbox.containsRect(t)?this.parent?.unionBBoxWith(this.bbox):this.parent?.recomputeBBox(!0)),this.checkRep()}unionBBoxWith(e){this.bbox=this.bbox.union(e),this.parent?.unionBBoxWith(e)}updateParents(e=!1){for(const t of this.children)t.parent=this,e&&t.updateParents(e)}rebalance(){if(this.parent&&1===this.parent.children.length){console.assert(null===this.parent.content),console.assert(this.parent.children[0]===this);const e=this.parent;if(null!==e.parent){const t=e.parent;t.children=t.children.filter((t=>t!==e)),e.parent=null,e.children=[],this.parent=t,t.children.push(this),this.parent.recomputeBBox(!1)}else null===this.content&&(this.parent.children=this.children,this.parent.updateParents(),this.parent=null)}if(this.children.length>10*this.targetChildCount){const e=this.getBBox().divideIntoGrid(4,4),t=[];for(;t.length<e.length;)t.push(0);for(const o of this.children)for(let n=0;n<e.length;n++)e[n].containsRect(o.getBBox())&&t[n]++;let o=0,n=t[0];for(let e=1;e<t.length;e++)t[e]>n&&(o=e,n=t[e]);const i=e[o];if(n>4){const e=[],t=[];for(const o of this.children)i.containsRect(o.getBBox())?t.push(o):e.push(o);if(t.length<this.children.length){this.children=e;const o=new S(this);this.children.push(o),o.children=t,o.updateParents(!1),o.recomputeBBox(!1),o.rebalance()}}}this.parent&&0===this.children.length&&null===this.content&&this.remove()}removeChild(e){this.checkRep();const t=this.children.length;this.children=this.children.filter((t=>t!==e)),console.assert(this.children.length===t-1,`${t-1} ≠ ${this.children.length} after removing all nodes equal to ${e}. Nodes should only be removed once.`),this.children.forEach((e=>{e.rebalance()})),this.recomputeBBox(!0),this.rebalance(),this.checkRep()}remove(){if(this.content?.onRemoveFromImage(),!this.parent)return this.content=null,void(this.children=[]);this.parent.removeChild(this),this.parent=null,this.content=null,this.children=[],this.checkRep()}async renderAllAsync(e,o){const n=this.getLeaves();(0,t.sortLeavesByZIndex)(n);const i=n.length;for(let t=0;t<i;t++){const r=n[t].getContent();if(r){if(!await o(r,t,i))return!1;r.render(e,void 0)}}return!0}render(e,o){let n;n=o?this.getLeavesIntersectingRegion(o,(t=>e.isTooSmallToRender(t))):this.getLeaves(),(0,t.sortLeavesByZIndex)(n);const i=(0,t.computeFirstIndexToRender)(n);for(let t=i;t<n.length;t++)n[t].getContent().render(e,o);w&&o&&(0!==i&&console.log("EditorImage: skipped ",i,"nodes due to occlusion"),this.renderDebugBoundingBoxes(e,o))}renderDebugBoundingBoxes(e,t,o=0){const n=this.getBBox(),i=1/(e.getSizeOfCanvasPixelOnScreen()||1);if(n.maxDimension<3*i||!n.intersects(t))return;e.startObject(n);const r=!!this.content,s=r?f.Color4.ofRGBA(1,0,1,.4):f.Color4.ofRGBA(0,1,Math.sin(o),.6),a=r?1*i:2*i;if(e.drawRect(n.intersection(t),a,{fill:s}),e.endObject(),n.maxDimension>t.maxDimension/3){const t={fontFamily:"monospace",size:n.minDimension/20,renderingStyle:{fill:f.Color4.red}};e.drawText(`Depth: ${o}`,f.Mat33.translation(n.bottomLeft),t)}for(const n of this.children)n.renderDebugBoundingBoxes(e,t,o+1)}checkRep(e=0){if(w){if(this.parent&&!this.parent.children.includes(this))throw new Error(`Parent does not have this node as a child. (depth: ${e})`);let t=null;const o=new Set;for(const e of this.children){if(t??=e.getBBox(),t=t.union(e.getBBox()),e.parent!==this)throw new Error(`Child with bbox ${e.getBBox()} and ${e.children.length} has wrong parent (was ${e.parent}).`);if(o.has(e))throw new Error(`Child ${e} is present twice or more in its parent's child list`);o.add(e)}const n=this.bbox.minDimension/100;if(t&&!this.bbox.eq(t,n))throw new Error(`Wrong bounding box ${t} \\neq ${this.bbox} (depth: ${e})`)}}}t.ImageNode=S,S.idCounter=0;class T extends S{constructor(){super(...arguments),this.fullscreenChildren=[],this.dataComponents=[]}getChildrenIntersectingRegion(e,t){const o=super.getChildrenIntersectingRegion(e);for(const e of this.fullscreenChildren)o.push(e);return o}getChildrenOrSelfIntersectingRegion(e,t){const o=this.getContent();return o&&o.getSizingMode()===p.ComponentSizingMode.FillScreen?[this]:super.getChildrenOrSelfIntersectingRegion(e,t)}getLeaves(){const e=super.getLeaves();return this.dataComponents.concat(this.fullscreenChildren,e)}removeChild(e){let t=!1;const o=o=>{const n=o===e;return t||=n,!n};this.dataComponents=this.dataComponents.filter(o),this.fullscreenChildren=this.fullscreenChildren.filter(o),t||super.removeChild(e)}getChildWithContent(e){return e.getSizingMode(),p.ComponentSizingMode.BoundingBox,super.getChildWithContent(e)??(()=>{const t=this.fullscreenChildren.concat(this.dataComponents);for(const o of t)if(o.getContent()===e)return o;return null})()}addLeaf(e){const t=e.getSizingMode();if(t===p.ComponentSizingMode.BoundingBox)return super.addLeaf(e);if(t===p.ComponentSizingMode.FillScreen){this.onContentChange();const t=S.createLeafNode(this,e);return this.fullscreenChildren.push(t),t}if(t===p.ComponentSizingMode.Anywhere){this.onContentChange();const t=S.createLeafNode(this,e);return this.dataComponents.push(t),t}throw new Error(`Invalid sizing mode, ${t}`)}}t.RootImageNode=T},8061:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755);t.default=(e,t,o)=>{let i=t.w,r=t.h;if(o?.minDimension&&i<o.minDimension){const e=o.minDimension;r*=e/(i||1),i=e}if(o?.minDimension&&r<o.minDimension){const e=o.minDimension;i*=e/(r||1),r=e}e.setAttribute("width",(0,n.toRoundedString)(i)),e.setAttribute("height",(0,n.toRoundedString)(r))}},159:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.editorImageToSVGAsync=t.editorImageToSVGSync=void 0;const i=o(3755),r=n(o(1712)),s=o(5466),a=n(o(8061)),l=(e,t,o)=>{const n=e.getImportExportViewport().getTemporaryClone();if(o?.minDimension){const e=n.visibleRect;let t=e;t.w<=0&&(t=new i.Rect2(t.x,t.y,o.minDimension,t.h)),t.h<=0&&(t=new i.Rect2(t.x,t.y,t.w,o.minDimension)),t.eq(e)||n.updateScreenSize(t.size)}const{element:l,renderer:c}=r.default.fromViewport(n,{sanitize:o.sanitize??!1,useViewBoxForPositioning:!0});return t(c,(()=>{e.getAutoresizeEnabled()?l.classList.add(s.svgLoaderAutoresizeClassName):l.classList.remove(s.svgLoaderAutoresizeClassName);const t=n.visibleRect;return(0,a.default)(l,t,o),l})),l};t.editorImageToSVGSync=(e,t)=>l(e,((t,o)=>{e.renderAll(t),o()}),t),t.editorImageToSVGAsync=(e,t,o)=>new Promise((n=>{l(e,(async(o,i)=>{await e.renderAllAsync(o,t);const r=i();n(r)}),o)}))},2728:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EditorImage=void 0;var i=o(2709);Object.defineProperty(t,"EditorImage",{enumerable:!0,get:function(){return n(i).default}})},4892:(e,t)=>{"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.isPointerEvt=t.keyPressEventFromHTMLEvent=t.keyUpEventFromHTMLEvent=t.InputEvtType=void 0,function(e){e[e.PointerDownEvt=0]="PointerDownEvt",e[e.PointerMoveEvt=1]="PointerMoveEvt",e[e.PointerUpEvt=2]="PointerUpEvt",e[e.GestureCancelEvt=3]="GestureCancelEvt",e[e.WheelEvt=4]="WheelEvt",e[e.KeyPressEvent=5]="KeyPressEvent",e[e.KeyUpEvent=6]="KeyUpEvent",e[e.CopyEvent=7]="CopyEvent",e[e.PasteEvent=8]="PasteEvent",e[e.ContextMenu=9]="ContextMenu"}(o||(t.InputEvtType=o={}));const n=(e,t)=>({kind:e,key:t.key,code:t.code,ctrlKey:t.ctrlKey||t.metaKey,altKey:t.altKey,shiftKey:t.shiftKey});t.keyUpEventFromHTMLEvent=e=>n(o.KeyUpEvent,e),t.keyPressEventFromHTMLEvent=e=>n(o.KeyPressEvent,e),t.isPointerEvt=e=>e.kind===o.PointerDownEvt||e.kind===o.PointerMoveEvt||e.kind===o.PointerUpEvt},7950:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLToolbar=t.AbstractToolbar=t.Editor=t.__js_draw__version=t.UndoRedoHistory=t.PointerDevice=t.Pointer=t.EventDispatcher=t.Viewport=t.SVGLoader=t.matchingLocalizationTable=t.getLocalizationTable=void 0;const s=r(o(5036));t.Editor=s.default,i(o(2728),t),i(o(2572),t),i(o(4892),t);var a=o(9389);Object.defineProperty(t,"getLocalizationTable",{enumerable:!0,get:function(){return r(a).default}}),Object.defineProperty(t,"matchingLocalizationTable",{enumerable:!0,get:function(){return a.matchingLocalizationTable}}),i(o(5520),t);var l=o(5466);Object.defineProperty(t,"SVGLoader",{enumerable:!0,get:function(){return r(l).default}});var c=o(4287);Object.defineProperty(t,"Viewport",{enumerable:!0,get:function(){return r(c).default}}),i(o(3755),t),i(o(3497),t),i(o(4671),t),i(o(3306),t),i(o(9582),t),i(o(4101),t),i(o(3441),t),i(o(7306),t);var d=o(9168);Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return r(d).default}});var h=o(7372);Object.defineProperty(t,"Pointer",{enumerable:!0,get:function(){return r(h).default}}),Object.defineProperty(t,"PointerDevice",{enumerable:!0,get:function(){return h.PointerDevice}});var u=o(1955);Object.defineProperty(t,"UndoRedoHistory",{enumerable:!0,get:function(){return r(u).default}}),i(o(2857),t);var p=o(2749);Object.defineProperty(t,"__js_draw__version",{enumerable:!0,get:function(){return r(p).default}});const f=r(o(9996));t.AbstractToolbar=f.default,t.HTMLToolbar=f.default,t.default=s.default},5520:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultEditorLocalization=void 0;const n=o(2939),i=o(2425),r=o(6405),s=o(8992),a=o(844);t.defaultEditorLocalization={...s.defaultToolbarLocalization,...a.defaultToolLocalization,...n.defaultCommandLocalization,...i.defaultComponentLocalization,...r.defaultTextRendererLocalization,accessibilityInputInstructions:['Press "t" to read the contents of the viewport as text.',"Use the arrow keys to move the viewport, click and drag to draw strokes.",'Press "w" to zoom in and "s" to zoom out.'].join(" "),loading:e=>`Loading ${e}%...`,imageEditor:"Image Editor",doneLoading:"Done loading",undoAnnouncement:e=>`Undid ${e}`,redoAnnouncement:e=>`Redid ${e}`,softwareLibraries:"Libraries",developerInformation:"Developer information"}},7741:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={...o(5520).defaultEditorLocalization,pen:"Stift",eraser:"Radierer",select:"Auswahl",handTool:"Verschieben",zoom:"Vergrößerung",image:"Bild",inputAltText:"Alt-Text: ",chooseFile:"Wähle Datei: ",submit:"Absenden",cancel:"Abbrechen",resetView:"Ansicht zurücksetzen",thicknessLabel:"Dicke: ",colorLabel:"Farbe: ",fontLabel:"Schriftart: ",textSize:"Größe: ",resizeImageToSelection:"Bildgröße an Auswahl anpassen",deleteSelection:"Auswahl löschen",duplicateSelection:"Auswahl duplizieren",undo:"Rückgängig",redo:"Wiederholen",pickColorFromScreen:"Farbe von Bildschirm auswählen",clickToPickColorAnnouncement:"Klicke auf den Bildschirm, um eine Farbe auszuwählen",selectionToolKeyboardShortcuts:"Auswahl-Werkzeug: Verwende die Pfeiltasten, um ausgewählte Elemente zu verschieben und ‚i‘ und ‚o‘, um ihre Größe zu ändern.",touchPanning:"Ansicht mit Touchscreen verschieben",anyDevicePanning:"Ansicht mit jedem Eingabegerät verschieben",selectPenType:"Objekt-Typ: ",roundedTipPen:"Freihand",flatTipPen:"Stift (druckempfindlich)",arrowPen:"Pfeil",linePen:"Linie",outlinedRectanglePen:"Umrissenes Rechteck",filledRectanglePen:"Ausgefülltes Rechteck",lockRotation:"Sperre Rotation",paste:"Einfügen",dropdownShown:e=>`Dropdown-Menü für ${e} angezeigt`,dropdownHidden:e=>`Dropdown-Menü für ${e} versteckt`,zoomLevel:e=>`Vergößerung: ${e}%`,colorChangedAnnouncement:e=>`Farbe zu ${e} geändert`,imageSize:(e,t)=>`Bild-Größe: ${e} ${t}`,imageLoadError:e=>`Fehler beim Laden des Bildes: ${e}`,errorImageHasZeroSize:"Fehler: Bild hat Größe Null",penTool:e=>`Stift ${e}`,selectionTool:"Auswahl",eraserTool:"Radiergummi",touchPanTool:"Ansicht mit Touchscreen verschieben",twoFingerPanZoomTool:"Ansicht verschieben und vergrößern",undoRedoTool:"Rückgängig/Wiederholen",rightClickDragPanTool:"Rechtsklick-Ziehen",pipetteTool:"Farbe von Bildschirm auswählen",keyboardPanZoom:"Tastaturkürzel zum Verschieben/Vergrößern der Ansicht",textTool:"Text",enterTextToInsert:"Einzufügender Text",changeTool:"Wechsle Werkzeug",pasteHandler:"Copy-Paste-Handler",findLabel:"Finde",toNextMatch:"Nächstes",closeDialog:"Schließen",findDialogShown:"Finde-Dialog angezeigt",findDialogHidden:"Finde-Dialog versteckt",focusedFoundText:(e,t)=>`Sieh Treffer ${e} von ${t} an`,toolEnabledAnnouncement:e=>`${e} aktiviert`,toolDisabledAnnouncement:e=>`${e} deaktiviert`,updatedViewport:"Transformierte Ansicht",transformedElements:(e,t)=>`${e} Element${1===e?"":"e"} transformiert (${t})`,resizeOutputCommand:e=>`Bildgröße auf ${e.w}x${e.h} geändert`,addComponentAction:e=>`${e} hinzugefügt`,eraseAction:(e,t)=>`${t} ${e} gelöscht`,duplicateAction:(e,t)=>`${t} ${e} dupliziert`,inverseOf:e=>`${e} umgekehrt`,elements:"Elemente",erasedNoElements:"Nichts entfernt",duplicatedNoElements:"Nichts dupliziert",rotatedBy:e=>`${Math.abs(e)} Grad ${e<0?"im Uhrzeigersinn":"gegen den Uhrzeigersinn"} gedreht`,movedLeft:"Nacht links bewegt",movedUp:"Nacht oben bewegt",movedDown:"Nacht unten bewegt",movedRight:"Nacht rechts bewegt",zoomedOut:"Ansicht verkleinert",zoomedIn:"Ansicht vergrößert",selectedElements:e=>`${e} Element${1===e?"":"e"} ausgewählt`,stroke:"Strich",svgObject:"SVG-Objekt",text:e=>`Text-Objekt: ${e}`,pathNodeCount:e=>`Es gibt ${e} sichtbare Pfad-Objekte.`,textNodeCount:e=>`Es gibt ${e} sichtbare Text-Knotenpunkte.`,textNode:e=>`Text: ${e}`,imageNodeCount:e=>`Es gibt ${e} sichtbare Bild-Knoten.`,imageNode:e=>`Bild: ${e}`,unlabeledImageNode:"Bild ohne Label",rerenderAsText:"Als Text darstellen",accessibilityInputInstructions:"Drücke ‚t‘, um den Inhalt des Ansichtsfensters als Text zu lesen. Verwende die Pfeiltasten, um die Ansicht zu verschieben, und klicke und ziehe, um Striche zu zeichnen. Drücke ‚w‘ zum Vergrößern und ‚s‘ zum Verkleinern der Ansicht.",loading:e=>`Laden ${e}%...`,doneLoading:"Laden fertig",imageEditor:"Bild-Editor",undoAnnouncement:e=>`${e} rückgängig gemacht`,redoAnnouncement:e=>`${e} wiederholt`,reformatSelection:"Formatiere Auswahl",documentProperties:"Seite",backgroundColor:"Hintergrundfarbe: ",imageWidthOption:"Breite: ",imageHeightOption:"Höhe: ",useGridOption:"Gitter: ",toggleOverflow:"Mehr",selectAllTool:"Alle auswählen",soundExplorer:"Klangbasierte Bilderkundung",disableAccessibilityExploreTool:"Deaktiviere klangbasierte Erkundung",enableAccessibilityExploreTool:"Aktiviere klangbasierte Erkundung",unionOf:(e,t)=>`Vereinigung: ${t} ${e}`,emptyBackground:"Leerer Hintergrund",filledBackgroundWithColor:e=>`Gefüllter Hintergrund (${e})`,restyledElement:e=>`${e} umgestaltet`};t.default=n},1093:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={...o(5520).defaultEditorLocalization};t.default=n},834:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={...o(5520).defaultEditorLocalization,pen:"Lapiz",eraser:"Borrador",select:"Selecciona",handTool:"Mover",image:"Imagen",inputAltText:"Texto alternativo",resetImage:"Reiniciar",chooseFile:"Seleccionar archivo",cancel:"Cancelar",resetView:"Reiniciar vista",thicknessLabel:"Tamaño",fontLabel:"Fuente:",textSize:"Tamaño",resizeImageToSelection:"Redimensionar la imagen a lo que está seleccionado",deleteSelection:"Borra la selección",duplicateSelection:"Duplica la selección",exit:"Salir",save:"Guardar",undo:"Deshace",redo:"Rehace",selectPenType:"Punta",selectShape:"Forma",pickColorFromScreen:"Selecciona un color de la pantalla",clickToPickColorAnnouncement:"Haga un clic en la pantalla para seleccionar un color",documentProperties:"Fondo",backgroundColor:"Color de fondo",imageWidthOption:"Ancho",imageHeightOption:"Alto",enableAutoresizeOption:"Redimensionar automático",toggleOverflow:"Más",about:"Acerca de",touchPanning:"Mover la pantalla con un dedo",roundedTipPen:"Lapiz Redondeado",arrowPen:"Flecha",linePen:"Línea",outlinedRectanglePen:"Rectángulo delineado",filledRectanglePen:"Rectángulo sin borde",lockRotation:"Bloquea rotación",paste:"Pegar",selectionMenu__paste:"Pegar",selectionMenu__delete:"Eliminar",selectionMenu__duplicate:"Duplicar",closeSidebar:e=>`Close sidebar for ${e}`,dropdownShown:e=>`Menú por ${e} es visible`,dropdownHidden:e=>`Menú por ${e} fue ocultado`,zoomLevel:e=>`Zoom: ${e}%`,colorChangedAnnouncement:e=>`Color fue cambiado a ${e}`,imageSize:(e,t)=>`Tamaño del imagen: ${e} ${t}`,imageLoadError:e=>`Error cargando imagen: ${e}`,penTool:e=>`Lapiz ${e}`,selectionTool:"Selecciona",eraserTool:"Borrador",touchPanTool:"Instrumento de mover la pantalla con un dedo",undoRedoTool:"Deshace/rehace",pipetteTool:"Seleccione un color de la pantalla",keyboardPanZoom:"Mover la pantalla con el teclado",textTool:"Texto",enterTextToInsert:"Entra texto",findLabel:"Buscar",toNextMatch:"Próxima",closeDialog:"Cerrar",anyDevicePanning:"Mover la pantalla con todo dispotivo",copied:e=>`${e} cosas fueron copiados`,pasted:e=>1===e?"Pegado":`${e} cosas fueron pegados`,toolEnabledAnnouncement:e=>`${e} fue activado`,toolDisabledAnnouncement:e=>`${e} fue desactivado`,resizeOutputCommand:e=>`Tamaño de imagen fue cambiado a ${e.w}x${e.h}`,eraseAction:(e,t)=>`Borrado: ${t} ${e}`,rerenderAsText:"Redibuja la pantalla al texto",loading:e=>`Cargando: ${e}%...`,imageEditor:"Editor de dibujos",doneLoading:"El cargado terminó",undoAnnouncement:e=>`${e} fue deshecho`,redoAnnouncement:e=>`${e} fue rehecho`};t.default=n},9389:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.matchingLocalizationTable=t.allLocales=void 0;const i=o(5520),r=n(o(7741)),s=n(o(1093)),a=n(o(834)),l=n(o(9400));t.allLocales={de:r.default,en:s.default,es:a.default,sk:l.default};const c=e=>{const t=/^(\w+)[_-](\w+)$/.exec(e);return t?t[1]:e};t.matchingLocalizationTable=(e,t,o)=>{let n;for(const o of e){const e=c(o);if(n&&e!==n&&n in t)return t[n];if(o in t)return t[o];n=e}return n&&n in t?t[n]:o},t.default=e=>(e??=navigator.languages,(0,t.matchingLocalizationTable)(e,t.allLocales,i.defaultEditorLocalization))},9400:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={...o(5520).defaultEditorLocalization,help:"Pomoc",helpHidden:"Skrytá pomoc",next:"Ďalšie",previous:"Prechádzajúce",close:"Zavrieť",helpScreenNavigationHelp:"Kliknutím na ovládací prvok získate viac informácií.",helpControlsAccessibilityLabel:"Ovládacie prvky: Aktivujte ovládací prvok, ktorý zobrazí pomoc.",pen:"Pero",eraser:"Guma",select:"Vybrať",handTool:"Posun",zoom:"Priblížiť",image:"Obrázok",reformatSelection:"Výber formátu",inputAltText:"Alternatívny text",decreaseImageSize:"Zmenšiť veľkosť",resetImage:"Obnoviť",chooseFile:"Vybrať súbor",dragAndDropHereOrBrowse:"Presuňte sem alebo {{prehľadávať}}",submit:"Odoslať",addAll:"Pridať všetko",cancel:"Zrušiť",resetView:"Obnoviť zobrazenie",thicknessLabel:"Hrúbka",colorLabel:"Farba",fontLabel:"Písmo",textSize:"Veľkosť",resizeImageToSelection:"Zmena veľkosti obrázka podľa výberu",deleteSelection:"Vymazať výber",duplicateSelection:"Duplikovať výber",exit:"Ukončiť",save:"Uložiť",undo:"Späť",redo:"Opakovať",fullStrokeEraser:"Guma s plným ťahom",selectPenType:"Typ pera",selectShape:"Tvar",pickColorFromScreen:"Vybrať farbu z obrazovky",clickToPickColorAnnouncement:"Kliknutím na obrazovku vyberte farbu",colorSelectionCanceledAnnouncement:"Výber farby zrušený",selectionTool__lassoSelect:"Výber voľného tvaru",selectionTool__lassoSelect__help:"Ak je táto funkcia zapnutá, ťahanie vytvorí voľný tvar (laso) výberu.",selectionToolKeyboardShortcuts:"Nástroj na výber: Pomocou klávesov so šípkami môžete presunúť vybrané položky, malými/veľkými písmenami „i“ a „o“ môžete zmeniť veľkosť.",documentProperties:"Strana",backgroundColor:"Farba pozadia",imageWidthOption:"Šírka",imageHeightOption:"Výška",useGridOption:"Mriežka",enableAutoresizeOption:"Automatická zmena veľkosti",toggleOverflow:"Viac",about:"O aplikácii",inputStabilization:"Stabilizácia",strokeAutocorrect:"Automatická oprava",pressureSensitivity:"Tlak",touchPanning:"Posúvanie dotykom",roundedTipPen:"Okrúhle",roundedTipPen2:"Viacčiarové",flatTipPen:"Ploché",arrowPen:"Šípka",linePen:"Čiara",outlinedRectanglePen:"Obrys obdĺžnika",filledRectanglePen:"Plný obdĺžnik",outlinedCirclePen:"Kružnica",lockRotation:"Zamknúť otáčanie",paste:"Vložiť",errorImageHasZeroSize:"Chyba: Obrázok má nulovú veľkosť",describeTheImage:"Popis obrázku",fileInput__loading:"Načítavanie...",fileInput__andNMoreFiles:e=>`(...${e} ďalších)`,penDropdown__baseHelpText:"Tento nástroj kreslí tvary alebo voľné čiary.",penDropdown__colorHelpText:"Zmení farbu pera",penDropdown__thicknessHelpText:"Mení hrúbku ťahov nakreslených perom.",penDropdown__penTypeHelpText:"Zmení štýl pera.\n\nMôžete si vybrať buď štýl „pero“, alebo „tvar“. Výberom štýlu „pero“ sa kreslia voľné čiary. Výberom štýlu „tvar“ sa kreslia tvary.",penDropdown__autocorrectHelpText:"Prevedie približné voľné čiary a obdĺžniky na dokonalé.\n\nPero musí byť držané nehybne na konci ťahu, aby sa spustila oprava.",penDropdown__stabilizationHelpText:"Kreslí hladšie ťahy.\n\nPridáva tiež krátke oneskorenie medzi pohybom myši/stylusu a ťahom.",penDropdown__pressureSensitivityHelpText:"Pri použití kompatibilného zariadenia, napríklad stylusu, mení hrúbku ťahov podľa sily stlačenia.",handDropdown__baseHelpText:"Tento nástroj je zodpovedný za posúvanie, otáčanie a zväčšovanie editora.",handDropdown__zoomInHelpText:"Priblížiť.",handDropdown__zoomOutHelpText:"Oddialiť.",handDropdown__resetViewHelpText:"Obnoví úroveň priblíženia na 100 % a vynuluje posúvanie.",handDropdown__zoomDisplayHelpText:"Zobrazí aktuálnu úroveň priblíženia. 100 % zobrazuje obrázok v jeho skutočnej veľkosti.",handDropdown__touchPanningHelpText:"Keď je táto funkcia zapnutá, gestá dotykovej obrazovky posúvajú obrázok, a nevyberajú ho ani nekreslia.",handDropdown__lockRotationHelpText:"Ak je táto funkcia zapnutá, zabraňuje dotykovým gestám otáčať obrazovku.",eraserDropdown__baseHelpText:"Tento nástroj odstraňuje ťahy, obrázky a text pod kurzorom.",eraserDropdown__thicknessHelpText:"Zmení veľkosť gumy.",eraserDropdown__fullStrokeEraserHelpText:"`V režime plného ťahu sa vymažú celé tvary.\n\nKeď nie je v režime plného ťahu, tvary sa môžu byť čiastočne vymazané.`",selectionDropdown__baseHelpText:"Vyberá obsah a manipuluje s výberom",selectionDropdown__resizeToHelpText:"Oreže kresbu na veľkosť toho, čo je aktuálne vybrané.\n\nAk je zapnutá automatická zmena veľkosti, bude táto funkcia vypnutá.",selectionDropdown__deleteHelpText:"Vymaže vybrané položky.",selectionDropdown__duplicateHelpText:"Vytvorí kópiu vybraných položiek.",selectionDropdown__changeColorHelpText:"Zmení farbu vybraných položiek.",pageDropdown__baseHelpText:"Ovláda farbu, vzor a veľkosť pozadia kresliaceho plátna.",pageDropdown__backgroundColorHelpText:"Zmení farbu pozadia kresliaceho plátna.",pageDropdown__gridCheckboxHelpText:"Zapne/vypne vzor mriežky na pozadí.",pageDropdown__autoresizeCheckboxHelpText:"Pokiaľ je označené, stránka sa zväčší tak, aby sa prispôsobila kresbe.\n\nKeď nie je označené, stránka je viditeľná a jej veľkosť sa dá nastaviť ručne.",pageDropdown__aboutButtonHelpText:"Zobrazí verziu, ladenie a ďalšie informácie.",colorPickerPipetteHelpText:"Vyberie farbu z obrazovky.",colorPickerToggleHelpText:"Otvorí/zatvorí výber farieb.",closeSidebar:e=>`Zatvoriť bočný panel pre ${e}`,dropdownShown:e=>`Ponuka pre ${e} zobrazená`,dropdownHidden:e=>`Ponuka pre ${e} skrytá`,zoomLevel:e=>`Priblíženie: ${e}%`,colorChangedAnnouncement:e=>`Farba zmenená na ${e}`,imageSize:(e,t)=>`Veľkosť obrázka: ${e} ${t}`,imageLoadError:e=>`Chyba pri načítavaní obrázka: ${e}`,penTool:e=>`Pero ${e}`,selectionTool:"Výber",selectAllTool:"Skratka pre výber všetkých",eraserTool:"Guma",touchPanTool:"Posúvanie dotykom",twoFingerPanZoomTool:"Posun a priblíženie",undoRedoTool:"Späť/Opakovať",rightClickDragPanTool:"Ťahanie pravým tlačidlom myši",pipetteTool:"Vybrať farbu z obrazovky",keyboardPanZoom:"Klávesové skratky pre posúvanie/priblíženie",selectionMenu__show:"Zobraziť ponuku výberu",selectionMenu__copyToClipboard:"Kopírovať do schránky",selectionMenu__duplicate:"Duplikovať",selectionMenu__delete:"Vymazať",selectionMenu__paste:"Vložiť",copyPasteError__heading:"Kopírovať/vložiť",copyPasteError__description:"Niečo sa pokazilo - tento nástroj nemusí mať prístup k schránke.",copyPasteError__errorDetails:"Zobraziť chybu",copyPasteError__pasteRetry:"Ak chcete opakovať pokus, vložte ho do nižšie uvedeného vstupného poľa:",copyPasteError__copyRetry:"Ak chcete opakovať pokus, skopírujte text do vstupného poľa nižšie:",copyPasteError__copyMe:"Skopíruj ma!",autocorrectedTo:e=>`Automaticky opravené na ${e}`,autocorrectionCanceled:"Automatická oprava zrušená",enterTextToInsert:"Text, ktorý sa má vložiť",changeTool:"Zmeniť nástroj",findLabel:"Hľadať",toNextMatch:"Ďalšie",closeDialog:"Zavrieť",findDialogShown:"Dialógové okno vyhľadávania zobrazené",findDialogHidden:"Dialógové okno vyhľadávania je skryté",copied:e=>`Skopírovaných ${e} položiek`,pasted:e=>`Vložených ${e} položiek`,toolEnabledAnnouncement:e=>`${e} zapnuté`,toolDisabledAnnouncement:e=>`${e} vypnuté`,resizeOutputCommand:e=>`Zmenená veľkosť obrázka na ${e.w}x${e.h}`,enabledAutoresizeOutputCommand:"Automatická zmena veľkosti výstupu je povolená",disabledAutoresizeOutputCommand:"Automatická zmena veľkosti výstupu je zakázaná",addComponentAction:e=>`Pridané ${e}`,eraseAction:(e,t)=>`Vymazané ${t} ${e}`,duplicateAction:(e,t)=>`Duplikované ${t} ${e}`,elements:"Prvky",erasedNoElements:"Nič sa nevymazalo.",duplicatedNoElements:"Nič sa neduplikovalo.",rotatedBy:e=>`Otočené o ${Math.abs(e)} stupňov ${e<0?"clockwise":"counter-clockwise"}`,movedLeft:"Presunuté doľava",movedUp:"Presunuté hore",movedDown:"Presunuté dole",movedRight:"Presunuté doprava",zoomedOut:"Oddialené",zoomedIn:"Priblížené",andNMoreCommands:e=>`A ${e} ďalších príkazov.`,unlabeledImageNode:"Obrázok bez označenia",stroke:"Ťah",svgObject:"Objekt SVG",emptyBackground:"Prázdne pozadie",gridBackground:"Pozadie s mriežkou",filledBackgroundWithColor:e=>`Vyplnené pozadie (${e})`,text:e=>`Textový objekt: ${e}`,imageNode:e=>`Obrázok: ${e}`,pathNodeCount:e=>`Viditeľných je ${e} objektov ciest.`,textNodeCount:e=>`Viditeľných je ${e} textových uzlov.`,imageNodeCount:e=>`Viditeľných je ${e} obrazových uzlov.`,rerenderAsText:"Opätovne vykresliť ako text.",accessibilityInputInstructions:"Pomocou tlačidla „t“ prečítate obsah zobrazovacieho okna ako text. Pomocou klávesov so šípkami pohybujte zobrazovacím oknom, kliknutím a ťahaním kreslite ťahy. Stlačením tlačidla „w“ priblížite a stlačením tlačidla „s“ oddialite pohľad.",loading:e=>`Načítava sa ${e}%...`,imageEditor:"Editor obrázkov",doneLoading:"Načítanie dokončené",softwareLibraries:"Knižnice",developerInformation:"Informácie pre vývojárov"};t.default=n},488:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderingMode=void 0;const i=n(o(1842)),r=o(2572),s=n(o(1166)),a=o(3755),l=n(o(3588)),c=n(o(8231)),d=n(o(9373));var h;!function(e){e[e.DummyRenderer=0]="DummyRenderer",e[e.CanvasRenderer=1]="CanvasRenderer"}(h||(t.RenderingMode=h={})),t.default=class{constructor(e,t,o){if(this.editor=e,this.parent=o,this.textRerenderOutput=null,this.devicePixelRatio=window.devicePixelRatio??1,this.getColorAt=e=>null,t===h.CanvasRenderer)this.initializeCanvasRendering();else{if(t!==h.DummyRenderer)throw new Error(`Unknown rendering mode, ${t}!`);this.dryInkRenderer=new s.default(e.viewport),this.wetInkRenderer=new s.default(e.viewport)}this.textRenderer=new c.default(e.viewport,e.localization),this.initializeTextRendering();const n=a.Vec2.of(600,600);this.cache=new l.default({createRenderer:()=>{if(t===h.DummyRenderer)return new s.default(e.viewport);if(t!==h.CanvasRenderer)throw new Error("Unspported rendering mode");const o=document.createElement("canvas");o.width=n.x+1,o.height=n.y+1;const r=o.getContext("2d");return new i.default(r,e.viewport)},isOfCorrectType:e=>this.dryInkRenderer.canRenderFromWithoutDataLoss(e),blockResolution:n,cacheSize:1296e5,maxScale:Math.max(1,1.3/window.devicePixelRatio),minProportionalRenderTimePerCache:80,minProportionalRenderTimeToUseCache:420}),this.editor.notifier.on(r.EditorEventType.DisplayResized,(e=>{if(e.kind!==r.EditorEventType.DisplayResized)throw new Error("Mismatched event.kinds!");this.resizeSurfacesCallback?.()}))}get width(){return this.dryInkRenderer.displaySize().x}get height(){return this.dryInkRenderer.displaySize().y}getCache(){return this.cache}initializeCanvasRendering(){const e=document.createElement("canvas"),t=document.createElement("canvas"),o=e.getContext("2d"),n=t.getContext("2d");this.dryInkRenderer=new i.default(o,this.editor.viewport),this.wetInkRenderer=new d.default(n,this.editor.viewport),e.className="dryInkCanvas",t.className="wetInkCanvas",this.parent&&(this.parent.appendChild(e),this.parent.appendChild(t)),this.resizeSurfacesCallback=()=>{const i=e=>Math.ceil(e.clientWidth*this.devicePixelRatio)||e.width,s=e=>Math.ceil(e.clientHeight*this.devicePixelRatio)||e.height,l=e=>s(e)!==e.height||i(e)!==e.width;(l(e)||l(t))&&(e.width=i(e),e.height=s(e),t.width=i(t),t.height=s(t),n.resetTransform(),o.resetTransform(),o.scale(this.devicePixelRatio,this.devicePixelRatio),n.scale(this.devicePixelRatio,this.devicePixelRatio),this.editor.notifier.dispatch(r.EditorEventType.DisplayResized,{kind:r.EditorEventType.DisplayResized,newSize:a.Vec2.of(this.width,this.height)}))},this.resizeSurfacesCallback(),this.flattenCallback=()=>{o.save(),o.resetTransform(),o.drawImage(t,0,0),o.restore()},this.getColorAt=e=>{const t=e.times(this.devicePixelRatio),n=o.getImageData(t.x,t.y,1,1),i=n?.data;return i?a.Color4.ofRGBA(i[0]/255,i[1]/255,i[2]/255,i[3]/255):null}}initializeTextRendering(){const e=document.createElement("div");e.classList.add("textRendererOutputContainer");const t=document.createElement("button");t.classList.add("rerenderButton"),t.innerText=this.editor.localization.rerenderAsText,this.textRerenderOutput=document.createElement("div"),this.textRerenderOutput.setAttribute("aria-live","polite"),t.onclick=()=>{this.rerenderAsText()},e.replaceChildren(t,this.textRerenderOutput),this.editor.createHTMLOverlay(e)}setDevicePixelRatio(e){if(isFinite(e)&&e>=.001&&e<=10&&e!==this.devicePixelRatio)return this.devicePixelRatio=e,this.resizeSurfacesCallback?.(),this.editor.queueRerender()}getDevicePixelRatio(){return this.devicePixelRatio}onPointerEvent(e){this.wetInkRenderer instanceof d.default&&this.wetInkRenderer.onEvent(e)}rerenderAsText(){this.textRenderer.clear(),this.editor.image.render(this.textRenderer,this.editor.viewport),this.textRerenderOutput&&(this.textRerenderOutput.innerText=this.textRenderer.getDescription())}startRerender(){return this.resizeSurfacesCallback?.(),this.dryInkRenderer.clear(),this.dryInkRenderer}setDraftMode(e){this.dryInkRenderer.setDraftMode(e)}getDryInkRenderer(){return this.dryInkRenderer}getWetInkRenderer(){return this.wetInkRenderer}flatten(){this.flattenCallback?.()}}},2956:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.visualEquivalent=t.simplifyPathToFullScreenOrEmpty=t.pathToRenderable=t.pathFromRenderable=void 0;const n=o(3755);t.pathFromRenderable=e=>e.path?e.path:new n.Path(e.startPoint,e.commands),t.pathToRenderable=(e,t)=>({startPoint:e.startPoint,style:t,commands:e.parts,path:e}),t.simplifyPathToFullScreenOrEmpty=(e,o,i={fastCheck:!0,expensiveCheck:!0})=>{const r=(0,t.pathFromRenderable)(e),s=e.style.stroke?.width??0,a=s>0&&0===e.style.fill.a,l=r.bbox.grownBy(s),c=a&&s>o.maxDimension&&l.containsRect(o);if(i.fastCheck&&c&&e.style.stroke){const i=s/2;for(const s of r.startEndPoints())if(o.isWithinRadiusOf(i,s))return{rectangle:o,path:(0,t.pathToRenderable)(n.Path.fromRect(o),{fill:e.style.stroke.color}),fullScreen:!0}}if(i.expensiveCheck&&c&&e.style.stroke&&s>3*o.maxDimension){const i=r.signedDistance(o.center,s/2),a=s/6;if(i<-o.maxDimension/2-a)return{path:(0,t.pathToRenderable)(n.Path.fromRect(o),{fill:e.style.stroke.color}),rectangle:o,fullScreen:!0};if(i>o.maxDimension/2+a)return{path:(0,t.pathToRenderable)(n.Path.empty,{fill:n.Color4.transparent}),rectangle:n.Rect2.empty,fullScreen:!1}}return null},t.visualEquivalent=(e,o)=>{const i=(0,t.pathFromRenderable)(e),r=e.style.stroke?.width??0,s=r>0&&0===e.style.fill.a,a=i.bbox.grownBy(r);let l=(0,t.simplifyPathToFullScreenOrEmpty)(e,o,{fastCheck:!0,expensiveCheck:!1});if(l)return l.path;if(o.grownBy(r).transformedBoundingBox(n.Mat33.scaling2D(4,o.center)).containsRect(a))return((e,t)=>e.path?e:{...e,path:t})(e,i);const c=[];let d=i.startPoint;for(const e of i.parts){const t=n.Path.computeBBoxForSegment(d,e).grownBy(r);let i;i=e.kind===n.PathCommandType.LineTo||e.kind===n.PathCommandType.MoveTo?e.point:e.endPoint,t.intersects(o)?c.push(e):s||e.kind===n.PathCommandType.MoveTo?c.push({kind:n.PathCommandType.MoveTo,point:i}):c.push({kind:n.PathCommandType.LineTo,point:i}),d=i}const h=new n.Path(i.startPoint,c),u=e.style;return l=(0,t.simplifyPathToFullScreenOrEmpty)(e,o,{fastCheck:!1,expensiveCheck:!0}),l?l.path:(0,t.pathToRenderable)(h,u)}},2293:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleFromJSON=t.styleToJSON=t.stylesEqual=t.cloneStyle=void 0;const n=o(3755);t.cloneStyle=e=>({fill:e.fill,stroke:e.stroke?{...e.stroke}:void 0}),t.stylesEqual=(e,t)=>(e===t||e.fill.eq(t.fill)&&null==e.stroke==(null==t.stroke)&&(e.stroke?.color?.eq(t.stroke?.color)??!0)&&e.stroke?.width===t.stroke?.width)??!1,t.styleToJSON=e=>{const t=e.stroke?{color:e.stroke.color.toHexString(),width:e.stroke.width}:void 0;return{fill:e.fill.toHexString(),stroke:t}},t.styleFromJSON=e=>{const t=e.stroke?{color:n.Color4.fromHex(e.stroke.color),width:e.stroke.width}:void 0;return{fill:n.Color4.fromHex(e.fill),stroke:t}}},6154:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textStyleToJSON=t.textStyleFromJSON=t.cloneTextStyle=void 0;const n=o(2293);t.cloneTextStyle=e=>({...e,renderingStyle:(0,n.cloneStyle)(e.renderingStyle)}),t.textStyleFromJSON=e=>{if("string"==typeof e&&(e=JSON.parse(e)),"string"!=typeof e.fontFamily)throw new Error("Serialized textStyle missing string fontFamily attribute!");return{renderingStyle:(0,n.styleFromJSON)(e.renderingStyle),size:e.size,fontWeight:e.fontWeight,fontVariant:e.fontVariant,fontFamily:e.fontFamily}},t.textStyleToJSON=e=>({...e,renderingStyle:(0,n.styleToJSON)(e.renderingStyle)})},8099:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755);t.default=class{constructor(e,t){this.onBeforeDeallocCallback=e,this.cacheState=t,this.allocd=!1,this.allocCount=0,this.renderer=t.props.createRenderer(),this.lastUsedCycle=-1,this.allocd=!0}startRender(){if(this.lastUsedCycle=this.cacheState.currentRenderingCycle,!this.allocd)throw new Error("Only alloc'd canvases can be rendered to");return this.renderer}dealloc(){this.onBeforeDeallocCallback?.(),this.allocd=!1,this.onBeforeDeallocCallback=null,this.lastUsedCycle=0}isAllocd(){return this.allocd}realloc(e){this.allocd&&this.dealloc(),this.allocd=!0,this.onBeforeDeallocCallback=e,this.lastUsedCycle=this.cacheState.currentRenderingCycle,this.allocCount++}getLastUsedCycle(){return this.lastUsedCycle}getTransform(e){return n.Mat33.scaling2D(this.cacheState.props.blockResolution.x/e.size.x).rightMul(n.Mat33.translation(e.topLeft.times(-1)))}setRenderingRegion(e){const t=this.getTransform(e);this.renderer.setTransform(t),this.renderer.overrideVisibleRect(e.grownBy(1/t.getScaleFactor()))}}},6160:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CacheRecordManager=void 0;const i=n(o(8099));t.CacheRecordManager=class{constructor(e){this.cacheRecords=[],this.maxCanvases=Math.ceil(e.cacheSize/4/e.blockResolution.x/e.blockResolution.y)}setSharedState(e){this.cacheState=e}allocCanvas(e,t){if(this.cacheRecords.length<this.maxCanvases){const o=new i.default(t,this.cacheState);return o.setRenderingRegion(e),this.cacheRecords.push(o),this.cacheState.debugMode&&console.log("[Cache] Cache spaces used: ",this.cacheRecords.length," of ",this.maxCanvases),o}{const o=this.getLeastRecentlyUsedRecord();return this.cacheState.debugMode&&console.log("[Cache] Re-alloc. Times allocated: ",o.allocCount,"\nLast used cycle: ",o.getLastUsedCycle(),"\nCurrent cycle: ",this.cacheState.currentRenderingCycle),o.realloc(t),o.setRenderingRegion(e),this.cacheState.debugMode&&(console.log("[Cache] Now re-alloc'd. Last used cycle: ",o.getLastUsedCycle()),console.assert(o.cacheState===this.cacheState,"[Cache] Unequal cache states! cacheState should be a shared object!")),o}}getLeastRecentlyUsedRecord(){return this.cacheRecords.sort(((e,t)=>e.getLastUsedCycle()-t.getLastUsedCycle())),this.cacheRecords[0]}getDebugInfo(){let e=0,t=0;for(const o of this.cacheRecords)t+=o.allocCount,o.isAllocd()&&e++;return t/=Math.max(this.cacheRecords.length,1),[`${this.cacheRecords.length} cache records (max ${this.maxCanvases})`,`${e} assigned to screen regions`,"Average number of times reassigned: "+Math.round(100*t)/100].join("\n")}}},3588:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=n(o(6884)),s=o(6160);t.default=class{constructor(e){this.recordManager=new s.CacheRecordManager(e),this.sharedState={props:e,currentRenderingCycle:0,recordManager:this.recordManager,debugMode:!1},this.recordManager.setSharedState(this.sharedState)}render(e,t,o){const n=o.visibleRect;if(this.sharedState.currentRenderingCycle++,!this.sharedState.props.isOfCorrectType(e))return void t.render(e,n);if(!this.rootNode){const e=this.sharedState.props.blockResolution,t=n.topLeft;this.rootNode=new r.default(new i.Rect2(t.x,t.y,e.x,e.y),this.sharedState)}for(;!this.rootNode.region.containsRect(n);)this.rootNode=this.rootNode.generateParent();this.rootNode=this.rootNode.smallestChildContaining(n)??this.rootNode;const s=t.getLeavesIntersectingRegion(o.visibleRect,(t=>e.isTooSmallToRender(t)));let a=0;for(const e of s)a+=e.getContent().getProportionalRenderingTime();a>this.sharedState.props.minProportionalRenderTimeToUseCache?this.rootNode.renderItems(e,[t],o):t.render(e,n)}getDebugInfo(){return this.recordManager.getDebugInfo()}setIsDebugMode(e){this.sharedState.debugMode=e}}},6884:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(2709),i=o(3755);class r{constructor(e,t){this.region=e,this.cacheState=t,this.instantiatedChildren=[],this.parent=null,this.cachedRenderer=null,this.renderedIds=[],this.renderedMaxZIndex=null}generateParent(){if(this.parent)return this.parent;const e=i.Rect2.fromCorners(this.region.topLeft.minus(this.region.size),this.region.bottomRight.plus(this.region.size)),t=new r(e,this.cacheState);t.generateChildren();const o=this.region.maxDimension/100,n=(t.instantiatedChildren.length-1)/2;if(!t.instantiatedChildren[n].region.eq(this.region,o))throw console.error(t.instantiatedChildren[n].region,"≠",this.region),new Error("Logic error: [this] is not contained within its parent's center child");return t.instantiatedChildren[n]=this,this.parent=t,t}generateChildren(){if(0===this.instantiatedChildren.length){if(this.region.size.x/3==0||this.region.size.y/3==0)return void console.warn("Cache element has zero size! Not generating children.");const e=this.region.divideIntoGrid(3,3);console.assert(9===e.length,"Warning: divideIntoGrid created the wrong number of subrectangles!");for(const t of e){const e=new r(t,this.cacheState);e.parent=this,this.instantiatedChildren.push(e)}}this.checkRep()}getChildren(){return this.checkRep(),this.generateChildren(),this.instantiatedChildren}smallestChildContaining(e){const t=e.maxDimension>this.region.maxDimension/3;if(!this.region.containsRect(e)||t)return null;for(const t of this.getChildren())if(t.region.containsRect(e))return t.smallestChildContaining(e)??t;return null}renderingWouldBeHighEnoughResolution(e){const t=this.region.w/this.cacheState.props.blockResolution.x;return!(e.getScaleFactor()*t>this.cacheState.props.maxScale)}allChildrenCanRender(e,t){if(0===this.instantiatedChildren.length)return!1;for(const o of this.instantiatedChildren)if(o.region.intersects(e.visibleRect)&&!o.renderingIsUpToDate(this.idsOfIntersecting(t)))return!1;return!0}computeSortedByLeafIds(e){const t=e.slice();return t.sort(((e,t)=>e.getId()-t.getId())),t}idsOfIntersecting(e){const t=[];for(const o of e)o.getBBox().intersects(this.region)&&t.push(o.getId());return t}allRenderedIdsIn(e){if(this.renderedIds.length>e.length)return!1;for(let t=0;t<this.renderedIds.length;t++)if(e[t]!==this.renderedIds[t])return!1;return!0}renderingIsUpToDate(e){return null!==this.cachedRenderer&&e.length===this.renderedIds.length&&this.allRenderedIdsIn(e)}renderItems(e,t,o){if(o.visibleRect.intersects(this.region)&&0!==t.length)if(t=(e=>{const t=[];for(const o of e){const e=o.getBBox();e.intersects(this.region)&&(e.maxDimension>=this.region.maxDimension?t.push(...o.getChildrenOrSelfIntersectingRegion(this.region)):t.push(o))}return t})(t),this.cacheState.props.isOfCorrectType(e)){if(this.cacheState.debugMode&&e.drawRect(this.region,o.getSizeOfPixelOnCanvas(),{fill:i.Color4.yellow}),this.renderingWouldBeHighEnoughResolution(o)){const r=e=>e.w/this.region.w<1/this.cacheState.props.blockResolution.x,s=[];for(const e of t)s.push(...e.getLeavesIntersectingRegion(this.region,r));(0,n.sortLeavesByZIndex)(s);const a=this.computeSortedByLeafIds(s);if(0===a.length)return;const l=a.map((e=>e.getId()));let c;if(this.renderingIsUpToDate(l))c=this.cachedRenderer.startRender();else{if(this.allChildrenCanRender(o,a)){for(const n of this.getChildren())n.renderItems(e,t,o);return}let d=0;for(const e of a)r(e.getBBox())||(d+=e.getContent().getProportionalRenderingTime());if(d>this.cacheState.props.minProportionalRenderTimePerCache){let t=!0;if(this.cachedRenderer)if(a.length>this.renderedIds.length&&this.allRenderedIdsIn(l)&&null!==this.renderedMaxZIndex){const n=[];let r=null;for(let e=0;e<a.length;e++){const t=a[e],o=t.getContent().getZIndex();(e>=this.renderedIds.length||t.getId()!==this.renderedIds[e])&&(n.push(t),(null===r||o<r)&&(r=o))}if(null!==r&&r>this.renderedMaxZIndex){t=!1,c=this.cachedRenderer.startRender();for(let e=0;e<s.length;e++){const t=s[e],o=t.getContent().getZIndex();o>this.renderedMaxZIndex&&(t.render(c,this.region),this.renderedMaxZIndex=o)}this.cacheState.debugMode&&e.drawRect(this.region,2*o.getSizeOfPixelOnCanvas(),{fill:i.Color4.clay})}}else this.cacheState.debugMode&&console.log("Decided on a full re-render. Reason: At least one of the following is false:","\n leafIds.length > this.renderedIds.length: ",l.length>this.renderedIds.length,"\n this.allRenderedIdsIn(leafIds): ",this.allRenderedIdsIn(l),"\n this.renderedMaxZIndex !== null: ",null!==this.renderedMaxZIndex,"\n\nthis.rerenderedIds: ",this.renderedIds,", leafIds: ",l);else this.cachedRenderer=this.cacheState.recordManager.allocCanvas(this.region,(()=>this.onRegionDealloc()));if(t){c=this.cachedRenderer.startRender(),c.clear(),this.renderedMaxZIndex=null;for(let e=(0,n.computeFirstIndexToRender)(s,this.region);e<s.length;e++){const t=s[e],o=t.getContent();this.renderedMaxZIndex??=o.getZIndex(),this.renderedMaxZIndex=Math.max(this.renderedMaxZIndex,o.getZIndex()),t.render(c,this.region)}this.cacheState.debugMode&&e.drawRect(this.region,3*o.getSizeOfPixelOnCanvas(),{fill:i.Color4.red})}this.renderedIds=l}else{this.cachedRenderer?.dealloc();const t=o.getSizeOfPixelOnCanvas(),n=new i.Rect2(this.region.x,this.region.y,this.region.w+t,this.region.h+t),r=!0;e.startObject(n,r);for(const t of s)t.render(e,this.region.intersection(o.visibleRect));e.endObject(),this.cacheState.debugMode&&e.drawRect(this.region,2*o.getSizeOfPixelOnCanvas(),{fill:i.Color4.green})}}if(c){const t=this.cachedRenderer.getTransform(this.region).inverse();e.renderFromOtherOfSameType(t,c)}this.instantiatedChildren.every((e=>e.isEmpty()))&&(this.instantiatedChildren=[])}else for(const n of this.getChildren())n.renderItems(e,t.filter((e=>e.getBBox().intersects(n.region))),o);this.checkRep()}else for(const n of t)n.render(e,o.visibleRect)}isEmpty(){return null===this.cachedRenderer&&this.instantiatedChildren.every((e=>e.isEmpty()))}onRegionDealloc(){this.cachedRenderer=null,this.isEmpty()&&(this.instantiatedChildren=[])}checkRep(){if(9!==this.instantiatedChildren.length&&0!==this.instantiatedChildren.length)throw new Error(`Repcheck: Wrong number of children. Got ${this.instantiatedChildren.length}`);if(void 0!==this.renderedIds[1]&&this.renderedIds[0]>=this.renderedIds[1])throw console.error(this.renderedIds),new Error("Repcheck: First two ids are not in ascending order!");for(const e of this.instantiatedChildren)if(e.parent!==this)throw new Error("Children should be linked to their parents!");if(this.cachedRenderer&&!this.cachedRenderer.isAllocd())throw new Error("this' cachedRenderer != null, but is dealloc'd")}}t.default=r},4101:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.pathVisualEquivalent=t.pathFromRenderable=t.pathToRenderable=t.RenderingMode=t.Display=t.CanvasRenderer=t.SVGRenderer=t.DummyRenderer=t.AbstractRenderer=void 0;var i=o(1328);Object.defineProperty(t,"AbstractRenderer",{enumerable:!0,get:function(){return n(i).default}});var r=o(1166);Object.defineProperty(t,"DummyRenderer",{enumerable:!0,get:function(){return n(r).default}});var s=o(1712);Object.defineProperty(t,"SVGRenderer",{enumerable:!0,get:function(){return n(s).default}});var a=o(1842);Object.defineProperty(t,"CanvasRenderer",{enumerable:!0,get:function(){return n(a).default}});var l=o(488);Object.defineProperty(t,"Display",{enumerable:!0,get:function(){return n(l).default}}),Object.defineProperty(t,"RenderingMode",{enumerable:!0,get:function(){return l.RenderingMode}});var c=o(2956);Object.defineProperty(t,"pathToRenderable",{enumerable:!0,get:function(){return c.pathToRenderable}}),Object.defineProperty(t,"pathFromRenderable",{enumerable:!0,get:function(){return c.pathFromRenderable}}),Object.defineProperty(t,"pathVisualEquivalent",{enumerable:!0,get:function(){return c.visualEquivalent}})},6405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTextRendererLocalization=void 0,t.defaultTextRendererLocalization={pathNodeCount:e=>`There are ${e} visible path objects.`,textNodeCount:e=>`There are ${e} visible text nodes.`,imageNodeCount:e=>`There are ${e} visible image nodes.`,textNode:e=>`Text: ${e}`,imageNode:e=>`Image: ${e}`,unlabeledImageNode:"Unlabeled image",rerenderAsText:"Re-render as text"}},1328:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755),i=o(2293),r=o(2956),s={setEnabled:()=>{},updateStyle:()=>{}};t.default=class{constructor(e){this.viewport=e,this.selfTransform=null,this.transformStack=[],this.objectLevel=0,this.currentPaths=null}getViewport(){return this.viewport}setDraftMode(e){}getDraftInkPresenter(){return s}flushPath(){if(!this.currentPaths)return;let e=null;for(const t of this.currentPaths){const{startPoint:o,commands:r,style:s}=t;e&&(0,i.stylesEqual)(e,s)?this.moveTo(o):(e&&this.endPath(e),this.beginPath(o),e=s);for(const e of r)e.kind===n.PathCommandType.LineTo?this.lineTo(e.point):e.kind===n.PathCommandType.MoveTo?this.moveTo(e.point):e.kind===n.PathCommandType.CubicBezierTo?this.traceCubicBezierCurve(e.controlPoint1,e.controlPoint2,e.endPoint):e.kind===n.PathCommandType.QuadraticBezierTo&&this.traceQuadraticBezierCurve(e.controlPoint,e.endPoint)}e&&this.endPath(e),this.currentPaths=[]}drawPath(e){0===this.objectLevel||null===this.currentPaths?(this.currentPaths=[e],this.flushPath(),this.currentPaths=null):this.currentPaths.push(e)}drawRect(e,t,o){const i=n.Path.fromRect(e,t);this.drawPath((0,r.pathToRenderable)(i,o))}fillRect(e,t){const o=n.Path.fromRect(e);this.drawPath((0,r.pathToRenderable)(o,{fill:t}))}startObject(e,t){this.objectLevel>0&&this.flushPath(),this.currentPaths=[],this.objectLevel++}endObject(e,t){if(this.flushPath(),this.currentPaths=null,this.objectLevel--,this.objectLevel<0)throw new Error("More objects have ended than have been started (negative object nesting level)!")}getNestingLevel(){return this.objectLevel}canRenderFromWithoutDataLoss(e){return!1}renderFromOtherOfSameType(e,t){throw new Error(`Unable to render from ${t}: Not implemented`)}setTransform(e){this.selfTransform=e}pushTransform(e){this.flushPath(),this.transformStack.push(this.selfTransform),this.setTransform(this.getCanvasToScreenTransform().rightMul(e))}popTransform(){if(0===this.transformStack.length)throw new Error("Unable to pop more transforms than have been pushed!");this.flushPath(),this.setTransform(this.transformStack.pop()??null)}getCanvasToScreenTransform(){return this.selfTransform?this.selfTransform:this.viewport.canvasToScreenTransform}canvasToScreen(e){return this.getCanvasToScreenTransform().transformVec2(e)}getSizeOfCanvasPixelOnScreen(){return this.getCanvasToScreenTransform().transformVec3(n.Vec2.unitX).length()}overrideVisibleRect(e){this.visibleRectOverride=e}getVisibleRect(){return this.visibleRectOverride??this.viewport.visibleRect}}},9373:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(1842));class r{constructor(e,t){this.viewport=t,this.enabled=new Map,this.presenter=null,this.style={color:"black",diameter:2},"ink"in navigator&&navigator.ink&&navigator.ink.requestPresenter({presentationArea:e}).then((e=>{this.presenter=e}))}setEnabled(e,t){this.enabled.set(e,t)}updateStyle(e){const t=e.color.toString();this.style={color:t,diameter:Math.ceil(e.width/this.viewport.getSizeOfPixelOnCanvas())}}onEvent(e){this.presenter&&this.enabled.get(e.pointerId)&&e.isTrusted&&this.presenter.updateInkTrailStartPoint(e,this.style)}}class s extends i.default{constructor(e,t){super(e,t),this.inkPresenter=new r(e.canvas,t)}getDraftInkPresenter(){return this.inkPresenter}onEvent(e){this.inkPresenter.onEvent(e)}}t.default=s},1842:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(3332)),r=o(3755),s=n(o(1328)),a=o(2956);class l extends s.default{constructor(e,t){super(t),this.ctx=e,this.ignoreObjectsAboveLevel=null,this.ignoringObject=!1,this.currentObjectBBox=null,this.clipLevels=[],this.setDraftMode(!1)}transformBy(e){this.ctx.transform(e.a1,e.b1,e.a2,e.b2,e.a3,e.b3)}canRenderFromWithoutDataLoss(e){return e instanceof l}renderFromOtherOfSameType(e,t){if(!(t instanceof l))throw new Error(`${t} cannot be rendered onto ${this}`);e=this.getCanvasToScreenTransform().rightMul(e),this.ctx.save(),this.transformBy(e),this.ctx.drawImage(t.ctx.canvas,0,0),this.ctx.restore()}setDraftMode(e){e?(this.minSquareCurveApproxDist=9,this.minRenderSizeBothDimens=1,this.minRenderSizeAnyDimen=.1):(this.minSquareCurveApproxDist=.5,this.minRenderSizeBothDimens=.1,this.minRenderSizeAnyDimen=1e-6)}displaySize(){return r.Vec2.of(this.ctx.canvas.clientWidth,this.ctx.canvas.clientHeight)}clear(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}beginPath(e){e=this.canvasToScreen(e),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y)}endPath(e){e.fill.a>0&&(this.ctx.fillStyle=e.fill.toHexString(),this.ctx.fill()),e.stroke&&(this.ctx.strokeStyle=e.stroke.color.toHexString(),this.ctx.lineWidth=this.getSizeOfCanvasPixelOnScreen()*e.stroke.width,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.stroke(),this.ctx.lineWidth=1),this.ctx.closePath()}lineTo(e){e=this.canvasToScreen(e),this.ctx.lineTo(e.x,e.y)}moveTo(e){e=this.canvasToScreen(e),this.ctx.moveTo(e.x,e.y)}traceCubicBezierCurve(e,t,o){e=this.canvasToScreen(e),t=this.canvasToScreen(t),o=this.canvasToScreen(o);const n=t.minus(e),i=o.minus(t);n.magnitudeSquared()<this.minSquareCurveApproxDist&&i.magnitudeSquared()<this.minSquareCurveApproxDist?this.ctx.lineTo(o.x,o.y):this.ctx.bezierCurveTo(e.x,e.y,t.x,t.y,o.x,o.y)}traceQuadraticBezierCurve(e,t){e=this.canvasToScreen(e),t=this.canvasToScreen(t),e.minus(t).magnitudeSquared()<this.minSquareCurveApproxDist?this.ctx.lineTo(t.x,t.y):this.ctx.quadraticCurveTo(e.x,e.y,t.x,t.y)}drawPath(e){if(this.ignoringObject)return;const t=this.getVisibleRect();this.currentObjectBBox?.containsRect(t)&&(e=(0,a.visualEquivalent)(e,t)),super.drawPath(e)}drawText(e,t,o){this.ctx.save(),t=this.getCanvasToScreenTransform().rightMul(t),this.transformBy(t),i.default.applyTextStyles(this.ctx,o),0!==o.renderingStyle.fill.a&&(this.ctx.fillStyle=o.renderingStyle.fill.toHexString(),this.ctx.fillText(e,0,0)),o.renderingStyle.stroke&&(this.ctx.strokeStyle=o.renderingStyle.stroke.color.toHexString(),this.ctx.lineWidth=o.renderingStyle.stroke.width,this.ctx.strokeText(e,0,0)),this.ctx.restore()}drawImage(e){if(0===e.image.width||0===e.image.height)return;this.ctx.save();const t=this.getCanvasToScreenTransform().rightMul(e.transform);this.transformBy(t),this.ctx.drawImage(e.image,0,0),this.ctx.restore()}startObject(e,t){if(this.isTooSmallToRender(e)&&(this.ignoreObjectsAboveLevel=this.getNestingLevel(),this.ignoringObject=!0),super.startObject(e),this.currentObjectBBox=e,!this.ignoringObject&&t&&!e.containsRect(this.getVisibleRect())){this.clipLevels.push(this.objectLevel),this.ctx.save(),this.ctx.beginPath();for(const t of e.corners){const e=this.canvasToScreen(t);this.ctx.lineTo(e.x,e.y)}this.ctx.clip()}}endObject(){const e=this.objectLevel;this.currentObjectBBox=null,super.endObject(),!this.ignoringObject&&this.clipLevels.length>0&&this.clipLevels[this.clipLevels.length-1]===e&&(this.ctx.restore(),this.clipLevels.pop()),null!==this.ignoreObjectsAboveLevel&&this.getNestingLevel()<=this.ignoreObjectsAboveLevel&&(this.ignoreObjectsAboveLevel=null,this.ignoringObject=!1)}drawWithRawRenderingContext(e){this.ctx.save(),this.transformBy(this.getCanvasToScreenTransform()),e(this.ctx),this.ctx.restore()}drawPoints(...e){for(let t=0;t<e.length;t++){const o=this.canvasToScreen(e[t]);this.ctx.beginPath(),this.ctx.arc(o.x,o.y,10,0,2*Math.PI),this.ctx.fillStyle=r.Color4.ofRGBA(.5+Math.sin(t)/2,1,.5+Math.cos(.2*t)/4,.5).toHexString(),this.ctx.lineWidth=2,this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.ctx.fillText(`${t}`,o.x,o.y,20)}}isTooSmallToRender(e){const t=e.size.times(this.getSizeOfCanvasPixelOnScreen()),o=this.minRenderSizeBothDimens,n=Math.abs(t.x)<o&&Math.abs(t.y)<o,i=this.minRenderSizeAnyDimen,r=Math.abs(t.x)<i||Math.abs(t.y)<i;return n||r}static fromViewport(e,t={}){const o=document.createElement("canvas"),n=e.getScreenRectSize();let i=t.canvasSize??n;t.maxCanvasDimen&&i.maximumEntryMagnitude()>t.maxCanvasDimen&&(i=i.times(t.maxCanvasDimen/i.maximumEntryMagnitude())),o.width=i.x,o.height=i.y;const r=o.getContext("2d"),s=Math.min(i.x/n.x,i.y/n.y);return r.scale(s,s),{renderer:new l(r,e),element:o}}}t.default=l},1166:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=n(o(1328));class s extends r.default{constructor(e){super(e),this.clearedCount=0,this.renderedPathCount=0,this.lastFillStyle=null,this.lastPoint=null,this.objectNestingLevel=0,this.lastText=null,this.lastImage=null,this.pointBuffer=[]}displaySize(){const e=this.getViewport().getScreenRectSize();return 0===e.x||0===e.y?i.Vec2.of(640,480):e}clear(){if(this.clearedCount++,this.renderedPathCount=0,this.pointBuffer=[],this.lastText=null,this.lastImage=null,this.objectNestingLevel>0)throw new Error(`Within an object while clearing! Nesting level: ${this.objectNestingLevel}`)}beginPath(e){this.lastPoint=e,this.pointBuffer.push(e)}endPath(e){this.renderedPathCount++,this.lastFillStyle=e}lineTo(e){e=this.canvasToScreen(e),this.lastPoint=e,this.pointBuffer.push(e)}moveTo(e){e=this.canvasToScreen(e),this.lastPoint=e,this.pointBuffer.push(e)}traceCubicBezierCurve(e,t,o){e=this.canvasToScreen(e),t=this.canvasToScreen(t),o=this.canvasToScreen(o),this.lastPoint=o,this.pointBuffer.push(e,t,o)}traceQuadraticBezierCurve(e,t){e=this.canvasToScreen(e),t=this.canvasToScreen(t),this.lastPoint=t,this.pointBuffer.push(e,t)}drawPoints(...e){}drawText(e,t,o){this.lastText=e}drawImage(e){this.lastImage=e}startObject(e,t){super.startObject(e),this.objectNestingLevel+=1}endObject(){super.endObject(),this.objectNestingLevel-=1}isTooSmallToRender(e){return!1}canRenderFromWithoutDataLoss(e){return e instanceof s}renderFromOtherOfSameType(e,t){if(!(t instanceof s))throw new Error(`${t} cannot be rendered onto ${this}`);this.renderedPathCount+=t.renderedPathCount,this.lastFillStyle=t.lastFillStyle,this.lastPoint=t.lastPoint,this.pointBuffer.push(...t.pointBuffer.map((t=>e.transformVec2(t))))}toString(){return"[DummyRenderer]"}}t.default=s},1712:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderedStylesheetId=void 0;const i=o(3755),r=o(5466),s=o(2293),a=n(o(1328)),l=o(2956),c=n(o(6035));t.renderedStylesheetId="js-draw-style-sheet";const d="http://www.w3.org/2000/svg",h={fontWeight:"400",fontStyle:"normal"};class u extends a.default{constructor(e,t,o=!1){super(t),this.elem=e,this.sanitize=o,this.lastPathStyle=null,this.lastPathString=[],this.lastContainerIDList=[],this.objectElems=null,this.overwrittenAttrs={},this.textContainer=null,this.textContainerTransform=null,this.textParentStyle=h,this.clear(),this.addStyleSheet()}addStyleSheet(){if(!this.elem.querySelector(`#${t.renderedStylesheetId}`)){const e=document.createElementNS("http://www.w3.org/2000/svg","style");e.appendChild(document.createTextNode("\n\t\t\t\tpath {\n\t\t\t\t\tstroke-linecap: round;\n\t\t\t\t\tstroke-linejoin: round;\n\t\t\t\t}\n\n\t\t\t\ttext {\n\t\t\t\t\twhite-space: pre;\n\t\t\t\t}\n\t\t\t".replace(/\s+/g,""))),e.setAttribute("id",t.renderedStylesheetId),this.elem.appendChild(e)}}setRootSVGAttribute(e,t){this.sanitize||(e in this.overwrittenAttrs||(this.overwrittenAttrs[e]=this.elem.getAttribute(e)),null!==t?this.elem.setAttribute(e,t):this.elem.removeAttribute(e))}displaySize(){return i.Vec2.of(this.elem.clientWidth,this.elem.clientHeight)}clear(){if(this.lastPathString=[],this.lastContainerIDList=[],!this.sanitize){for(const e in this.overwrittenAttrs){const t=this.overwrittenAttrs[e];t?this.elem.setAttribute(e,t):this.elem.removeAttribute(e)}this.overwrittenAttrs={}}}addPathToSVG(){if(!this.lastPathStyle||0===this.lastPathString.length)return null;const e=document.createElementNS(d,"path");e.setAttribute("d",this.lastPathString.join(" "));const t=this.lastPathStyle;return t.fill.a>0?e.setAttribute("fill",t.fill.toHexString()):e.setAttribute("fill","none"),t.stroke&&(e.setAttribute("stroke",t.stroke.color.toHexString()),e.setAttribute("stroke-width",(0,i.toRoundedString)(t.stroke.width*this.getSizeOfCanvasPixelOnScreen()))),this.elem.appendChild(e),this.objectElems?.push(e),e}drawPath(e){const t=e.style,o=(0,l.pathFromRenderable)(e).transformedBy(this.getCanvasToScreenTransform());0!==this.lastPathString.length&&this.lastPathStyle&&(0,s.stylesEqual)(this.lastPathStyle,t)||(this.addPathToSVG(),this.lastPathStyle=t,this.lastPathString=[]),this.lastPathString.push(o.toString())}transformFrom(e,t,o=!1){const n=o?e:this.getCanvasToScreenTransform().rightMul(e);if(n.eq(i.Mat33.identity))t.style.transform="";else{const e=n.toCSSMatrix();t.style.transform=e,t.setAttribute("data-highp-transform",e)}}drawText(e,t,o){const n=(e,t)=>{t.fontFamily!==this.textParentStyle?.fontFamily&&(e.style.fontFamily=t.fontFamily),t.fontVariant!==this.textParentStyle?.fontVariant&&(e.style.fontVariant=t.fontVariant??""),t.fontWeight!==this.textParentStyle?.fontWeight&&(e.style.fontWeight=t.fontWeight??""),t.fontStyle!==this.textParentStyle?.fontStyle&&(e.style.fontStyle=t.fontStyle??""),t.size!==this.textParentStyle?.size&&(e.style.fontSize=t.size+"px");const o=t.renderingStyle.fill.toHexString();if(e.style.fill=o,t.renderingStyle.stroke){const o=t.renderingStyle.stroke;e.style.stroke=o.color.toHexString(),e.style.strokeWidth=o.width+"px"}};if(t=this.getCanvasToScreenTransform().rightMul(t),this.textContainer){const r=document.createElementNS(d,"tspan");r.appendChild(document.createTextNode(e)),this.textContainer.appendChild(r);const s=(t=this.textContainerTransform.inverse().rightMul(t)).transformVec2(i.Vec2.zero);r.setAttribute("x",`${(0,i.toRoundedString)(s.x)}`),r.setAttribute("y",`${(0,i.toRoundedString)(s.y)}`),n(r,o)}else{const i=document.createElementNS(d,"text");i.appendChild(document.createTextNode(e)),this.transformFrom(t,i,!0),n(i,o),this.elem.appendChild(i),this.objectElems?.push(i),this.objectLevel>0&&(this.textContainer=i,this.textContainerTransform=t,this.textParentStyle={...h,...o})}}drawImage(e){let t=e.label??e.image.getAttribute("aria-label")??"";""===t&&(t=e.image.getAttribute("alt")??"");const o=document.createElementNS(d,"image");o.setAttribute("href",e.base64Url),o.setAttribute("width",e.image.getAttribute("width")??""),o.setAttribute("height",e.image.getAttribute("height")??""),o.setAttribute("aria-label",t),this.transformFrom(e.transform,o),this.elem.appendChild(o),this.objectElems?.push(o)}startObject(e){super.startObject(e),this.lastPathString=[],this.lastPathStyle=null,this.textContainer=null,this.textParentStyle=h,this.objectElems=[]}endObject(e,t){if(super.endObject(e),this.addPathToSVG(),this.objectElems){if(e&&!this.sanitize){for(const t of this.objectElems){const o=e[r.svgAttributesDataKey],n=e[r.svgStyleAttributesDataKey];if(o)for(const[e,n]of o)t.setAttribute(e,n);if(n)for(const e of n)t.style.setProperty(e.key,e.value,e.priority)}const t=e[r.svgLoaderAttributeContainerID];let o=[];if(t&&t[0]&&t[0].length&&(o=t[0]),o.length>0&&(0,c.default)(this.lastContainerIDList,o)&&this.lastContainerIDList.length>=o.length-1){const e=o[o.length-1],t=this.elem.querySelectorAll(`g#${e}`);if(t.length>=1){const e=t[0];if(0===e.children.length||this.lastContainerIDList.length>=o.length)for(const t of this.objectElems)t.remove(),e.appendChild(t);else o=[]}}else o=[];this.lastContainerIDList=o}if(t&&this.objectElems)if(1===this.objectElems.length)this.objectElems[0].classList.add(...t);else{const e=document.createElementNS(d,"g");e.classList.add(...t);for(const t of this.objectElems)t.remove(),e.appendChild(t);this.elem.appendChild(e)}}}unimplementedMessage(){throw new Error("Not implemenented!")}beginPath(e){this.unimplementedMessage()}endPath(e){this.unimplementedMessage()}lineTo(e){this.unimplementedMessage()}moveTo(e){this.unimplementedMessage()}traceCubicBezierCurve(e,t,o){this.unimplementedMessage()}traceQuadraticBezierCurve(e,t){this.unimplementedMessage()}drawPoints(...e){e.map((e=>{const t=document.createElementNS(d,"circle");t.setAttribute("cx",`${e.x}`),t.setAttribute("cy",`${e.y}`),t.setAttribute("r","15"),this.elem.appendChild(t)}))}drawSVGElem(e){if(this.sanitize)return;if("style"===e.tagName.toLowerCase()&&e.getAttribute("id")===t.renderedStylesheetId)return;const o=e.cloneNode(!0);this.elem.appendChild(o),this.objectElems?.push(o)}drawWithSVGParent(e){const t=document.createElementNS(d,"g");this.transformFrom(i.Mat33.identity,t,!0),e(t,{sanitize:this.sanitize}),this.elem.appendChild(t),this.objectElems?.push(t)}isTooSmallToRender(e){return!1}static fromViewport(e,t=!0){let o,n;"boolean"==typeof t?(o=t,n=!1):(o=t.sanitize??!0,n=t.useViewBoxForPositioning??!1);const r="http://www.w3.org/2000/svg",s=document.createElementNS(r,"svg"),a=e.getScreenRectSize(),l=e.visibleRect;let c;if(n){const t=e.visibleRect;c=[t.x,t.y,t.w,t.h],(e=e.getTemporaryClone()).resetTransform(i.Mat33.identity)}else c=[0,0,a.x,a.y];s.setAttribute("viewBox",c.map((e=>(0,i.toRoundedString)(e))).join(" ")),s.setAttribute("width",(0,i.toRoundedString)(a.x)),s.setAttribute("height",(0,i.toRoundedString)(a.y)),s.setAttribute("version","1.1"),s.setAttribute("baseProfile","full"),s.setAttribute("xmlns",r);const d=new u(s,e,o);return l.eq(e.visibleRect)||d.overrideVisibleRect(l),{element:s,renderer:d}}}t.default=u},8231:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=n(o(1328));class s extends r.default{constructor(e,t){super(e),this.localizationTable=t,this.descriptionBuilder=[],this.pathCount=0,this.textNodeCount=0,this.imageNodeCount=0}displaySize(){return i.Vec2.of(500,500)}clear(){this.descriptionBuilder=[],this.pathCount=0,this.textNodeCount=0,this.imageNodeCount=0}getDescription(){return[this.localizationTable.pathNodeCount(this.pathCount),...this.textNodeCount>0?[this.localizationTable.textNodeCount(this.textNodeCount)]:[],...this.imageNodeCount>0?[this.localizationTable.imageNodeCount(this.imageNodeCount)]:[],...this.descriptionBuilder].join("\n")}beginPath(e){}endPath(e){this.pathCount++}lineTo(e){}moveTo(e){}traceCubicBezierCurve(e,t,o){}traceQuadraticBezierCurve(e,t){}drawText(e,t,o){this.descriptionBuilder.push(this.localizationTable.textNode(e)),this.textNodeCount++}drawImage(e){const t=e.label?this.localizationTable.imageNode(e.label):this.localizationTable.unlabeledImageNode;this.descriptionBuilder.push(t),this.imageNodeCount++}isTooSmallToRender(e){return e.maxDimension<15/this.getSizeOfCanvasPixelOnScreen()}drawPoints(...e){}}t.default=s},5617:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=e=>e.toUpperCase()===e&&e.toLowerCase()!==e&&1===e.length,n=e=>e.toLowerCase()===e&&e.toUpperCase()!==e&&1===e.length;class i{constructor(e){this.key=e.key,this.shiftKey=e.shiftKey,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.metaKey=e.metaKey,this.controlOrMeta=e.controlOrMeta}matchesEvent(e){const t=e.key?.toLowerCase(),i=o(e.key??""),r=n(e.key??""),s=(e.ctrlKey??!1)||"control"===t,a=(e.altKey??!1)||"alt"===t,l=(e.metaKey??!1)||"meta"===t,c=(e.shiftKey??i)||"shift"===t,d=e.controlOrMeta||e.ctrlKey||e.metaKey||!1;if(this.key!==e.code){if(this.key.toLowerCase()!==t)return!1;if((i||r)&&this.key!==e.key&&(!0!==this.shiftKey||this.key.toUpperCase()!==e.key))return!1}const h=this.controlOrMeta;return(s===this.ctrlKey&&l===this.metaKey&&!h||h&&d)&&a===this.altKey&&(c===this.shiftKey||void 0===this.shiftKey)}toString(){const e=[];return this.ctrlKey&&"control"!==this.key&&e.push("Ctrl"),this.controlOrMeta&&e.push("CtrlOrMeta"),this.altKey&&"alt"!==this.key&&e.push("Alt"),this.metaKey&&"meta"!==this.key&&e.push("Meta"),this.shiftKey&&"shift"!==this.key&&e.push("Shift"),e.push(this.key),e.join("+")}static fromString(e){const t=e=>{let t;o(e)?t=!0:(n(e)||e.length>1)&&(t=!1);const i=e.toLowerCase();return"shift"===i&&(t=!0),{shiftKey:t,ctrlKey:"control"===i||"ctrl"===i,altKey:"alt"===i,metaKey:"meta"===i,controlOrMeta:"control or meta"===i||"ctrlormeta"===i}};if(-1===e.search(/[-+]/)||1===e.length){const o=t(e);return new i({key:e,...o})}const r=/^(.*[-+])?(.+)$/g.exec(e);if(!r)throw new Error(`Invalid shortcut expression, ${e}!`);const s=r[2],a=t(s),l=(r[1]??"").split(/[-+]/);let c=a.shiftKey,d=a.ctrlKey,h=a.altKey,u=a.metaKey,p=a.controlOrMeta;for(const t of l)if(""!==t)switch(t.toLowerCase()){case"shift":c=!0;break;case"anyshift":c=void 0;break;case"ctrl":case"control":d=!0;break;case"meta":u=!0;break;case"ctrlormeta":case"ctrl or meta":case"controlormeta":p=!0;break;case"alt":h=!0;break;default:throw new Error(`Unknown modifier: "${t}" in shortcut ${e}.`)}return new i({key:s,shiftKey:c,ctrlKey:d,altKey:h,metaKey:u,controlOrMeta:p})}}t.default=i},2451:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(9389),r=n(o(5617));class s{constructor(e){this.shortcutOverrides=Object.create(null);for(const t in e)this.overrideShortcut(t,e[t])}overrideShortcut(e,t){this.shortcutOverrides[e]=[...t]}matchesShortcut(e,t){let o=this.shortcutOverrides[e];if(!o){if(!(e in s.shortcuts))throw new Error(`No shortcut with ID ${e} exists!`);o=s.shortcuts[e]}for(const e of o)if(e.matchesEvent(t))return!0;return!1}static registerDefaultKeyboardShortcut(e,t,o){if(e in s.shortcuts)return!1;const n=t.map((e=>"string"==typeof e?r.default.fromString(e):e));return s.shortcuts[e]=[...n],s.shortcutDefaultDescriptions[e]=o,!0}static provideShortcutDescription(e,t,o){t in s.shortcutLocalizedDescriptions||(s.shortcutLocalizedDescriptions[t]=Object.create(null)),s.shortcutLocalizedDescriptions[t][e]=o}static getAllShortcutIds(){const e=[];for(const t in this.shortcuts)e.push(t);return e}static getShortcutDefaultKeybindings(e){if(!(e in s.shortcuts))throw new Error(`No shortcut with ID ${e} exists!`);return s.shortcuts[e]}static getShortcutDescription(e,t){return(0,i.matchingLocalizationTable)(t??[],this.shortcutLocalizedDescriptions,this.shortcutDefaultDescriptions)[e]??this.shortcutDefaultDescriptions[e]??null}}s.shortcuts=Object.create(null),s.shortcutDefaultDescriptions=Object.create(null),s.shortcutLocalizedDescriptions=Object.create(null),t.default=s},7306:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.KeyBinding=t.KeyboardShortcutManager=void 0;var i=o(2451);Object.defineProperty(t,"KeyboardShortcutManager",{enumerable:!0,get:function(){return n(i).default}});var r=o(5617);Object.defineProperty(t,"KeyBinding",{enumerable:!0,get:function(){return n(r).default}})},8897:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{let t=0;const o=e.map((e=>e.id));o.sort();for(const e of o)t===e&&(t=e+1);return t}},3441:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendTouchEvent=t.sendPenEvent=void 0;var i=o(4459);Object.defineProperty(t,"sendPenEvent",{enumerable:!0,get:function(){return n(i).default}});var r=o(1891);Object.defineProperty(t,"sendTouchEvent",{enumerable:!0,get:function(){return n(r).default}})},4459:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=s(o(7372)),c=o(4892),d=a(o(8897));t.default=(e,t,o,n,i=l.PointerDevice.Pen)=>{const r=(0,d.default)(n??[]),s=l.default.ofCanvasPoint(o,t!==c.InputEvtType.PointerUpEvt,e.viewport,r,i);return e.toolController.dispatchInputEvent({kind:t,allPointers:n??[s],current:s}),s}},1891:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=s(o(7372)),c=o(4892),d=a(o(8897));t.default=(e,t,o,n)=>{const i=e.viewport.screenToCanvas(o),r=(0,d.default)(n??[]),s=l.default.ofCanvasPoint(i,t!==c.InputEvtType.PointerUpEvt,e.viewport,r,l.PointerDevice.Touch);return e.toolController.dispatchInputEvent({kind:t,allPointers:[...n??[],s],current:s}),s}},9996:function(e,t,o){"use strict";var n,i,r,s,a=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=o(2572),h=o(2067),u=c(o(8522)),p=c(o(1801)),f=c(o(5384)),m=c(o(6953)),g=c(o(3822)),b=c(o(4122)),v=c(o(61)),y=c(o(4135)),w=c(o(9374)),x=c(o(3268)),S=o(1794),T=c(o(2517)),C=c(o(4160)),P=c(o(783)),k=o(3755),E=o(1404),z=c(o(8632)),_=c(o(2365)),M=o(5673);class I{constructor(e,t){this.editor=e,n.set(this,[]),i.set(this,{}),r.set(this,[]),s.set(this,null),this.closeColorPickerOverlay=null,this.localizationTable=t??e.localization,I.colorisStarted||((0,h.init)(),I.colorisStarted=!0),this.setupColorPickers()}setupCloseColorPickerOverlay(){this.closeColorPickerOverlay||(this.closeColorPickerOverlay=document.createElement("div"),this.closeColorPickerOverlay.className=`${E.toolbarCSSPrefix}closeColorPickerOverlay`,this.editor.createHTMLOverlay(this.closeColorPickerOverlay),a(this,n,"f").push(this.editor.handlePointerEventsExceptClicksFrom(this.closeColorPickerOverlay,(e=>("pointerdown"===e&&(0,h.close)(),"pointerup"===e&&this.editor.focus(),!0)))))}setupColorPickers(){if(a(this,s,"f"))return void a(this,s,"f").call(this);this.setupCloseColorPickerOverlay();const e=[k.Color4.red.toHexString(),k.Color4.purple.toHexString(),k.Color4.blue.toHexString(),k.Color4.clay.toHexString(),k.Color4.black.toHexString(),k.Color4.white.toHexString()],t=e.length;let o=!1;const i=()=>{try{(0,h.coloris)({el:".coloris_input",format:"hex",selectInput:!1,focusInput:!1,themeMode:"auto",swatches:e})}catch(e){console.warn("Failed to initialize Coloris. Error: ",e),o||(o=!0,document.addEventListener("load",(()=>{i()}),{once:!0}))}};i(),l(this,s,i,"f"),a(this,n,"f").push(this.editor.notifier.on(d.EditorEventType.ColorPickerToggled,(e=>{e.kind===d.EditorEventType.ColorPickerToggled&&this.closeColorPickerOverlay&&(this.closeColorPickerOverlay.style.display=e.open?"block":"none")}))),a(this,n,"f").push(this.editor.notifier.on(d.EditorEventType.ColorPickerColorSelected,(o=>{o.kind===d.EditorEventType.ColorPickerColorSelected&&(o=>{let n=!1;for(const t of e)t===o&&(n=!0);n||(e.push(o),e.length>12&&e.splice(t,1),i())})(o.color.toHexString())})))}closeColorPickers(){(0,h.close)?.()}getWidgetUniqueId(e){return e.getUniqueIdIn(a(this,i,"f"))}getWidgetFromId(e){return a(this,i,"f")[e]}getAllWidgets(){return a(this,r,"f")}addWidget(e){const t=e.getUniqueIdIn(a(this,i,"f"));a(this,i,"f")[t]=e,a(this,r,"f").push(e),this.addWidgetInternal(e),this.setupColorPickers()}removeWidget(e){const t=e.getUniqueIdIn(a(this,i,"f"));this.removeWidgetInternal(e),delete a(this,i,"f")[t],l(this,r,a(this,r,"f").filter((t=>t!==e)),"f")}serializeState(){const e={};for(const t in a(this,i,"f"))e[t]=a(this,i,"f")[t].serializeState();return e[I.rootToolbarId]=this.serializeInternal(),JSON.stringify(e)}deserializeState(e){const t=JSON.parse(e);(0,M.assertIsObject)(t),(0,M.assertTruthy)(t);const o=I.rootToolbarId;o in t&&void 0!==t[o]&&this.deserializeInternal(t[o]);for(const e in t)e!==o&&(e in a(this,i,"f")?"object"==typeof t[e]&&t[e]&&a(this,i,"f")[e].deserializeFrom(t[e]):console.warn(`Unable to deserialize widget ${e} ­— no such widget.`))}serializeInternal(){}deserializeInternal(e){}makeActionButton(e,t,o=!0){"boolean"==typeof o&&(o={mustBeToplevel:o});const n=o.mustBeToplevel??!0,i=o.autoDisableInReadOnlyEditors??!0,r="string"==typeof e?e:e.label;return new T.default(this.editor,"action-button",(()=>"string"==typeof e?null:e.icon),r,t,this.editor.localization,n,i)}addActionButton(e,t,o=!0){const n=this.makeActionButton(e,t,o);return this.addWidget(n),n}addTaggedActionButton(e,t,o,n=!0){const i=this.makeActionButton(t,o,n);return i.setTags(e),this.addWidget(i),i}addSaveButton(e,t={}){const o=new z.default(this.editor,this.localizationTable,e,t);return this.addWidget(o),o}addExitButton(e,t={}){const o=new _.default(this.editor,this.localizationTable,e,t);return this.addWidget(o),o}addUndoRedoButtons(e=!0){const t=()=>this.addTaggedActionButton([S.ToolbarWidgetTag.Undo],{label:this.localizationTable.undo,icon:this.editor.icons.makeUndoIcon()},(()=>{this.editor.history.undo()})),o=()=>this.addTaggedActionButton([S.ToolbarWidgetTag.Redo],{label:this.localizationTable.redo,icon:this.editor.icons.makeRedoIcon()},(()=>{this.editor.history.redo()}));let n,i;e?(n=t(),i=o()):(i=o(),n=t()),n.setDisabled(!0),i.setDisabled(!0),this.editor.notifier.on(d.EditorEventType.UndoRedoStackUpdated,(e=>{if(e.kind!==d.EditorEventType.UndoRedoStackUpdated)throw new Error("Wrong event type!");n.setDisabled(0===e.undoStackSize),i.setDisabled(0===e.redoStackSize)}))}addWidgetsForPrimaryTools(e){for(const t of this.editor.toolController.getPrimaryTools())if(!e||e?.(t))if(t instanceof g.default){const e=new b.default(this.editor,t,this.localizationTable);this.addWidget(e)}else t instanceof m.default?this.addWidget(new v.default(this.editor,t,this.localizationTable)):t instanceof u.default?this.addWidget(new y.default(this.editor,t,this.localizationTable)):t instanceof f.default?this.addWidget(new w.default(this.editor,t,this.localizationTable)):t instanceof p.default&&this.addWidget(new x.default(this.editor,t,this.localizationTable))}addDefaultToolWidgets(){this.addWidgetsForPrimaryTools(),this.addDefaultEditorControlWidgets()}addDefaultEditorControlWidgets(){this.addWidget(new P.default(this.editor,this.localizationTable)),this.addWidget(new C.default(this.editor,this.localizationTable))}addDefaultActionButtons(){this.addUndoRedoButtons()}remove(){this.closeColorPickerOverlay?.remove();for(const e of a(this,n,"f"))e.remove();l(this,n,[],"f"),this.onRemove();for(const e of a(this,r,"f"))e.remove()}manageListener(e){a(this,n,"f").push(e)}}n=new WeakMap,i=new WeakMap,r=new WeakMap,s=new WeakMap,I.colorisStarted=!1,I.rootToolbarId="root-toolbar--",t.default=I},7113:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeDropdownToolbar=void 0;const i=n(o(2889)),r=n(o(9996)),s=o(1404);t.makeDropdownToolbar=e=>new a(e,e.getRootElement(),e.localization);class a extends r.default{constructor(e,t,o){super(e,o),this.widgetOrderCounter=0,this.overflowWidget=null,this.reLayoutQueued=!1,this.container=document.createElement("div"),this.container.classList.add(`${s.toolbarCSSPrefix}root`),this.container.classList.add(`${s.toolbarCSSPrefix}element`),this.container.classList.add(`${s.toolbarCSSPrefix}dropdown-toolbar`),this.container.setAttribute("role","toolbar"),t.appendChild(this.container),"ResizeObserver"in window?(this.resizeObserver=new ResizeObserver((e=>{this.reLayout()})),this.resizeObserver.observe(this.container)):console.warn("ResizeObserver not supported. Toolbar will not resize.")}queueReLayout(){this.reLayoutQueued||(this.reLayoutQueued=!0,requestAnimationFrame((()=>this.reLayout())))}reLayout(){if(this.reLayoutQueued=!1,!this.overflowWidget)return;const e=e=>{let t=0;for(const o of e)o.isHidden()||(t+=o.getButtonWidth());return t},t=this.getAllWidgets();let o=e(this.overflowWidget.getChildWidgets()),n=e(t)-o,i=.87*this.container.clientWidth;window.innerHeight>1.75*i&&(i*=1.75);let r=!1;if((e=>{const t=this.overflowWidget?.getChildWidgets()??[];return 0!==t.length&&t[0].getButtonWidth()<=e})(i-n)){const e=this.overflowWidget.clearChildren();for(const t of e)t.addTo(this.container),t.setIsToplevel(!0),t.isHidden()||(n+=t.getButtonWidth());o=0,r=!0}if(n>=i){for(let e=t.length-1;e>=0&&n>=i;e--){const o=t[e];this.overflowWidget.hasAsChild(o)||o.canBeInOverflowMenu()&&(n-=o.getButtonWidth(),this.overflowWidget.addToOverflow(o))}r=!0}this.overflowWidget.setHidden(0===this.overflowWidget.getChildWidgets().length),r&&this.setupColorPickers()}addWidgetInternal(e){e.addTo(this.container).style.order=""+this.widgetOrderCounter++,this.queueReLayout()}removeWidgetInternal(e){e.remove(),this.queueReLayout()}addSpacer(e={}){const t=document.createElement("div");t.classList.add(`${s.toolbarCSSPrefix}spacer`),e.grow&&(t.style.flexGrow=`${e.grow}`),e.minSize&&(t.style.minWidth=e.minSize),e.maxSize&&(t.style.maxWidth=e.maxSize),t.style.order=""+this.widgetOrderCounter++,this.container.appendChild(t)}addOverflowWidget(){this.overflowWidget=new i.default(this.editor,this.localizationTable),this.addWidget(this.overflowWidget)}addDefaults(){this.addDefaultToolWidgets(),this.addOverflowWidget(),this.addDefaultActionButtons()}onRemove(){this.container.remove(),this.resizeObserver.disconnect()}}t.default=a},2878:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeEdgeToolbar=void 0;const i=o(1794),r=o(1404),s=n(o(1053)),a=o(5786),l=n(o(9996)),c=n(o(626)),d=n(o(4646));t.makeEdgeToolbar=e=>new h(e,e.getRootElement(),e.localization);class h extends l.default{constructor(e,t,o){super(e,o),this.clearDragListeners=null,this.toolbarContainer=document.createElement("div"),this.toolbarContainer.classList.add(`${r.toolbarCSSPrefix}root`),this.toolbarContainer.classList.add(`${r.toolbarCSSPrefix}element`),this.toolbarContainer.classList.add(`${r.toolbarCSSPrefix}edge-toolbar`),this.toolbarContainer.setAttribute("role","toolbar"),this.toolbarActionRow=document.createElement("div"),this.toolbarActionRow.classList.add("toolbar-element","toolbar-action-row"),this.toolbarToolRow=document.createElement("div"),this.toolbarToolRow.classList.add("toolbar-element","toolbar-tool-row"),(0,c.default)(this.toolbarToolRow),"ResizeObserver"in window?(this.toolRowResizeObserver=new ResizeObserver((e=>{this.onToolbarRowResize()})),this.toolRowResizeObserver.observe(this.toolbarToolRow)):console.warn("ResizeObserver not supported. Toolbar will not resize."),this.toolbarContainer.replaceChildren(this.toolbarActionRow,this.toolbarToolRow),t.appendChild(this.toolbarContainer),this.sidebarVisible=a.ReactiveValue.fromInitialValue(!1),this.sidebarY=a.ReactiveValue.fromInitialValue(0),this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(`${r.toolbarCSSPrefix}edgemenu-container`),this.sidebarContainer=document.createElement("div"),this.sidebarContainer.classList.add(`${r.toolbarCSSPrefix}edgemenu`,`${r.toolbarCSSPrefix}element`),this.sidebarContainer.classList.add(`${r.toolbarCSSPrefix}tool-properties`),this.sidebarContent=document.createElement("div"),this.sidebarY.onUpdateAndNow((e=>{const t="dropdown-below-edge";e>0?(this.sidebarContainer.style.transform=`translate(0, ${e}px)`,this.sidebarContainer.style.paddingBottom="",this.menuContainer.classList.add(t)):(this.sidebarContainer.style.transform="",this.sidebarContainer.style.paddingBottom=-e+"px",this.menuContainer.classList.remove(t))})),this.closeButton=document.createElement("button"),this.closeButton.classList.add("drag-elem"),this.editor.handleKeyEventsFrom(this.closeButton,(e=>"Space"!==e.code&&"Enter"!==e.code&&"Tab"!==e.code)),this.sidebarContainer.addEventListener("keyup",(e=>{e.defaultPrevented||"Escape"!==e.code||(this.sidebarVisible.set(!1),e.preventDefault())})),this.initDragListeners(),this.sidebarTitle=a.MutableReactiveValue.fromInitialValue(""),this.layoutManager=new s.default(((...e)=>{this.sidebarContent.replaceChildren(...e),this.setupColorPickers()}),this.sidebarTitle,this.sidebarVisible,e.announceForAccessibility.bind(e),o),this.sidebarTitle.onUpdateAndNow((e=>{this.closeButton.setAttribute("aria-label",o.closeSidebar(e))})),this.listenForVisibilityChanges(),this.sidebarContainer.replaceChildren(this.closeButton,this.sidebarContent),this.menuContainer.replaceChildren(this.sidebarContainer),t.appendChild(this.menuContainer)}listenForVisibilityChanges(){let e=null;this.sidebarVisible.get()||(this.menuContainer.style.display="none",this.menuContainer.style.opacity="0");const t=window.matchMedia?.("(prefers-reduced-motion: reduce)")??"";this.sidebarVisible.onUpdate((o=>{const n="170ms ease",i=t.matches?"-reduce-motion":"";o?(this.sidebarY.set(this.snappedSidebarY()),e&&(clearTimeout(e),e=null),this.menuContainer.style.display="",this.sidebarContainer.style.animation=`${n} ${r.toolbarCSSPrefix}-edgemenu-transition-in${i}`,this.menuContainer.style.animation=`${n} ${r.toolbarCSSPrefix}-edgemenu-container-transition-in${i}`,this.menuContainer.style.opacity="1",this.closeButton.focus({preventScroll:!0})):(this.closeColorPickers(),null===e&&(this.sidebarContainer.style.animation=`${n} ${r.toolbarCSSPrefix}-edgemenu-transition-out${i}`,this.menuContainer.style.animation=`${n} ${r.toolbarCSSPrefix}-edgemenu-container-transition-out${i}`,this.menuContainer.style.opacity="0",this.editor.announceForAccessibility(this.localizationTable.dropdownHidden(this.sidebarTitle.get())),e=setTimeout((()=>{this.menuContainer.style.display="none",this.menuContainer.style.overflowY="",e=null}),170)))}))}onToolbarRowResize(){const e=this.toolbarActionRow.getBoundingClientRect(),t=this.toolbarToolRow.getBoundingClientRect();e.y+e.height<=t.y?this.toolbarContainer.classList.remove("one-row"):this.toolbarContainer.classList.add("one-row"),this.toolbarToolRow.clientWidth<this.toolbarToolRow.scrollWidth?(this.toolbarToolRow.classList.add("has-scroll"),(()=>{const e=this.toolbarToolRow.clientWidth;let t=0,o=0,n=0;for(const i of this.toolbarToolRow.children){const r=i.clientHeight;if(t+=r,n++,t>e){o=e-t+r/2,o<0&&(o+=r);break}}const i=Math.round(o/n*10)/10;this.toolbarToolRow.style.setProperty("--extra-left-right-padding",`${i}px`)})()):this.toolbarToolRow.classList.remove("has-scroll","extra-padding")}addSpacer(e){}addUndoRedoButtons(){super.addUndoRedoButtons(!1)}addDefaults(){this.addDefaultActionButtons(),this.addDefaultToolWidgets()}updateWidgetCSSClasses(e){const t=e.getTags();e.removeCSSClassFromContainer("label-inline"),e.removeCSSClassFromContainer("label-left"),e.removeCSSClassFromContainer("label-right"),t.includes(i.ToolbarWidgetTag.Save)&&(e.addCSSClassToContainer("label-inline"),e.addCSSClassToContainer("label-left")),t.includes(i.ToolbarWidgetTag.Exit)&&(e.addCSSClassToContainer("label-inline"),e.addCSSClassToContainer("label-right"))}addWidgetInternal(e){this.updateWidgetCSSClasses(e),e.setLayoutManager(this.layoutManager),e.mustBeInToplevelMenu()?e.addTo(this.toolbarActionRow):e.addTo(this.toolbarToolRow)}removeWidgetInternal(e){e.remove()}onRemove(){this.toolbarContainer.remove(),this.menuContainer.remove(),this.toolRowResizeObserver.disconnect(),this.clearDragListeners?.()}initDragListeners(){const e=[this.closeButton,this.sidebarContainer,this.sidebarContent];this.manageListener(this.editor.handlePointerEventsExceptClicksFrom(this.menuContainer,((e,t)=>t.target===this.menuContainer?("pointerdown"===e&&(this.sidebarVisible.set(!1),setTimeout((()=>this.editor.focus()),0)),!0):!this.sidebarVisible.get()),((e,t)=>t.target===this.menuContainer)));let t=!0,o=0;const n=(0,d.default)(this.sidebarContainer,{draggableChildElements:e,onDrag:(e,t)=>this.handleDrag(e,t),onDragEnd:e=>{o=e.endTimestamp,t=e.roughlyClick,this.finalizeDrag()}});this.clearDragListeners=()=>n.removeListeners(),this.closeButton.onclick=()=>{const e=performance.now()-o<100;(e&&t||!e)&&this.sidebarVisible.set(!1)}}handleDrag(e,t){this.sidebarContainer.style.transition="none",this.sidebarY.set(this.sidebarY.get()+t)}snappedSidebarY(e){const t=e??this.sidebarY.get(),o=[-100,0];this.sidebarContainer.clientHeight>window.innerHeight&&o.push(100);let n=o[0];for(const e of o)Math.abs(e-t)<Math.abs(n-t)&&(n=e);return n}finalizeDrag(){this.sidebarContainer.style.transition="",this.sidebarY.get()>this.sidebarContainer.clientHeight/2?this.sidebarVisible.set(!1):this.sidebarY.set(this.snappedSidebarY())}serializeInternal(){return{menuSizeY:this.snappedSidebarY()}}deserializeInternal(e){"object"==typeof e&&"number"==typeof e.menuSizeY&&this.sidebarY.set(this.snappedSidebarY(e.menuSizeY))}}t.default=h},6573:function(e,t,o){"use strict";var n,i,r=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(3755),l=s(o(1712)),c=s(o(4287)),d=o(8195),h=o(5024),u=o(6953),p=o(5890),f=o(711),m="http://www.w3.org/2000/svg";let g=0;const b=()=>{const e="checkerboard-"+g++,t=(0,p.createSvgElement)("pattern",{id:e,viewBox:"0,0,10,10",width:"20%",height:"20%",patternUnits:"userSpaceOnUse",children:(0,p.createSvgElements)("rect",[{x:0,y:0,width:10,height:10,fill:"white"},{x:0,y:0,width:5,height:5,fill:"gray"},{x:5,y:5,width:5,height:5,fill:"gray"}])}),o=`url(#${e})`;return{patternDefElement:t,get patternDef(){return t.innerHTML},patternRef:o}},v=e=>{const t=document.createElementNS(m,"svg");t.innerHTML="\n\t\t<style>\n\t\t\t.toolbar-svg-undo-redo-icon {\n\t\t\t\tstroke: var(--icon-color);\n\t\t\t\tstroke-width: 12;\n\t\t\t\tstroke-linejoin: round;\n\t\t\t\tstroke-linecap: round;\n\t\t\t\tfill: none;\n\n\t\t\t\ttransform-origin: center;\n\t\t\t}\n\t\t</style>\n\t";const o=document.createElementNS(m,"path");return o.setAttribute("d","M20,20 A15,15 0 0 1 70,80 L80,90 L60,70 L65,90 L87,90 L65,80"),o.classList.add("toolbar-svg-undo-redo-icon"),e&&(o.style.transform="scale(-1, 1)"),t.appendChild(o),t.setAttribute("viewBox","0 0 100 100"),t};n=new WeakSet,i=function(){return this.makeIconFromPath("\n\t\t\tM 15,15 85,85\n\t\t\tM 15,85 85,15\n\t\t","none","var(--icon-color)","6px")},t.default=class{constructor(){n.add(this)}makeUndoIcon(){return v(!0)}makeRedoIcon(){return v(!1)}makeDropdownIcon(){const e=this.makeIconFromPath("M5,10 L50,90 L95,10 Z");return e.setAttribute("viewBox","-10 -10 110 110"),e}makeEraserIcon(e,t){e??=10;const o=e/4,n="#ff70af";return(0,p.createSvgElement)("svg",{viewBox:"0 0 120 120",children:[(0,p.createSvgElement)("defs",{children:[(0,p.createSvgElement)("linearGradient",{id:"dash-pattern",children:(0,p.createSvgElements)("stop",[{offset:"80%","stop-color":n},{offset:"85%","stop-color":"white"},{offset:"90%","stop-color":n}])})]}),(0,p.createSvgElement)("path",{fill:t===u.EraserMode.PartialStroke?"url(#dash-pattern)":n,stroke:"black",transform:"rotate(41.35)",d:`\n\t\t\t\t\t\tM 52.5 27\n\t\t\t\t\t\tC 50 28.9 48.9 31.7 48.9 34.8\n\t\t\t\t\t\tL 48.9 39.8\n\t\t\t\t\t\tC 48.9 45.3 53.4 49.8 58.9 49.8\n\t\t\t\t\t\tL 103.9 49.8\n\t\t\t\t\t\tC 105.8 49.8 107.6 49.2 109.1 48.3\n\t\t\t\t\t\tL 110.2 ${o+49.5} L 159.7 ${o+5}\n\t\t\t\t\t\tL 157.7 ${5.2-o} L 112.4 ${49.5-o}\n\t\t\t\t\t\tC 113.4 43.5 113.9 41.7 113.9 39.8\n\t\t\t\t\t\tL 113.9 34.8\n\t\t\t\t\t\tC 113.9 29.3 109.4 24.8 103.9 24.8\n\t\t\t\t\t\tL 58.9 24.8\n\t\t\t\t\t\tC 56.5 24.8 54.3 25.7 52.5 27\n\t\t\t\t\t\tz\n\t\t\t\t\t`}),(0,p.createSvgElement)("rect",{stroke:"#cc8077",fill:"var(--icon-color)",width:65,height:75,x:48.9,y:-38.7,transform:"rotate(41.35)"})]})}makeSelectionIcon(e=f.SelectionMode.Rectangle){const t=document.createElementNS(m,"svg");return e===f.SelectionMode.Rectangle?t.innerHTML='\n\t\t\t<g>\n\t\t\t\t<rect x="10" y="10" width="70" height="70" fill="pink" stroke="black" stroke-dasharray="32 9"/>\n\t\t\t\t<rect x="75" y="75" width="10" height="10" fill="white" stroke="black"/>\n\t\t\t</g>\n\t\t\t':t.innerHTML='\n\t\t\t<g>\n\t\t\t\t<rect x="10" y="10" width="76" height="76" rx="50" stroke-dasharray="32 9" fill="pink" stroke="black"/>\n\t\t\t\t<rect x="71" y="71" width="10" height="10" fill="white" stroke="black"/>\n\t\t\t</g>\n\t\t\t',t.setAttribute("viewBox","0 0 100 100"),t}makeRotateIcon(){const e=document.createElementNS(m,"svg");return e.innerHTML='\n\t\t\t<defs>\n\t\t\t\t<marker\n\t\t\t\t\tid="arrow-marker"\n\t\t\t\t\tviewBox="0 0 10 10"\n\t\t\t\t\trefX="3" refY="5"\n\t\t\t\t\tmarkerWidth="3" markerHeight="3"\n\t\t\t\t\torient="auto-start-reverse"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M0,0 L8,5 L0,10z"\n\t\t\t\t\t\tfill="var(--icon-color)"\n\t\t\t\t\t/>\n\t\t\t\t</marker>\n\t\t\t</defs>\n\n\t\t\t<path\n\t\t\t\tmarker-start="url(#arrow-marker)"\n\t\t\t\td="\n\t\t\t\t\tM20,20\n\t\t\t\t\tA30,30 0 1 1 80 80\n\t\t\t\t"\n\t\t\t\tfill="none"\n\t\t\t\tstroke="var(--icon-color)"\n\t\t\t\tstroke-width="12"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="\n\t\t\t\t\tM80,80\n\t\t\t\t\tA30,30 0 1 1 20 20\n\t\t\t\t"\n\t\t\t\tfill="none"\n\t\t\t\tstroke="var(--icon-color)"\n\t\t\t\tstroke-width="12"\n\t\t\t\tstroke-dasharray="30 10 20 10 20 10 10"\n\t\t\t\tstyle="stroke-linecap: butt;"\n\t\t\t/>\n\t\t',e.setAttribute("viewBox","-5 -5 110 110"),e}makeHandToolIcon(){return this.makeIconFromPath("\n\t\t\tm 10,60\n\t\t\t\t5,30\n\t\t\tH 90\n\t\t\tV 30\n\t\t\tC 90,20 75,20 75,30\n\t\t\tV 60\n\t\t\t\t20\n\t\t\tC 75,10 60,10 60,20\n\t\t\tV 60\n\t\t\t\t15\n\t\t\tC 60,5 45,5 45,15\n\t\t\tV 60\n\t\t\t\t25\n\t\t\tC 45,15 30,15 30,25\n\t\t\tV 60\n\t\t\t\t75\n\t\t\tL 25,60\n\t\t\tC 20,45 10,50 10,60\n\t\t\tZ\n\t\t","none","var(--icon-color)","3")}makeTouchPanningIcon(){return this.makeIconFromPath("\n\t\t\tM 5,5.5\n\t\t\tV 17.2\n\t\t\tL 16.25,5.46\n\t\t\tZ\n\t\n\t\t\tm 33.75,0\n\t\t\tL 50,17\n\t\t\tV 5.5\n\t\t\tZ\n\t\n\t\t\tM 5,40.7\n\t\t\tv 11.7\n\t\t\th 11.25\n\t\t\tz\n\t\n\t\t\tM 26,19\n\t\t\tC 19.8,19.4 17.65,30.4 21.9,34.8\n\t\t\tL 50,70\n\t\t\tH 27.5\n\t\t\tc -11.25,0 -11.25,17.6 0,17.6\n\t\t\tH 61.25\n\t\t\tC 94.9,87.8 95,87.6 95,40.7 78.125,23 67,29 55.6,46.5\n\t\t\tL 33.1,23\n\t\t\tC 30.3125,20.128192 27.9,19 25.830078,19.119756\n\t\t\tZ\n\t\t","none","var(--icon-color)","3")}makeAllDevicePanningIcon(){return this.makeIconFromPath("\n\t\t\tM 5 5\n\t\t\tL 5 17.5\n\t\t\t\t17.5 5\n\t\t\t\t5 5\n\t\t\tz\n\t\n\t\t\tM 42.5 5\n\t\t\tL 55 17.5\n\t\t\t\t55 5\n\t\t\t\t42.5 5\n\t\t\tz\n\t\n\t\t\tM 70 10\n\t\t\tL 70 21\n\t\t\t\t61 15\n\t\t\t\t55.5 23\n\t\t\t\t66 30\n\t\t\t\t56 37\n\t\t\t\t61 45\n\t\t\t\t70 39\n\t\t\t\t70 50\n\t\t\t\t80 50\n\t\t\t\t80 39\n\t\t\t\t89 45\n\t\t\t\t95 36\n\t\t\t\t84 30\n\t\t\t\t95 23\n\t\t\t\t89 15\n\t\t\t\t80 21\n\t\t\t\t80 10\n\t\t\t\t70 10\n\t\t\tz\n\t\n\t\t\tM 27.5 26.25\n\t\t\tL 27.5 91.25\n\t\t\tL 43.75 83.125\n\t\t\tL 52 99\n\t\t\tL 68 91\n\t\t\tL 60 75\n\t\t\tL 76.25 66.875\n\t\t\tL 27.5 26.25\n\t\t\tz\n\t\n\t\t\tM 5 42.5\n\t\t\tL 5 55\n\t\t\tL 17.5 55\n\t\t\tL 5 42.5\n\t\t\tz\n\t\t","none","var(--icon-color)","3")}makeZoomIcon(){const e=document.createElementNS(m,"svg");e.setAttribute("viewBox","0 0 100 100");const t=(t,o,n)=>{const i=document.createElementNS(m,"text");i.appendChild(document.createTextNode(t)),i.setAttribute("x",o.toString()),i.setAttribute("y",n.toString()),i.style.textAlign="center",i.style.textAnchor="middle",i.style.fontSize="55px",i.style.fill="var(--icon-color)",i.style.fontFamily="monospace",e.appendChild(i)};return t("+",40,45),t("-",70,75),e}makeRotationLockIcon(){const e=this.makeIconFromPath("\n\t\t\tM 40.1 25.1 \n\t\t\tC 32.5 25 27.9 34.1 27.9 34.1 \n\t\t\tL 25.7 30 \n\t\t\tL 28 44.7 \n\t\t\tL 36.6 40.3 \n\t\t\tL 32.3 38.3 \n\t\t\tC 33.6 28 38.1 25.2 45.1 31.8 \n\t\t\tL 49.4 29.6 \n\t\t\tC 45.9 26.3 42.8 25.1 40.1 25.1 \n\t\t\tz\n\n\t\t\tM 51.7 34.2 \n\t\t\tL 43.5 39.1 \n\t\t\tL 48 40.8 \n\t\t\tC 47.4 51.1 43.1 54.3 35.7 48.2 \n\t\t\tL 31.6 50.7 \n\t\t\tC 45.5 62.1 52.6 44.6 52.6 44.6 \n\t\t\tL 55.1 48.6 \n\t\t\tL 51.7 34.2 \n\t\t\tz\n\n\t\t\tM 56.9 49.9 \n\t\t\tC 49.8 49.9 49.2 57.3 49.3 60.9 \n\t\t\tL 47.6 60.9 \n\t\t\tL 47.6 73.7 \n\t\t\tL 66.1 73.7 \n\t\t\tL 66.1 60.9 \n\t\t\tL 64.4 60.9 \n\t\t\tC 64.5 57.3 63.9 49.9 56.9 49.9 \n\t\t\tz\n\n\t\t\tM 56.9 53.5 \n\t\t\tC 60.8 53.5 61 58.2 60.8 60.9 \n\t\t\tL 52.9 60.9 \n\t\t\tC 52.7 58.2 52.9 53.5 56.9 53.5 \n\t\t\tz\n\t\t");return e.setAttribute("viewBox","10 10 70 70"),e}makeInsertImageIcon(){return this.makeIconFromPath("\n\t\t\tM 5 10 L 5 90 L 95 90 L 95 10 L 5 10 z\n\t\t\tM 10 15 L 90 15 L 90 50 L 70 75 L 40 50 L 10 75 L 10 15 z\n\t\t\tM 22.5 25 A 7.5 7.5 0 0 0 15 32.5 A 7.5 7.5 0 0 0 22.5 40 A 7.5 7.5 0 0 0 30 32.5 A 7.5 7.5 0 0 0 22.5 25 z \n\t\t")}makeUploadFileIcon(){return this.makeIconFromPath("\n\t\t\tM 48,10 32,34 43,33 42,68\n\t\t\tH 54\n\t\t\tL 53,33 64,34 Z\n\t\n\t\t\tM 8,66 V 86 H 88 V 66 H 78 V 76 H 18 V 66 Z\n\t\t")}makeTextIcon(e){const t=document.createElementNS(m,"svg");t.setAttribute("viewBox","0 0 100 100");const o=document.createElementNS(m,"text");return o.appendChild(document.createTextNode("T")),o.style.fontFamily=e.fontFamily,o.style.fontWeight=e.fontWeight??"",o.style.fontVariant=e.fontVariant??"",o.style.fill=e.renderingStyle.fill.toHexString(),o.style.textAnchor="middle",o.setAttribute("x","50"),o.setAttribute("y","75"),o.style.fontSize="65px",o.style.filter="drop-shadow(0px 0px 10px var(--shadow-color))",t.appendChild(o),t}makePenIcon(e){const t=Math.round(4*Math.sqrt(e.thickness)),o=e.color,n=t/2,i=`\n\t\t\tM ${15-n},${80-n}\n\t\t\t  ${15-n},${80+n}\n\t\t\t  30,83\n\t\t\t  15,65\n\t\t\tZ\n\t\t`,r=80+n,s=`\n\t\t\tm ${15-1.1*n},${r}\n\t\t\tc 35,10 55,15 60,30\n\t\t\tl ${35+1.2*n},${-10-n}\n\t\t\tC 80.47,98.32 50.5,${90+n} 20,${r} Z\n\t\t`,l="\n\t\t\tM 72.45,35.67\n\t\t\tA 10,15 41.8 0 1 55,40.2 10,15 41.8 0 1 57.55,22.3 10,15 41.8 0 1 75,17.8 10,15 41.8 0 1 72.5,35.67\n\t\t\tZ\n\t\t";let c="M 85,-25 25,35 h 10 v 10 h 10 v 10 h 10 v 10 h 10 l -5,10 60,-60 z",d="M 25,35 H 35 L 90,-15 85,-25 Z",h="M 60,75 65,65 H 55 l 55,-55 10,5 z";this.isRoundedTipPen(e)&&(c="M 85,-25 25,35 c 15,0 40,30 35,40 l 60,-60 z",d="m 25,35 c 3.92361,0.384473 7.644275,0.980572 10,3 l 55,-53 -5,-10 z",h="M 60,75 C 61,66 59,65 56,59 l 54,-54 10,10 z");const u=`M 25,35 ${10-n/4},${70-n/2} 20,75 25,85 60,75 70,55 45,25 Z`,f=a.Color4.fromHex("#f4d7d7").mix(o,n/40-.1).toHexString(),g=b(),v=o.toHexString(),y=(0,p.createSvgPaths)({fill:g.patternRef,d:i},{fill:g.patternRef,d:s},{fill:v,d:i},{fill:v,d:s}),w=(0,p.createSvgPaths)({fill:g.patternRef,d:u},{fill:f,stroke:v,d:u}),x=(0,p.createSvgPaths)({fill:"var(--icon-color)",stroke:"var(--icon-color)",d:c},{fill:"rgba(150, 150, 150, 0.3)",d},{fill:"rgba(100, 100, 100, 0.2)",d:h},{fill:g.patternRef,d:l},{fill:v,d:l}),S=document.createElementNS(m,"svg");S.setAttribute("viewBox","0 0 100 100");const T=(0,p.createSvgElement)("g",{children:[y,w,x].flat()}),C=(0,p.createSvgElement)("defs",{children:[g.patternDefElement]});return S.replaceChildren(C,T),S}makeIconFromFactory(e){const t=3*Math.sqrt(e.thickness),o=performance.now(),n={pos:a.Vec2.of(10,10),width:t,color:e.color,time:o-100},i={pos:a.Vec2.of(90,90),width:t,color:e.color,time:o},r=new c.default((()=>{})),s=e.factory(n,r);s.addPoint(i);const d=document.createElementNS(m,"svg");let h;if(d.setAttribute("viewBox","0 0 100 100"),r.updateScreenSize(a.Vec2.of(100,100)),e.color.a<1){const e=b(),t=document.createElementNS(m,"defs");t.appendChild(e.patternDefElement),d.appendChild(t);const o=document.createElementNS(m,"g");d.appendChild(o),h=new class extends l.default{constructor(){super(d,r)}addPathToSVG(){const t=super.addPathToSVG();if(t){const n=t.cloneNode(!0);n.style.zIndex="-1",n.hasAttribute("stroke")?n.setAttribute("stroke",e.patternRef):n.hasAttribute("fill")&&n.setAttribute("fill",e.patternRef),o.appendChild(n)}return t}}}else h=new l.default(d,r);s.preview(h);const u=s.getBBox();return d.setAttribute("viewBox",`${u.x} ${u.y} ${u.w} ${u.h}`),d}makePipetteIcon(e){const t=document.createElementNS(m,"svg"),o=document.createElementNS(m,"g");o.style.rotate="45deg",o.style.transformOrigin="center";const n=document.createElementNS(m,"g");if(n.innerHTML='\n\t\t<path\n\t\t\tstyle="fill: var(--icon-color); stroke-linecap:round; stroke-linejoin:round;"\n\t\t\td="\n\t\t\t\tm 32,12 v 68\n\t\t\t\tc 0,1 0.5,2 1.33,2.5 1.67,1.15 3.67,2.1 5.17,3.2 1.4,1.1 2.3,2.1 2.5,3.1 0.6,2.1 1,4.6 1,6.2 0,3.7 5.45,4.1 6,0.4 l 0.9,-6.8\n\t\t\t\tc 0.3,-0.9 1.1,-1.9 2.6,-2.9 1.5,-1.1 3.4,-2 5.1,-3.2\n\t\t\t\tC 57.5,82 58,81 58,80\n\t\t\t\tV 12 Z m 20,25 v 41.3\n\t\t\t\tc 0,1.7 -2.5,1.6 -4,2.7 -1,0.76 -2.1,1.5 -3,2.6\n\t\t\t\tC 44,82.5 43.02,81.75 42,81 40.51,79.92 38,80 38,78.34\n\t\t\t\tV 51 Z\n\t\t\t"\n\t\t/>\n\t\t<rect\n\t\t\tstyle="fill: var(--icon-color);"\n\t\t\twidth="32"\n\t\t\theight="9"\n\t\t\tx="29"\n\t\t\ty="2"\n\t\t\try="4.5"\n\t\t/>\n\t\t<path\n\t\t\tstyle="fill: var(--icon-color);"\n\t\t\td="m 45,-25 c -5.54,0 -11,4.26 -11,9 V 0 h 22 v -16 c 0,-4.74 -5.46,-9 -11,-9 z"\n\t\t/>\n\t\t',e){const n=b(),i=document.createElementNS(m,"defs");i.appendChild(n.patternDefElement),t.appendChild(i);const r=document.createElementNS(m,"path"),s=document.createElementNS(m,"path"),a="\n\t\t\t\tM 35,36 H 55 V 78.678012 83 L 45,87 35,83 Z\n\t\t\t";s.setAttribute("d",a),r.setAttribute("d",a),s.style.fill=e.toHexString(),r.style.fill=n.patternRef,o.appendChild(r),o.appendChild(s)}return o.appendChild(n),t.appendChild(o),t.setAttribute("viewBox","5 -40 140 140"),t}makeShapeAutocorrectIcon(){return this.makeIconFromPath("\n\t\t\tm 79.129476,33.847107 9.967823,-0.03218 v 55 h -55 l 0.03218,-9.96782\n\t\t\tM 71.1,40.8 a 30,30 0 0 1 -30,30 30,30 0 0 1 -30,-30 30,30 0 0 1 30,-30 30,30 0 0 1 30,30 L 71.1,40.8\n\t\t\tM 34.1,58.8 v -25 h 25 v 0\n\t\t","none","var(--icon-color)","7px")}makeStrokeSmoothingIcon(){return this.makeIconFromPath("\n\t\t\tm 31,83.2 c -50,0 30,-65 -20,-65\n\t\t\tM 75,17.3 40,59.7 38.2,77.6 55.5,72.4 90.5,30 Z\n\t\t","none","var(--icon-color)","7px")}makePressureSensitivityIcon(){const e=document.createElementNS(m,"svg");return e.setAttribute("viewBox","4 -10 100 100"),e.replaceChildren(...(0,p.createSvgPaths)({d:"\n\t\t\t\t\tM 39.7,77.7\n\t\t\t\t\tC 39.7,77.7 3.4,78.1 4.2,60 4.7,45.2 33.2,30.5 40,25 55.9,12.1 7.4,4.8 7.4,4.8\n\t\t\t\t\tc 0,0 40.2,5.5 40.2,15.4\n\t\t\t\t\tC 47.6,29.1 21.2,35.1 23.9,60 25,70 39.7,77.7 39.7,77.7\n\t\t\t\t\tZ",fill:"var(--icon-color)",stroke:"var(--icon-color)","stroke-width":"2px"},{d:"M 86.4,15.6 101.4,28.8 65,70 47.5,74.6 50,56.7Z",fill:"transparent",stroke:"var(--icon-color)","stroke-width":"6px"})),e}makeFormatSelectionIcon(){return this.makeIconFromPath("\n\t\t\tM 5 10\n\t\t\tL 5 20 L 10 20 L 10 15 L 20 15 L 20 40 L 15 40 L 15 45 L 35 45 L 35 40 L 30 40 L 30 15 L 40 15 L 40 20 L 45 20 L 45 15 L 45 10 L 5 10 z\n\t\t\tM 90 10 C 90 10 86.5 13.8 86 14 C 86 14 76.2 24.8 76 25 L 60 25 L 60 65 C 75 70 85 70 90 65 L 90 25 L 80 25 L 76.7 25 L 90 10 z\n\t\t\tM 60 25 L 55 25 L 50 30 L 60 25 z\n\t\t\tM 10 55 L 10 90 L 41 90 L 41 86 L 45 86 L 45 55 L 10 55 z\n\t\t\tM 42 87 L 42 93 L 48 93 L 48 87 L 42 87 z \n\t\t")}makeResizeImageToSelectionIcon(){return this.makeIconFromPath("\n\t\t\tM 75 5 75 10 90 10 90 25 95 25 95 5 75 5 z\n\t\t\tM 15 15 15 30 20 30 20 20 30 20 30 15 15 15 z\n\t\t\tM 84 15 82 17 81 16 81 20 85 20 84 19 86 17 84 15 z\n\t\t\tM 26 24 24 26 26 28 25 29 29 29 29 25 28 26 26 24 z\n\t\t\tM 25 71 26 72 24 74 26 76 28 74 29 75 29 71 25 71 z\n\t\t\tM 15 75 15 85 25 85 25 80 20 80 20 75 15 75 z\n\t\t\tM 90 75 90 90 75 90 75 95 95 95 95 75 90 75 z\n\t\t\tM 81 81 81 85 82 84 84 86 86 84 84 82 85 81 81 81 z\n\t\t")}makeResizeViewportIcon(){return this.makeResizeImageToSelectionIcon()}makeDuplicateSelectionIcon(){return this.makeIconFromPath("\n\t\t\tM 45,10 45,55 90,55 90,10 45,10 z\n\t\t\tM 10,25 10,90 70,90 70,60 40,60 40,25 10,25 z \n\t\t")}makeCopyIcon(){return this.makeIconFromPath("\n\t\t\tM 45,10 45,55 90,55 90,10 45,10 z\n\t\t\tM 10,25 10,90 70,90 70,60 40,60 40,25 10,25 z \n\t\t")}makePasteIcon(){const e=this.makeIconFromPath("\n\t\t\tM 50 0 L 50 5 L 35 5 L 40 24.75 L 20 25 L 20 100 L 85 100 L 100 90 L 100 24 L 75.1 24.3 L 80 5 L 65 5 L 65 0 L 50 0 z\n\t\t\tM 10 15 L 10 115 L 110 115 L 110 15 L 85 15 L 83 20 L 105 20 L 105 110 L 15 110 L 15 20 L 32 20 L 30 15 L 10 15 z\n\t\t\tM 25 35 L 90 35 L 90 40 L 25 40 L 25 35 z\n\t\t\tM 25 45 L 90 45 L 90 50 L 25 50 L 25 45 z\n\t\t\tM 25 55 L 85 55 L 85 60 L 25 60 L 25 55 z\n\t\t\tM 25 65 L 90 65 L 90 70 L 25 70 L 25 65 z \n\t\t");return e.setAttribute("viewBox","0 0 120 120"),e}makeDeleteSelectionIcon(){return r(this,n,"m",i).call(this)}makeCloseIcon(){return r(this,n,"m",i).call(this)}makeSaveIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.innerHTML="\n\t\t\t<style>\n\t\t\t\t.toolbar-save-icon {\n\t\t\t\t\tstroke: var(--icon-color);\n\t\t\t\t\tstroke-width: 6;\n\t\t\t\t\tstroke-linejoin: round;\n\t\t\t\t\tstroke-linecap: round;\n\t\t\t\t\tfill: none;\n\t\t\t\t}\n\t\t\t</style>\n\t\t\t<path\n\t\t\t\td='\n\t\t\t\t\tM 15,55 30,70 85,20\n\t\t\t\t'\n\t\t\t\tclass='toolbar-save-icon'\n\t\t\t/>\n\t\t",e.setAttribute("viewBox","0 0 100 100"),e}makeConfigureDocumentIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.innerHTML="\n\t\t\t<path\n\t\t\t\td='\n\t\t\t\t\tM 5,5 V 95 H 95 V 5 Z m 5,5 H 90 V 90 H 10 Z\n\t\t\t\t\tm 5,10 V 30 H 50 V 25 H 20 v -5 z\n\t\t\t\t\tm 40,0 V 50 H 85 V 20 Z\n\t\t\t\t\tm 2,2 H 83 V 39 L 77,28 70,42 64,35 57,45 Z\n\t\t\t\t\tm 8.5,5 C 64.67,27 64,27.67 64,28.5 64,29.33 64.67,30 65.5,30 66.33,30 67,29.33 67,28.5 67,27.67 66.33,27 65.5,27 Z\n\t\t\t\t\tM 15,40 v 5 h 35 v -5 z\n\t\t\t\t\tm 0,15 v 5 h 70 v -5 z\n\t\t\t\t\tm 0,15 v 5 h 70 v -5 z\n\t\t\t\t'\n\t\t\t\tstyle='fill: var(--icon-color);'\n\t\t\t/>\n\t\t",e.setAttribute("viewBox","0 0 100 100"),e}makeOverflowIcon(){return this.makeIconFromPath("\n\t\t\tM 15 40\n\t\t\tA 12.5 12.5 0 0 0 2.5 52.5\n\t\t\tA 12.5 12.5 0 0 0 15 65\n\t\t\tA 12.5 12.5 0 0 0 27.5 52.5\n\t\t\tA 12.5 12.5 0 0 0 15 40\n\t\t\tz\n\t\n\t\t\tM 50 40\n\t\t\tA 12.5 12.5 0 0 0 37.5 52.5\n\t\t\tA 12.5 12.5 0 0 0 50 65\n\t\t\tA 12.5 12.5 0 0 0 62.5 52.5\n\t\t\tA 12.5 12.5 0 0 0 50 40\n\t\t\tz\n\t\t\t\n\t\t\tM 85 40\n\t\t\tA 12.5 12.5 0 0 0 72.5 52.5\n\t\t\tA 12.5 12.5 0 0 0 85 65\n\t\t\tA 12.5 12.5 0 0 0 97.5 52.5\n\t\t\tA 12.5 12.5 0 0 0 85 40\n\t\t\tz\n\t\t")}makeHelpIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.innerHTML='\n\t\t\t<circle\n\t\t\t\tstyle="stroke-width:1.587; stroke: var(--icon-color);"\n\t\t\t\tfill="none"\n\t\t\t\tcx="13.23"\n\t\t\t\tcy="13.23"\n\t\t\t\tr="11.9"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tstyle="stroke-width: 3; stroke-linecap: butt; stroke: var(--icon-color);"\n\t\t\t\tfill="none"\n\t\t\t\td="M 9.26,6.61 C 18.7,3.25 19.95,10.4 14.3,13.4 c -1.15,0.61 -1.32,1.32 -1.32,2.65 v 2.12"\n\t\t\t/>\n\t\t\t<circle\n\t\t\t\tstyle="fill: var(--icon-color);"\n\t\t\t\tcx="13"\n\t\t\t\tcy="21.32"\n\t\t\t\tr="1.9"\n\t\t\t/>\n\t\t',e.setAttribute("viewBox","0 0 26.46 26.46"),e.setAttribute("width","100"),e.setAttribute("height","100"),e}makeIconFromPath(e,t="var(--icon-color)",o="none",n="0px"){const i=document.createElementNS(m,"svg"),r=document.createElementNS(m,"path");return r.setAttribute("d",e),r.style.fill=t,r.style.stroke=o,r.style.strokeWidth=n,i.appendChild(r),i.setAttribute("viewBox","0 0 100 100"),i}makeCheckerboardPattern(){return b()}isRoundedTipPen(e){return e.factory===d.makeFreehandLineBuilder||e.factory===h.makePolylineBuilder}isPolylinePen(e){return e.factory===h.makePolylineBuilder}licenseInfo(){return null}}},1404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toolbarCSSPrefix=void 0,t.toolbarCSSPrefix="toolbar-"},9582:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeEdgeToolbar=t.makeDropdownToolbar=t.IconProvider=void 0,i(o(6952),t),i(o(117),t);var s=o(6573);Object.defineProperty(t,"IconProvider",{enumerable:!0,get:function(){return r(s).default}});var a=o(7113);Object.defineProperty(t,"makeDropdownToolbar",{enumerable:!0,get:function(){return a.makeDropdownToolbar}});var l=o(2878);Object.defineProperty(t,"makeEdgeToolbar",{enumerable:!0,get:function(){return l.makeEdgeToolbar}})},8992:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultToolbarLocalization=void 0;const n=o(8014);t.defaultToolbarLocalization={...n.defaultToolbarUtilsLocalization,pen:"Pen",eraser:"Eraser",select:"Select",handTool:"Pan",zoom:"Zoom",image:"Image",reformatSelection:"Format selection",inputAltText:"Alt text",decreaseImageSize:"Decrease size",resetImage:"Reset",chooseFile:"Choose file",dragAndDropHereOrBrowse:"Drag and drop here\nor\n{{browse}}",submit:"Submit",addAll:"Add all",cancel:"Cancel",resetView:"Reset view",thicknessLabel:"Thickness",colorLabel:"Color",fontLabel:"Font",textSize:"Size",resizeImageToSelection:"Resize image to selection",deleteSelection:"Delete selection",duplicateSelection:"Duplicate selection",exit:"Exit",save:"Save",undo:"Undo",redo:"Redo",fullStrokeEraser:"Full stroke eraser",selectPenType:"Pen type",selectShape:"Shape",pickColorFromScreen:"Pick color from screen",clickToPickColorAnnouncement:"Click on the screen to pick a color",colorSelectionCanceledAnnouncement:"Color selection canceled",selectionTool__lassoSelect:"Freeform selection",selectionTool__lassoSelect__help:"When enabled, dragging creates a freeform (lasso) selection.",selectionToolKeyboardShortcuts:"Selection tool: Use arrow keys to move selected items, lowercase/uppercase ‘i’ and ‘o’ to resize.",documentProperties:"Page",backgroundColor:"Background color",imageWidthOption:"Width",imageHeightOption:"Height",useGridOption:"Grid",enableAutoresizeOption:"Auto-resize",toggleOverflow:"More",about:"About",inputStabilization:"Stabilization",strokeAutocorrect:"Autocorrect",pressureSensitivity:"Pressure",touchPanning:"Scroll with touch",roundedTipPen:"Round",roundedTipPen2:"Polyline",flatTipPen:"Flat",arrowPen:"Arrow",linePen:"Line",outlinedRectanglePen:"Outlined rectangle",filledRectanglePen:"Filled rectangle",outlinedCirclePen:"Outlined circle",lockRotation:"Lock rotation",paste:"Paste",errorImageHasZeroSize:"Error: Image has zero size",describeTheImage:"Image description",fileInput__loading:"Loading...",fileInput__andNMoreFiles:e=>`(...${e} more)`,penDropdown__baseHelpText:"This tool draws shapes or freehand lines.",penDropdown__colorHelpText:"Changes the pen's color",penDropdown__thicknessHelpText:"Changes the thickness of strokes drawn by the pen.",penDropdown__penTypeHelpText:"Changes the pen style.\n\nEither a “pen” style or “shape” can be chosen. Choosing a “pen” style draws freehand lines. Choosing a “shape” draws shapes.",penDropdown__autocorrectHelpText:"Converts approximate freehand lines and rectangles to perfect ones.\n\nThe pen must be held stationary at the end of a stroke to trigger a correction.",penDropdown__stabilizationHelpText:"Draws smoother strokes.\n\nThis also adds a short delay between the mouse/stylus and the stroke.",penDropdown__pressureSensitivityHelpText:"Changes the thickness of strokes according to how hard you press, when using a compatible device like a stylus.",handDropdown__baseHelpText:"This tool is responsible for scrolling, rotating, and zooming the editor.",handDropdown__zoomInHelpText:"Zooms in.",handDropdown__zoomOutHelpText:"Zooms out.",handDropdown__resetViewHelpText:"Resets the zoom level to 100% and resets scroll.",handDropdown__zoomDisplayHelpText:"Shows the current zoom level. 100% shows the image at its actual size.",handDropdown__touchPanningHelpText:"When enabled, touchscreen gestures move the image rather than select or draw.",handDropdown__lockRotationHelpText:"When enabled, prevents touch gestures from rotating the screen.",eraserDropdown__baseHelpText:"This tool removes strokes, images, and text under the cursor.",eraserDropdown__thicknessHelpText:"Changes the size of the eraser.",eraserDropdown__fullStrokeEraserHelpText:"When in full-stroke mode, entire shapes are erased.\n\nWhen not in full-stroke mode, shapes can be partially erased.",selectionDropdown__baseHelpText:"Selects content and manipulates the selection",selectionDropdown__resizeToHelpText:"Crops the drawing to the size of what's currently selected.\n\nIf auto-resize is enabled, it will be disabled.",selectionDropdown__deleteHelpText:"Erases selected items.",selectionDropdown__duplicateHelpText:"Makes a copy of selected items.",selectionDropdown__changeColorHelpText:"Changes the color of selected items.",pageDropdown__baseHelpText:"Controls the drawing canvas' background color, pattern, and size.",pageDropdown__backgroundColorHelpText:"Changes the background color of the drawing canvas.",pageDropdown__gridCheckboxHelpText:"Enables/disables a background grid pattern.",pageDropdown__autoresizeCheckboxHelpText:"When checked, the page grows to fit the drawing.\n\nWhen unchecked, the page is visible and its size can be set manually.",pageDropdown__aboutButtonHelpText:"Shows version, debug, and other information.",colorPickerPipetteHelpText:"Picks a color from the screen.",colorPickerToggleHelpText:"Opens/closes the color picker.",closeSidebar:e=>`Close sidebar for ${e}`,dropdownShown:e=>`Menu for ${e} shown`,dropdownHidden:e=>`Menu for ${e} hidden`,zoomLevel:e=>`Zoom: ${e}%`,colorChangedAnnouncement:e=>`Color changed to ${e}`,imageSize:(e,t)=>`Image size: ${e} ${t}`,imageLoadError:e=>`Error loading image: ${e}`}},1212:function(e,t,o){"use strict";var n,i=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(3755),a=r(o(4646)),l=o(5786),c=r(o(2281)),d=r(o(7026));n=new WeakMap,t.default=class{constructor(e,t){this.createOverlay=e,this.context=t,n.set(this,[])}showHelpOverlay(){const e=document.createElement("dialog");e.setAttribute("autofocus","true"),e.classList.add("toolbar-help-overlay");const t=()=>{e.classList.add("-hiding"),setTimeout((()=>e.close()),250)};let o=0;const r=()=>{performance.now()-o<100||t()},h=(()=>{const e=l.MutableReactiveValue.fromInitialValue(0),t=document.createElement("div");t.classList.add("navigation-content");const o=((t,o,n,i)=>{const r=document.createElement("div");r.classList.add("help-page-container");const a=document.createElement("div");a.classList.add("label","-space-above"),a.setAttribute("aria-live","polite");let l=0,h=t[0]??null,u=[];r.addEventListener("click",(e=>{e.target===r&&n()}));const p=()=>{if(!h)return s.Rect2.empty;const e=h.targetElements.map((e=>s.Rect2.of(e.getBoundingClientRect())));return s.Rect2.union(...e)},f=()=>{const t=p();for(let o=0;o<u.length;o++)for(const{container:n,bbox:i}of u[o])if(o===l)n.classList.add("-active"),n.classList.remove("-clickable","-background"),n.onclick=()=>{};else{i.containsRect(t)?(n.classList.add("-background"),n.classList.remove("-active","-clickable")):(n.classList.add("-clickable"),n.classList.remove("-active","-background"));const r=o;n.onclick=()=>{var t;t=r,e.set(t)}}},m=()=>{const e=s.Rect2.of(a.getBoundingClientRect()),t=p();if(e.intersects(t)){const o=s.Rect2.of(r.getBoundingClientRect()),n=t.topLeft.y,i=o.bottomLeft.y-t.bottomLeft.y;n>i&&n>e.height/3&&(a.classList.remove("-small-space-above","-large-space-above"),a.classList.add("-large-space-below")),n<i&&i>e.height&&(a.classList.add("-large-space-above"),a.classList.remove("-large-space-below"))}},g=()=>{r.replaceChildren(),a.classList.remove("-large-space-above"),a.classList.add("-small-space-above","-large-space-below"),r.appendChild(a);const e=new s.Rect2(0,0,window.innerWidth,window.innerHeight);u=[];for(let o=0;o<t.length;o++){const n=t[o],a=[];for(const t of n.targetElements){let o=s.Rect2.of(t.getBoundingClientRect());if(!e.intersects(o)){const t=e.bottomLeft.lerp(e.bottomRight,.5),n=o.bottomLeft.lerp(o.bottomRight,.5),i=t.minus(n);o=o.translatedBy(i)}const n=(0,c.default)(t);for(const e of n.querySelectorAll("input"))e.disabled=!0;n.style.margin="0";const l=document.createElement("div");l.classList.add("cloned-element-container"),l.role="group",l.ariaLabel=i.localization.helpControlsAccessibilityLabel,l.style.position="absolute",l.style.left=`${o.topLeft.x}px`,l.style.top=`${o.topLeft.y}px`,l.replaceChildren(n),(0,d.default)(l,{timeout:0}),a.push({container:l,bbox:o}),r.appendChild(l)}u.push(a)}f()},b=()=>{const e=document.createElement("div");e.textContent=h?.helpText??"",e.classList.add("current-item-help");const t=document.createElement("div");t.textContent=i.localization.helpScreenNavigationHelp,t.classList.add("navigation-help"),a.replaceChildren(e,...0===l?[t]:[]),f()};return b(),{addToParent:e=>{g(),e.appendChild(r),m()},refresh:()=>{g(),m()},setPageIndex:e=>{l=e,h=t[e],b()}}})(i(this,n,"f"),0,r,this.context);o.addToParent(t),e.onUpdateAndNow((e=>{e>=i(this,n,"f").length||e<0?(console.warn("Help screen: Navigated to out-of-bounds page",e),t.style.display="none"):(t.style.display="",o.setPageIndex(e))}));const a={content:t,currentPage:e,toNext:()=>{a.hasNext()&&e.set(e.get()+1)},toPrevious:()=>{a.hasPrevious()&&e.set(e.get()-1)},hasNext:()=>e.get()+1<i(this,n,"f").length,hasPrevious:()=>e.get()>0,refreshCurrent:()=>{o.refresh()}};return a})(),u=(e=>{const t=document.createElement("div");t.classList.add("navigation-buttons");const o=document.createElement("button"),n=document.createElement("button");return o.textContent=this.context.localization.next,n.textContent=this.context.localization.previous,o.classList.add("next"),n.classList.add("previous"),e.currentPage.onUpdateAndNow((()=>{t.classList.remove("-has-next","-has-previous"),e.hasNext()?(t.classList.add("-has-next"),o.disabled=!1):(t.classList.remove("-has-next"),o.disabled=!0),e.hasPrevious()?(t.classList.add("-has-previous"),n.disabled=!1):(t.classList.remove("-has-previous"),n.disabled=!0)})),o.onclick=()=>{e.toNext()},n.onclick=()=>{e.toPrevious()},t.replaceChildren(n,o),t})(h);e.replaceChildren((()=>{const e=document.createElement("button");e.classList.add("close-button"),e.appendChild(this.context.icons.makeCloseIcon());const o=this.context.localization.close;return e.setAttribute("aria-label",o),e.setAttribute("title",o),e.onclick=()=>{t()},e})(),u,h.content),this.createOverlay(e),e.showModal();const p=t=>{t>0&&!h.hasPrevious()&&(t=0),t<0&&!h.hasNext()&&(t=0),(t>30||t<-30)&&(t=30*Math.sign(t)),e.style.transform=`translate(${t}px, 0px)`,t>=30?u.classList.add("-highlight-previous"):u.classList.remove("-highlight-previous"),t<=-30?u.classList.add("-highlight-next"):u.classList.remove("-highlight-next")},f=(0,a.default)(e,{draggableChildElements:[h.content],onDrag:(t,o,n)=>{e.classList.add("-dragging"),p(n.x)},onDragEnd:t=>{if(e.classList.remove("-dragging"),p(0),!t.roughlyClick){const e=t.displacement.x;e>30?h.toPrevious():e<-30&&h.toNext(),o=t.endTimestamp}}});let m;window.ResizeObserver&&(m=new ResizeObserver((()=>{h.refreshCurrent()})),m.observe(e));const g=()=>{requestAnimationFrame((()=>h.refreshCurrent()))},b=window.matchMedia?.("(prefers-color-scheme: dark)");b?.addEventListener("change",g);const v=[h.content,u,e];e.onclick=e=>{v.includes(e.target)&&r()},e.onkeyup=e=>{"Escape"===e.code?(t(),e.preventDefault()):"ArrowRight"===e.code?(h.toNext(),e.preventDefault()):"ArrowLeft"===e.code&&(h.toPrevious(),e.preventDefault())},e.addEventListener("close",(()=>{this.context.announceForAccessibility(this.context.localization.helpHidden),b?.removeEventListener("change",g),f.removeListeners(),m?.disconnect(),e.remove()}))}registerTextHelpForElement(e,t){this.registerTextHelpForElements([e],t)}registerTextHelpForElements(e,t){i(this,n,"f").push({targetElements:[...e],helpText:t})}hasHelpText(){return i(this,n,"f").length>0}createToggleButton(){const e=document.createElement("div");e.classList.add("toolbar-help-overlay-button");const t=document.createElement("button");t.classList.add("button");const o=this.context.icons.makeHelpIcon();return o.classList.add("icon"),t.appendChild(o),t.setAttribute("aria-label",this.context.localization.help),t.onclick=()=>{this.showHelpOverlay()},e.appendChild(t),e}}},8014:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultToolbarUtilsLocalization=void 0,t.defaultToolbarUtilsLocalization={help:"Help",helpHidden:"Help hidden",next:"Next",previous:"Previous",close:"Close",helpScreenNavigationHelp:"Click on a control for more information.",helpControlsAccessibilityLabel:"Controls: Activate a control to show help."}},4646:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755);t.default=(e,t)=>{const o=[...t.draggableChildElements,e];let i=0,r=0,s=0,a=0,l=!1,c=null;const d=[],h=(t,o,n)=>{e.addEventListener(t,o,n),d.push((()=>{e.removeEventListener(t,o)}))},u=()=>Math.hypot(i-s,r-a)<5;let p=!1;h("pointerdown",(e=>{!e.defaultPrevented&&(e=>{if(!e)return!1;if(o.includes(e))return!0;const t=["INPUT","SELECT","IMG"];let n=!1,i=e.parentElement;for(;i&&!t.includes(i.tagName);){if(o.includes(i)){n=!0;break}i=i.parentElement}return!t.includes(e.tagName)&&n})(e.target)&&e.isPrimary&&(p=!1,i=e.clientX,r=e.clientY,s=e.clientX,a=e.clientY,c=null,l=!0)}),{passive:!0});const f=o=>{l&&(null!==c&&(e.releasePointerCapture(c),c=null),t.onDragEnd({roughlyClick:u(),endTimestamp:performance.now(),displacement:n.Vec2.of(i-s,r-a)}),l=!1,p=!1)};return h("pointermove",(o=>{if(!o.isPrimary||!l)return;if("mouse"===o.pointerType&&0===o.buttons)return void f();null!==c||u()||(e.setPointerCapture(o.pointerId),c=o.pointerId);const d=o.clientX,h=o.clientY,m=d-i,g=h-r;Math.abs(d-s)<=5&&Math.abs(h-a)<=5&&!p||(t.onDrag(m,g,n.Vec2.of(d-s,h-a)),i=d,r=h,p=!0)})),h("pointerleave",(t=>{null===c&&l&&t.isPrimary&&(e.setPointerCapture(t.pointerId),c=t.pointerId)})),h("pointerup",f),h("pointercancel",f),{removeListeners:()=>{for(const e of d)e()}}}},2517:function(e,t,o){"use strict";var n,i,r=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},s=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(o(1794));class c extends l.default{constructor(e,t,o,s,a,l,c=!1,d=!0){super(e,t,l),this.makeIcon=o,this.title=s,this.clickAction=a,this.mustBeToplevel=c,n.set(this,void 0),i.set(this,void 0),r(this,n,d,"f")}setHelpText(e){r(this,i,e,"f")}getHelpText(){return s(this,i,"f")}shouldAutoDisableInReadOnlyEditor(){return s(this,n,"f")}handleClick(){this.clickAction()}getTitle(){return this.title}createIcon(){return this.makeIcon()}fillDropdown(e){return!1}mustBeInToplevelMenu(){return this.mustBeToplevel}}n=new WeakMap,i=new WeakMap,t.default=c},1736:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(1794)),r=o(1404);class s extends i.default{constructor(e,t,o,n){super(e,o,n),this.targetTool=t,this.targetTool.enabledValue().onUpdateAndNow((e=>{e?(this.setSelected(!0),(()=>{const e=[...document.querySelectorAll("*:focus")];return e.length&&e.some((e=>e.classList.contains(`${r.toolbarCSSPrefix}button`)))})()&&this.focus()):(this.setSelected(!1),this.setDropdownVisible(!1))}))}shouldAutoDisableInReadOnlyEditor(){return!this.targetTool.canReceiveInputInReadOnlyEditor()}handleClick(){this.hasDropdown?this.targetTool.isEnabled()?this.setDropdownVisible(!this.isDropdownVisible()):(this.targetTool.setEnabled(!0),this.activateDropdown()):this.targetTool.setEnabled(!this.targetTool.isEnabled())}onKeyPress(e){return!(!this.isSelected()||"Space"!==e.code||!this.hasDropdown||(this.handleClick(),0))}addTo(e){const t=super.addTo(e);return this.setSelected(this.targetTool.isEnabled()),t}}t.default=s},1794:function(e,t,o){"use strict";var n,i,r,s,a,l,c,d=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},h=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarWidgetTag=void 0;const p=u(o(3914)),f=o(4892),m=o(1404),g=u(o(2076)),b=u(o(7026)),v=u(o(1212)),y=o(5673);var w;!function(e){e.Save="save",e.Exit="exit",e.Undo="undo",e.Redo="redo"}(w||(t.ToolbarWidgetTag=w={}));class x{constructor(e,t,o){n.add(this),this.editor=e,this.id=t,this.dropdown=null,r.set(this,void 0),this.disabled=!1,s.set(this,!1),a.set(this,[]),this.subWidgets={},this.toplevel=!0,l.set(this,null),this.localizationTable=o??e.localization;const i=new g.default((e=>this.editor.announceForAccessibility(e)),this.localizationTable);i.connectToEditorNotifier(e.notifier),this.layoutManager=i,this.icon=null,this.container=document.createElement("div"),this.container.classList.add(`${m.toolbarCSSPrefix}toolContainer`,`${m.toolbarCSSPrefix}toolButtonContainer`,`${m.toolbarCSSPrefix}internalWidgetId--${t.replace(/[^a-zA-Z0-9_]/g,"-")}`),this.dropdownContent=document.createElement("div"),d(this,r,!1,"f"),this.button=document.createElement("div"),this.button.classList.add(`${m.toolbarCSSPrefix}button`),this.label=document.createElement("label"),this.button.setAttribute("role","button"),this.button.tabIndex=0,this.button.oncontextmenu=e=>{e.preventDefault()},(0,b.default)(this.button)}shouldAutoDisableInReadOnlyEditor(){return!0}getId(){return this.id}setTags(e){const t=e=>`toolwidget-tag--${e}`;for(const e of h(this,a,"f"))this.container.classList.remove(t(e));d(this,a,[...e],"f");for(const e of h(this,a,"f"))this.container.classList.add(t(e))}getTags(){return[...h(this,a,"f")]}getUniqueIdIn(e){let t=this.getId(),o=0;for(;t in e&&e[t]!==this;)t=this.getId()+"-"+o.toString(),o++;return t}fillDropdown(e,t){if(0===Object.keys(this.subWidgets).length)return!1;for(const o in this.subWidgets){const n=this.subWidgets[o],i=n.addTo(e);n.setIsToplevel(!1);const r=n.getHelpText();r&&t?.registerTextHelpForElement(i,r)}return!0}getHelpText(){}setupActionBtnClickListener(e){return this.setUpButtonEventListeners(e)}setUpButtonEventListeners(e){const t={Enter:!0," ":!0};e.onkeydown=e=>{let o=!1;if(e.key in t&&(this.disabled||(this.handleClick(),o=!0)),!o){const t=(0,f.keyPressEventFromHTMLEvent)(e);o=this.editor.toolController.dispatchInputEvent(t)}o&&e.preventDefault()},e.onkeyup=e=>{if(e.key in t)return;const o=(0,f.keyUpEventFromHTMLEvent)(e);this.editor.toolController.dispatchInputEvent(o)&&e.preventDefault()},e.onclick=()=>{this.disabled||this.handleClick()},e.ondblclick=e=>{e.preventDefault()}}onKeyPress(e){return!1}get hasDropdown(){return h(this,r,"f")}addSubWidget(e){const t=e.getUniqueIdIn(this.subWidgets);this.subWidgets[t]=e}setLayoutManager(e){e!==this.layoutManager&&(this.layoutManager=e,this.container.parentElement&&this.addTo(this.container.parentElement))}addTo(e){this.icon=null,this.updateIcon(),this.label.innerText=this.getTitle();const t="long-label";this.label.innerText.length>7?this.label.classList.add(t):this.label.classList.remove(t),this.setUpButtonEventListeners(this.button),this.container.replaceChildren(),this.button.replaceChildren(this.icon,this.label),this.container.appendChild(this.button);const o=new v.default((e=>this.editor.createHTMLOverlay(e)),this.editor),i=this.getHelpText();return i&&o.registerTextHelpForElement(this.dropdownContent,[this.getTitle(),i].join("\n\n")),this.dropdownContent.replaceChildren(),d(this,r,this.fillDropdown(this.dropdownContent,o),"f"),h(this,r,"f")&&(this.button.classList.add("has-dropdown"),this.dropdown?.destroy(),this.dropdownIcon=this.createDropdownIcon(),this.button.appendChild(this.dropdownIcon),this.dropdown=this.layoutManager.createToolMenu({target:this.button,getTitle:()=>this.getTitle(),isToplevel:()=>this.toplevel}),this.dropdown.visible.onUpdate((e=>{e?this.container.classList.add("dropdownVisible"):this.container.classList.remove("dropdownVisible"),e||this.focus()})),o.hasHelpText()&&this.dropdown.appendChild(o.createToggleButton()),this.dropdown.appendChild(this.dropdownContent)),this.setDropdownVisible(!1),this.container.parentElement&&this.container.remove(),h(this,n,"m",c).call(this),e.appendChild(this.container),this.container}remove(){this.container.remove(),h(this,l,"f")?.call(this)}focus(){this.button.focus()}addCSSClassToContainer(e){this.container.classList.add(e)}removeCSSClassFromContainer(e){this.container.classList.remove(e)}updateIcon(){let e=this.createIcon();e?this.container.classList.remove("no-icon"):(e=document.createElement("div"),this.container.classList.add("no-icon")),this.icon?.replaceWith(e),this.icon=e,this.icon.classList.add(`${m.toolbarCSSPrefix}icon`)}setDisabled(e){this.disabled=e,d(this,s,!1,"f"),this.disabled?(this.button.classList.add("disabled"),this.button.setAttribute("aria-disabled","true")):(this.button.classList.remove("disabled"),this.button.removeAttribute("aria-disabled"))}setSelected(e){this.isSelected()!==e&&(this.button.setAttribute("role","switch"),e?(this.container.classList.add("selected"),this.button.setAttribute("aria-checked","true")):(this.container.classList.remove("selected"),this.button.setAttribute("aria-checked","false")))}setDropdownVisible(e){e?this.dropdown?.requestShow():this.dropdown?.requestHide()}activateDropdown(){this.dropdown?.onActivated()}mustBeInToplevelMenu(){return!1}canBeInOverflowMenu(){return!this.mustBeInToplevelMenu()}getButtonWidth(){return this.button.clientWidth}isHidden(){return"none"===this.container.style.display}setHidden(e){this.container.style.display=e?"none":""}setIsToplevel(e){this.toplevel=e}isDropdownVisible(){return this.dropdown?.visible?.get()??!1}isSelected(){return this.container.classList.contains("selected")}createDropdownIcon(){const e=this.editor.icons.makeDropdownIcon();return e.classList.add(`${m.toolbarCSSPrefix}showHideDropdownIcon`),e}serializeState(){const e={};for(const t in this.subWidgets)e[t]=this.subWidgets[t].serializeState();return{subwidgetState:e}}deserializeFrom(e){if(e.subwidgetState){(0,y.assertIsObject)(e.subwidgetState);for(const t in e.subwidgetState)if(t in this.subWidgets){const o=e.subwidgetState[t];o&&this.subWidgets[t].deserializeFrom(o)}}}}i=x,r=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,n=new WeakSet,c=function(){h(this,l,"f")?.call(this);const e=this.editor.toolController.getMatchingTools(p.default);let t=null;if(e.length>0&&this.onKeyPress!==i.prototype.onKeyPress){const o=e=>this.onKeyPress(e),n=e[0];n.registerListener(o),t=()=>{n.removeListener(o)}}const o=this.editor.isReadOnlyReactiveValue().onUpdateAndNow((e=>{e&&this.shouldAutoDisableInReadOnlyEditor()&&!this.disabled?(this.setDisabled(!0),d(this,s,!0,"f"),h(this,r,"f")&&this.dropdown?.requestHide()):!e&&h(this,s,"f")&&(d(this,s,!1,"f"),this.setDisabled(!1))}));d(this,l,(()=>{o.remove(),t?.(),d(this,l,null,"f")}),"f")},t.default=x},783:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(o(3538)),c=a(o(1583)),d=s(o(4569)),h=o(2709),u=o(3755),p=o(2572),f=o(1404),m=a(o(117)),g=a(o(1794));class b extends g.default{constructor(e,t){super(e,"document-properties-widget",t),this.updateDropdownContent=()=>{},this.dropdownUpdateQueued=!1,this.container.classList.add("dropdownShowable"),this.editor.notifier.on(p.EditorEventType.UndoRedoStackUpdated,(()=>{this.queueDropdownUpdate()})),this.editor.image.notifier.on(h.EditorImageEventType.ExportViewportChanged,(()=>{this.queueDropdownUpdate()}))}getTitle(){return this.localizationTable.documentProperties}createIcon(){return this.editor.icons.makeConfigureDocumentIcon()}handleClick(){this.setDropdownVisible(!this.isDropdownVisible()),this.queueDropdownUpdate()}queueDropdownUpdate(){this.dropdownUpdateQueued||(requestAnimationFrame((()=>this.updateDropdown())),this.dropdownUpdateQueued=!0)}updateDropdown(){this.dropdownUpdateQueued=!1,this.isDropdownVisible()&&this.updateDropdownContent()}setBackgroundColor(e){this.editor.dispatch(this.editor.setBackgroundColor(e))}getBackgroundColor(){return this.editor.estimateBackgroundColor()}removeBackgroundComponents(){const e=[];for(const t of this.editor.image.getBackgroundComponents())t instanceof d.default&&e.push(t);return new l.default(e)}setBackgroundType(e){const t=this.editor.estimateBackgroundColor(),o=new d.default(e,t),n=this.editor.image.addComponent(o);return(0,c.default)([this.removeBackgroundComponents(),n])}getBackgroundType(){const e=this.editor.image.getBackgroundComponents();for(let t=e.length-1;t>=0;t--){const o=e[t];if(o instanceof d.default)return o.getBackgroundType()}return d.BackgroundType.None}updateImportExportRectSize(e){const t=e=>(void 0!==e&&(!isFinite(e)||e<=0)&&(e=100),e),o=t(e.width),n=t(e.height),i=this.editor.getImportExportRect(),r=new u.Rect2(i.x,i.y,o??i.w,n??i.h);this.editor.dispatch(this.editor.image.setImportExportRect(r)),this.editor.queueRerender()}getHelpText(){return this.localizationTable.pageDropdown__baseHelpText}fillDropdown(e,t){const o=document.createElement("div");o.classList.add(`${f.toolbarCSSPrefix}spacedList`,`${f.toolbarCSSPrefix}nonbutton-controls-main-list`,`${f.toolbarCSSPrefix}document-properties-widget`);const{backgroundColorRow:n,setBgColorInputValue:i,registerWithHelp:r}=(()=>{const e=document.createElement("div"),t=document.createElement("label");t.innerText=this.localizationTable.backgroundColor;const{input:o,container:n,setValue:i,registerWithHelpTextDisplay:r}=(0,m.default)(this.editor,(e=>{e.eq(this.getBackgroundColor())||this.setBackgroundColor(e)}));return o.id=`${f.toolbarCSSPrefix}docPropertiesColorInput-${b.idCounter++}`,t.htmlFor=o.id,e.replaceChildren(t,n),{setBgColorInputValue:i,backgroundColorRow:e,registerWithHelp:t=>{t&&(t?.registerTextHelpForElement(e,this.localizationTable.pageDropdown__backgroundColorHelpText),r(t))}}})(),s=(e,t)=>{const o=document.createElement("div"),n=document.createElement("label"),i=document.createElement("input");return i.id=`${f.toolbarCSSPrefix}docPropertiesCheckbox-${b.idCounter++}`,n.htmlFor=i.id,i.type="checkbox",n.innerText=e,i.oninput=()=>{t(i.checked)},o.replaceChildren(n,i),{container:o,checkbox:i}},{container:a,checkbox:l}=s(this.localizationTable.useGridOption,(e=>{if(this.getBackgroundType()===d.BackgroundType.Grid===e)return;let t=d.BackgroundType.SolidColor;e&&(t=d.BackgroundType.Grid),this.editor.dispatch(this.setBackgroundType(t))})),c=(e,t)=>{const o=document.createElement("div"),n=document.createElement("label"),i=document.createElement("input");return n.innerText=e,i.type="number",i.min="0",i.id=`${f.toolbarCSSPrefix}docPropertiesDimensionRow-${b.idCounter++}`,n.htmlFor=i.id,i.style.flexGrow="2",i.style.width="25px",i.oninput=()=>{t(parseFloat(i.value))},o.classList.add("js-draw-size-input-row"),o.replaceChildren(n,i),{setValue:e=>{if(document.activeElement===i&&i.value.match(/^0*$/)){const t=i.value;i.type="text",i.value=e.toString();const o=Math.max(1,i.value.length-t.length);i.setSelectionRange(0,o),i.type="number"}else i.value=e.toString()},setIsAutomaticSize:e=>{i.disabled=e;const t="size-input-row--automatic-size";e?o.classList.add(t):o.classList.remove(t)},element:o}},h=c(this.localizationTable.imageWidthOption,(e=>{this.updateImportExportRectSize({width:e})})),u=c(this.localizationTable.imageHeightOption,(e=>{this.updateImportExportRectSize({height:e})})),{container:p,checkbox:g}=s(this.localizationTable.enableAutoresizeOption,(e=>{const t=this.editor.image;this.editor.dispatch(t.setAutoresizeEnabled(e))})),v=document.createElement("button");return v.classList.add("about-button"),v.innerText=this.localizationTable.about,v.onclick=()=>{this.editor.showAboutDialog()},r(t),t?.registerTextHelpForElement(a,this.localizationTable.pageDropdown__gridCheckboxHelpText),t?.registerTextHelpForElement(p,this.localizationTable.pageDropdown__autoresizeCheckboxHelpText),t?.registerTextHelpForElement(v,this.localizationTable.pageDropdown__aboutButtonHelpText),this.updateDropdownContent=()=>{i(this.getBackgroundColor());const e=this.editor.image.getAutoresizeEnabled(),t=this.editor.getImportExportRect();h.setValue(t.width),u.setValue(t.height),g.checked=e,h.setIsAutomaticSize(e),u.setIsAutomaticSize(e),l.checked=this.getBackgroundType()===d.BackgroundType.Grid},this.updateDropdownContent(),o.replaceChildren(n,a,h.element,u.element,p,v),e.replaceChildren(o),!0}}b.idCounter=0,t.default=b},61:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(6953),r=o(2572),s=o(1404),a=n(o(1736)),l=n(o(6385));class c extends a.default{constructor(e,t,o){super(e,t,"eraser-tool-widget",o),this.tool=t,this.updateInputs=()=>{},this.editor.notifier.on(r.EditorEventType.ToolUpdated,(e=>{e.kind===r.EditorEventType.ToolUpdated&&e.tool===this.tool&&(this.updateInputs(),this.updateIcon())}))}getHelpText(){return this.localizationTable.eraserDropdown__baseHelpText}getTitle(){return this.localizationTable.eraser}makeIconForType(e){return this.editor.icons.makeEraserIcon(this.tool.getThickness(),e)}createIcon(){return this.makeIconForType(this.tool.getModeValue().get())}makeEraserTypeSelector(e){const t=document.createElement("div"),o=document.createElement("label"),n=document.createElement("input");return n.id=`${s.toolbarCSSPrefix}eraserToolWidget-${c.idCounter++}`,o.htmlFor=n.id,o.innerText=this.localizationTable.fullStrokeEraser,n.type="checkbox",n.oninput=()=>{this.tool.getModeValue().set(n.checked?i.EraserMode.FullStroke:i.EraserMode.PartialStroke)},t.replaceChildren(o,n),e?.registerTextHelpForElement(t,this.localizationTable.eraserDropdown__fullStrokeEraserHelpText),{addTo:e=>{e.appendChild(t)},updateValue:()=>{n.checked=this.tool.getModeValue().get()===i.EraserMode.FullStroke}}}fillDropdown(e,t){const o=document.createElement("div");o.classList.add(`${s.toolbarCSSPrefix}spacedList`,`${s.toolbarCSSPrefix}nonbutton-controls-main-list`);const n=(0,l.default)(this.editor,(e=>{this.tool.setThickness(e)}));n.setBounds(10,55),t?.registerTextHelpForElement(n.container,this.localizationTable.eraserDropdown__thicknessHelpText);const i=this.makeEraserTypeSelector(t);return this.updateInputs=()=>{n.setValue(this.tool.getThickness()),i.updateValue()},this.updateInputs(),o.replaceChildren(n.container),i.addTo(o),e.replaceChildren(o),!0}serializeState(){return{...super.serializeState(),thickness:this.tool.getThickness(),mode:this.tool.getModeValue().get()}}deserializeFrom(e){if(super.deserializeFrom(e),e.thickness){const t=parseFloat(e.thickness);if("number"!=typeof t||!isFinite(t))throw new Error(`Deserializing property ${t} is not a number or is not finite.`);this.tool.setThickness(t)}if(e.mode){const t=e.mode;Object.values(i.EraserMode).includes(t)&&this.tool.getModeValue().set(t)}}}c.idCounter=0,t.default=c},2365:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(2517)),r=o(1794),s=o(9870);class a extends i.default{constructor(e,t,o,n={}){super(e,"exit-button",(()=>n.icon??e.icons.makeCloseIcon()),n.label??t.exit,o),this.setTags([r.ToolbarWidgetTag.Exit])}shouldAutoDisableInReadOnlyEditor(){return!1}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(s.exitKeyboardShortcut,e)?(this.clickAction(),!0):super.onKeyPress(e)}mustBeInToplevelMenu(){return!0}}t.default=a},3268:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(3755),c=s(o(1801)),d=o(2572),h=a(o(4287)),u=o(1404),p=a(o(1736)),f=a(o(1794)),m=a(o(461));class g extends f.default{constructor(e,t,o,n,i,r,s){super(e,`pan-mode-${o}`,s),this.tool=t,this.flag=o,this.makeIcon=n,this.title=i,this.helpText=r,e.notifier.on(d.EditorEventType.ToolUpdated,(e=>{if(e.kind===d.EditorEventType.ToolUpdated&&e.tool===t){const e=!!(t.getMode()&c.PanZoomMode.SinglePointerGestures);this.setSelected(!!(t.getMode()&o)||e),this.setDisabled(e&&o!==c.PanZoomMode.SinglePointerGestures)}})),this.setSelected(!1)}shouldAutoDisableInReadOnlyEditor(){return!1}setModeFlag(e){this.tool.setModeEnabled(this.flag,e)}handleClick(){this.setModeFlag(!this.isSelected())}getTitle(){return this.title}createIcon(){return this.makeIcon()}fillDropdown(e){return!1}getHelpText(){return this.helpText}}class b extends p.default{constructor(e,t,o){const n=e.toolController.getPrimaryTools().includes(t),i=(n?t:b.getPrimaryHandTool(e.toolController))??t;super(e,i,"hand-tool-widget",o),this.overridePanZoomTool=(n?b.getOverrideHandTool(e.toolController):t)??t,this.allowTogglingBaseTool=null!==i,this.allowTogglingBaseTool||this.container.classList.add("dropdownShowable");const r=new g(e,this.overridePanZoomTool,c.PanZoomMode.OneFingerTouchGestures,(()=>this.editor.icons.makeTouchPanningIcon()),o.touchPanning,o.handDropdown__touchPanningHelpText,o),s=new g(e,this.overridePanZoomTool,c.PanZoomMode.RotationLocked,(()=>this.editor.icons.makeRotationLockIcon()),o.lockRotation,o.handDropdown__lockRotationHelpText,o);this.addSubWidget(r),this.addSubWidget(s)}static getPrimaryHandTool(e){return e.getPrimaryTools().filter((e=>e instanceof c.default))[0]}static getOverrideHandTool(e){return e.getMatchingTools(c.default)[0]}shouldAutoDisableInReadOnlyEditor(){return!1}getTitle(){return this.localizationTable.handTool}createIcon(){return this.editor.icons.makeHandToolIcon()}handleClick(){this.allowTogglingBaseTool?super.handleClick():this.setDropdownVisible(!this.isDropdownVisible())}getHelpText(){return this.localizationTable.handDropdown__baseHelpText}fillDropdown(e,t){super.fillDropdown(e,t);const o=document.createElement("div");o.classList.add(`${u.toolbarCSSPrefix}nonbutton-controls-main-list`),(0,m.default)().addTo(o);const n=((e,t,o)=>{const n=document.createElement("div"),i=document.createElement("button"),r=document.createElement("button"),s=document.createElement("button"),a=document.createElement("span");let c;i.innerText="+",r.innerText="-",s.innerText=e.resetView,n.replaceChildren(a,i,r,s),n.classList.add(`${u.toolbarCSSPrefix}zoomLevelEditor`),a.classList.add("zoomDisplay");const p=()=>{let o=100*t.viewport.getScaleFactor();o=o>.1?Math.round(10*o)/10:Math.round(1e3*o)/1e3,o!==c&&(a.textContent=e.zoomLevel(o),c=o)};p(),t.notifier.on(d.EditorEventType.ViewportChanged,(e=>{e.kind===d.EditorEventType.ViewportChanged&&(p(),s.disabled=e.newTransform.eq(l.Mat33.identity))}));const f=e=>{const o=t.viewport.visibleRect.center,n=l.Mat33.scaling2D(e,o);t.dispatch(h.default.transformBy(n),!1)};return i.onclick=()=>{f(5/4)},r.onclick=()=>{f(.8)},s.onclick=()=>{t.dispatch(h.default.transformBy(t.viewport.canvasToScreenTransform.inverse()),!1)},o?.registerTextHelpForElement(i,e.handDropdown__zoomInHelpText),o?.registerTextHelpForElement(r,e.handDropdown__zoomOutHelpText),o?.registerTextHelpForElement(s,e.handDropdown__resetViewHelpText),o?.registerTextHelpForElement(a,e.handDropdown__zoomDisplayHelpText),n})(this.localizationTable,this.editor,t);return o.appendChild(n),e.appendChild(o),!0}setSelected(e){this.allowTogglingBaseTool&&super.setSelected(e)}serializeState(){const e=this.overridePanZoomTool.getMode();return{...super.serializeState(),touchPanning:e&c.PanZoomMode.OneFingerTouchGestures,rotationLocked:e&c.PanZoomMode.RotationLocked}}deserializeFrom(e){void 0!==e.touchPanning&&this.overridePanZoomTool.setModeEnabled(c.PanZoomMode.OneFingerTouchGestures,!!e.touchPanning),void 0!==e.rotationLocked&&this.overridePanZoomTool.setModeEnabled(c.PanZoomMode.RotationLocked,!!e.rotationLocked),super.deserializeFrom(e)}}t.default=b},9740:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageWrapper=void 0;class o{constructor(e,t,o){this.imageBase64Url=e,this.preview=t,this.onUrlUpdate=o,this.originalSrc=e,t.src=e}updateImageData(e){this.preview.src=e,this.imageBase64Url=e,this.onUrlUpdate()}decreaseSize(e=3/4){const t=document.createElement("canvas");t.width=this.preview.naturalWidth*e,t.height=this.preview.naturalHeight*e;const o=t.getContext("2d");o?.drawImage(this.preview,0,0,t.width,t.height);const n=this.originalSrc?.startsWith("data:image/jpeg;")?"image/jpeg":"image/png";this.updateImageData(t.toDataURL(n))}reset(){this.updateImageData(this.originalSrc)}isChanged(){return this.imageBase64Url!==this.originalSrc}isLarge(){return this.getBase64Url().length>125829.12}getBase64Url(){return this.imageBase64Url}getAltText(){return this.altText}setAltText(e){this.altText=e,this.preview.alt=e}static fromSrcAndPreview(e,t,n){return new o(e,t,n)}static fromRenderable(e,t){const n=new Image;n.src=e.base64Url;const i=new o(e.base64Url,n,t),r=e.label??e.image.getAttribute("alt");return r&&i.setAltText(r),{wrapper:i,preview:n}}}t.ImageWrapper=o},4160:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(2192)),r=n(o(3538)),s=n(o(2709)),a=n(o(1583)),l=n(o(8522)),c=o(3755),d=n(o(1794)),h=o(2572),u=o(1404),p=n(o(6284)),f=o(5786),m=n(o(8308)),g=o(9740),b=n(o(6907)),v=n(o(8493));class y extends d.default{constructor(e,t){t??=e.localization,super(e,"insert-image-widget",t),this.container.classList.add("dropdownShowable"),e.notifier.on(h.EditorEventType.SelectionUpdated,(e=>{e.kind===h.EditorEventType.SelectionUpdated&&this.isDropdownVisible()&&this.updateInputs()})),this.images=f.MutableReactiveValue.fromInitialValue([]),this.images.onUpdateAndNow((()=>{this.onImageDataUpdate()}))}getTitle(){return this.localizationTable.image}createIcon(){return this.editor.icons.makeInsertImageIcon()}setDropdownVisible(e){super.setDropdownVisible(e),this.isDropdownVisible()?this.updateInputs():this.selectedFiles?.set([])}handleClick(){this.setDropdownVisible(!this.isDropdownVisible())}fillDropdown(e){const t=document.createElement("div");t.classList.add("insert-image-widget-dropdown-content",`${u.toolbarCSSPrefix}spacedList`,`${u.toolbarCSSPrefix}nonbutton-controls-main-list`);const{container:o,selectedFiles:n}=(0,p.default)(this.localizationTable.chooseFile,this.editor,{accepts:"image/*",allowMultiSelect:!0,customPickerAction:this.editor.getCurrentSettings().image?.showImagePicker}),i=document.createElement("div");this.imagesPreview=(0,b.default)(this.images),this.statusView=document.createElement("div");const r=document.createElement("div");r.classList.add("action-button-row"),this.statusView.classList.add("insert-image-image-status-view"),this.submitButton=document.createElement("button"),this.selectedFiles=n,this.imageAltTextInput=document.createElement("input");const s=document.createElement("label"),a="insert-image-alt-text-input-"+y.nextInputId++;return this.imageAltTextInput.setAttribute("id",a),s.htmlFor=a,s.innerText=this.localizationTable.inputAltText,this.imageAltTextInput.type="text",this.imageAltTextInput.placeholder=this.localizationTable.describeTheImage,this.statusView.setAttribute("aria-live","polite"),this.submitButton.innerText=this.localizationTable.submit,this.imagesPreview.visibleItem.onUpdateAndNow((()=>this.onImageDataUpdate())),this.imageAltTextInput.oninput=()=>{const e=this.imagesPreview.visibleItem.get();e&&(e.setAltText(this.imageAltTextInput.value),this.submitButton.style.display="")},this.selectedFiles.onUpdateAndNow((async e=>{if(0===e.length)return void this.images.set([]);const t=(await Promise.all(e.map((async e=>{let t;try{t=await(0,v.default)(e)}catch(e){console.error("Image load error",e);const t=this.localizationTable.imageLoadError(e);return this.statusView.innerText=t,[]}return t.map((e=>{const{wrapper:t,preview:o}=g.ImageWrapper.fromRenderable(e,(()=>this.onImageDataUpdate()));return{data:t,element:o}}))})))).flat();this.images.set(t)})),i.replaceChildren(s,this.imageAltTextInput),r.replaceChildren(this.submitButton),t.replaceChildren(o,i,this.imagesPreview.container,this.statusView,r),e.replaceChildren(t),!0}onImageDataUpdate(){if(!this.imagesPreview)return;const e=this.imagesPreview.visibleItem.get(),t=e?.getBase64Url();this.imageAltTextInput.value=e?.getAltText()??"",t?(this.submitButton.disabled=!1,this.submitButton.style.display="",this.updateImageSizeDisplay()):(this.submitButton.disabled=!0,this.submitButton.style.display="none",this.statusView.innerText="",this.submitButton.disabled=!0),this.images.get().length<=1?this.submitButton.innerText=this.localizationTable.submit:this.submitButton.innerText=this.localizationTable.addAll}hideDialog(){this.setDropdownVisible(!1)}updateImageSizeDisplay(){const e=this.imagesPreview.visibleItem.get(),t=e?.getBase64Url()??"",{size:o,units:n}=(0,m.default)(t.length),i=document.createElement("span");i.innerText=this.localizationTable.imageSize(Math.round(o),n);const r=document.createElement("button");r.innerText=this.localizationTable.decreaseImageSize,r.onclick=()=>{e?.decreaseSize()};const s=document.createElement("button");s.innerText=this.localizationTable.resetImage,s.onclick=()=>{e?.reset()},this.statusView.replaceChildren(i),e?.isLarge()?this.statusView.appendChild(r):e?.isChanged()?this.statusView.appendChild(s):this.images.get().some((e=>e.data?.isChanged()||e.data?.isLarge()))&&(r.disabled=!0,this.statusView.appendChild(r))}updateInputs(){(()=>{this.selectedFiles?.set([]),this.imageAltTextInput.value="",this.submitButton.disabled=!0,this.statusView.innerText="",this.submitButton.style.display=""})();const e=this.editor.toolController.getMatchingTools(l.default),t=e.map((e=>e.getSelectedObjects())).flat();let o=null;if(1===t.length&&t[0]instanceof i.default){o=t[0];const e=new Image,n=g.ImageWrapper.fromSrcAndPreview(o.getURL(),e,(()=>this.onImageDataUpdate()));n.setAltText(o.getAltText()??""),this.images.set([{data:n,element:e}])}else t.length>0&&e.forEach((e=>e.clearSelection()));this.submitButton.style.display="none",this.submitButton.onclick=async()=>{const t=[];let n=c.Mat33.identity,l=null;for(const{data:e}of this.images.get()){if(!e)continue;const o=new Image;o.src=e.getBase64Url();const r=e.getAltText();let s;r&&o.setAttribute("alt",r);try{s=await i.default.fromImage(o,n)}catch(e){return console.error("Error loading image",e),void(this.statusView.innerText=this.localizationTable.imageLoadError(e))}const a=s.getBBox();if(0===a.area)return void(this.statusView.innerText=this.localizationTable.errorImageHasZeroSize);t.push(s),l??=a,l.union(a);const d=c.Vec2.of(0,a.height);n=n.rightMul(c.Mat33.translation(d))}if(t.length){if(!l)throw new Error("Logic error: Full bounding box must be calculated when components are to be added.");if(this.hideDialog(),o){const n=new r.default([o]),i=o.getTransformation(),d=o.getBBox().width||1,h=l.transformedBoundingBox(i).width||1,u=c.Mat33.scaling2D(d/h),p=[];for(const e of t)p.push(s.default.addComponent(e),e.transformBy(i.rightMul(u)),e.setZIndex(o.getZIndex()));this.editor.dispatch((0,a.default)([...p,n])),e[0]?.setSelection(t)}else await this.editor.addAndCenterComponents(t)}}}}y.nextInputId=0,t.default=y},8493:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(7311)),r=o(3755);t.default=async e=>{const t=[],o=new Image,n=await(0,i.default)(e);return n&&t.push({image:o,base64Url:n,transform:r.Mat33.identity}),t}},2889:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(1794));class r extends i.default{constructor(e,t){super(e,"overflow-widget",t),this.overflowChildren=[],this.container.classList.add("toolbar-overflow-widget"),this.container.classList.add("dropdownShowable"),this.overflowContainer??=document.createElement("div")}shouldAutoDisableInReadOnlyEditor(){return!1}getTitle(){return this.localizationTable.toggleOverflow}createIcon(){return this.editor.icons.makeOverflowIcon()}handleClick(){this.setDropdownVisible(!this.isDropdownVisible())}fillDropdown(e){return this.overflowContainer??=document.createElement("div"),this.overflowContainer.parentElement&&this.overflowContainer.remove(),this.overflowContainer.classList.add("toolbar-overflow-widget-overflow-list"),e.appendChild(this.overflowContainer),!0}clearChildren(){this.overflowContainer.replaceChildren(),this.container.classList.remove("horizontal");const e=this.overflowChildren;return this.overflowChildren=[],e}getChildWidgets(){return[...this.overflowChildren]}hasAsChild(e){for(const t of this.overflowChildren)if(e===t)return!0;return!1}addToOverflow(e){this.overflowChildren.push(e),e.addTo(this.overflowContainer),e.setIsToplevel(!1),this.overflowChildren.length>2&&this.container.classList.add("horizontal")}canBeInOverflowMenu(){return!1}}t.default=r},4122:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(2731),r=o(8195),s=o(1664),a=o(686),l=o(8871),c=o(7912),d=o(2572),h=n(o(117)),u=n(o(1736)),p=o(3755),f=o(9870),m=o(1404),g=n(o(6385)),b=n(o(9917)),v=o(5024);class y extends u.default{constructor(e,t,o){super(e,t,"pen",o),this.tool=t,this.updateInputs=()=>{},this.shapelikeIDs=["pressure-sensitive-pen","freehand-pen"];const n=e.getCurrentSettings().pens?.additionalPenTypes??[],h=e.getCurrentSettings().pens?.filterPenTypes??(()=>!0);this.penTypes=[{name:this.localizationTable.flatTipPen,id:"pressure-sensitive-pen",factory:s.makePressureSensitiveFreehandLineBuilder},{name:this.localizationTable.roundedTipPen,id:"freehand-pen",factory:r.makeFreehandLineBuilder},{name:this.localizationTable.roundedTipPen2,id:"polyline-pen",factory:v.makePolylineBuilder},...n.filter((e=>!e.isShapeBuilder)),{name:this.localizationTable.arrowPen,id:"arrow",isShapeBuilder:!0,factory:i.makeArrowBuilder},{name:this.localizationTable.linePen,id:"line",isShapeBuilder:!0,factory:a.makeLineBuilder},{name:this.localizationTable.filledRectanglePen,id:"filled-rectangle",isShapeBuilder:!0,factory:l.makeFilledRectangleBuilder},{name:this.localizationTable.outlinedRectanglePen,id:"outlined-rectangle",isShapeBuilder:!0,factory:l.makeOutlinedRectangleBuilder},{name:this.localizationTable.outlinedCirclePen,id:"outlined-circle",isShapeBuilder:!0,factory:c.makeOutlinedCircleBuilder},...n.filter((e=>e.isShapeBuilder))].filter(h),this.editor.notifier.on(d.EditorEventType.ToolUpdated,(e=>{if(e.kind!==d.EditorEventType.ToolUpdated)throw new Error("Invalid event type!");e.tool===this.tool&&(this.updateIcon(),this.updateInputs())}))}getTitle(){return this.targetTool.description}getCurrentPenTypeIdx(){const e=this.tool.getStrokeFactory();for(let t=0;t<this.penTypes.length;t++)if(this.penTypes[t].factory===e)return t;return-1}getCurrentPenType(){for(const e of this.penTypes)if(e.factory===this.tool.getStrokeFactory())return e;return null}createIconForRecord(e){const t={...this.tool.getStyleValue().get()};e?.factory&&(t.factory=e.factory);const o=e?.factory;return o&&o!==r.makeFreehandLineBuilder&&o!==s.makePressureSensitiveFreehandLineBuilder&&o!==v.makePolylineBuilder?this.editor.icons.makeIconFromFactory(t):this.editor.icons.makePenIcon(t)}createIcon(){return this.createIconForRecord(this.getCurrentPenType())}createPenTypeSelector(e){const t=this.penTypes.map(((e,t)=>({id:t,makeIcon:()=>this.createIconForRecord(e),title:e.name,isShapeBuilder:e.isShapeBuilder??!1}))),o=t.filter((e=>!e.isShapeBuilder)),n=(0,b.default)(this.localizationTable.selectPenType,this.getCurrentPenTypeIdx(),o),i=t.filter((e=>e.isShapeBuilder)),r=(0,b.default)(this.localizationTable.selectShape,this.getCurrentPenTypeIdx(),i),s=e=>{this.tool.setStrokeFactory(this.penTypes[e].factory)};return n.value.onUpdate(s),r.value.onUpdate(s),e?.registerTextHelpForElements([n.getRootElement(),r.getRootElement()],this.localizationTable.penDropdown__penTypeHelpText),{setValue:e=>{n.value.set(e),r.value.set(e)},updateIcons:()=>{n.updateIcons(),r.updateIcons()},addTo:e=>{o.length&&n.addTo(e),i.length&&r.addTo(e)}}}createStrokeCorrectionOptions(e){const t=document.createElement("div");t.classList.add("action-button-row",`${m.toolbarCSSPrefix}-pen-tool-toggle-buttons`);const o=(o,n)=>{const i=document.createElement("button");i.classList.add(`${m.toolbarCSSPrefix}-toggle-button`);const r=n.cloneNode(!0);r.classList.add("icon");const s=document.createElement("span");s.innerText=o,i.replaceChildren(r,s),i.setAttribute("role","switch"),t.appendChild(i);let a=!1,l=e=>{};const c={setChecked(e){a=e,i.setAttribute("aria-checked",`${a}`),l(a)},setOnInputListener(e){l=e},addHelpText(t){e?.registerTextHelpForElement(i,t)}};return i.onclick=()=>{c.setChecked(!a)},c},n=o(this.localizationTable.inputStabilization,this.editor.icons.makeStrokeSmoothingIcon());n.setOnInputListener((e=>{this.tool.setHasStabilization(e)}));const i=o(this.localizationTable.strokeAutocorrect,this.editor.icons.makeShapeAutocorrectIcon());i.setOnInputListener((e=>{this.tool.setStrokeAutocorrectEnabled(e)}));const r=o(this.localizationTable.pressureSensitivity,this.editor.icons.makePressureSensitivityIcon());return r.setOnInputListener((e=>{this.tool.setPressureSensitivityEnabled(e)})),i.addHelpText(this.localizationTable.penDropdown__autocorrectHelpText),n.addHelpText(this.localizationTable.penDropdown__stabilizationHelpText),r.addHelpText(this.localizationTable.penDropdown__pressureSensitivityHelpText),{update:()=>{n.setChecked(!!this.tool.getInputMapper()),i.setChecked(this.tool.getStrokeAutocorrectionEnabled()),r.setChecked(this.tool.getPressureSensitivityEnabled())},addTo:e=>{e.appendChild(t)}}}getHelpText(){return this.localizationTable.penDropdown__baseHelpText}fillDropdown(e,t){const o=document.createElement("div");o.classList.add(`${m.toolbarCSSPrefix}spacedList`,`${m.toolbarCSSPrefix}nonbutton-controls-main-list`);const{container:n,setValue:i}=(0,g.default)(this.editor,(e=>{this.tool.setThickness(e)})),r=document.createElement("div"),s=document.createElement("label"),a=(0,h.default)(this.editor,(e=>{this.tool.setColor(e)})),{input:l,container:c}=a;l.id=`${m.toolbarCSSPrefix}colorInput${y.idCounter++}`,s.innerText=this.localizationTable.colorLabel,s.setAttribute("for",l.id),r.appendChild(s),r.appendChild(c);const d=this.createStrokeCorrectionOptions(t),u=this.createPenTypeSelector(t);return t?.registerTextHelpForElement(r,this.localizationTable.penDropdown__colorHelpText),t&&a.registerWithHelpTextDisplay(t),t?.registerTextHelpForElement(n,this.localizationTable.penDropdown__thicknessHelpText),this.updateInputs=()=>{a.setValue(this.tool.getColor()),i(this.tool.getThickness()),u.updateIcons(),u.setValue(this.getCurrentPenTypeIdx()),d.update()},this.updateInputs(),o.replaceChildren(r,n),u.addTo(o),e.replaceChildren(o),d.addTo(e),!0}onKeyPress(e){if(!this.isSelected())return!1;for(let t=0;t<f.selectStrokeTypeKeyboardShortcutIds.length;t++){const o=f.selectStrokeTypeKeyboardShortcutIds[t];if(this.editor.shortcuts.matchesShortcut(o,e)){const e=t;if(e<this.penTypes.length)return this.tool.setStrokeFactory(this.penTypes[e].factory),!0}}return!!super.onKeyPress(e)}serializeState(){return{...super.serializeState(),color:this.tool.getColor().toHexString(),thickness:this.tool.getThickness(),strokeFactoryId:this.getCurrentPenType()?.id,inputStabilization:!!this.tool.getInputMapper(),strokeAutocorrect:this.tool.getStrokeAutocorrectionEnabled(),pressureSensitivity:this.tool.getPressureSensitivityEnabled()}}deserializeFrom(e){super.deserializeFrom(e);const t=(t,o)=>{const n=typeof e[t];if(n!==o)throw new Error(`Deserializing property ${t}: Invalid type. Expected ${o}, was ${n}.`)};if(e.color&&(t("color","string"),this.tool.setColor(p.Color4.fromHex(e.color))),e.thickness&&(t("thickness","number"),this.tool.setThickness(e.thickness)),e.strokeFactoryId){t("strokeFactoryId","string");const o=e.strokeFactoryId;for(const e of this.penTypes)if(o===e.id){this.tool.setStrokeFactory(e.factory);break}}void 0!==e.inputStabilization&&this.tool.setHasStabilization(!!e.inputStabilization),void 0!==e.strokeAutocorrect&&this.tool.setStrokeAutocorrectEnabled(!!e.strokeAutocorrect),void 0!==e.pressureSensitivity&&this.tool.setPressureSensitivityEnabled(!!e.pressureSensitivity)}}y.idCounter=0,t.default=y},8632:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(2517)),r=o(1794),s=o(9870);class a extends i.default{constructor(e,t,o,n={}){super(e,"save-button",(()=>n.icon??e.icons.makeSaveIcon()),n.label??t.save,o),this.setTags([r.ToolbarWidgetTag.Save])}shouldAutoDisableInReadOnlyEditor(){return!1}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(s.saveKeyboardShortcut,e)?(this.clickAction(),!0):super.onKeyPress(e)}mustBeInToplevelMenu(){return!0}}t.default=a},4135:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=o(3048),s=n(o(1583)),a=o(8522),l=o(2572),c=n(o(117)),d=n(o(1736)),h=o(9870),u=n(o(461)),p=o(1404),f=n(o(1794)),m=n(o(3168)),g=o(5786);class b extends f.default{constructor(e,t,o){super(e,"selection-mode-toggle",o),this.tool=t,e.notifier.on(l.EditorEventType.ToolUpdated,(e=>{e.kind===l.EditorEventType.ToolUpdated&&e.tool===t&&this.setSelected(t.modeValue.get()===a.SelectionMode.Lasso)})),this.setSelected(!1)}shouldAutoDisableInReadOnlyEditor(){return!1}setModeFlag(e){this.tool.modeValue.set(e?a.SelectionMode.Lasso:a.SelectionMode.Rectangle)}handleClick(){this.setModeFlag(!this.isSelected())}getTitle(){return this.localizationTable.selectionTool__lassoSelect}createIcon(){return this.editor.icons.makeSelectionIcon(a.SelectionMode.Lasso)}fillDropdown(e){return!1}getHelpText(){return this.localizationTable.selectionTool__lassoSelect__help}}class v extends d.default{constructor(e,t,o){super(e,t,"selection-tool-widget",o),this.tool=t,this.updateFormatMenu=()=>{},this.addSubWidget(new b(e,t,this.localizationTable));const n=()=>{const e=this.tool.getSelection();return!!e&&e.getSelectedItemCount()>0};this.hasSelectionValue=g.MutableReactiveValue.fromInitialValue(n()),this.editor.notifier.on(l.EditorEventType.ToolUpdated,(e=>{if(e.kind!==l.EditorEventType.ToolUpdated)throw new Error("Invalid event type!");e.tool===this.tool&&(this.hasSelectionValue.set(n()),this.updateFormatMenu())})),t.modeValue.onUpdate((()=>{this.updateIcon()}))}resizeImageToSelection(){const e=this.tool.getSelection();e&&this.editor.dispatch(this.editor.setImportExportRect(e.region))}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(h.resizeImageToSelectionKeyboardShortcut,e)?(this.resizeImageToSelection(),!0):!!super.onKeyPress(e)}getTitle(){return this.localizationTable.select}createIcon(){return this.editor.icons.makeSelectionIcon(this.tool.modeValue.get())}getHelpText(){return this.localizationTable.selectionDropdown__baseHelpText}createSelectionActions(e){const t=this.editor.icons;return{container:(0,m.default)([{icon:()=>t.makeDeleteSelectionIcon(),label:this.localizationTable.deleteSelection,onCreated:t=>{e?.registerTextHelpForElement(t,this.localizationTable.selectionDropdown__deleteHelpText)},onClick:()=>{const e=this.tool.getSelection();this.editor.dispatch(e.deleteSelectedObjects()),this.tool.clearSelection()},enabled:this.hasSelectionValue},{icon:()=>t.makeDuplicateSelectionIcon(),label:this.localizationTable.duplicateSelection,onCreated:t=>{e?.registerTextHelpForElement(t,this.localizationTable.selectionDropdown__duplicateHelpText)},onClick:async()=>{const e=this.tool.getSelection(),t=await(e?.duplicateSelectedObjects());t&&this.editor.dispatch(t)},enabled:this.hasSelectionValue},{icon:()=>t.makeResizeImageToSelectionIcon(),label:this.localizationTable.resizeImageToSelection,onCreated:t=>{e?.registerTextHelpForElement(t,this.localizationTable.selectionDropdown__resizeToHelpText)},onClick:()=>{this.resizeImageToSelection()},enabled:this.hasSelectionValue}],3).container}}fillDropdown(e,t){super.fillDropdown(e,t);const o=document.createElement("div");o.classList.add(`${p.toolbarCSSPrefix}nonbutton-controls-main-list`),e.appendChild(o),(0,u.default)().addTo(o);const n=this.createSelectionActions(t);o.appendChild(n.container),(0,u.default)(this.localizationTable.reformatSelection).addTo(o);const a=((e,t,o)=>{const n=document.createElement("div");n.classList.add("selection-format-menu",`${p.toolbarCSSPrefix}spacedList`,`${p.toolbarCSSPrefix}indentedList`);const a=document.createElement("div"),l=document.createElement("label"),d=(0,c.default)(e,(o=>{const n=t.getSelection();if(n){const t=[];for(const e of n.getSelectedObjects())(0,r.isRestylableComponent)(e)&&t.push(e.updateStyle({color:o}));const i=(0,s.default)(t);e.dispatch(i)}})),{input:h,container:u}=d;return l.innerText=o.colorLabel,a.replaceChildren(l,u),n.replaceChildren(a),{addTo:e=>{e.appendChild(n)},update:()=>{const e=t.getSelection();if(e&&e.getSelectedItemCount()>0){h.disabled=!1,n.classList.remove("disabled");const t=[];for(const o of e.getSelectedObjects())if((0,r.isRestylableComponent)(o)){const e=o.getStyle().color;e&&t.push(e)}d.setValue(i.Color4.average(t))}else h.disabled=!0,n.classList.add("disabled"),d.setValue(i.Color4.transparent)},registerHelpText:e=>{e.registerTextHelpForElement(a,o.selectionDropdown__changeColorHelpText),d.registerWithHelpTextDisplay(e)}}})(this.editor,this.tool,this.localizationTable);return a.addTo(o),this.updateFormatMenu=()=>a.update(),t&&a.registerHelpText(t),a.update(),!0}serializeState(){return{...super.serializeState(),selectionMode:this.tool.modeValue.get()}}deserializeFrom(e){super.deserializeFrom(e),Object.values(a.SelectionMode).includes(e.selectionMode)&&this.tool.modeValue.set(e.selectionMode)}}t.default=v},9374:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=o(2572),s=o(1404),a=n(o(117)),l=n(o(1736));class c extends l.default{constructor(e,t,o){super(e,t,"text-tool-widget",o),this.tool=t,this.updateDropdownInputs=null,e.notifier.on(r.EditorEventType.ToolUpdated,(e=>{e.kind===r.EditorEventType.ToolUpdated&&e.tool===t&&(this.updateIcon(),this.updateDropdownInputs?.())}))}getTitle(){return this.targetTool.description}createIcon(){const e=this.tool.getTextStyle();return this.editor.icons.makeTextIcon(e)}fillDropdown(e){const t=document.createElement("div");t.classList.add(`${s.toolbarCSSPrefix}spacedList`,`${s.toolbarCSSPrefix}nonbutton-controls-main-list`);const o=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("select"),l=document.createElement("label"),d=document.createElement("input"),h=document.createElement("label"),{input:u,container:p,setValue:f}=(0,a.default)(this.editor,(e=>{this.tool.setColor(e)})),m=document.createElement("label"),g=new Set,b=e=>{const t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t),g.add(e)};d.setAttribute("type","number"),d.min="1",d.max="128",l.innerText=this.localizationTable.fontLabel,m.innerText=this.localizationTable.colorLabel,h.innerText=this.localizationTable.textSize,u.id=`${s.toolbarCSSPrefix}-text-color-input-${c.idCounter++}`,m.setAttribute("for",u.id),d.id=`${s.toolbarCSSPrefix}-text-size-input-${c.idCounter++}`,h.setAttribute("for",d.id);const v=this.editor.getCurrentSettings().text?.fonts??[];for(const e of v)b(e);return r.classList.add("font-selector"),r.id=`${s.toolbarCSSPrefix}-text-font-input-${c.idCounter++}`,l.setAttribute("for",r.id),r.onchange=()=>{this.tool.setFontFamily(r.value)},d.onchange=()=>{const e=parseInt(d.value);!isNaN(e)&&e>0&&this.tool.setFontSize(e)},n.appendChild(m),n.appendChild(p),o.appendChild(l),o.appendChild(r),i.appendChild(h),i.appendChild(d),this.updateDropdownInputs=()=>{const e=this.tool.getTextStyle();f(e.renderingStyle.fill),g.has(e.fontFamily)||b(e.fontFamily),r.value=e.fontFamily,d.value=`${e.size}`},this.updateDropdownInputs(),t.replaceChildren(n,i,o),e.appendChild(t),!0}serializeState(){const e=this.tool.getTextStyle();return{...super.serializeState(),fontFamily:e.fontFamily,textSize:e.size,color:e.renderingStyle.fill.toHexString()}}deserializeFrom(e){e.fontFamily&&"string"==typeof e.fontFamily&&this.tool.setFontFamily(e.fontFamily),e.color&&"string"==typeof e.color&&this.tool.setColor(i.Color4.fromHex(e.color)),e.textSize&&"number"==typeof e.textSize&&this.tool.setFontSize(e.textSize),super.deserializeFrom(e)}}c.idCounter=0,t.default=c},3168:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(7026));t.default=(e,t)=>{const o=document.createElement("div");return o.classList.add("toolbar-button-grid"),o.style.setProperty("--column-count",`${t}`),e.map((e=>{const t=document.createElement("button");t.classList.add("button");const n=e.icon();n.classList.add("icon");const r=document.createElement("label");return r.textContent=e.label,r.classList.add("button-label-text"),t.onclick=e.onClick,e.enabled&&e.enabled.onUpdateAndNow((e=>{t.disabled=!e})),t.replaceChildren(n,r),o.appendChild(t),(0,i.default)(t),e.onCreated?.(t),t})),{container:o}}},117:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeColorInput=void 0;const i=o(3755),r=n(o(776)),s=o(2572);t.makeColorInput=(e,t)=>{const o=document.createElement("span"),n=document.createElement("span"),r=document.createElement("input");r.type="button",r.classList.add("coloris_input"),o.classList.add("color-input-container"),n.classList.add("color-input-wrapper"),n.appendChild(r),o.appendChild(n);const l=a(e,o,(e=>{r.value=e.toHexString(),h();const t=r.parentElement;t&&t.classList.contains("clr-field")&&(t.style.color=r.value)}));let c;const d=()=>{c=i.Color4.fromHex(r.value)},h=()=>{d(),c&&(e.announceForAccessibility(e.localization.colorChangedAnnouncement(c.toHexString())),t(c),e.notifier.dispatch(s.EditorEventType.ColorPickerColorSelected,{kind:s.EditorEventType.ColorPickerColorSelected,color:c}))};r.oninput=d;let u=!1;return r.addEventListener("open",(()=>{u=!0,e.notifier.dispatch(s.EditorEventType.ColorPickerToggled,{kind:s.EditorEventType.ColorPickerToggled,open:!0}),l.cancel(),o.classList.add("picker-open");const t=document.querySelector("#clr-picker #clr-hue-slider");t?.focus()})),r.addEventListener("close",(()=>{u=!1,e.notifier.dispatch(s.EditorEventType.ColorPickerToggled,{kind:s.EditorEventType.ColorPickerToggled,open:!1}),h(),r.focus(),o.classList.remove("picker-open")})),{input:r,container:o,setValue:e=>{"object"==typeof e&&(e=e.toHexString()),r.value=e,r.dispatchEvent(new Event("input",{bubbles:!0}))},closePicker:()=>{u&&h()},registerWithHelpTextDisplay:t=>{t.registerTextHelpForElement(n,e.localization.colorPickerToggleHelpText),l.registerWithHelpTextDisplay(t)}}};const a=(e,t,o)=>{const n=document.createElement("button");n.classList.add("pipetteButton"),n.title=e.localization.pickColorFromScreen,n.setAttribute("alt",n.title);const i=document.createElement("span");i.classList.add("pickColorInstructions"),i.innerText=e.localization.clickToPickColorAnnouncement;const s=t=>{n.replaceChildren(e.icons.makePipetteIcon(t),i)};s();const a=e.toolController.getMatchingTools(r.default)[0],l=()=>{a?.clearColorListener(),s(),n.classList.remove("active")},c=e=>{l(),e&&o(e)},d=e=>{e?s(e):s()};return n.onclick=()=>{if(n.classList.contains("active"))return l(),void e.announceForAccessibility(e.localization.colorSelectionCanceledAnnouncement);a?.setColorListener(d,c),a&&(n.classList.add("active"),e.announceForAccessibility(e.localization.clickToPickColorAnnouncement))},t.appendChild(n),{cancel:()=>{l()},registerWithHelpTextDisplay:t=>{t.registerTextHelpForElement(n,e.localization.colorPickerPipetteHelpText)}}};t.default=t.makeColorInput},6284:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(5786));let r=0;t.default=(e,t,{accepts:o="*",allowMultiSelect:n=!1,customPickerAction:s}={})=>{const a=document.createElement("div"),l=document.createElement("label"),c=document.createElement("input"),d=document.createElement("div");d.classList.add("toolbar--file-input-description");const h=document.createElement("span");a.classList.add("toolbar--file-input-container"),l.appendChild(document.createTextNode(e)),c.accept=o,c.type=s?"button":"file",c.classList.add("file-input"),c.multiple=n;const u="js-draw-file-input-"+r++;c.setAttribute("id",u),l.htmlFor=u;const p=t.icons.makeUploadFileIcon();p.classList.add("icon"),d.replaceChildren(p,h),l.appendChild(d),a.replaceChildren(l,c);const f=i.default.fromInitialValue([]);let m=!1,g=null;const b=()=>{const e=f.get();if(m){if(h.textContent=t.localization.fileInput__loading,g){const e=document.createElement("b");e.textContent=t.localization.cancel,e.classList.add("cancel-button"),h.appendChild(e)}p.style.display="none"}else if(e.length>0){const o=e.map((e=>e.name)),n=5;if(o.length<=n)h.textContent=o.join("\n");else{const e=o.slice(0,n-1);h.textContent=[...e,t.localization.fileInput__andNMoreFiles(o.length-e.length)].join("\n")}p.style.display="none"}else{p.style.display="";const e=t.localization.dragAndDropHereOrBrowse.split(/[{]{2}(.*)[}]{2}/g);h.replaceChildren();for(let t=0;t<e.length;t++)if(t%2==1){const o=document.createElement("b");o.textContent=e[t],h.appendChild(o)}else h.appendChild(document.createTextNode(e[t]))}};if(l.addEventListener("dragover",(e=>{e.preventDefault(),l.classList.add("drag-target")})),l.addEventListener("dragenter",(e=>{e.preventDefault(),l.classList.add("drag-target")})),l.addEventListener("dragleave",(e=>{e.preventDefault();const t=e.relatedTarget;t&&l.contains(t)||l.classList.remove("drag-target")})),l.addEventListener("drop",(e=>{e.preventDefault(),l.classList.remove("drag-target");const t=[];e.dataTransfer&&t.push(...e.dataTransfer.files),f.set(t)})),c.addEventListener("change",(()=>{const e=c.files??[];f.set([...e])})),s){const e=async()=>{if(m)g?.();else{a.classList.add("-loading"),m=!0,b();try{const e=await s({setOnCancelCallback:e=>{if(!m)throw new Error("Task already completed. Can't register cancel handler.");g=()=>{g=null,b(),e()},b()}});e&&f.set(e)}finally{a.classList.remove("-loading"),m=!1,b()}}};c.onclick=e}return f.onUpdate((e=>{0===e.length&&c.files&&c.files.length>0&&(c.value=""),g?.()})),f.onUpdateAndNow(b),{container:a,input:c,selectedFiles:f,addTo:e=>{e.appendChild(a)}}}},9917:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(5786),r=n(o(626)),s=n(o(7026)),a=o(1404);let l=0;t.default=(e,t,o)=>{const n=document.createElement("div");n.classList.add(`${a.toolbarCSSPrefix}grid-selector`);const c=i.MutableReactiveValue.fromInitialValue(t),d=document.createElement("div");d.role="group",d.id=`${a.toolbarCSSPrefix}-grid-select-id-${l++}`,(0,r.default)(d);const h=document.createElement("label");h.textContent=e,h.htmlFor=d.id,n.appendChild(h);let u=`${a.toolbarCSSPrefix}-grid-selector-${l++}`;const p=e=>{const t=document.createElement("div");t.classList.add("choice-button");const o=document.createElement("input");o.type="radio",o.id=`${a.toolbarCSSPrefix}-grid-select-button-${l++}`,(0,s.default)(t);const n=document.createElement("label"),i=()=>{n.setAttribute("title",e.title);const t=document.createElement("span");t.classList.add("button-label-text");const i=e.makeIcon();i.classList.add("icon"),t.innerText=e.title,n.htmlFor=o.id,n.replaceChildren(i,t)};i();const r=()=>{o.name=u};r();const h=()=>{o.checked?t.classList.add("checked"):t.classList.remove("checked")};o.oninput=()=>{o.checked&&c.set(e.id),h()},o.onfocus=()=>{t.querySelector(":focus-visible")&&t.classList.add("focus-visible")},o.onblur=()=>{t.classList.remove("focus-visible")},t.oncontextmenu=e=>{e.preventDefault()},t.replaceChildren(o,n),d.appendChild(t);const p=e=>{o.checked=e,h()};return p(!1),{choiceRecord:e,setChecked:p,updateIcon:()=>{i()},updateButtonRadiogroupName:r}},f=[];for(const e of o)f.push(p(e));n.appendChild(d),c.onUpdateAndNow((e=>{for(let t=0;t<f.length;t++)f[t].setChecked(f[t].choiceRecord.id===e)}));const m={value:c,_radiogroupName:u,linkWith:e=>{m._radiogroupName=e._radiogroupName,u=e._radiogroupName;for(const e of f)e.updateButtonRadiogroupName()},updateIcons:()=>{f.forEach((e=>e.updateIcon()))},getRootElement:()=>n,addTo:e=>{e.appendChild(n)}};return m}},461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e="")=>{const t=document.createElement("div");return t.classList.add("tool-dropdown-separator"),t.innerText=e,{addTo:e=>{e.appendChild(t)}}}},6907:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(626)),r=o(5786);t.default=e=>{const t=document.createElement("div");t.classList.add("toolbar-snapped-scroll-list");const o=document.createElement("div");o.classList.add("scroller");const n=r.MutableReactiveValue.fromInitialValue(0);let s=null;const a=r.ReactiveValue.map(e,(e=>e.map(((e,t)=>{const o=document.createElement("div");return e.element.parentElement&&e.element.remove(),o.appendChild(e.element),o.classList.add("item"),o.setAttribute("data-item-index",`${t}`),{element:o,data:e.data}})))),l=[];a.onUpdateAndNow((e=>{n.set(-1);for(const e of l)s?.unobserve(e.element);o.replaceChildren(),e.length>1?s=new IntersectionObserver((e=>{for(const t of e)if(t.isIntersecting&&t.intersectionRatio>.7){const e=t.target.getAttribute("data-item-index");if(null===e)throw new Error("Could not find attribute data-item-index");const o=Number(e);n.set(o);break}}),{root:o,threshold:.9}):s&&(s.disconnect(),n.set(0),s=null),0===e.length?t.classList.add("-empty"):t.classList.remove("-empty");for(const t of e)o.appendChild(t.element);if(n.set(0),s)for(const t of e)s.observe(t.element)}));const c=r.ReactiveValue.map(n,(t=>{const o=e.get();return 0<=t&&t<o.length?o[t].data:null}));return(0,i.default)(o),t.replaceChildren((()=>{const o=document.createElement("div");o.classList.add("page-markers"),o.setAttribute("tabindex","-1");const i=[];return r.ReactiveValue.union([n,e]).onUpdateAndNow((([e,n])=>{let r,s=!1;for(;n.length<i.length;)i.pop(),s=!0;for(let t=0;t<n.length;t++){let o;if(t>=i.length){o=document.createElement("div");const e=document.createElement("div");e.classList.add("content"),o.replaceChildren(e),i.push(o),s=!0}else o=i[t];o.classList.add("marker"),t===e?(o.classList.add("-active"),r=o):o.classList.remove("-active");const n=t;o.onclick=()=>{a.get()[n]?.element?.scrollIntoView({block:"nearest",behavior:"smooth"})}}s&&o.replaceChildren(...i),r&&o.scrollHeight>t.clientHeight&&r.scrollIntoView({block:"nearest"}),1===i.length?o.classList.add("-one-element"):o.classList.remove("-one-element")})),o})(),o),{container:t,visibleItem:c}}},6385:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755),i=o(1404);let r=0;t.default=(e,t)=>{const o=document.createElement("div"),s=document.createElement("label"),a=document.createElement("input");o.classList.add(`${i.toolbarCSSPrefix}thicknessSliderContainer`),a.id=`${i.toolbarCSSPrefix}thicknessInput${r++}`,s.innerText=e.localization.thicknessLabel,s.setAttribute("for",a.id);const l=e=>Math.log10(e);a.type="range",a.oninput=()=>{t((e=>10**e)(parseFloat(a.value)))},o.appendChild(s),o.appendChild(a);const c=(e,t)=>{const o=(e,t)=>(t?Math.ceil:Math.floor)(100*e)/100,i=o(l(e),!1),r=o(l(t),!0);a.min=`${i}`,a.max=`${r}`,a.step=`${(0,n.toRoundedString)((r-i)/20)}`};return c(2,262),{container:o,addTo:e=>{e.appendChild(o)},setBounds:c,setValue:e=>{a.value=l(e).toString()}}}},9870:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.exitKeyboardShortcut=t.saveKeyboardShortcut=t.selectStrokeTypeKeyboardShortcutIds=t.resizeImageToSelectionKeyboardShortcut=void 0;const i=n(o(2451));t.resizeImageToSelectionKeyboardShortcut="jsdraw.toolbar.SelectionTool.resizeImageToSelection",i.default.registerDefaultKeyboardShortcut(t.resizeImageToSelectionKeyboardShortcut,["ctrlOrMeta+r"],"Resize image to selection"),t.selectStrokeTypeKeyboardShortcutIds=[1,2,3,4,5,6,7,8,9].map((e=>`jsdraw.toolbar.PenTool.select-pen-${e}`));for(let e=0;e<t.selectStrokeTypeKeyboardShortcutIds.length;e++){const o=t.selectStrokeTypeKeyboardShortcutIds[e];i.default.registerDefaultKeyboardShortcut(o,[`CtrlOrMeta+Digit${e+1}`],"Select pen style "+(e+1))}t.saveKeyboardShortcut="jsdraw.toolbar.SaveActionWidget.save",i.default.registerDefaultKeyboardShortcut(t.saveKeyboardShortcut,["ctrlOrMeta+KeyS"],"Save"),t.exitKeyboardShortcut="jsdraw.toolbar.ExitActionWidget.exit",i.default.registerDefaultKeyboardShortcut(t.exitKeyboardShortcut,["Alt+KeyQ"],"Exit")},2076:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(2572),r=n(o(9168)),s=o(1404),a=o(5786);var l;!function(e){e[e.DropdownShown=0]="DropdownShown",e[e.DropdownHidden=1]="DropdownHidden"}(l||(l={}));class c{constructor(e,t,o){this.parent=e,this.notifier=t,this.onDestroy=o,this.dropdownToggleListener=null,this.hideDropdownTimeout=null,this.visible=a.ReactiveValue.fromInitialValue(!1),this.dropdownContainer=document.createElement("div"),this.dropdownContainer.classList.add(`${s.toolbarCSSPrefix}dropdown`),this.dropdownContainer.classList.add("hidden"),e.target.insertAdjacentElement("afterend",this.dropdownContainer),this.dropdownToggleListener=this.notifier.on(l.DropdownShown,(e=>{e.dropdown!==this&&e.fromToplevelDropdown&&this.setVisible(!1)}))}onActivated(){}repositionDropdown(){const e=this.dropdownContainer.getBoundingClientRect(),t=document.scrollingElement?.clientWidth??document.body.clientHeight,o=document.scrollingElement?.clientHeight??document.body.clientHeight;let n,i;e.left>t/2&&(n=`calc(${this.parent.target.clientWidth+"px"} - 100%)`),e.bottom>o&&e.top-e.height>0&&(i=`calc(-${this.parent.target.clientHeight}px - 100%)`),this.dropdownContainer.style.translate=n||i?`${n??"0"} ${i??"0"}`:""}setVisible(e){if(this.visible.get()===e)return;if(this.hideDropdownTimeout&&(clearTimeout(this.hideDropdownTimeout),this.hideDropdownTimeout=null,this.dropdownContainer.classList.remove("hiding"),this.repositionDropdown()),this.visible.set(e),e)this.dropdownContainer.classList.remove("hidden"),this.notifier.dispatch(l.DropdownShown,{dropdown:this,fromToplevelDropdown:this.parent.isToplevel()}),this.repositionDropdown();else{this.notifier.dispatch(l.DropdownHidden,{dropdown:this,fromToplevelDropdown:this.parent.isToplevel()}),this.dropdownContainer.classList.add("hiding");const e=142.5;this.hideDropdownTimeout=setTimeout((()=>{this.dropdownContainer.classList.add("hidden"),this.dropdownContainer.classList.remove("hiding"),this.repositionDropdown()}),e)}const t=`var(--dropdown-${e?"show":"hide"}-animation)`;this.dropdownContainer.style.animation=`150ms ease ${t}`}requestShow(){this.setVisible(!0)}requestHide(){this.setVisible(!1)}appendChild(e){this.dropdownContainer.appendChild(e)}clearChildren(){this.dropdownContainer.replaceChildren()}destroy(){this.setVisible(!1),this.dropdownContainer.remove(),this.dropdownToggleListener?.remove(),this.clearChildren(),this.onDestroy()}}t.default=class{constructor(e,t){this.localization=t,this.dropdowns=new Set,this.listeners=[],this.connectedNotifiers=[],this.notifier=new r.default,this.notifier.on(l.DropdownShown,(({dropdown:t,fromToplevelDropdown:o})=>{t&&(e(this.localization.dropdownShown(t.parent.getTitle())),this.connectedNotifiers.forEach((e=>{e.dispatch(i.EditorEventType.ToolbarDropdownShown,{kind:i.EditorEventType.ToolbarDropdownShown,fromToplevelDropdown:o,layoutManager:this})})))})),this.notifier.on(l.DropdownHidden,(({dropdown:t})=>{t&&e(this.localization.dropdownHidden(t.parent.getTitle()))}))}connectToEditorNotifier(e){this.connectedNotifiers.push(e),this.refreshListeners()}createToolMenu(e){const t=new c(e,this.notifier,(()=>{this.dropdowns.delete(t),this.refreshListeners()}));return this.dropdowns.add(t),this.refreshListeners(),t}refreshListeners(){const e=()=>{this.listeners.forEach((e=>e.remove())),this.listeners=[]};0===this.dropdowns.size?e():this.listeners.length!==this.connectedNotifiers.length&&(e(),this.listeners=this.connectedNotifiers.map((e=>e.on(i.EditorEventType.ToolbarDropdownShown,(e=>{e.kind===i.EditorEventType.ToolbarDropdownShown&&e.layoutManager!==this&&this.notifier.dispatch(l.DropdownShown,{fromToplevelDropdown:e.fromToplevelDropdown})})))))}}},1053:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(5786);t.default=class{constructor(e,t,o,i,r){this.setSidebarContent=e,this.sidebarTitle=t,this.sidebarVisibility=o,this.announceForAccessibility=i,this.localization=r,this.visibleWidgetContent=n.ReactiveValue.fromInitialValue(null)}createToolMenu(e){const t=document.createElement("div");let o=null;const i=n.ReactiveValue.fromCallback((()=>this.visibleWidgetContent.get()===o&&this.sidebarVisibility.get()),[this.visibleWidgetContent,this.sidebarVisibility]);return o={visible:i,requestShow:()=>{this.setSidebarContent(t),this.sidebarTitle.set(e.getTitle()),this.visibleWidgetContent.set(o),this.sidebarVisibility.set(!0),this.announceForAccessibility(this.localization.dropdownShown(e.getTitle()))},onActivated:()=>{},requestHide:()=>{i.get()&&this.sidebarVisibility.set(!1)},appendChild:e=>{t.appendChild(e)},clearChildren:()=>{t.replaceChildren()},destroy:()=>{o?.requestHide(),t.parentElement&&t.remove(),this.visibleWidgetContent.get()===o&&this.visibleWidgetContent.set(null)}},o}}},6952:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentPropertiesWidget=t.InsertImageWidget=t.EraserToolWidget=t.SelectionToolWidget=t.HandToolWidget=t.TextToolWidget=t.PenToolWidget=t.ToolbarWidgetTag=t.BaseWidget=t.BaseToolWidget=t.ActionButtonWidget=void 0;var i=o(2517);Object.defineProperty(t,"ActionButtonWidget",{enumerable:!0,get:function(){return n(i).default}});var r=o(1736);Object.defineProperty(t,"BaseToolWidget",{enumerable:!0,get:function(){return n(r).default}});var s=o(1794);Object.defineProperty(t,"BaseWidget",{enumerable:!0,get:function(){return n(s).default}}),Object.defineProperty(t,"ToolbarWidgetTag",{enumerable:!0,get:function(){return s.ToolbarWidgetTag}});var a=o(4122);Object.defineProperty(t,"PenToolWidget",{enumerable:!0,get:function(){return n(a).default}});var l=o(9374);Object.defineProperty(t,"TextToolWidget",{enumerable:!0,get:function(){return n(l).default}});var c=o(3268);Object.defineProperty(t,"HandToolWidget",{enumerable:!0,get:function(){return n(c).default}});var d=o(4135);Object.defineProperty(t,"SelectionToolWidget",{enumerable:!0,get:function(){return n(d).default}});var h=o(61);Object.defineProperty(t,"EraserToolWidget",{enumerable:!0,get:function(){return n(h).default}});var u=o(4160);Object.defineProperty(t,"InsertImageWidget",{enumerable:!0,get:function(){return n(u).default}});var p=o(783);Object.defineProperty(t,"DocumentPropertiesWidget",{enumerable:!0,get:function(){return n(p).default}})},9482:function(e,t,o){"use strict";var n,i,r,s,a=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},l=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});const c=o(2572),d=o(4892),h=o(5786);n=new WeakMap,i=new WeakMap,r=new WeakMap,s=new WeakMap,t.default=class{constructor(e,t){this.notifier=e,this.description=t,n.set(this,void 0),i.set(this,null),r.set(this,null),s.set(this,null),a(this,n,h.ReactiveValue.fromInitialValue(!0),"f"),l(this,n,"f").onUpdate((e=>{e?(l(this,i,"f")?.notifyEnabled(this),this.notifier.dispatch(c.EditorEventType.ToolEnabled,{kind:c.EditorEventType.ToolEnabled,tool:this})):this.notifier.dispatch(c.EditorEventType.ToolDisabled,{kind:c.EditorEventType.ToolDisabled,tool:this})}))}canReceiveInputInReadOnlyEditor(){return!1}setInputMapper(e){a(this,r,e,"f"),e&&e.setEmitListener((e=>this.dispatchEventToCallback(e)))}getInputMapper(){return l(this,r,"f")}dispatchEventToCallback(e){let t;switch(e.kind){case d.InputEvtType.PointerDownEvt:return this.onPointerDown(e);case d.InputEvtType.PointerMoveEvt:this.onPointerMove(e);break;case d.InputEvtType.PointerUpEvt:return this.onPointerUp(e)??!1;case d.InputEvtType.GestureCancelEvt:this.onGestureCancel(e);break;case d.InputEvtType.WheelEvt:return this.onWheel(e);case d.InputEvtType.KeyPressEvent:return this.onKeyPress(e);case d.InputEvtType.KeyUpEvent:return this.onKeyUp(e);case d.InputEvtType.CopyEvent:return this.onCopy(e);case d.InputEvtType.PasteEvent:return this.onPaste(e);case d.InputEvtType.ContextMenu:return this.onContextMenu(e);default:return t=e,t}return!0}onEvent(e){return l(this,r,"f")?l(this,r,"f").onEvent(e):this.dispatchEventToCallback(e)}onPointerDown(e){return!1}onPointerMove(e){}onPointerUp(e){}onGestureCancel(e){}onWheel(e){return!1}onCopy(e){return!1}onPaste(e){return!1}onKeyPress(e){return!1}onKeyUp(e){return!1}onContextMenu(e){return!1}eventCanBeDeliveredToNonActiveTool(e){return!0}setEnabled(e){l(this,n,"f").set(e)}isEnabled(){return l(this,n,"f").get()}enabledValue(){return l(this,n,"f")}setToolGroup(e){this.isEnabled()&&e.notifyEnabled(this),a(this,i,e,"f")}getToolGroup(){return l(this,i,"f")?l(this,i,"f"):null}onDestroy(){l(this,s,"f")?.remove(),a(this,s,null,"f"),a(this,i,null,"f")}}},6953:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EraserMode=void 0;const i=o(2572),r=n(o(9482)),s=o(3755),a=n(o(3538)),l=o(7372),c=o(2916),d=o(5786),h=n(o(2709)),u=n(o(1583)),p=o(2956);var f;!function(e){e.PartialStroke="partial-stroke",e.FullStroke="full-stroke"}(f||(t.EraserMode=f={}));class m extends r.default{constructor(e,t){super(e.notifier,e.localization.changeTool),this.editor=e,this.eraser=t}onPointerDown(e){if(1===e.allPointers.length&&e.current.device===l.PointerDevice.Eraser){const t=this.editor.toolController.getPrimaryTools().filter((e=>e.isEnabled()));if(t.length?this.previousEnabledTool=t[0]:this.previousEnabledTool=null,this.previousEraserEnabledState=this.eraser.isEnabled(),this.eraser.setEnabled(!0),this.eraser.onPointerDown(e))return!0;this.restoreOriginalTool()}return!1}onPointerMove(e){this.eraser.onPointerMove(e)}restoreOriginalTool(){this.eraser.setEnabled(this.previousEraserEnabledState),this.previousEnabledTool&&this.previousEnabledTool.setEnabled(!0)}onPointerUp(e){this.eraser.onPointerUp(e),this.restoreOriginalTool()}onGestureCancel(e){this.eraser.onGestureCancel(e),this.restoreOriginalTool()}}class g extends r.default{constructor(e,t,o){super(e.notifier,t),this.editor=e,this.lastPoint=null,this.isFirstEraseEvt=!0,this.toAdd=new Set,this.eraseCommands=[],this.addCommands=[],this.thickness=o?.thickness??10,this.thicknessValue=d.ReactiveValue.fromInitialValue(this.thickness),this.thicknessValue.onUpdate((e=>{this.thickness=e,this.editor.notifier.dispatch(i.EditorEventType.ToolUpdated,{kind:i.EditorEventType.ToolUpdated,tool:this})})),this.modeValue=d.ReactiveValue.fromInitialValue(o?.mode??f.FullStroke),this.modeValue.onUpdate((e=>{this.editor.notifier.dispatch(i.EditorEventType.ToolUpdated,{kind:i.EditorEventType.ToolUpdated,tool:this})}))}makeEraserSwitcherTool(){return new m(this.editor,this)}clearPreview(){this.editor.clearWetInk()}getSizeOnCanvas(){return this.thickness/this.editor.viewport.getScaleFactor()}drawPreviewAt(e){this.clearPreview();const t=this.getSizeOnCanvas(),o=this.editor.display.getWetInkRenderer(),n=this.getEraserRect(e),i=this.getEraserRect(this.lastPoint??e),r={fill:s.Color4.transparent,stroke:{width:t/10,color:s.Color4.gray}};o.drawPath((0,p.pathToRenderable)(s.Path.fromConvexHullOf([...n.corners,...i.corners]),r))}getEraserRect(e){const t=this.getSizeOnCanvas(),o=s.Vec2.of(t/2,t/2);return s.Rect2.fromCorners(e.minus(o),e.plus(o))}eraseTo(e){if(!this.isFirstEraseEvt&&0===e.distanceTo(this.lastPoint))return;this.isFirstEraseEvt=!1;const t=this.getEraserRect(e),o=new s.LineSegment2(this.lastPoint,e),n=s.Rect2.union(o.bbox,t),i=this.editor.image.getComponentsIntersecting(n).filter((e=>e.intersects(o)||e.intersectsRect(t))).filter((e=>e.isSelectable()));if(this.modeValue.get()===f.FullStroke){this.toRemove.push(...i);const e=i.map((e=>new a.default([e])));e.forEach((e=>e.apply(this.editor))),this.eraseCommands.push(...e)}else{const o=[],n=[];for(const r of i){if(o.push(r),!r.withRegionErased)continue;if(t.grownBy(t.maxDimension/3).containsRect(r.getExactBBox()))continue;const i=s.Path.fromConvexHullOf([...t.corners,...this.getEraserRect(this.lastPoint??e).corners].map((e=>this.editor.viewport.roundPoint(e))));n.push(...r.withRegionErased(i,this.editor.viewport))}const r=new a.default(o),l=n.map((e=>h.default.addComponent(e)));r.apply(this.editor),l.forEach((e=>e.apply(this.editor)));const c=[];for(const e of o)this.toAdd.has(e)?this.toAdd.delete(e):c.push(e);this.toRemove.push(...c);for(const e of n)this.toAdd.add(e);this.eraseCommands.push(new a.default(c)),this.addCommands.push(...l)}this.drawPreviewAt(e),this.lastPoint=e}onPointerDown(e){return(1===e.allPointers.length||e.current.device===l.PointerDevice.Eraser)&&(this.lastPoint=e.current.canvasPos,this.toRemove=[],this.toAdd.clear(),this.isFirstEraseEvt=!0,this.drawPreviewAt(e.current.canvasPos),!0)}onPointerMove(e){const t=e.current.canvasPos;this.eraseTo(t)}onPointerUp(e){this.eraseTo(e.current.canvasPos);const t=[];if(this.addCommands.length>0){this.addCommands.forEach((e=>e.unapply(this.editor)));for(const e of this.toAdd)this.toRemove.includes(e)&&(this.toAdd.delete(e),this.toRemove=this.toRemove.filter((t=>t!==e)));for(const e of this.toRemove)this.toAdd.has(e)&&(this.toAdd.delete(e),this.toRemove=this.toRemove.filter((t=>t!==e)));t.push(...[...this.toAdd].map((e=>h.default.addComponent(e)))),this.addCommands=[]}if(this.eraseCommands.length>0){this.eraseCommands.forEach((e=>e.unapply(this.editor))),this.eraseCommands=[];const e=new a.default(this.toRemove);t.push(e)}1===t.length?this.editor.dispatch(t[0]):this.editor.dispatch((0,u.default)(t)),this.clearPreview()}onGestureCancel(e){this.addCommands.forEach((e=>e.unapply(this.editor))),this.eraseCommands.forEach((e=>e.unapply(this.editor))),this.eraseCommands=[],this.addCommands=[],this.clearPreview()}onKeyPress(e){const t=this.editor.shortcuts;let o;return t.matchesShortcut(c.decreaseSizeKeyboardShortcutId,e)?o=2*this.getThickness()/3:t.matchesShortcut(c.increaseSizeKeyboardShortcutId,e)&&(o=3*this.getThickness()/2),void 0!==o&&(o=Math.min(Math.max(1,o),200),this.setThickness(o),!0)}getThickness(){return this.thickness}setThickness(e){this.thicknessValue.set(e)}getThicknessValue(){return this.thicknessValue}getModeValue(){return this.modeValue}}t.default=g},1196:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(3332)),r=n(o(2192)),s=n(o(9482)),a=o(2916),l="find-tool";class c extends s.default{constructor(e){super(e.notifier,e.localization.findLabel),this.editor=e,this.currentMatchIdx=0,this.overlay=document.createElement("div"),this.fillOverlay(),e.createHTMLOverlay(this.overlay),this.overlay.style.display="none",this.overlay.classList.add(`${l}-overlay`)}canReceiveInputInReadOnlyEditor(){return!0}getMatches(e){const t=e.toLocaleLowerCase();return this.editor.image.getAllComponents().filter((o=>{let n="";if(o instanceof i.default)n=o.getText();else{if(!(o instanceof r.default))return!1;n=o.getAltText()??""}const s=-1!==n.toLocaleLowerCase().indexOf(t),a=-1!==n.indexOf(e);return s||a})).map((e=>e.getBBox()))}focusCurrentMatch(){const e=this.getMatches(this.searchInput.value);let t=this.currentMatchIdx%e.length;if(t<0&&(t=e.length+t),t<e.length){const o=!1;this.editor.dispatch(this.editor.viewport.zoomTo(e[t],!0,!0),o),this.editor.announceForAccessibility(this.editor.localization.focusedFoundText(t+1,e.length))}}toNextMatch(){this.currentMatchIdx++,this.focusCurrentMatch()}toPrevMatch(){this.currentMatchIdx--,this.focusCurrentMatch()}fillOverlay(){const e=document.createElement("label");this.searchInput=document.createElement("input");const t=document.createElement("button"),o=document.createElement("button");this.searchInput.setAttribute("id",`${l}-searchInput-${Math.random()}`),e.htmlFor=this.searchInput.getAttribute("id"),e.innerText=this.editor.localization.findLabel,t.innerText=this.editor.localization.toNextMatch,o.innerText=this.editor.localization.closeDialog,this.searchInput.onkeydown=e=>{"Enter"===e.key?e.shiftKey?this.toPrevMatch():this.toNextMatch():"Escape"===e.key?this.setVisible(!1):this.editor.shortcuts.matchesShortcut(a.toggleFindVisibleShortcutId,e)&&(e.preventDefault(),this.toggleVisible())},t.onclick=()=>{this.toNextMatch()},o.onclick=()=>{this.setVisible(!1)},this.overlay.replaceChildren(e,this.searchInput,t,o)}isVisible(){return"none"!==this.overlay.style.display}setVisible(e){e!==this.isVisible()&&(this.overlay.style.display=e?"block":"none",e?(this.searchInput.focus(),this.editor.announceForAccessibility(this.editor.localization.findDialogShown)):(this.editor.focus(),this.editor.announceForAccessibility(this.editor.localization.findDialogHidden)))}toggleVisible(){this.setVisible(!this.isVisible())}onKeyPress(e){return!!this.editor.shortcuts.matchesShortcut(a.toggleFindVisibleShortcutId,e)&&(this.toggleVisible(),!0)}setEnabled(e){super.setEnabled(e),this.isEnabled()&&this.setVisible(!1)}}t.default=c},7214:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(4892),c=a(o(8453)),d=s(o(6761)),h=o(7372);class u extends c.default{constructor(){super(),this.canShowContextMenu=!1,this.stationaryDetector=null,this.clickTolerance=12}canMakeLongPressMenuEvent(e){const t=[h.PointerDevice.Touch];return 1===e.allPointers.length&&t.includes(e.current.device)}onEvent(e){const t=()=>!!(0,l.isPointerEvt)(e)&&(!(!this.canShowContextMenu||!this.emit({kind:l.InputEvtType.ContextMenu,screenPos:e.current.screenPos,canvasPos:e.current.canvasPos}))&&(this.emit({kind:l.InputEvtType.GestureCancelEvt}),!0));if(e.kind===l.InputEvtType.PointerDownEvt)1===e.allPointers.length?(this.canShowContextMenu=!0,this.contextMenuTriggerPointer=e.current,this.contextMenuStartPoint=e.current.screenPos,this.canMakeLongPressMenuEvent(e)&&(this.stationaryDetector=new d.default(e.current,d.defaultStationaryDetectionConfig,t))):this.canShowContextMenu=!1;else if(e.kind===l.InputEvtType.PointerMoveEvt){if(this.canShowContextMenu){this.stationaryDetector?.onPointerMove(e.current);const t=e.current.screenPos.minus(this.contextMenuStartPoint),o=this.clickTolerance;t.length()>o&&(this.canShowContextMenu=!1)}}else if(e.kind===l.InputEvtType.PointerUpEvt&&(this.stationaryDetector?.destroy(),this.contextMenuTriggerPointer?.id===e.current.id&&this.contextMenuTriggerPointer.device===h.PointerDevice.RightButtonMouse&&t()))return!0;return this.emit(e)}}t.default=u},8453:function(e,t){"use strict";var o,n=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},i=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),o=new WeakMap,t.default=class{constructor(){o.set(this,null)}setEmitListener(e){n(this,o,e&&"object"==typeof e?t=>e.onEvent(t)??!1:e,"f")}emit(e){return i(this,o,"f")?.call(this,e)??!1}}},7966:function(e,t,o){"use strict";var n,i,r=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},s=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(o(8453));class c extends l.default{constructor(){super(...arguments),n.set(this,null),i.set(this,null)}onEvent(e){return null===r(this,n,"f")?this.emit(e):r(this,n,"f").onEvent(e)}addToTail(e){r(this,i,"f")?(r(this,i,"f").setEmitListener(e),s(this,i,e,"f")):(s(this,n,e,"f"),s(this,i,r(this,n,"f"),"f")),r(this,i,"f").setEmitListener((e=>this.emit(e)))}}n=new WeakMap,i=new WeakMap,t.default=c},5117:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(4892),r=n(o(8453)),s=o(3755),a=n(o(2560));var l;!function(e){e[e.IntertialStabilizer=0]="IntertialStabilizer"}(l||(l={}));const c={kind:l.IntertialStabilizer,mass:.4,springConstant:100,frictionCoefficient:.28,maxPointDist:10,inertiaFraction:.75,minSimilarityToFinalize:0,velocityDecayFactor:.1};class d{constructor(e,t,o){this.updatePointer=t,this.options=o,this.runLoop=!0,this.lastUpdateTime=0,this.velocity=s.Vec2.zero,this.strokePoint=e,this.targetPoint=e,this.targetInterval=10,this.loop()}async loop(){for(this.lastUpdateTime=performance.now();this.runLoop;)this.update(!1),await(0,a.default)()}setTarget(e){this.targetPoint=e}getNextVelocity(e){const t=this.targetPoint.minus(this.strokePoint),o=t.times(this.options.springConstant),n=10*this.options.mass,i=this.velocity.normalizedOrZero().times(-this.options.frictionCoefficient*n),r=o.plus(i).times(1/this.options.mass),s=this.options.velocityDecayFactor,a=this.velocity.times(1-s).plus(r.times(e/1e3));return t.normalizedOrZero().times(a.length()).lerp(a,this.options.inertiaFraction)}update(e){const t=performance.now(),o=t-this.lastUpdateTime,n=this.strokePoint.eq(this.targetPoint);if(o>this.targetInterval||e){if(!n){let e,n,i=1;do{e=this.getNextVelocity(o/i),n=e.times(o/1e3),i++}while(n.magnitude()>this.options.maxPointDist&&i<10);for(let e=0;e<i;e++)this.velocity=this.getNextVelocity(o/i),n=this.velocity.times(o/1e3),this.strokePoint=this.strokePoint.plus(n),e<i-1&&this.updatePointer(this.strokePoint,t)}if(this.lastUpdateTime=t,e||!n)return this.updatePointer(this.strokePoint,t)}return!1}finish(){this.runLoop=!1;const e=this.targetPoint.minus(this.strokePoint);this.velocity.dot(e)>this.options.minSimilarityToFinalize&&this.updatePointer(this.targetPoint,performance.now())}cancel(){this.runLoop=!1}}class h extends r.default{constructor(e,t=c){super(),this.viewport=e,this.options=t,this.stabilizer=null,this.lastPointerEvent=null}mapPointerEvent(e){return(0,i.isPointerEvt)(e)&&e.kind!==i.InputEvtType.PointerUpEvt&&(this.lastPointerEvent=e),e.kind===i.InputEvtType.GestureCancelEvt||e.allPointers.length>1||null===this.stabilizer?this.emit(e):(this.stabilizer.setTarget(e.current.screenPos),e.kind===i.InputEvtType.PointerMoveEvt?this.stabilizer.update(!0):e.kind===i.InputEvtType.PointerUpEvt?(this.stabilizer.finish(),this.emit(e)):this.emit(e))}emitPointerMove(e,t){if(!this.lastPointerEvent)return!1;const o=this.lastPointerEvent.current.withScreenPosition(e,this.viewport).withTimestamp(t),n={kind:i.InputEvtType.PointerMoveEvt,current:o,allPointers:[o]};return this.emit(n)}onEvent(e){if((0,i.isPointerEvt)(e)||e.kind===i.InputEvtType.GestureCancelEvt){e.kind===i.InputEvtType.PointerDownEvt&&(e.allPointers.length>1?(this.stabilizer?.cancel(),this.stabilizer=null):(this.stabilizer?.cancel(),this.stabilizer=new d(e.current.screenPos,((e,t)=>this.emitPointerMove(e,t)),this.options)));const t=this.mapPointerEvent(e);return e.kind!==i.InputEvtType.PointerUpEvt&&e.kind!==i.InputEvtType.GestureCancelEvt||(this.stabilizer?.cancel(),this.stabilizer=null),t}return this.emit(e)}static fromEditor(e){return new h(e.viewport)}}t.default=h},8058:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(4892),r=n(o(8453)),s=o(2916);class a extends r.default{constructor(e,t){super(),this.shortcuts=e,this.viewport=t,this.snapToGridEnabled=!1,this.angleLockEnabled=!1,this.startPointCanvas=null}xyAxesSnap(e){if(!this.startPointCanvas)return e;const t=this.viewport.canvasToScreen(this.startPointCanvas);return e.lockedToXYAxesScreen(t,this.viewport)}mapPointerEvent(e){const t=t=>e.allPointers.length>1?t:this.snapToGridEnabled?t.snappedToGrid(this.viewport):this.angleLockEnabled&&this.startPointCanvas?this.xyAxesSnap(t):t;return{kind:e.kind,current:t(e.current),allPointers:e.allPointers.map(t)}}onEvent(e){const t=this.shortcuts;e.kind!==i.InputEvtType.PointerDownEvt&&e.kind!==i.InputEvtType.PointerMoveEvt&&e.kind!==i.InputEvtType.PointerUpEvt||(e.kind===i.InputEvtType.PointerDownEvt&&(this.startPointCanvas=e.current.canvasPos),e=this.mapPointerEvent(e));let o=this.emit(e);if(e.kind===i.InputEvtType.KeyUpEvent||!o&&e.kind===i.InputEvtType.KeyPressEvent){const n=e.kind===i.InputEvtType.KeyPressEvent;t.matchesShortcut(s.snapToGridKeyboardShortcutId,e)&&(this.snapToGridEnabled=n,o=!0),t.matchesShortcut(s.lineLockKeyboardShortcutId,e)&&(this.angleLockEnabled=n,o=!0)}return o}static fromEditor(e){return new a(e.shortcuts,e.viewport)}}t.default=a},1801:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PanZoomMode=void 0;const i=o(3755),r=o(7372),s=o(2572),a=n(o(2560)),l=o(4287),c=n(o(9482)),d=o(2916);var h;!function(e){e[e.OneFingerTouchGestures=1]="OneFingerTouchGestures",e[e.TwoFingerTouchGestures=2]="TwoFingerTouchGestures",e[e.RightClickDrags=4]="RightClickDrags",e[e.SinglePointerGestures=8]="SinglePointerGestures",e[e.Keyboard=16]="Keyboard",e[e.RotationLocked=32]="RotationLocked"}(h||(t.PanZoomMode=h={}));class u{constructor(e,t,o){this.initialVelocity=e,this.scrollBy=t,this.onComplete=o,this.running=!1,this.start()}async start(){if(this.running)return;this.currentVelocity=this.initialVelocity;let e=performance.now();for(this.running=!0,this.currentVelocity.magnitude()>5e3&&(this.currentVelocity=this.currentVelocity.normalized().times(5e3));this.running&&this.currentVelocity.magnitude()>200;){const t=performance.now(),o=(t-e)/1e3;this.currentVelocity=this.currentVelocity.times(Math.pow(1/8,o)),this.scrollBy(this.currentVelocity.times(o)),await(0,a.default)(),e=t}this.running&&this.stop()}getCurrentVelocity(){return this.running?this.currentVelocity:null}stop(){this.running&&(this.running=!1,this.onComplete())}}class p extends c.default{constructor(e,t,o){super(e.notifier,o),this.editor=e,this.mode=t,this.transform=null,this.initialRotationSnapAngle=.22,this.afterRotationStartSnapAngle=.07,this.pinchZoomStartThreshold=1.08,this.lastPointerDownTimestamp=0,this.initialTouchAngle=0,this.initialViewportRotation=0,this.initialViewportScale=0,this.isScaling=!1,this.isRotating=!1,this.inertialScroller=null,this.velocity=null}canReceiveInputInReadOnlyEditor(){return!0}computePinchData(e,t){if(e.id<t.id){const o=e;e=t,t=o}const o=t.screenPos.minus(e.screenPos),n=o.angle(),i=o.magnitude();return{canvasCenter:t.canvasPos.plus(e.canvasPos).times(.5),screenCenter:t.screenPos.plus(e.screenPos).times(.5),angle:n,dist:i}}allPointersAreOfType(e,t){return e.every((e=>e.device===t))}onPointerDown({allPointers:e,current:t}){let o=!1;const n=this.inertialScroller?.getCurrentVelocity()??i.Vec2.zero;this.inertialScroller?.stop(),this.velocity=n,this.lastPointerDownTimestamp=t.timeStamp;const s=this.allPointersAreOfType(e,r.PointerDevice.Touch),a=this.allPointersAreOfType(e,r.PointerDevice.RightButtonMouse);if(s&&2===e.length&&this.mode&h.TwoFingerTouchGestures){const{screenCenter:t,angle:n,dist:i}=this.computePinchData(e[0],e[1]);this.lastTouchDist=i,this.startTouchDist=i,this.lastScreenCenter=t,this.initialTouchAngle=n,this.initialViewportRotation=this.editor.viewport.getRotationAngle(),this.initialViewportScale=this.editor.viewport.getScaleFactor(),this.isScaling=!1,this.isRotating=Math.abs(Math.sin(2*this.initialViewportRotation))>.001,o=!0}else 1===e.length&&(this.mode&h.OneFingerTouchGestures&&s||a&&this.mode&h.RightClickDrags||this.mode&h.SinglePointerGestures)&&(this.lastScreenCenter=e[0].screenPos,this.isScaling=!1,o=!0);return o&&(this.lastTimestamp=performance.now(),this.transform??=l.Viewport.transformBy(i.Mat33.identity),this.editor.display.setDraftMode(!0)),o}updateVelocity(e){const t=e.minus(this.lastScreenCenter);let o=(performance.now()-this.lastTimestamp)/1e3;if(0===t.magnitude()&&o<.1)return;if(0===o)return;o=Math.max(o,.01);const n=t.times(1/o);let i=n;this.velocity&&(i=this.velocity.lerp(n,.5)),this.velocity=i}getCenterDelta(e){return this.editor.viewport.screenToCanvasTransform.transformVec3(e.minus(this.lastScreenCenter))}toSnappedRotationDelta(e){let t=e-this.initialTouchAngle+this.initialViewportRotation;const o=Math.PI/2,n=Math.round(t/o)*o,i=this.isRotating?this.afterRotationStartSnapAngle:this.initialRotationSnapAngle;return Math.abs(t-n)<i&&(t=n,0!==t&&(t+=1e-4)),t-this.editor.viewport.getRotationAngle()}toSnappedScaleFactor(e){const t=this.initialViewportScale*e/this.startTouchDist,o=this.editor.viewport.getScaleFactor(),n=Math.log(t)/Math.log(10),i=Math.round(n);return Math.abs(i-n)<.04?Math.pow(10,i)/o:e/this.lastTouchDist}handleTwoFingerMove(e){const{screenCenter:t,canvasCenter:o,angle:n,dist:r}=this.computePinchData(e[0],e[1]),s=this.getCenterDelta(t);let a;if(a=this.isRotationLocked()?0:this.toSnappedRotationDelta(n),Math.abs(a)>1e-8&&(this.isRotating=!0),this.updateVelocity(t),!this.isScaling){const e=r/this.startTouchDist,t=this.pinchZoomStartThreshold,o=1/this.pinchZoomStartThreshold;(e>t||e<o)&&(this.isScaling=!0)}let c=1;this.isScaling&&(c=this.toSnappedScaleFactor(r),this.lastTouchDist=r);const d=i.Mat33.translation(s).rightMul(i.Mat33.scaling2D(c,o)).rightMul(i.Mat33.zRotation(a,o));return this.lastScreenCenter=t,this.transform=l.Viewport.transformBy(this.transform.transform.rightMul(d)),d}handleOneFingerMove(e){const t=this.getCenterDelta(e.screenPos),o=i.Mat33.translation(t);return this.transform=l.Viewport.transformBy(this.transform.transform.rightMul(o)),this.updateVelocity(e.screenPos),this.lastScreenCenter=e.screenPos,o}onPointerMove({allPointers:e}){this.transform??=l.Viewport.transformBy(i.Mat33.identity);let t=i.Mat33.identity;2===e.length?t=this.handleTwoFingerMove(e):1===e.length&&(t=this.handleOneFingerMove(e[0])),l.Viewport.transformBy(t).apply(this.editor),this.lastTimestamp=performance.now()}onPointerUp(e){const t=()=>{this.transform&&(this.transform.unapply(this.editor),this.editor.dispatch(this.transform,!1)),this.editor.display.setDraftMode(!1),this.transform=null,this.velocity=i.Vec2.zero};if(e.current.device===r.PointerDevice.Touch&&1===e.allPointers.length&&null!==this.velocity&&e.current.timeStamp-this.lastPointerDownTimestamp>30&&null!==this.velocity){const o=this.velocity;this.updateVelocity(e.current.screenPos),o.magnitude()<this.velocity.magnitude()&&(this.velocity=o),this.inertialScroller?.stop(),this.inertialScroller=new u(this.velocity,(e=>{if(!this.transform)return;const t=this.editor.viewport.screenToCanvasTransform.transformVec3(e);this.transform.unapply(this.editor),this.transform=l.Viewport.transformBy(this.transform.transform.rightMul(i.Mat33.translation(t))),this.transform.apply(this.editor)}),t)}else t()}onGestureCancel(){this.inertialScroller?.stop(),this.velocity=i.Vec2.zero,this.transform?.unapply(this.editor),this.editor.display.setDraftMode(!1),this.transform=null}updateTransform(e,t=!1){let o=e;this.transform&&(o=this.transform.transform.rightMul(e)),this.transform?.unapply(this.editor),this.transform=l.Viewport.transformBy(o),this.transform.apply(this.editor),t&&this.editor.announceForAccessibility(this.transform.description(this.editor,this.editor.localization))}applyAndFinalizeTransform(e){this.updateTransform(e,!0),this.transform=null}onWheel({delta:e,screenPos:t}){this.inertialScroller?.stop(),this.transform=l.Viewport.transformBy(i.Mat33.identity);const o=this.editor.viewport.screenToCanvas(t),n=this.editor.viewport.screenToCanvasTransform.transformVec3(i.Vec3.of(-e.x,-e.y,0));let r=e.z;r=2*Math.atan(r/2);const s=i.Mat33.scaling2D(Math.max(.4,Math.min(Math.pow(1.04,-r),4)),o).rightMul(i.Mat33.translation(n));return this.applyAndFinalizeTransform(s),!0}onKeyPress(e){if(this.inertialScroller?.stop(),!(this.mode&h.Keyboard))return!1;this.transform=l.Viewport.transformBy(i.Mat33.identity);let t=i.Vec2.zero,o=1,n=0;const r=this.editor.shortcuts;if(r.matchesShortcut(d.moveLeftKeyboardShortcutId,e))t=i.Vec2.of(-1,0);else if(r.matchesShortcut(d.moveRightKeyboardShortcutId,e))t=i.Vec2.of(1,0);else if(r.matchesShortcut(d.moveUpKeyboardShortcutId,e))t=i.Vec2.of(0,-1);else if(r.matchesShortcut(d.moveDownKeyboardShortcutId,e))t=i.Vec2.of(0,1);else if(r.matchesShortcut(d.zoomInKeyboardShortcutId,e))o=.5;else if(r.matchesShortcut(d.zoomOutKeyboardShortcutId,e))o=2;else if(r.matchesShortcut(d.rotateClockwiseKeyboardShortcutId,e))n=1;else{if(!r.matchesShortcut(d.rotateCounterClockwiseKeyboardShortcutId,e))return!1;n=-1}t=t.times(30),n*=Math.PI/8,t=t.times(-1),n*=-1,o=1/o,0!==n&&(n+=1e-4),this.isRotationLocked()&&(n=0),t=this.editor.viewport.screenToCanvasTransform.transformVec3(t);const s=this.editor.viewport.visibleRect.center,a=i.Mat33.scaling2D(o,s).rightMul(i.Mat33.zRotation(n,s)).rightMul(i.Mat33.translation(t));return this.applyAndFinalizeTransform(a),!0}isRotationLocked(){return!!(this.mode&h.RotationLocked)}setModeEnabled(e,t){let o=this.mode;t?o|=e:o&=~e,this.setMode(o)}setMode(e){e!==this.mode&&(this.mode=e,this.editor.notifier.dispatch(s.EditorEventType.ToolUpdated,{kind:s.EditorEventType.ToolUpdated,tool:this}))}getMode(){return this.mode}}t.default=p},2408:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(3332)),r=n(o(5466)),s=o(3755),a=n(o(9482)),l=n(o(5384)),c=n(o(2192));class d extends a.default{constructor(e){super(e.notifier,e.localization.pasteHandler),this.editor=e}onPaste(e,t){const o=e.mime.toLowerCase(),n=(()=>{if("image/svg+xml"===o)return e.data;if("text/plain"===o){const t=e.data.trim();if(t.startsWith("<svg")&&t.endsWith("</svg>"))return t}if("text/html"!==o)return!1;if(!e.data.match(/^[^]{0,200}<svg.*/i))return!1;let t=e.data.toLowerCase().lastIndexOf("</svg>");return-1===t&&(t=e.data.length),e.data.substring(e.data.search(/<svg/i),t)})();return n?(this.doSVGPaste(n).then(t),!0):"text/plain"===o?(this.doTextPaste(e.data).then(t),!0):("image/png"===o||"image/jpeg"===o)&&(this.doImagePaste(e.data).then(t),!0)}async addComponentsFromPaste(e){await this.editor.addAndCenterComponents(e,!0,this.editor.localization.pasted(e.length))}async doSVGPaste(e){this.editor.showLoadingWarning(0);try{const t=r.default.fromString(e,{sanitize:!0,plugins:this.editor.getCurrentSettings().svg?.loaderPlugins??[]}),o=[];await t.start((e=>{o.push(e)}),((e,t)=>null)),await this.addComponentsFromPaste(o)}finally{this.editor.hideLoadingWarning()}}async doTextPaste(e){const t=this.editor.toolController.getMatchingTools(l.default);t.sort(((e,t)=>!e.isEnabled()&&t.isEnabled()?-1:!t.isEnabled()&&e.isEnabled()?1:0));const o={size:12,fontFamily:"sans",renderingStyle:{fill:s.Color4.red}},n=t[0]?.getTextStyle()??o;if(""===e.trim())return;const r=e.split("\n");await this.addComponentsFromPaste([i.default.fromLines(r,s.Mat33.identity,n)])}async doImagePaste(e){const t=new Image;t.src=e;const o=await c.default.fromImage(t,s.Mat33.identity);await this.addComponentsFromPaste([o])}}t.default=d},3822:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(3755),c=a(o(2709)),d=o(7372),h=o(8195),u=o(2572),p=a(o(9482)),f=o(2916),m=o(2916),g=a(o(5117)),b=o(5786),v=s(o(6761));class y extends p.default{constructor(e,t,o){super(e.notifier,t),this.editor=e,this.builder=null,this.lastPoint=null,this.startPoint=null,this.currentDeviceType=null,this.currentPointerId=null,this.shapeAutocompletionEnabled=!1,this.pressureSensitivityEnabled=!0,this.autocorrectedShape=null,this.lastAutocorrectedShape=null,this.removedAutocorrectedShapeTime=0,this.stationaryDetector=null,this.styleValue=b.ReactiveValue.fromInitialValue({factory:h.makeFreehandLineBuilder,color:l.Color4.blue,thickness:4,...o}),this.styleValue.onUpdateAndNow((e=>{this.style=e,this.noteUpdated()})),this.wetInkRenderer=this.editor.display.getWetInkRenderer()}getPressureMultiplier(){const e=this.style.thickness;return 1/this.editor.viewport.getScaleFactor()*e}toStrokePoint(e){let t=Math.max(e.pressure??1,.3);isFinite(t)||(console.warn("Non-finite pressure!",e),t=.3),console.assert(isFinite(e.canvasPos.length()),"Non-finite canvas position!"),console.assert(isFinite(e.screenPos.length()),"Non-finite screen position!"),console.assert(isFinite(e.timeStamp),"Non-finite timeStamp on pointer!");const o=e.canvasPos;return this.getPressureSensitivityEnabled()||(t=.5),{pos:o,width:t*this.getPressureMultiplier(),color:this.style.color,time:e.timeStamp}}previewStroke(){if(this.editor.clearWetInk(),this.autocorrectedShape){const e=this.editor.viewport.visibleRect;this.autocorrectedShape.render(this.wetInkRenderer,e)}else if(this.builder&&(this.builder.preview(this.wetInkRenderer),this.builder.inkTrailStyle)){const e=this.builder.inkTrailStyle();this.wetInkRenderer.getDraftInkPresenter().updateStyle(e)}}addPointToStroke(e){if(!this.builder)throw new Error("No stroke is currently being generated.");this.builder.addPoint(e),this.lastPoint=e,this.previewStroke()}onPointerDown(e){if(this.builder&&!this.eventCanCancelStroke(e))return!0;const{current:t,allPointers:o}=e,n=t.device===d.PointerDevice.Eraser,i=t.device===d.PointerDevice.Pen;return!((1!==o.length||n)&&!i||(this.startPoint=this.toStrokePoint(t),this.builder=this.style.factory(this.startPoint,this.editor.viewport),this.currentDeviceType=t.device,this.currentPointerId=t.id,this.shapeAutocompletionEnabled?this.stationaryDetector=new v.default(t,v.defaultStationaryDetectionConfig,(e=>this.autocorrectShape(e))):this.stationaryDetector=null,this.lastAutocorrectedShape=null,this.removedAutocorrectedShapeTime=0,this.builder.inkTrailStyle&&this.wetInkRenderer.getDraftInkPresenter().setEnabled(t.id,!0),0))}eventCanCancelStroke(e){const t=this.lastPoint?.time??0;if(e.current.timeStamp-t>1e3)return!0;const o=this.currentDeviceType===d.PointerDevice.Pen,n=e.current.device===d.PointerDevice.Touch;return!o||!n}eventCanBeDeliveredToNonActiveTool(e){return this.eventCanCancelStroke(e)}onPointerMove({current:e}){if(!this.builder)return;if(e.device!==this.currentDeviceType)return;if(e.id!==this.currentPointerId)return;const t=this.stationaryDetector?.onPointerMove(e);t||(this.addPointToStroke(this.toStrokePoint(e)),this.autocorrectedShape&&(this.removedAutocorrectedShapeTime=performance.now(),this.autocorrectedShape=null,this.editor.announceForAccessibility(this.editor.localization.autocorrectionCanceled)))}onPointerUp({current:e}){if(!this.builder)return!1;if(e.id!==this.currentPointerId)return!0;this.stationaryDetector?.onPointerUp(e);const t=this.toStrokePoint(e),o={...t,width:this.lastPoint?.width??t.width};return this.addPointToStroke(o),this.finalizeStroke(),!1}postGestureCleanup(){null!==this.currentPointerId&&this.wetInkRenderer.getDraftInkPresenter().setEnabled(this.currentPointerId,!1),this.builder=null,this.lastPoint=null,this.autocorrectedShape=null,this.lastAutocorrectedShape=null,this.editor.clearWetInk(),this.stationaryDetector?.destroy(),this.stationaryDetector=null}onGestureCancel(){this.postGestureCleanup()}removedAutocorrectedShapeRecently(){return this.removedAutocorrectedShapeTime>performance.now()-320}async autocorrectShape(e){if(!this.builder||!this.builder.autocorrectShape)return;if(!this.shapeAutocompletionEnabled)return;if(this.autocorrectedShape)return;const t=await this.builder.autocorrectShape();if(!this.builder||!t)return;const o=t.getBBox().area;if(0===o||!isFinite(o))return;const n=t.description(this.editor.localization);this.editor.announceForAccessibility(this.editor.localization.autocorrectedTo(n)),this.autocorrectedShape=t,this.lastAutocorrectedShape=t,this.previewStroke()}finalizeStroke(){if(this.builder){this.lastAutocorrectedShape&&this.removedAutocorrectedShapeRecently()&&(this.autocorrectedShape=this.lastAutocorrectedShape);const e=this.autocorrectedShape??this.builder.build();if(this.previewStroke(),e.getBBox().area>0){e===this.autocorrectedShape&&this.editor.announceForAccessibility(this.editor.localization.autocorrectedTo(e.description(this.editor.localization)));const t=!0,o=c.default.addComponent(e,t);this.editor.dispatch(o)}else console.warn("Pen: Not adding empty stroke",e,"to the canvas.")}this.postGestureCleanup()}noteUpdated(){this.editor.notifier.dispatch(u.EditorEventType.ToolUpdated,{kind:u.EditorEventType.ToolUpdated,tool:this})}setColor(e){e.toHexString()!==this.style.color.toHexString()&&this.styleValue.set({...this.style,color:e})}setThickness(e){e!==this.style.thickness&&this.styleValue.set({...this.style,thickness:e})}setStrokeFactory(e){e!==this.style.factory&&this.styleValue.set({...this.style,factory:e})}setHasStabilization(e){const t=!!this.getInputMapper();e!==t&&(t?this.setInputMapper(null):this.setInputMapper(new g.default(this.editor.viewport)),this.noteUpdated())}setStrokeAutocorrectEnabled(e){e!==this.shapeAutocompletionEnabled&&(this.shapeAutocompletionEnabled=e,this.noteUpdated())}getStrokeAutocorrectionEnabled(){return this.shapeAutocompletionEnabled}setPressureSensitivityEnabled(e){e!==this.pressureSensitivityEnabled&&(this.pressureSensitivityEnabled=e,this.noteUpdated())}getPressureSensitivityEnabled(){return this.pressureSensitivityEnabled}getThickness(){return this.style.thickness}getColor(){return this.style.color}getStrokeFactory(){return this.style.factory}getStyleValue(){return this.styleValue}onKeyPress(e){const t=this.editor.shortcuts,o=t.matchesShortcut(f.undoKeyboardShortcutId,e);if(this.builder&&o)return this.finalizeStroke(),!1;let n;return t.matchesShortcut(m.decreaseSizeKeyboardShortcutId,e)?n=2*this.getThickness()/3:t.matchesShortcut(m.increaseSizeKeyboardShortcutId,e)&&(n=3*this.getThickness()/2),void 0!==n&&(n=Math.min(Math.max(1,n),256),this.setThickness(n),!0)}}t.default=y},776:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(9482));class r extends i.default{constructor(e,t){super(e.notifier,t),this.editor=e,this.colorPreviewListener=null,this.colorSelectListener=null,this.enabledValue().onUpdateAndNow((()=>{this.updateSelectingStatus()}))}canReceiveInputInReadOnlyEditor(){return!0}updateSelectingStatus(){const e="pipette--color-selection-in-progress";this.isEnabled()&&this.colorSelectListener&&this.colorPreviewListener?this.editor.getRootElement().classList.add(e):this.editor.getRootElement().classList.remove(e)}setColorListener(e,t){this.colorPreviewListener=e,this.colorSelectListener=t,this.updateSelectingStatus()}clearColorListener(){this.colorPreviewListener=null,this.colorSelectListener=null,this.updateSelectingStatus()}onPointerDown({current:e,allPointers:t}){return!(!this.colorPreviewListener||1!==t.length||(this.colorPreviewListener(this.editor.display.getColorAt(e.screenPos)),0))}onPointerMove({current:e}){this.colorPreviewListener?.(this.editor.display.getColorAt(e.screenPos))}onPointerUp({current:e}){this.colorSelectListener?.(this.editor.display.getColorAt(e.screenPos))}onGestureCancel(){this.colorSelectListener?.(null)}}t.default=r},7705:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=o(2572),s=n(o(9482));class a extends s.default{constructor(e){super(e.notifier,"scrollbar"),this.editor=e,this.fadeOutTimeout=null,this.scrollbarOverlay=document.createElement("div"),this.scrollbarOverlay.classList.add("ScrollbarTool-overlay"),this.verticalScrollbar=document.createElement("div"),this.verticalScrollbar.classList.add("vertical-scrollbar"),this.horizontalScrollbar=document.createElement("div"),this.horizontalScrollbar.classList.add("horizontal-scrollbar"),this.scrollbarOverlay.replaceChildren(this.verticalScrollbar,this.horizontalScrollbar);let t=null,o=null;this.enabledValue().onUpdateAndNow((n=>{t?.remove(),o?.remove(),o=null,t=null,n&&(o=e.notifier.on(r.EditorEventType.ViewportChanged,(e=>{this.updateScrollbars()})),this.updateScrollbars(),t=e.createHTMLOverlay(this.scrollbarOverlay))}))}updateScrollbars(){const e=this.editor.viewport,t=e.getScreenRectSize(),o=new i.Rect2(0,0,t.x,t.y),n=this.editor.getImportExportRect().transformedBoundingBox(e.canvasToScreenTransform).union(o),r=o.width/n.width*t.x,s=o.height/n.height*t.y,a=(o.x-n.x)/n.width*t.x,l=(o.y-n.y)/n.height*t.y;this.horizontalScrollbar.style.width=`${r}px`,this.verticalScrollbar.style.height=`${s}px`,this.horizontalScrollbar.style.marginLeft=`${a}px`,this.verticalScrollbar.style.marginTop=`${l}px`;const c=(e,t,o)=>{const n="represents-no-scroll";Math.abs(t-o)<1e-8?e.classList.add(n):e.classList.remove(n)};c(this.horizontalScrollbar,r,t.x),c(this.verticalScrollbar,s,t.y),null!==this.fadeOutTimeout&&clearTimeout(this.fadeOutTimeout),this.fadeOutTimeout=setTimeout((()=>{this.scrollbarOverlay.classList.remove("just-updated")}),3e3),this.scrollbarOverlay.classList.add("just-updated")}}t.default=a},3931:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(9482)),r=o(2916),s=n(o(8522));class a extends i.default{constructor(e){super(e.notifier,e.localization.selectAllTool),this.editor=e}canReceiveInputInReadOnlyEditor(){return!0}onKeyPress(e){if(this.editor.shortcuts.matchesShortcut(r.selectAllKeyboardShortcut,e)){const e=this.editor.toolController.getMatchingTools(s.default);if(e.length>0){const t=e[0];return t.setEnabled(!0),t.setSelection(this.editor.image.getAllComponents()),!0}}return!1}}t.default=a},3924:function(e,t,o){"use strict";var n,i,r=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),i=0;i<o.length;i++)"default"!==o[i]&&r(t,e,o[i]);return s(t,e),t}),l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=l(o(8164)),d=o(3755),h=a(o(3138)),u=o(8522),p=l(o(4287)),f=l(o(3538)),m=l(o(7005)),g=o(6109),b=o(711),v=l(o(2709)),y=l(o(1583)),w=l(o(7197)),x=o(5673),S=l(o(2832));class T{constructor(e,t,o){this.editor=t,this.selectionTightBoundingBox=null,this.transform=d.Mat33.identity,this.selectedElems=[],this.hasParent=!0,this.removedFromImage={},this.activeHandle=null,this.backgroundDragging=!1,this.selectionDuplicatedAnimationTimeout=null,e=[...e],this.selectedElems=e,this.originalRegion=d.Rect2.empty,this.transformers={drag:new g.DragTransformer(t,this),resize:new g.ResizeTransformer(t,this),rotate:new g.RotateTransformer(t,this)},this.outerContainer=document.createElement("div"),this.outerContainer.classList.add(`${u.cssPrefix}selection-outer-container`),this.innerContainer=document.createElement("div"),this.innerContainer.classList.add(`${u.cssPrefix}selection-inner-container`),this.backgroundElem=document.createElement("div"),this.backgroundElem.classList.add(`${u.cssPrefix}selection-background`),this.innerContainer.appendChild(this.backgroundElem),this.outerContainer.appendChild(this.innerContainer);const n=(e,t)=>{const o={[b.ResizeMode.Both]:h.HandleAction.ResizeXY,[b.ResizeMode.HorizontalOnly]:h.HandleAction.ResizeX,[b.ResizeMode.VerticalOnly]:h.HandleAction.ResizeY};return new h.default({action:o[e],side:t},this,this.editor.viewport,(t=>this.transformers.resize.onDragStart(t,e)),(e=>this.transformers.resize.onDragUpdate(e)),(()=>this.transformers.resize.onDragEnd()))},i=[n(b.ResizeMode.HorizontalOnly,d.Vec2.of(0,.5)),n(b.ResizeMode.HorizontalOnly,d.Vec2.of(1,.5))],r=n(b.ResizeMode.VerticalOnly,d.Vec2.of(.5,1)),s=n(b.ResizeMode.Both,d.Vec2.of(1,1)),a=new h.default({action:h.HandleAction.Rotate,side:d.Vec2.of(.5,0),icon:this.editor.icons.makeRotateIcon()},this,this.editor.viewport,(e=>this.transformers.rotate.onDragStart(e)),(e=>this.transformers.rotate.onDragUpdate(e)),(()=>this.transformers.rotate.onDragEnd())),l=new w.default(this,this.editor.viewport,this.editor.icons.makeOverflowIcon(),o,this.editor.localization);this.childwidgets=[l,s,...i,r,a];for(const e of this.childwidgets)e.addTo(this.backgroundElem);this.recomputeRegion(),this.updateUI()}getBackgroundElem(){return this.backgroundElem}getTransform(){return this.transform}get preTransformRegion(){return this.originalRegion}get region(){const e=d.Mat33.zRotation(this.regionRotation,this.originalRegion.center),t=this.transform.rightMul(e.inverse());return this.originalRegion.transformedBoundingBox(t)}computeTightBoundingBox(){return this.selectedElems.reduce(((e,t)=>(e??t.getBBox()).union(t.getBBox())),null)??d.Rect2.empty}get regionRotation(){return this.transform.transformVec3(d.Vec2.unitX).angle()}get preTransformedScreenRegion(){const e=e=>this.editor.viewport.canvasToScreen(e);return d.Rect2.fromCorners(e(this.preTransformRegion.topLeft),e(this.preTransformRegion.bottomRight))}get preTransformedScreenRegionRotation(){return this.editor.viewport.getRotationAngle()}getScreenRegion(){const e=this.editor.viewport.canvasToScreenTransform,t=this.editor.viewport.getScaleFactor(),o=e.transformVec2(this.region.center);return new d.Rect2(o.x,o.y,t*this.region.width,t*this.region.height).translatedBy(this.region.size.times(-t/2))}get screenRegionRotation(){return this.regionRotation+this.editor.viewport.getRotationAngle()}setTransform(e,t=!0){this.transform=e,t&&this.hasParent&&this.previewTransformCmds()}getDeltaZIndexToMoveSelectionToTop(){if(0===this.selectedElems.length)return 0;const e=this.selectedElems[0].getZIndex(),t=this.editor.image.getComponentsIntersecting(this.region);return(t[t.length-1]?.getZIndex()??e)+1-e}finalizeTransform(){const e=this.transform,t=this.selectedElems;let o;if(this.originalRegion=this.originalRegion.transformedBoundingBox(this.transform),this.transform=d.Mat33.identity,this.scrollTo(),this.selectedElems.length>0){const n=this.getDeltaZIndexToMoveSelectionToTop();o=this.editor.dispatch(new i.ApplyTransformationCommand(this,t,this.originalRegion.center,e,n))}return o}sendToBack(){const e=this.editor.image.getComponentsIntersecting(this.editor.viewport.visibleRect),t=(e[0]?.getZIndex()??0)-1-(this.selectedElems[this.selectedElems.length-1]?.getZIndex()??0);if(0!==t){const e=this.selectedElems.map((e=>e.setZIndex(e.getZIndex()+t)));return(0,y.default)(e,100)}return null}previewTransformCmds(){if(0===this.selectedElems.length)return;if(this.selectedElems.length>500)return void this.updateUI();const e=this.editor.display.getWetInkRenderer();e.clear(),e.pushTransform(this.transform);const t=this.editor.viewport.visibleRect.union(this.region).transformedBoundingBox(this.transform.inverse());for(const o of this.selectedElems)o.render(e,t);e.popTransform(),this.updateUI()}recomputeRegion(){const e=this.computeTightBoundingBox();return this.selectionTightBoundingBox=e,e?(this.originalRegion=e,this.padRegion(),!0):(this.cancelSelection(),!1)}padRegion(){const e=this.selectionTightBoundingBox??this.originalRegion,t=this.getMinCanvasSize();if(e.w<t||e.h<t){const o=t/2;this.originalRegion=d.Rect2.bboxOf(e.corners,o),this.updateUI()}}getMinCanvasSize(){return h.handleSize/this.editor.viewport.getScaleFactor()*2}getSelectedItemCount(){return this.selectedElems.length}updateUI(){if(!this.hasParent)return;const e=this.getScreenRegion();this.backgroundElem.style.marginLeft=`${e.topLeft.x}px`,this.backgroundElem.style.marginTop=`${e.topLeft.y}px`,this.backgroundElem.style.width=`${e.width}px`,this.backgroundElem.style.height=`${e.height}px`;const t=180*this.screenRegionRotation/Math.PI;this.backgroundElem.style.transform=`rotate(${t}deg)`,this.backgroundElem.style.transformOrigin="center";const o=`${u.cssPrefix}rotated-near-perpendicular`;Math.abs(Math.sin(this.screenRegionRotation))>.5?this.innerContainer.classList.add(o):this.innerContainer.classList.remove(o),0===e.width&&0===e.height?this.innerContainer.classList.add("-empty"):this.innerContainer.classList.remove("-empty");for(const e of this.childwidgets)e.updatePosition(this.getScreenRegion())}addRemoveSelectionFromImage(e){if(e||!(this.selectedElems.length>500)){for(const t of this.selectedElems){const o=this.editor.image.findParent(t);!e&&o?(this.removedFromImage[t.getId()]=!0,o.remove()):!o&&this.removedFromImage[t.getId()]&&(v.default.addComponent(t).apply(this.editor),this.removedFromImage[t.getId()]=!1,delete this.removedFromImage[t.getId()])}this.editor.queueRerender().then((()=>{e?this.editor.display.getWetInkRenderer().clear():this.previewTransformCmds()}))}}removeDeletedElemsFromSelection(){this.selectedElems=this.selectedElems.filter((e=>{const t=!!this.editor.image.findParent(e),o=this.removedFromImage[e.getId()];return t||o}))}onDragStart(e){if(0===this.selectedElems.length)return!1;document.getSelection()?.removeAllRanges(),this.activeHandle=null;let t=!1;this.backgroundDragging=!1,this.region.containsPoint(e.canvasPos)&&(this.backgroundDragging=!0,t=!0);for(const o of this.childwidgets)o.containsPoint(e.canvasPos)&&(this.activeHandle=o,this.backgroundDragging=!1,t=!0);return t&&(this.removeDeletedElemsFromSelection(),this.addRemoveSelectionFromImage(!1)),this.activeHandle&&this.activeHandle.handleDragStart(e),this.backgroundDragging&&this.transformers.drag.onDragStart(e.canvasPos),t}onDragUpdate(e){this.backgroundDragging&&this.transformers.drag.onDragUpdate(e.canvasPos),this.activeHandle&&this.activeHandle.handleDragUpdate(e)}onDragEnd(){this.backgroundDragging?this.transformers.drag.onDragEnd():this.activeHandle&&this.activeHandle.handleDragEnd(),this.addRemoveSelectionFromImage(!0),this.backgroundDragging=!1,this.activeHandle=null,this.updateUI()}onDragCancel(){this.backgroundDragging=!1,this.activeHandle=null,this.setTransform(d.Mat33.identity),this.addRemoveSelectionFromImage(!0),this.updateUI()}scrollTo(){if(0===this.selectedElems.length)return!1;const e=this.editor.viewport.getScreenRectSize(),t=new d.Rect2(0,0,e.x,e.y),o=this.getScreenRegion();if(!t.containsPoint(o.center)){const e=o.center,n=t.getClosestPointOnBoundaryTo(e),i=this.editor.viewport.screenToCanvas(n),r=this.region.center,s=i.minus(r);return this.editor.dispatchNoAnnounce(p.default.transformBy(d.Mat33.translation(s.times(.5))),!1),this.editor.queueRerender().then((()=>{this.previewTransformCmds()})),!0}return!1}deleteSelectedObjects(){return(this.backgroundDragging||this.activeHandle)&&this.onDragEnd(),new f.default(this.selectedElems)}runSelectionDuplicatedAnimation(){this.selectionDuplicatedAnimationTimeout&&clearTimeout(this.selectionDuplicatedAnimationTimeout),this.backgroundElem.style.animation="400ms ease selection-duplicated-animation",this.selectionDuplicatedAnimationTimeout=setTimeout((()=>{this.backgroundElem.style.animation="",this.selectionDuplicatedAnimationTimeout=null}),400)}async duplicateSelectedObjects(){const e=this.backgroundDragging||this.activeHandle;let t,o=null;if(e||this.runSelectionDuplicatedAnimation(),e){const e=null,n=this.getDeltaZIndexToMoveSelectionToTop();o=new i.ApplyTransformationCommand(e,this.selectedElems,this.region.center,this.transform,n),await o.apply(this.editor),this.addRemoveSelectionFromImage(!0),t=(0,y.default)(this.selectedElems.map((e=>v.default.addComponent(e.clone())))),await(o?.unapply(this.editor)),this.addRemoveSelectionFromImage(!1),this.previewTransformCmds(),this.updateUI()}else t=new m.default(this.selectedElems);return t}snapSelectedObjectsToGrid(){const e=this.editor.viewport,t=this.computeTightBoundingBox().topLeft,o=e.snapToGrid(t).minus(t),n=this.getTransform();this.setTransform(n.rightMul(d.Mat33.translation(o))),this.finalizeTransform()}setHandlesVisible(e){e?this.innerContainer.classList.remove("-hide-handles"):this.innerContainer.classList.add("-hide-handles")}addTo(e){this.outerContainer.parentElement&&this.outerContainer.remove(),e.appendChild(this.outerContainer),this.hasParent=!0}setToPoint(e){this.originalRegion=this.originalRegion.grownToPoint(e),this.selectionTightBoundingBox=null,this.updateUI()}cancelSelection(){this.outerContainer.parentElement&&this.outerContainer.remove(),this.originalRegion=d.Rect2.empty,this.selectionTightBoundingBox=null,this.hasParent=!1}getSelectedObjects(){return[...this.selectedElems]}}i=T,c.default.register("selection-tool-transform",((e,t)=>{const o=e.transform,n=e.selectionCenter??[0,0],r=e.elems??[];(0,x.assertIsNumberArray)(o),(0,x.assertIsNumberArray)(n),(0,x.assertIsStringArray)(r);const s=new d.Mat33(...o),a=r,l=parseInt(e.deltaZIndex??0),c=d.Vec2.of(n[0]??0,n[1]??0);return new i.ApplyTransformationCommand(null,a,c,s,l)})),T.ApplyTransformationCommand=class extends c.default{constructor(e,t,o,n,i){super("selection-tool-transform"),this.selection=e,this.selectionCenter=o,this.fullTransform=n,this.deltaZIndex=i,"string"==typeof t[0]?this.selectedElemIds=t:(this.selectedElemIds=t.map((e=>e.getId())),this.transformCommands=t.map((e=>e.setZIndexAndTransformBy(this.fullTransform,e.getZIndex()+i))))}resolveToElems(e,t){this.transformCommands||(this.transformCommands=this.selectedElemIds.map((o=>{const n=e.image.lookupElement(o);if(!n)return console.warn(`Unable to find element with ID, ${o}.`),null;let i=n.getZIndex(),r=n.getZIndex()+this.deltaZIndex;return t&&(r=n.getZIndex(),i=n.getZIndex()-this.deltaZIndex),n.setZIndexAndTransformBy(this.fullTransform,r,i)})).filter((e=>null!==e)))}async apply(e){this.resolveToElems(e,!1),this.selection?.setTransform(this.fullTransform,!1),this.selection?.updateUI(),await e.asyncApplyCommands(this.transformCommands,100),this.selection?.setTransform(d.Mat33.identity,!1),this.selection?.recomputeRegion(),this.selection?.updateUI()}async unapply(e){this.resolveToElems(e,!0),this.selection?.setTransform(this.fullTransform.inverse(),!1),this.selection?.updateUI(),await e.asyncUnapplyCommands(this.transformCommands,100,!0),this.selection?.setTransform(d.Mat33.identity,!1),this.selection?.recomputeRegion(),this.selection?.updateUI()}serializeToJSON(){return{elems:this.selectedElemIds,transform:this.fullTransform.toArray(),deltaZIndex:this.deltaZIndex,selectionCenter:this.selectionCenter.asArray()}}description(e,t){return t.transformedElements(this.selectedElemIds.length,(0,S.default)(this.selectionCenter,this.fullTransform,!1,t))}},t.default=T},7708:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=o(3755),s=n(o(5138));class a extends s.default{constructor(e,t){super(),this.viewport=t,this.boundaryPoints=[],this.boundaryPoints.push(e),this.lastPoint=e}onPointerMove(e){const t=this.boundaryPoints[this.boundaryPoints.length-1],o=8*this.viewport.getSizeOfPixelOnCanvas();t.distanceTo(e)>=o&&this.boundaryPoints.push(e),this.lastPoint=e}previewPath(){const e=this.boundaryPoints.map((e=>({kind:r.PathCommandType.LineTo,point:e})));return e.push({kind:r.PathCommandType.LineTo,point:this.lastPoint}),new i.Path(this.boundaryPoints[0],e).asClosed()}resolveInternal(e){const t=this.previewPath(),o=t.polylineApproximation();return e.getComponentsIntersecting(t.bbox).filter((e=>{if(t.closedContainsRect(e.getExactBBox()))return!0;let n=!1;for(const o of e.keyPoints())if(t.closedContainsPoint(o)){n=!0;break}if(!n)return!1;for(const t of o)if(e.intersects(t))return!1;return!0}))}}t.default=a},4244:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=n(o(5138));class s extends r.default{constructor(e){super(),this.rect=i.Rect2.fromCorners(e,e)}onPointerMove(e){this.rect=this.rect.grownToPoint(e)}previewPath(){return i.Path.fromRect(this.rect)}resolveInternal(e){return e.getComponentsIntersecting(this.rect).filter((e=>e.intersectsRect(this.rect)))}}t.default=s},5138:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(2956);t.default=class{render(e,t){e.drawPath((0,n.pathToRenderable)(this.previewPath(),{fill:t}))}resolve(e,t){const o=this.previewPath(),n=e=>e.filter((e=>e.isSelectable()));let i;const r=3*t.getSizeOfPixelOnCanvas();if(o.bbox.maxDimension<=r){const r=t.visibleRect.maxDimension/200,s=o.bbox.grownBy(r);i=e.getComponentsIntersecting(s).filter((e=>s.containsRect(e.getBBox())||e.intersectsRect(s))),i=n(i),i.length>1&&(i=[i[0]])}else i=n(this.resolveInternal(e));return i}}},3138:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleSize=t.HandleAction=void 0;const n=o(5673),i=o(3755),r=o(8522);var s,a;!function(e){e[e.Circle=0]="Circle",e[e.Square=1]="Square"}(s||(s={})),function(e){e.ResizeXY="resize-xy",e.Rotate="rotate",e.ResizeX="resize-x",e.ResizeY="resize-y"}(a||(t.HandleAction=a={})),t.handleSize=30,t.default=class{constructor(e,t,o,i,l,c){this.presentation=e,this.parent=t,this.viewport=o,this.onDragStart=i,this.onDragUpdate=l,this.onDragEnd=c,this.dragLastPos=null,this.element=document.createElement("div"),this.element.classList.add(`${r.cssPrefix}handle`,`${r.cssPrefix}${e.action}`);const d=document.createElement("div");d.classList.add(`${r.cssPrefix}content`),this.element.appendChild(d),this.parentSide=e.side;const h=e.icon;switch(h&&(d.appendChild(h),h.classList.add("icon")),e.action===a.Rotate?this.shape=s.Circle:this.shape=s.Square,this.shape){case s.Circle:this.element.classList.add(`${r.cssPrefix}circle`);break;case s.Square:this.element.classList.add(`${r.cssPrefix}square`);break;default:(0,n.assertUnreachable)(this.shape)}this.updatePosition()}addTo(e){e.appendChild(this.element)}remove(){this.element.remove()}getBBoxParentCoords(){const e=this.parent.getScreenRegion(),o=i.Vec2.of(t.handleSize,t.handleSize),n=e.size.scale(this.parentSide).minus(o.times(.5));return new i.Rect2(n.x,n.y,o.x,o.y)}getBBoxCanvasCoords(){const e=this.parent.region,o=i.Vec2.of(t.handleSize,t.handleSize).times(1/this.viewport.getScaleFactor()),n=e.size.scale(this.parentSide).minus(o.times(.5));return new i.Rect2(n.x,n.y,o.x,o.y).translatedBy(e.topLeft)}updatePosition(){const e=this.getBBoxParentCoords();this.element.style.marginLeft=`${e.topLeft.x}px`,this.element.style.marginTop=`${e.topLeft.y}px`,this.element.style.width=`${e.w}px`,this.element.style.height=`${e.h}px`}containsPoint(e){const t=this.getBBoxCanvasCoords(),o=e.minus(t.center),n=t.size.x/2;let i;return i=this.shape===s.Circle?o.magnitude()<=n:Math.abs(o.x)<=n&&Math.abs(o.y)<=n,i}handleDragStart(e){return this.onDragStart(e.canvasPos),this.dragLastPos=e.canvasPos,!0}handleDragUpdate(e){this.dragLastPos&&this.onDragUpdate(e.canvasPos)}handleDragEnd(){if(this.dragLastPos)return this.onDragEnd()}setSnapToGrid(e){this.snapToGrid=e}isSnappingToGrid(){return this.snapToGrid}}},7197:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755),i=o(8522);t.default=class{constructor(e,t,o,n,r){this.parent=e,this.viewport=t,this.icon=o,this.localization=r,this.lastDragPointer=null,this.element=document.createElement("div"),this.element.classList.add(`${i.cssPrefix}handle`,`${i.cssPrefix}selection-menu`),this.element.style.setProperty("--vertical-offset","40px"),this.onClick=()=>{this.button?.focus({preventScroll:!0});const e=this.getBBoxCanvasCoords().center;n(e)},this.initUI(),this.updatePosition()}initUI(){const e=document.createElement("button");this.icon.classList.add("icon"),e.replaceChildren(this.icon),e.ariaLabel=this.localization.selectionMenu__show,e.title=e.ariaLabel,this.button=e,e.onkeydown=e=>{"Enter"===e.key&&(e.preventDefault(),this.onClick())},this.element.appendChild(e),requestAnimationFrame((()=>{this.updatePosition()}))}addTo(e){e.appendChild(this.element)}remove(){this.element.remove()}getElementScreenSize(){return n.Vec2.of(this.element.clientWidth,this.element.clientHeight)}getBBoxParentCoords(){const e=n.Vec2.of(0,-40),t=this.getElementScreenSize();return new n.Rect2(e.x,e.y,t.x,t.y)}getBBoxCanvasCoords(){const e=this.parent.region,t=this.viewport.getSizeOfPixelOnCanvas(),o=this.getElementScreenSize().times(t),i=40/this.viewport.getScaleFactor(),r=n.Vec2.of(e.x,e.y-i),s=n.Vec2.of(48,48).times(t);return new n.Rect2(r.x,r.y,o.x,o.y).grownToSize(s)}updatePosition(){const e=this.getBBoxParentCoords();this.element.style.marginLeft=`${e.topLeft.x}px`,this.element.style.marginTop=`${e.topLeft.y}px`}containsPoint(e){return this.getBBoxCanvasCoords().containsPoint(e)}handleDragStart(e){return this.lastDragPointer=e,!0}handleDragUpdate(e){this.lastDragPointer=e}handleDragEnd(){this.lastDragPointer&&this.containsPoint(this.lastDragPointer.canvasPos)&&this.onClick(),this.lastDragPointer=null}}},8522:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionMode=t.cssPrefix=void 0;const i=o(3755),r=o(2572),s=n(o(4287)),a=n(o(9482)),l=n(o(1842)),c=n(o(1712)),d=n(o(3924)),h=n(o(3332)),u=o(2916),p=n(o(497)),f=n(o(4476)),m=o(5786),g=o(711);Object.defineProperty(t,"SelectionMode",{enumerable:!0,get:function(){return g.SelectionMode}});const b=n(o(7708)),v=n(o(4244));t.cssPrefix="selection-tool-";class y extends a.default{constructor(e,t){super(e.notifier,t),this.editor=e,this.removeSelectionScheduled=!1,this.startPoint=null,this.expandingSelectionBox=!1,this.shiftKeyPressed=!1,this.snapToGrid=!1,this.lastPointer=null,this.showContextMenu=async(e,t=!0)=>{await(0,f.default)(this.selectionBox,this.editor,e,t,(()=>this.clearSelection()))},this.selectionBoxHandlingEvt=!1,this.lastSelectedObjects=[],this.hasUnfinalizedTransformFromKeyPress=!1,this.modeValue=m.MutableReactiveValue.fromInitialValue(g.SelectionMode.Rectangle),this.modeValue.onUpdate((()=>{this.editor.notifier.dispatch(r.EditorEventType.ToolUpdated,{kind:r.EditorEventType.ToolUpdated,tool:this})})),this.autoscroller=new p.default(e.viewport,(t=>{if(e.dispatch(s.default.transformBy(i.Mat33.translation(t)),!1),this.lastPointer){const t=this.lastPointer.withScreenPosition(this.lastPointer.screenPos,e.viewport);this.onMainPointerUpdated(t)}})),this.handleOverlay=document.createElement("div"),e.createHTMLOverlay(this.handleOverlay),this.handleOverlay.style.display="none",this.handleOverlay.classList.add("handleOverlay"),e.notifier.on(r.EditorEventType.ViewportChanged,(e=>{this.editor.clearWetInk(),this.expandingSelectionBox||this.selectionBox?.padRegion(),this.selectionBox?.updateUI()})),this.editor.handleKeyEventsFrom(this.handleOverlay),this.editor.handlePointerEventsFrom(this.handleOverlay)}getSelectionColor(){const e=getComputedStyle(this.handleOverlay).getPropertyValue("--selection-background-color");return i.Color4.fromString(e).withAlpha(.5)}makeSelectionBox(e){this.prevSelectionBox=this.selectionBox,this.selectionBox=new d.default(e,this.editor,this.showContextMenu),this.expandingSelectionBox||this.prevSelectionBox?.cancelSelection(),this.selectionBox.addTo(this.handleOverlay)}onContextMenu(e){const t=this.selectionBox?.getScreenRegion()?.containsPoint(e.screenPos);return this.showContextMenu(e.canvasPos,t),!0}onPointerDown({allPointers:e,current:t}){const o=this.snapToGrid;if(o&&(t=t.snappedToGrid(this.editor.viewport)),1===e.length){this.startPoint=t.canvasPos;let e=!1;return this.selectionBox&&(o&&this.selectionBox.snapSelectedObjectsToGrid(),this.selectionBox.onDragStart(t)&&(e=!0,this.selectionBoxHandlingEvt=!0,this.expandingSelectionBox=!1)),e?this.autoscroller.start():(this.expandingSelectionBox=this.shiftKeyPressed,this.removeSelectionScheduled=!this.expandingSelectionBox,this.modeValue.get()===g.SelectionMode.Lasso?this.selectionBuilder=new b.default(t.canvasPos,this.editor.viewport):this.selectionBuilder=new v.default(t.canvasPos)),!0}return!1}onPointerMove(e){this.onMainPointerUpdated(e.current)}onMainPointerUpdated(e){if(this.lastPointer=e,this.removeSelectionScheduled&&(this.removeSelectionScheduled=!1,this.handleOverlay.replaceChildren(),this.prevSelectionBox=this.selectionBox,this.selectionBox=null),this.autoscroller.onPointerMove(e.screenPos),!this.expandingSelectionBox&&this.shiftKeyPressed&&this.startPoint){const t=this.editor.viewport.canvasToScreen(this.startPoint);e=e.lockedToXYAxesScreen(t,this.editor.viewport)}this.snapToGrid&&(e=e.snappedToGrid(this.editor.viewport)),this.selectionBoxHandlingEvt?this.selectionBox?.onDragUpdate(e):(this.selectionBuilder?.onPointerMove(e.canvasPos),this.editor.clearWetInk(),this.selectionBuilder?.render(this.editor.display.getWetInkRenderer(),this.getSelectionColor()))}onPointerUp(e){if(this.onMainPointerUpdated(e.current),this.autoscroller.stop(),this.selectionBoxHandlingEvt)this.selectionBox?.onDragEnd();else if(this.selectionBuilder){const e=this.selectionBuilder.resolve(this.editor.image,this.editor.viewport);this.selectionBuilder=null,this.editor.clearWetInk(),this.expandingSelectionBox&&this.selectionBox?this.setSelection([...this.selectionBox.getSelectedObjects(),...e]):this.setSelection(e)}this.expandingSelectionBox=!1,this.removeSelectionScheduled=!1,this.selectionBoxHandlingEvt=!1,this.lastPointer=null}onGestureCancel(){this.selectionBuilder&&(this.selectionBuilder=null,this.editor.clearWetInk()),this.autoscroller.stop(),this.selectionBoxHandlingEvt?this.selectionBox?.onDragCancel():this.removeSelectionScheduled||(this.selectionBox?.cancelSelection(),this.selectionBox=this.prevSelectionBox,this.selectionBox?.addTo(this.handleOverlay),this.selectionBox?.recomputeRegion(),this.prevSelectionBox=null),this.removeSelectionScheduled=!1,this.expandingSelectionBox=!1,this.lastPointer=null,this.selectionBoxHandlingEvt=!1}onSelectionUpdated(){const e=this.selectionBox?.getSelectedItemCount()??0,t=this.selectionBox?.getSelectedObjects()??[];(this.lastSelectedObjects.length!==e||t.some(((e,t)=>this.lastSelectedObjects[t]!==e)))&&(this.lastSelectedObjects=t,this.editor.notifier.dispatch(r.EditorEventType.ToolUpdated,{kind:r.EditorEventType.ToolUpdated,tool:this}),this.editor.notifier.dispatch(r.EditorEventType.SelectionUpdated,{kind:r.EditorEventType.SelectionUpdated,selectedComponents:t,tool:this}),e>0&&(this.editor.announceForAccessibility(this.editor.localization.selectedElements(e)),this.zoomToSelection())),0===e&&this.selectionBox&&(this.selectionBox.cancelSelection(),this.prevSelectionBox=this.selectionBox,this.selectionBox=null)}zoomToSelection(){if(this.selectionBox){const e=this.selectionBox.region;this.editor.dispatchNoAnnounce(this.editor.viewport.zoomTo(e,!1),!1)}}onKeyPress(e){const t=this.editor.shortcuts;if(t.matchesShortcut(u.snapToGridKeyboardShortcutId,e))return this.snapToGrid=!0,!0;if(this.selectionBox&&(t.matchesShortcut(u.duplicateSelectionShortcut,e)||t.matchesShortcut(u.sendToBackSelectionShortcut,e)))return!0;if(t.matchesShortcut(u.selectAllKeyboardShortcut,e))return this.setSelection(this.editor.image.getAllComponents()),!0;if(e.ctrlKey)return!1;if((e.shiftKey||"Shift"===e.key)&&(this.shiftKeyPressed=!0,"Shift"===e.key))return!0;let o=0,n=0,r=0,a=0,l=0;t.matchesShortcut(u.translateLeftSelectionShortcutId,e)?n-=1:t.matchesShortcut(u.translateRightSelectionShortcutId,e)?n+=1:t.matchesShortcut(u.translateUpSelectionShortcutId,e)?r-=1:t.matchesShortcut(u.translateDownSelectionShortcutId,e)?r+=1:t.matchesShortcut(u.rotateClockwiseSelectionShortcutId,e)?o+=1:t.matchesShortcut(u.rotateCounterClockwiseSelectionShortcutId,e)?o-=1:t.matchesShortcut(u.shrinkXSelectionShortcutId,e)?a-=1:t.matchesShortcut(u.stretchXSelectionShortcutId,e)?a+=1:t.matchesShortcut(u.shrinkYSelectionShortcutId,e)?l-=1:t.matchesShortcut(u.stretchYSelectionShortcutId,e)?l+=1:t.matchesShortcut(u.shrinkXYSelectionShortcutId,e)?(a-=1,l-=1):t.matchesShortcut(u.stretchXYSelectionShortcutId,e)&&(a+=1,l+=1);let c=0!==n||0!==r||0!==o||0!==a||0!==l;if(this.selectionBox){if(c){const e=10*this.editor.viewport.getSizeOfPixelOnCanvas(),t=Math.PI/8,c=5/4,d=this.selectionBox.region,h=i.Vec2.of(c**a,c**l),u=i.Mat33.zRotation(o*t).mapEntries((e=>s.default.roundScaleRatio(e))),p=this.editor.viewport.roundPoint(d.center),f=i.Mat33.scaling2D(h,this.editor.viewport.roundPoint(d.topLeft)).rightMul(i.Mat33.translation(p).rightMul(u).rightMul(i.Mat33.translation(p.times(-1)))).rightMul(i.Mat33.translation(this.editor.viewport.roundPoint(i.Vec2.of(n,r).times(e)))),m=this.selectionBox.getTransform();this.selectionBox.setTransform(m.rightMul(f)),this.selectionBox.scrollTo(),this.hasUnfinalizedTransformFromKeyPress=!0}}else c=!1;return!this.selectionBox||c||"Delete"!==e.key&&"Backspace"!==e.key||(this.editor.dispatch(this.selectionBox.deleteSelectedObjects()),this.clearSelection(),c=!0),c}onKeyUp(e){const t=this.editor.shortcuts;if(t.matchesShortcut(u.snapToGridKeyboardShortcutId,e))return this.snapToGrid=!1,!0;if(t.matchesShortcut(u.selectAllKeyboardShortcut,e))return!0;if(this.selectionBox&&t.matchesShortcut(u.duplicateSelectionShortcut,e))return this.selectionBox.duplicateSelectedObjects().then((e=>{this.editor.dispatch(e)})),!0;if(this.selectionBox&&t.matchesShortcut(u.sendToBackSelectionShortcut,e)){const e=this.selectionBox.sendToBack();return e&&this.editor.dispatch(e),!0}return!1===e.shiftKey&&(this.shiftKeyPressed=!1),"Shift"===e.key?(this.shiftKeyPressed=!1,!0):!this.hasUnfinalizedTransformFromKeyPress||!!this.selectionBox&&(this.selectionBox.finalizeTransform(),this.hasUnfinalizedTransformFromKeyPress=!1,!0)}onCopy(e){if(!this.selectionBox)return!1;const t=this.selectionBox.getSelectedObjects(),o=this.selectionBox.region;if(0===t.length)return!1;const n=new s.default((()=>{}));let r=this.selectionBox.getScreenRegion().size.times(this.editor.display.getDevicePixelRatio()).maximumEntryMagnitude()/(o.size.maximumEntryMagnitude()||1);r=Math.pow(2,Math.ceil(Math.log2(r))),n.updateScreenSize(o.size.times(r)),n.resetTransform(i.Mat33.scaling2D(r).rightMul(i.Mat33.translation(o.topLeft.times(-1))));const{element:a,renderer:d}=c.default.fromViewport(n,{sanitize:!0,useViewBoxForPositioning:!0}),{element:u,renderer:p}=l.default.fromViewport(n,{maxCanvasDimen:4096}),f=[];for(const e of t)e.render(d),e.render(p),e instanceof h.default&&f.push(e.getText());return e.setData("image/svg+xml",a.outerHTML),e.setData("text/html",a.outerHTML),e.setData("image/png",new Promise(((e,t)=>{u.toBlob((o=>{o?e(o):t(new Error("Failed to convert canvas to blob."))}),"image/png")}))),f.length>0&&e.setData("text/plain",f.join("\n")),!0}setEnabled(e){const t=this.isEnabled();super.setEnabled(e),t!==e&&(this.selectionBox?.cancelSelection(),this.onSelectionUpdated(),this.handleOverlay.replaceChildren(),this.selectionBox=null,this.shiftKeyPressed=!1,this.snapToGrid=!1,this.handleOverlay.style.display=e?"block":"none",e?(this.handleOverlay.tabIndex=0,this.handleOverlay.role="group",this.handleOverlay.ariaLabel=this.editor.localization.selectionToolKeyboardShortcuts):this.handleOverlay.tabIndex=-1)}getSelection(){return this.selectionBox}isSelecting(){return!!this.selectionBuilder}getSelectedObjects(){return this.selectionBox?.getSelectedObjects()??[]}setSelection(e){(e=e.filter((e=>e.isSelectable()))).sort(((e,t)=>e.getZIndex()-t.getZIndex())),e=e.filter(((t,o)=>!(o>0)||t!==e[o-1]));let t=null;for(const o of e)t=t?t.union(o.getBBox()):o.getBBox();this.clearSelectionNoUpdateEvent(),t&&this.makeSelectionBox(e),this.onSelectionUpdated()}clearSelectionNoUpdateEvent(){this.handleOverlay.replaceChildren(),this.prevSelectionBox=this.selectionBox,this.selectionBox=null}clearSelection(){this.clearSelectionNoUpdateEvent(),this.onSelectionUpdated()}}t.default=y},497:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=n(o(2560));t.default=class{constructor(e,t){this.viewport=e,this.scrollByCanvasDelta=t,this.started=!1,this.updateLoopId=0,this.updateLoopRunning=!1,this.targetPoint=null,this.scrollRate=1e3}getScrollForPoint(e){const t=this.viewport.getScreenRectSize(),o=new i.Rect2(0,0,t.x,t.y).grownBy(-44);if(o.containsPoint(e))return i.Vec2.zero;const n=o.getClosestPointOnBoundaryTo(e),r=n.distanceTo(e),s=n.minus(e),a=Math.min(r/44,1.25);return s.normalizedOrZero().times(a)}start(){this.started=!0}onPointerMove(e){this.started&&(this.getScrollForPoint(e)===i.Vec2.zero?this.stopUpdateLoop():(this.targetPoint=e,this.startUpdateLoop()))}stop(){this.targetPoint=null,this.started=!1,this.stopUpdateLoop()}startUpdateLoop(){this.updateLoopRunning||(async()=>{this.updateLoopId++;const e=this.updateLoopId;let t=performance.now();for(;this.updateLoopId===e&&this.targetPoint;){this.updateLoopRunning=!0;const e=performance.now(),o=e-t,n=this.getScrollForPoint(this.targetPoint).times(this.scrollRate*o/1e3);this.scrollByCanvasDelta(this.viewport.screenToCanvasTransform.transformVec3(n)),t=e,await(0,r.default)()}this.updateLoopRunning=!1})()}stopUpdateLoop(){this.updateLoopId++}}},6109:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RotateTransformer=t.ResizeTransformer=t.DragTransformer=void 0;const i=o(3755),r=n(o(4287)),s=o(711);t.DragTransformer=class{constructor(e,t){this.editor=e,this.selection=t}onDragStart(e){this.selection.setTransform(i.Mat33.identity),this.dragStartPoint=e}onDragUpdate(e){const t=this.editor.viewport.roundPoint(e.minus(this.dragStartPoint));this.selection.setTransform(i.Mat33.translation(t))}onDragEnd(){return this.selection.finalizeTransform()}},t.ResizeTransformer=class{constructor(e,t){this.editor=e,this.selection=t,this.mode=s.ResizeMode.Both}onDragStart(e,t){this.selection.setTransform(i.Mat33.identity),this.mode=t,this.dragStartPoint=e,this.computeOriginAndScaleRate()}computeOriginAndScaleRate(){const e=this.selection.preTransformRegion,t=e.corners;let o=0;for(let e=0;e<t.length;e++){const n=t[e],i=this.dragStartPoint.minus(n).magnitudeSquared();i>o&&(o=i,this.transformOrigin=n)}let n=1,r=1;this.transformOrigin.x>e.center.x&&(n=-1),this.transformOrigin.y>e.center.y&&(r=-1),this.scaleRate=i.Vec2.of(n,r)}onDragUpdate(e){const t=e.minus(this.dragStartPoint),o=this.selection.preTransformRegion.width,n=this.selection.preTransformRegion.height;let a=i.Vec2.of(1,1);if(this.mode===s.ResizeMode.HorizontalOnly){const e=o+t.x*this.scaleRate.x;a=i.Vec2.of(e/o,a.y)}if(this.mode===s.ResizeMode.VerticalOnly){const e=n+t.y*this.scaleRate.y;a=i.Vec2.of(a.x,e/n)}if(this.mode===s.ResizeMode.Both){const e=o+(Math.abs(t.x)>Math.abs(t.y)?t.x:t.y);a=i.Vec2.of(e/o,e/o)}if(a=a.map((e=>r.default.roundScaleRatio(e,2))),0!==a.x&&0!==a.y){const e=this.editor.viewport.roundPoint(this.transformOrigin);this.selection.setTransform(i.Mat33.scaling2D(a,e))}}onDragEnd(){return this.selection.finalizeTransform()}},t.RotateTransformer=class{constructor(e,t){this.editor=e,this.selection=t,this.startAngle=0,this.targetRotation=0,this.maximumDistFromStart=0}getAngle(e){const t=this.selection.preTransformRegion.center;return e.minus(t).angle()}roundAngle(e){const t=8/Math.PI;return Math.round(e*t)/t}onDragStart(e){this.startPoint=e,this.selection.setTransform(i.Mat33.identity),this.startAngle=this.getAngle(e),this.targetRotation=0,this.maximumDistFromStart=0,this.startTime=performance.now()}setRotationTo(e){const t=this.editor.viewport.roundPoint(this.selection.preTransformRegion.center),o=i.Mat33.zRotation(e).mapEntries((e=>r.default.roundScaleRatio(e))),n=i.Mat33.translation(t).rightMul(o).rightMul(i.Mat33.translation(t.times(-1)));this.selection.setTransform(n)}onDragUpdate(e){this.targetRotation=this.roundAngle(this.getAngle(e)-this.startAngle),this.setRotationTo(this.targetRotation);const t=e.minus(this.startPoint).magnitude();t>this.maximumDistFromStart&&(this.maximumDistFromStart=t)}onDragEnd(){return(performance.now()-this.startTime)/1e3<.4&&this.maximumDistFromStart<10&&0===this.targetRotation&&this.setRotationTo(-Math.PI/2),this.selection.finalizeTransform()}}},9979:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.stretchXYSelectionShortcutId=t.shrinkXYSelectionShortcutId=t.stretchYSelectionShortcutId=t.shrinkYSelectionShortcutId=t.stretchXSelectionShortcutId=t.shrinkXSelectionShortcutId=t.rotateClockwiseSelectionShortcutId=t.rotateCounterClockwiseSelectionShortcutId=t.translateDownSelectionShortcutId=t.translateUpSelectionShortcutId=t.translateRightSelectionShortcutId=t.translateLeftSelectionShortcutId=t.sendToBackSelectionShortcut=t.duplicateSelectionShortcut=t.selectAllKeyboardShortcut=void 0;const i=n(o(2451));t.selectAllKeyboardShortcut="jsdraw.tools.SelectionTool.selectAll",i.default.registerDefaultKeyboardShortcut(t.selectAllKeyboardShortcut,["CtrlOrMeta+KeyA"],"Select all"),t.duplicateSelectionShortcut="jsdraw.tools.SelectionTool.duplicateSelection",i.default.registerDefaultKeyboardShortcut(t.duplicateSelectionShortcut,["CtrlOrMeta+KeyD"],"Duplicate selection"),t.sendToBackSelectionShortcut="jsdraw.tools.SelectionTool.sendToBack",i.default.registerDefaultKeyboardShortcut(t.sendToBackSelectionShortcut,["End"],"Send to back"),t.translateLeftSelectionShortcutId="jsdraw.tools.SelectionTool.translateLeft",i.default.registerDefaultKeyboardShortcut(t.translateLeftSelectionShortcutId,["KeyA","KeyH","ArrowLeft"],"Move selection left"),t.translateRightSelectionShortcutId="jsdraw.tools.SelectionTool.translateRight",i.default.registerDefaultKeyboardShortcut(t.translateRightSelectionShortcutId,["KeyD","KeyL","ArrowRight"],"Move selection right"),t.translateUpSelectionShortcutId="jsdraw.tools.SelectionTool.translateUp",i.default.registerDefaultKeyboardShortcut(t.translateUpSelectionShortcutId,["KeyQ","KeyK","ArrowUp"],"Move selection up"),t.translateDownSelectionShortcutId="jsdraw.tools.SelectionTool.translateDown",i.default.registerDefaultKeyboardShortcut(t.translateDownSelectionShortcutId,["KeyE","KeyJ","ArrowDown"],"Move selection down"),t.rotateCounterClockwiseSelectionShortcutId="jsdraw.tools.SelectionTool.rotateCCW",i.default.registerDefaultKeyboardShortcut(t.rotateCounterClockwiseSelectionShortcutId,["Shift+KeyR"],"Rotate selection counter clockwise"),t.rotateClockwiseSelectionShortcutId="jsdraw.tools.SelectionTool.rotateCW",i.default.registerDefaultKeyboardShortcut(t.rotateClockwiseSelectionShortcutId,["KeyR"],"Rotate selection clockwise"),t.shrinkXSelectionShortcutId="jsdraw.tools.SelectionTool.shrink.x",i.default.registerDefaultKeyboardShortcut(t.shrinkXSelectionShortcutId,["KeyI"],"Decrease width"),t.stretchXSelectionShortcutId="jsdraw.tools.SelectionTool.stretch.x",i.default.registerDefaultKeyboardShortcut(t.stretchXSelectionShortcutId,["Shift+KeyI"],"Increase width"),t.shrinkYSelectionShortcutId="jsdraw.tools.SelectionTool.shrink.y",i.default.registerDefaultKeyboardShortcut(t.shrinkYSelectionShortcutId,["KeyO"],"Decrease height"),t.stretchYSelectionShortcutId="jsdraw.tools.SelectionTool.stretch.y",i.default.registerDefaultKeyboardShortcut(t.stretchYSelectionShortcutId,["Shift+KeyO"],"Increase height"),t.shrinkXYSelectionShortcutId="jsdraw.tools.SelectionTool.shrink.xy",i.default.registerDefaultKeyboardShortcut(t.shrinkXYSelectionShortcutId,["Comma"],"Decrease selection size"),t.stretchXYSelectionShortcutId="jsdraw.tools.SelectionTool.stretch.xy",i.default.registerDefaultKeyboardShortcut(t.stretchXYSelectionShortcutId,["Period"],"Increase selection size")},711:(e,t)=>{"use strict";var o,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.TransformMode=t.ResizeMode=t.SelectionMode=void 0,function(e){e.Lasso="lasso",e.Rectangle="rect"}(o||(t.SelectionMode=o={})),function(e){e[e.Both=0]="Both",e[e.HorizontalOnly=1]="HorizontalOnly",e[e.VerticalOnly=2]="VerticalOnly"}(n||(t.ResizeMode=n={})),function(e){e[e.Snap=0]="Snap",e[e.NoSnap=1]="NoSnap"}(i||(t.TransformMode=i={}))},5552:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(6414)),r=n(o(6682));t.default=e=>{const t=t=>{const o=(0,i.default)(e,{title:e.localization.copyPasteError__heading,classNames:["clipboard-error-dialog"]});o.appendChild(document.createTextNode(e.localization.copyPasteError__description));const n=document.createElement("details"),r=document.createElement("summary");return r.textContent=e.localization.copyPasteError__errorDetails,n.appendChild(r),n.appendChild(document.createTextNode(`Error: ${t}`)),o.appendChild(n),o};return{onCopyError(o){const n=t(o),i=document.createElement("label");i.textContent=e.localization.copyPasteError__copyRetry;const s=document.createElement("textarea");i.appendChild(s);const a=new r.default(e),l=e=>(e.preventDefault(),a.copy(e).then((()=>{n.close()})));s.oncopy=l,s.ondragstart=l,s.value=e.localization.copyPasteError__copyMe,n.appendChild(i),s.select(),document.execCommand("copy")},onPasteError(o){const n=t(o),i=document.createElement("label");i.textContent=e.localization.copyPasteError__pasteRetry;const s=document.createElement("textarea");i.appendChild(s);const a=new r.default(e),l=e=>(e.preventDefault(),a.paste(e).then((e=>{e&&n.close()})));s.onpaste=l,s.ondrop=l,n.appendChild(i),s.focus(),document.execCommand("paste")}}}},4476:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(5139)),r=n(o(6682)),s=n(o(5552));t.default=async(e,t,o,n,a)=>{const l=t.localization,c=e?.getSelectedItemCount()&&n,d=[{text:l.selectionMenu__paste,icon:()=>t.icons.makePasteIcon(),key:()=>{new r.default(t,(0,s.default)(t)).paste()}}],h=await(0,i.default)(t,o,c?[{text:l.selectionMenu__duplicate,icon:()=>t.icons.makeDuplicateSelectionIcon(),key:async()=>{await t.dispatch(await e.duplicateSelectedObjects())}},{text:l.selectionMenu__delete,icon:()=>t.icons.makeDeleteSelectionIcon(),key:async()=>{await t.dispatch(e.deleteSelectedObjects()),a()}},{text:l.selectionMenu__copyToClipboard,icon:()=>t.icons.makeCopyIcon(),key:()=>{new r.default(t,(0,s.default)(t)).copy()}},...d]:d);h?.()}},7882:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3755),r=n(o(9482));class s{constructor(){if(this.closed=!1,!window.AudioContext)return console.warn("Accessibility sound UI: Unable to open AudioContext."),void(this.closed=!0);this.ctx=new AudioContext,this.colorOscHue=this.ctx.createOscillator(),this.colorOscValue=this.ctx.createOscillator(),this.colorOscSaturation=this.ctx.createOscillator(),this.colorOscHue.type="triangle",this.colorOscSaturation.type="sine",this.colorOscValue.type="sawtooth",this.valueGain=this.ctx.createGain(),this.colorOscValue.connect(this.valueGain),this.valueGain.gain.setValueAtTime(.18,this.ctx.currentTime),this.colorGain=this.ctx.createGain(),this.colorOscHue.connect(this.colorGain),this.valueGain.connect(this.colorGain),this.colorOscSaturation.connect(this.colorGain),this.colorGain.connect(this.ctx.destination),this.boundaryGain=this.ctx.createGain(),this.boundaryOsc=this.ctx.createOscillator(),this.boundaryOsc.type="sawtooth",this.boundaryGain.gain.setValueAtTime(0,this.ctx.currentTime),this.boundaryOsc.connect(this.boundaryGain),this.boundaryGain.connect(this.ctx.destination),this.colorOscHue.start(),this.colorOscSaturation.start(),this.colorOscValue.start(),this.boundaryOsc.start(),this.pause()}pause(){this.closed||(this.colorGain.gain.setValueAtTime(0,this.ctx.currentTime),this.ctx.suspend())}play(){this.closed||this.ctx.resume()}setColor(e){const t=e.asHSV(),o=220*-Math.cos(t.x/2)+440,n=440*t.y+220,i=440*(t.z+.1),r=.25*Math.min(1,e.a)/(1+Math.exp(3*-(t.z-.5)));this.colorOscHue.frequency.setValueAtTime(o,this.ctx.currentTime),this.colorOscSaturation.frequency.setValueAtTime(n,this.ctx.currentTime),this.colorOscValue.frequency.setValueAtTime(i,this.ctx.currentTime),this.valueGain.gain.setValueAtTime(.4*(1-t.z),this.ctx.currentTime),this.colorGain.gain.setValueAtTime(r,this.ctx.currentTime)}announceBoundaryCross(e){this.boundaryGain.gain.cancelScheduledValues(this.ctx.currentTime),this.boundaryGain.gain.setValueAtTime(0,this.ctx.currentTime),this.boundaryGain.gain.linearRampToValueAtTime(.018,this.ctx.currentTime+.1),this.boundaryOsc.frequency.setValueAtTime(440+100*Math.atan(e/2),this.ctx.currentTime),this.boundaryGain.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.25)}close(){this.ctx.close(),this.closed=!0}}class a extends r.default{constructor(e,t){super(e.notifier,t),this.editor=e,this.soundFeedback=null,this.toggleButtonContainer=document.createElement("div"),this.toggleButtonContainer.classList.add("js-draw-sound-ui-toggle"),this.toggleButton=document.createElement("button"),this.toggleButton.onclick=()=>{this.setEnabled(!this.isEnabled())},this.toggleButtonContainer.appendChild(this.toggleButton),this.updateToggleButtonText(),e.createHTMLOverlay(this.toggleButtonContainer)}canReceiveInputInReadOnlyEditor(){return!0}updateToggleButtonText(){const e="sound-ui-tool-enabled";this.isEnabled()?(this.toggleButton.innerText=this.editor.localization.disableAccessibilityExploreTool,this.toggleButtonContainer.classList.add(e)):(this.toggleButton.innerText=this.editor.localization.enableAccessibilityExploreTool,this.toggleButtonContainer.classList.remove(e))}setEnabled(e){super.setEnabled(e),this.isEnabled()?this.editor.announceForAccessibility(this.editor.localization.soundExplorerUsageAnnouncement):(this.soundFeedback?.close(),this.soundFeedback=null),this.updateToggleButtonText()}onKeyPress(e){return"Escape"===e.code&&(this.setEnabled(!1),!0)}onPointerDown({current:e,allPointers:t}){return this.soundFeedback||(this.soundFeedback=new s),!(t.length>=2||(this.soundFeedback?.play(),this.soundFeedback?.setColor(this.editor.display.getColorAt(e.screenPos)??i.Color4.black),this.lastPointerPos=e.canvasPos,0))}onPointerMove({current:e}){this.soundFeedback?.setColor(this.editor.display.getColorAt(e.screenPos)??i.Color4.black);const t=new i.LineSegment2(this.lastPointerPos,e.canvasPos),o=this.editor.image.getComponentsIntersecting(t.bbox).filter((e=>e.intersects(t)));this.lastPointerPos=e.canvasPos,o.length>0&&this.soundFeedback?.announceBoundaryCross(o.length)}onPointerUp(e){this.soundFeedback?.pause()}onGestureCancel(){this.soundFeedback?.pause()}}t.default=a},5384:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(3332)),r=n(o(2709)),s=o(3755),a=o(7372),l=o(2572),c=n(o(9482)),d=n(o(3538)),h=n(o(1583)),u=o(5786),p="textEditorOverlay";class f extends c.default{constructor(e,t,o){super(e.notifier,t),this.editor=e,this.localizationTable=o,this.textInputElem=null,this.textMeasuringCtx=null,this.removeExistingCommand=null;const n=e.getCurrentSettings().text?.fonts??[];this.textStyleValue=u.ReactiveValue.fromInitialValue({size:32,fontFamily:n.length>0?n[0]:"sans-serif",renderingStyle:{fill:s.Color4.purple}}),this.textStyleValue.onUpdateAndNow((()=>{this.textStyle=this.textStyleValue.get(),this.updateTextInput(),this.editor.notifier.dispatch(l.EditorEventType.ToolUpdated,{kind:l.EditorEventType.ToolUpdated,tool:this})})),this.contentTransform=u.ReactiveValue.fromInitialValue(s.Mat33.identity),this.textEditOverlay=document.createElement("div"),this.textEditOverlay.classList.add(p),this.editor.addStyleSheet(`\n\t\t\t.${p} textarea {\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0);\n\n\t\t\t\twhite-space: pre;\n\t\t\t\toverflow: hidden;\n\n\t\t\t\tpadding: 0;\n\t\t\t\tmargin: 0;\n\t\t\t\tborder: none;\n\t\t\t\tpadding: 0;\n\n\t\t\t\tmin-width: 100px;\n\t\t\t\tmin-height: 1.1em;\n\t\t\t}\n\t\t`),this.anchorControl=this.editor.anchorElementToCanvas(this.textEditOverlay,this.contentTransform)}initTextMeasuringCanvas(){this.textMeasuringCtx??=document.createElement("canvas").getContext("2d")}getTextAscent(e,t){if(this.initTextMeasuringCanvas(),this.textMeasuringCtx){this.textMeasuringCtx.textBaseline="alphabetic",i.default.applyTextStyles(this.textMeasuringCtx,t);const o=this.textMeasuringCtx.measureText(e);return o.fontBoundingBoxAscent??o.actualBoundingBoxAscent}return 2*t.size/3}flushInput(e=!0){if(!this.textInputElem)return;const t=this.textEditOverlay.parentElement,o=s.Vec2.of(t?.scrollLeft??0,t?.scrollTop??0),n=this.textInputElem.value.trimEnd();if(this.textInputElem.value="",e){const e=this.textInputElem;this.textInputElem=null,e.remove()}if(""!==n){const e=o.times(-1),t=this.editor.viewport.screenToCanvasTransform.transformVec3(e),a=s.Mat33.translation(t),l=i.default.fromLines(n.split("\n"),a.rightMul(this.contentTransform.get()),this.textStyle),c=r.default.addComponent(l);this.removeExistingCommand?(this.removeExistingCommand.unapply(this.editor),this.editor.dispatch((0,h.default)([this.removeExistingCommand,c])),this.removeExistingCommand=null):this.editor.dispatch(c)}}updateTextInput(){if(!this.textInputElem)return;this.textInputElem.placeholder=this.localizationTable.enterTextToInsert,this.textInputElem.style.fontFamily=this.textStyle.fontFamily,this.textInputElem.style.fontStyle=this.textStyle.fontStyle??"",this.textInputElem.style.fontVariant=this.textStyle.fontVariant??"",this.textInputElem.style.fontWeight=this.textStyle.fontWeight??"",this.textInputElem.style.fontSize=`${this.textStyle.size}px`,this.textInputElem.style.color=this.textStyle.renderingStyle.fill.toHexString(),this.textInputElem.style.margin="0",this.textInputElem.style.width=`${this.textInputElem.scrollWidth}px`,this.textInputElem.style.height=`${this.textInputElem.scrollHeight}px`;const e=this.getTextAscent("Testing!",this.textStyle);this.textInputElem.style.transform=`translate(0, ${-e}px)`,this.textInputElem.style.transformOrigin="top left";const t=Math.floor(this.textStyle.size);this.textInputElem.style.lineHeight=`${t}px`}startTextInput(e,t){this.flushInput(),this.textInputElem=document.createElement("textarea"),this.textInputElem.value=t,this.textInputElem.style.display="inline-block";const o=this.editor.viewport.roundPoint(e),n=-this.editor.viewport.getRotationAngle(),i=s.Vec2.of(1,1).times(this.editor.viewport.getSizeOfPixelOnCanvas());this.contentTransform.set(s.Mat33.translation(o).rightMul(s.Mat33.zRotation(n)).rightMul(s.Mat33.scaling2D(i))),this.updateTextInput(),setTimeout((()=>this.updateTextInput()),0),this.textInputElem.oninput=()=>{this.textInputElem&&(this.textInputElem.style.width=`${this.textInputElem.scrollWidth}px`,this.textInputElem.style.height=`${this.textInputElem.scrollHeight}px`)},this.textInputElem.onblur=()=>{const e=this.textInputElem;this.flushInput(!1),this.textInputElem=null,e&&e.classList.add("-hiding"),setTimeout((()=>{e?.remove()}),0)},this.textInputElem.onkeyup=e=>{e.isComposing||("Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(this.textInputElem?.remove(),this.textInputElem=null,this.editor.focus(),this.removeExistingCommand?.unapply(this.editor),this.removeExistingCommand=null):(this.flushInput(),this.editor.focus()))},this.textEditOverlay.replaceChildren(this.textInputElem),setTimeout((()=>this.textInputElem?.focus()),0)}setEnabled(e){super.setEnabled(e),this.isEnabled()||this.flushInput(),this.textEditOverlay.style.display=e?"block":"none"}onPointerDown({current:e,allPointers:t}){if(e.device===a.PointerDevice.Eraser)return!1;if(1===t.length){const t=e.canvasPos,o=s.Vec2.of(4,4).times(this.editor.viewport.getSizeOfPixelOnCanvas()),n=s.Rect2.fromCorners(t.minus(o),t.plus(o));let r=this.editor.image.getComponentsIntersecting(n).filter((e=>e instanceof i.default));const a=this.editor.viewport.visibleRect;if(r=r.filter((e=>!e.getBBox().containsRect(a))),this.flushInput(),r.length>0){const e=r[r.length-1];this.setTextStyle(e.getTextStyle()),this.removeExistingCommand=new d.default([e]),this.removeExistingCommand.apply(this.editor),this.startTextInput(e.getBaselinePos(),e.getText()),this.contentTransform.set(e.getTransform()),this.updateTextInput()}else this.removeExistingCommand=null,this.startTextInput(e.canvasPos,"");return!0}return!1}onGestureCancel(){this.flushInput(),this.editor.focus()}setFontFamily(e){e!==this.textStyle.fontFamily&&this.textStyleValue.set({...this.textStyle,fontFamily:e})}setColor(e){e.eq(this.textStyle.renderingStyle.fill)||this.textStyleValue.set({...this.textStyle,renderingStyle:{...this.textStyle.renderingStyle,fill:e}})}setFontSize(e){e!==this.textStyle.size&&this.textStyleValue.set({...this.textStyle,size:e})}getTextStyle(){return this.textStyle}getStyleValue(){return this.textStyleValue}setTextStyle(e){this.textStyleValue.set(e)}onDestroy(){super.onDestroy(),this.anchorControl.remove()}}t.default=f},5819:function(e,t,o){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&i(t,e,o[s]);return r(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(2572),c=o(3755),d=s(o(1801)),h=a(o(3822)),u=a(o(1627)),p=a(o(6953)),f=a(o(8522)),m=a(o(1477)),g=a(o(5384)),b=a(o(776)),v=a(o(5638)),y=a(o(2408)),w=a(o(3914)),x=o(1664),S=a(o(1196)),T=a(o(3931)),C=a(o(7882)),P=o(4892),k=a(o(7966)),E=a(o(5117)),z=a(o(7705));t.default=class{constructor(e,t){this.activeTool=null,this.isEditorReadOnly=e.isReadOnlyReactiveValue(),this.inputPipeline=new k.default,this.inputPipeline.setEmitListener((e=>this.onEventInternal(e)));const o=new u.default;this.primaryToolGroup=o;const n=new d.default(e,d.PanZoomMode.TwoFingerTouchGestures|d.PanZoomMode.RightClickDrags,t.touchPanTool),i=new d.default(e,d.PanZoomMode.Keyboard,t.keyboardPanZoom),r=new h.default(e,t.penTool(1),{color:c.Color4.purple,thickness:8}),s=new h.default(e,t.penTool(2),{color:c.Color4.clay,thickness:4});s.setInputMapper(new E.default(e.viewport));const a=new p.default(e,t.eraserTool),P=[r,s,new h.default(e,t.penTool(3),{color:c.Color4.ofRGBA(1,1,0,.5),thickness:40,factory:x.makePressureSensitiveFreehandLineBuilder}),a,new f.default(e,t.selectionTool),new g.default(e,t.textTool,t),new d.default(e,d.PanZoomMode.SinglePointerGestures,t.anyDevicePanning)],_=new C.default(e,t.soundExplorer);_.setEnabled(!1),this.tools=[new z.default(e),new b.default(e,t.pipetteTool),_,n,...P,i,new m.default(e),new w.default(e),new v.default(e),a.makeEraserSwitcherTool(),new S.default(e),new y.default(e),new T.default(e)],P.forEach((e=>e.setToolGroup(o))),n.setEnabled(!0),r.setEnabled(!0),e.notifier.on(l.EditorEventType.ToolEnabled,(o=>{o.kind===l.EditorEventType.ToolEnabled&&e.announceForAccessibility(t.toolEnabledAnnouncement(o.tool.description))})),e.notifier.on(l.EditorEventType.ToolDisabled,(o=>{o.kind===l.EditorEventType.ToolDisabled&&e.announceForAccessibility(t.toolDisabledAnnouncement(o.tool.description))})),this.activeTool=null}setTools(e,t){this.tools=e,this.primaryToolGroup=t??new u.default}addPrimaryTool(e){e.setToolGroup(this.primaryToolGroup),e.isEnabled()&&this.primaryToolGroup.notifyEnabled(e),this.tools.includes(e)||this.addTool(e)}getPrimaryTools(){return this.tools.filter((e=>e.getToolGroup()===this.primaryToolGroup))}addTool(e,t){this.tools.includes(e)||(t?.addToFront?this.tools.splice(0,0,e):this.tools.push(e))}removeAndDestroyTools(e){const t=[];for(const o of this.tools)e.includes(o)?(this.activeTool===o&&(this.activeTool=null),o.onDestroy()):t.push(o);this.tools=t}insertTools(e,t,o){this.tools=this.tools.filter((e=>!t.includes(e)));const n=[];for(const i of this.tools)"after"===o&&n.push(i),i===e&&n.push(...t),"before"===o&&n.push(i);this.tools=n}insertToolsAfter(e,t){this.insertTools(e,t,"after")}insertToolsBefore(e,t){this.insertTools(e,t,"before")}onEventInternal(e){const t=this.isEditorReadOnly.get(),o=e=>e.isEnabled()&&(!t||e.canReceiveInputInReadOnlyEditor());let n=!1;if(e.kind===P.InputEvtType.PointerDownEvt){let t=!1;this.activeTool&&!this.activeTool.eventCanBeDeliveredToNonActiveTool(e)&&(t=!0);for(const i of this.tools)if((!t||i===this.activeTool)&&o(i)&&i.onEvent(e)){this.activeTool!==i&&this.activeTool?.onEvent({kind:P.InputEvtType.GestureCancelEvt}),this.activeTool=i,n=!0;break}}else if(e.kind===P.InputEvtType.PointerUpEvt){const t=this.activeTool?.onEvent(e);t&&e.allPointers.length>1||(this.activeTool=null),n=!0}else if(e.kind===P.InputEvtType.PointerMoveEvt)null!==this.activeTool&&(this.activeTool.onEvent(e),n=!0);else if(e.kind===P.InputEvtType.GestureCancelEvt)null!==this.activeTool&&(this.activeTool.onEvent(e),this.activeTool=null);else for(const t of this.tools)if(o(t)&&(n=t.onEvent(e),n))break;return n}onEvent(e){return this.dispatchInputEvent(e)}dispatchInputEvent(e){return this.inputPipeline.onEvent(e)}addInputMapper(e){this.inputPipeline.addToTail(e)}getMatchingTools(e){return this.tools.filter((t=>t instanceof e))}onEditorDestroyed(){for(const e of this.tools)e.onDestroy()}}},1627:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){}notifyEnabled(e){e!==this.activeTool&&(this.activeTool?.setEnabled(!1),this.activeTool=e)}}},5638:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(9482));class r extends i.default{constructor(e){super(e.notifier,e.localization.changeTool),this.editor=e}canReceiveInputInReadOnlyEditor(){return!0}onKeyPress({key:e}){const t=this.editor.toolController.getPrimaryTools(),o=/^[0-9]$/.exec(e);let n;return o&&(n=t[parseInt(o[0],10)-1]),!!n&&(n.setEnabled(!0),!0)}}t.default=r},3914:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(9482));class r extends i.default{constructor(e){super(e.notifier,e.localization.changeTool),this.listeners=new Set([])}registerListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}onKeyPress(e){const t=Array.from(this.listeners.values());for(const o of t)if(o(e))return!0;return!1}}t.default=r},1477:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(9482)),r=o(2916);class s extends i.default{constructor(e){super(e.notifier,e.localization.undoRedoTool),this.editor=e}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(r.undoKeyboardShortcutId,e)?(this.editor.history.undo(),!0):!!this.editor.shortcuts.matchesShortcut(r.redoKeyboardShortcutId,e)&&(this.editor.history.redo(),!0)}}t.default=s},2916:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.zoomOutKeyboardShortcutId=t.zoomInKeyboardShortcutId=t.rotateCounterClockwiseKeyboardShortcutId=t.rotateClockwiseKeyboardShortcutId=t.moveDownKeyboardShortcutId=t.moveUpKeyboardShortcutId=t.moveRightKeyboardShortcutId=t.moveLeftKeyboardShortcutId=t.toggleFindVisibleShortcutId=t.lineLockKeyboardShortcutId=t.snapToGridKeyboardShortcutId=t.decreaseSizeKeyboardShortcutId=t.increaseSizeKeyboardShortcutId=t.redoKeyboardShortcutId=t.undoKeyboardShortcutId=void 0;const s=r(o(2451));t.undoKeyboardShortcutId="jsdraw.tools.undo",t.redoKeyboardShortcutId="jsdaw.tools.redo",s.default.registerDefaultKeyboardShortcut(t.undoKeyboardShortcutId,["CtrlOrMeta+KeyZ"],"Undo"),s.default.registerDefaultKeyboardShortcut(t.redoKeyboardShortcutId,["CtrlOrMeta+Shift+KeyZ","CtrlOrMeta+KeyY"],"Redo"),t.increaseSizeKeyboardShortcutId="jsdraw.tools.increaseSize",s.default.registerDefaultKeyboardShortcut(t.increaseSizeKeyboardShortcutId,["Equal","Shift+Equal"],"Increase pen/eraser size"),t.decreaseSizeKeyboardShortcutId="jsdraw.tools.decreaseSize",s.default.registerDefaultKeyboardShortcut(t.decreaseSizeKeyboardShortcutId,["Minus","Shift+Minus"],"Decrease pen/eraser size"),t.snapToGridKeyboardShortcutId="jsdraw.tools.snapToGrid",s.default.registerDefaultKeyboardShortcut(t.snapToGridKeyboardShortcutId,["Control","Meta"],"Snap to grid (press and hold)"),t.lineLockKeyboardShortcutId="jsdraw.tools.lockToLine",s.default.registerDefaultKeyboardShortcut(t.lineLockKeyboardShortcutId,["Shift"],"Snap to XY axes (press and hold)"),t.toggleFindVisibleShortcutId="js-draw.tools.FindTool.toggleVisible",s.default.registerDefaultKeyboardShortcut(t.toggleFindVisibleShortcutId,["CtrlOrMeta+KeyF"],"Shows/hides the find tool"),t.moveLeftKeyboardShortcutId="jsdraw.tools.PanZoom.moveLeft",s.default.registerDefaultKeyboardShortcut(t.moveLeftKeyboardShortcutId,["ArrowLeft","KeyH","KeyA"],"Pan left"),t.moveRightKeyboardShortcutId="jsdraw.tools.PanZoom.moveRight",s.default.registerDefaultKeyboardShortcut(t.moveRightKeyboardShortcutId,["ArrowRight","KeyL","KeyD"],"Pan right"),t.moveUpKeyboardShortcutId="jsdraw.tools.PanZoom.moveUp",s.default.registerDefaultKeyboardShortcut(t.moveUpKeyboardShortcutId,["ArrowUp","KeyK","KeyQ"],"Pan up"),t.moveDownKeyboardShortcutId="jsdraw.tools.PanZoom.moveDown",s.default.registerDefaultKeyboardShortcut(t.moveDownKeyboardShortcutId,["ArrowDown","KeyJ","KeyE"],"Pan down"),t.rotateClockwiseKeyboardShortcutId="jsdraw.tools.PanZoom.rotateViewClockwise",s.default.registerDefaultKeyboardShortcut(t.rotateClockwiseKeyboardShortcutId,["Shift+KeyR"],"Rotate viewport clockwise"),t.rotateCounterClockwiseKeyboardShortcutId="jsdraw.tools.PanZoom.rotateViewCounterClockwise",s.default.registerDefaultKeyboardShortcut(t.rotateCounterClockwiseKeyboardShortcutId,["KeyR"],"Rotate viewport counter-clockwise"),t.zoomInKeyboardShortcutId="jsdraw.tools.PanZoom.zoomIn",s.default.registerDefaultKeyboardShortcut(t.zoomInKeyboardShortcutId,["KeyW"],"Zoom in"),t.zoomOutKeyboardShortcutId="jsdraw.tools.PanZoom.zoomOut",s.default.registerDefaultKeyboardShortcut(t.zoomOutKeyboardShortcutId,["KeyS"],"Zoom out"),i(o(9979),t)},3306:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarShortcutHandler=t.SoundUITool=t.PasteHandler=t.EraserMode=t.EraserTool=t.SelectAllShortcutHandler=t.SelectionMode=t.SelectionTool=t.TextTool=t.PenTool=t.PanZoomMode=t.PanZoomTool=t.ToolSwitcherShortcut=t.UndoRedoShortcut=t.ToolEnabledGroup=t.ToolController=t.BaseTool=t.InputMapper=void 0;var i=o(8453);Object.defineProperty(t,"InputMapper",{enumerable:!0,get:function(){return n(i).default}});var r=o(9482);Object.defineProperty(t,"BaseTool",{enumerable:!0,get:function(){return n(r).default}});var s=o(5819);Object.defineProperty(t,"ToolController",{enumerable:!0,get:function(){return n(s).default}});var a=o(1627);Object.defineProperty(t,"ToolEnabledGroup",{enumerable:!0,get:function(){return n(a).default}});var l=o(1477);Object.defineProperty(t,"UndoRedoShortcut",{enumerable:!0,get:function(){return n(l).default}});var c=o(5638);Object.defineProperty(t,"ToolSwitcherShortcut",{enumerable:!0,get:function(){return n(c).default}});var d=o(1801);Object.defineProperty(t,"PanZoomTool",{enumerable:!0,get:function(){return n(d).default}}),Object.defineProperty(t,"PanZoomMode",{enumerable:!0,get:function(){return d.PanZoomMode}});var h=o(3822);Object.defineProperty(t,"PenTool",{enumerable:!0,get:function(){return n(h).default}});var u=o(5384);Object.defineProperty(t,"TextTool",{enumerable:!0,get:function(){return n(u).default}});var p=o(8522);Object.defineProperty(t,"SelectionTool",{enumerable:!0,get:function(){return n(p).default}}),Object.defineProperty(t,"SelectionMode",{enumerable:!0,get:function(){return p.SelectionMode}});var f=o(3931);Object.defineProperty(t,"SelectAllShortcutHandler",{enumerable:!0,get:function(){return n(f).default}});var m=o(6953);Object.defineProperty(t,"EraserTool",{enumerable:!0,get:function(){return n(m).default}}),Object.defineProperty(t,"EraserMode",{enumerable:!0,get:function(){return m.EraserMode}});var g=o(2408);Object.defineProperty(t,"PasteHandler",{enumerable:!0,get:function(){return n(g).default}});var b=o(7882);Object.defineProperty(t,"SoundUITool",{enumerable:!0,get:function(){return n(b).default}});var v=o(3914);Object.defineProperty(t,"ToolbarShortcutHandler",{enumerable:!0,get:function(){return n(v).default}})},844:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultToolLocalization=void 0,t.defaultToolLocalization={penTool:e=>`Pen ${e}`,selectionTool:"Selection",selectAllTool:"Select all shortcut",eraserTool:"Eraser",touchPanTool:"Touch panning",twoFingerPanZoomTool:"Panning and zooming",undoRedoTool:"Undo/Redo",rightClickDragPanTool:"Right-click drag",pipetteTool:"Pick color from screen",keyboardPanZoom:"Keyboard pan/zoom shortcuts",selectionMenu__show:"Show selection menu",selectionMenu__copyToClipboard:"Copy to clipboard",selectionMenu__duplicate:"Duplicate",selectionMenu__delete:"Delete",selectionMenu__paste:"Paste",copyPasteError__heading:"Copy/paste",copyPasteError__description:"Something went wrong — this tool may not have clipboard access.",copyPasteError__errorDetails:"Show error",copyPasteError__pasteRetry:"To retry, please paste into the input box below:",copyPasteError__copyRetry:"To retry, please copy the text in the input box below:",copyPasteError__copyMe:"Copy me!",autocorrectedTo:e=>`Autocorrected to ${e}`,autocorrectionCanceled:"Autocorrect cancelled",textTool:"Text",enterTextToInsert:"Text to insert",changeTool:"Change tool",pasteHandler:"Copy paste handler",soundExplorer:"Sound-based image exploration",disableAccessibilityExploreTool:"Disable sound-based exploration",enableAccessibilityExploreTool:"Enable sound-based exploration",soundExplorerUsageAnnouncement:"Sound-based image exploration enabled: Click/drag the screen to play a sound representation of different parts of the image.",findLabel:"Find",toNextMatch:"Next",closeDialog:"Close",findDialogShown:"Find dialog shown",findDialogHidden:"Find dialog hidden",focusedFoundText:(e,t)=>`Viewing match ${e} of ${t}`,anyDevicePanning:"Any device panning",copied:e=>`Copied ${e} item(s)`,pasted:e=>`Pasted ${e} item(s)`,toolEnabledAnnouncement:e=>`${e} enabled`,toolDisabledAnnouncement:e=>`${e} disabled`}},6761:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultStationaryDetectionConfig=void 0;const n=o(3755);t.defaultStationaryDetectionConfig={maxSpeed:8.5,maxRadius:11,minTimeSeconds:.5},t.default=class{constructor(e,t,o){this.config=t,this.onStationary=o,this.timeout=null,this.stationaryStartPointer=e,this.lastPointer=e,this.averageVelocity=n.Vec2.zero,this.setStationaryTimeout(1e3*this.config.minTimeSeconds)}onPointerMove(e){if(!this.stationaryStartPointer)return;if(e.id!==this.stationaryStartPointer.id)return!1;const t=e.screenPos.minus(this.lastPointer.screenPos),o=e.screenPos.minus(this.stationaryStartPointer.screenPos);let n=(e.timeStamp-this.lastPointer.timeStamp)/1e3;0===n&&(n=1);const i=t.times(1/n);this.averageVelocity=this.averageVelocity.lerp(i,.5);const r=e.timeStamp-this.stationaryStartPointer.timeStamp,s=o.length()>this.config.maxRadius;if(this.hasMovedOutOfRadius||=s,s||this.averageVelocity.length()>this.config.maxSpeed||r<this.config.minTimeSeconds)return this.stationaryStartPointer=e,this.lastPointer=e,this.setStationaryTimeout(1e3*this.config.minTimeSeconds),!1;const a=1e3*this.config.minTimeSeconds-r;return this.lastPointer=e,a<=0}onPointerUp(e){e.id!==this.stationaryStartPointer?.id&&this.cancelStationaryTimeout()}destroy(){this.cancelStationaryTimeout(),this.stationaryStartPointer=null}getHasMovedOutOfRadius(){return this.hasMovedOutOfRadius}cancelStationaryTimeout(){null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}setStationaryTimeout(e){null===this.timeout&&(e<=0?this.onStationary(this.lastPointer):this.timeout=setTimeout((()=>{if(this.timeout=null,!this.stationaryStartPointer)return;const e=performance.now()-this.stationaryStartPointer.timeStamp,t=1e3*this.config.minTimeSeconds-e;t<=0?this.onStationary(this.lastPointer):this.setStationaryTimeout(t)}),e))}}},5139:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(3591)),r=o(2572);let s=0;t.default=async(e,t,o)=>{const n=document.createElement("div"),{remove:a}=e.createHTMLOverlay(n),l=document.createElement("dialog");l.classList.add("editor-popup-menu"),l.style.setProperty("--hide-menu-animation-timeout","240ms");const c=()=>{const o=e.getOutputBBoxInDOM(),n=e.viewport.canvasToScreen(t).plus(o.topLeft);l.style.setProperty("--anchor-x",`${n.x}px`),l.style.setProperty("--anchor-y",`${n.y}px`)};c();const d=e.notifier.on(r.EditorEventType.ViewportChanged,c);n.appendChild(l);let h=!1;const u=async()=>{h||(h=!0,d.remove(),l.classList.add("-hide"),await(0,i.default)(240),l.close())};return new Promise((t=>{let n=!1,i=null;const r=()=>{n||(t(i),n=!0)};l.onclose=()=>{a(),r()},e.handlePointerEventsExceptClicksFrom(l,((e,t)=>t.target===l&&"pointerdown"===e?(u(),!0):!!h),((e,t)=>t.target===l));const c=document.createElement("div");c.classList.add("content"),c.role="menu";const d=[];c.addEventListener("keydown",(e=>{const t=d.findIndex((e=>e===document.activeElement));if(-1===t)return;let o=t;"ArrowDown"===e.key?o++:"ArrowUp"===e.key?o--:"End"===e.key?o=d.length-1:"Home"===e.key&&(o=0),o<0&&(o+=d.length),o%=d.length,o!==t&&(e.preventDefault(),d[o].focus())}));for(const e of o){const t=document.createElement("button");t.id="menu-overlay-option-"+s++,t.role="menuitem",t.classList.add("option","editor-popup-menu-option"),t.replaceChildren(e.icon(),document.createTextNode(e.text)),t.onclick=t=>{var o;t.defaultPrevented||(o=e.key,i=o,u(),r())},c.appendChild(t),0===d.length&&(t.autofocus=!0),d.push(t)}l.appendChild(c),l.showModal(),c.scrollIntoView({block:"nearest"})}))}},2572:(e,t)=>{"use strict";var o,n;Object.defineProperty(t,"__esModule",{value:!0}),t.UndoEventType=t.EditorEventType=void 0,function(e){e[e.ToolEnabled=0]="ToolEnabled",e[e.ToolDisabled=1]="ToolDisabled",e[e.ToolUpdated=2]="ToolUpdated",e[e.UndoRedoStackUpdated=3]="UndoRedoStackUpdated",e[e.CommandDone=4]="CommandDone",e[e.CommandUndone=5]="CommandUndone",e[e.ObjectAdded=6]="ObjectAdded",e[e.ViewportChanged=7]="ViewportChanged",e[e.DisplayResized=8]="DisplayResized",e[e.SelectionUpdated=9]="SelectionUpdated",e[e.ReadOnlyModeToggled=10]="ReadOnlyModeToggled",e[e.ColorPickerToggled=11]="ColorPickerToggled",e[e.ColorPickerColorSelected=12]="ColorPickerColorSelected",e[e.ToolbarDropdownShown=13]="ToolbarDropdownShown"}(o||(t.EditorEventType=o={})),function(e){e[e.CommandDone=0]="CommandDone",e[e.CommandUndone=1]="CommandUndone",e[e.CommandRedone=2]="CommandRedone"}(n||(t.UndoEventType=n={}))},6682:function(e,t,o){"use strict";var n,i=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},r=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(4892),l=s(o(7311)),c=e=>e.endsWith("+xml")||e.startsWith("text/");n=new WeakMap,t.default=class{constructor(e,t){this.editor=e,this.callbacks=t,n.set(this,!1)}paste(e){const t=e=>{if(this.callbacks?.onPasteError)return this.callbacks.onPasteError(e),Promise.resolve(!1);throw e};try{return this.pasteInternal(e).catch(t)}catch(e){return t(e)}}async pasteInternal(e){const t=this.editor,o=e?.dataTransfer??e?.clipboardData??null,n=!!o,i=(e,o)=>o&&t.toolController.dispatchInputEvent({kind:a.InputEvtType.PasteEvent,mime:e,data:o}),r=["image/svg+xml","text/html","image/png","image/jpeg","text/plain"];let s=[];const d=new Map,h=t.getCurrentSettings();if(n){s=[...o.files];for(const e of r){const t=o.getData(e);t&&d.set(e,t)}}else if(h.clipboardApi){const e=await h.clipboardApi.read();for(const[t,o]of e.entries())if("string"==typeof o)d.set(t,o);else{let e=o;e.type!==t&&(e=new Blob([e],{type:t})),s.push(e)}}else{const e=await navigator.clipboard.read();for(const t of e)for(const e of t.types)r.includes(e)&&s.push(await t.getType(e))}const u=async o=>{const n=c(o);if(n){const t=d.get(o);if(i(o,t))return e?.preventDefault(),!0}for(const r of s){const s=r?.type?.toLowerCase();if(s===o)if(n){const t=await r.text();if(i(o,t))return e?.preventDefault(),!0}else{t.showLoadingWarning(0);const n=e=>{t.showLoadingWarning(e.loaded/e.total)};try{const s=await(0,l.default)(r,{onprogress:n});if(i(o,s))return e?.preventDefault(),t.hideLoadingWarning(),!0}catch(e){console.error("Error reading image:",e)}t.hideLoadingWarning()}}return!1};for(const e of r)if(await u(e))return!0;return!1}copy(e){const t=e=>{if(this.callbacks?.onCopyError)return this.callbacks.onCopyError(e),Promise.resolve();throw e};try{return this.copyInternal(e).catch(t)}catch(e){return t(e)}}copyInternal(e){const t=new Map;this.editor.toolController.dispatchInputEvent({kind:a.InputEvtType.CopyEvent,setData:(e,o)=>{t.set(e,o)}})&&e?.preventDefault();const o=[...t.keys()].some((e=>!c(e))),s=o=>{if(!e)throw new Error("Unable to copy -- no event provided"+(o?`. Original error: ${o}`:""));for(const[o,n]of t.entries())"string"==typeof n&&("clipboardData"in e?e.clipboardData?.setData(o,n):e.dataTransfer?.setData(o,n))},l="undefined"!=typeof ClipboardItem&&void 0!==navigator?.clipboard?.write,d=!i(this,n,"f")&&l&&(o||!e),h=this.editor.getCurrentSettings();if(d&&h.clipboardApi)return h.clipboardApi.write(t)??Promise.resolve();if(d){let e=null;const o=e=>{console.warn("Unable to copy to the clipboard API. Future calls to .copy will use ClipboardEvents if possible.",e),r(this,n,!0,"f"),s(e)};try{e=(()=>{const e=(e=>{const t=Object.create(null);for(const[o,n]of Object.entries(e))"supports"in ClipboardItem&&"function"==typeof ClipboardItem.supports&&!ClipboardItem.supports(o)||(t[o]=n);return t})((e=>{const t=Object.create(null);for(const[o,n]of e.entries()){if("string"==typeof n){const e=new Blob([(new TextEncoder).encode(n)],{type:o});t[o]=e}else t[o]=n;"image/svg+xml"===o&&(t["text/html"]??=t[o])}return t})(t));return navigator.clipboard.write([new ClipboardItem(e)])})()}catch(e){o(e)}if(e)return e.catch(o)}else s();return Promise.resolve()}}},5786:function(e,t){"use strict";var o,n,i=this&&this.__classPrivateFieldSet||function(e,t,o,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,o):i?i.value=o:t.set(e,o),o},r=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.MutableReactiveValue=t.ReactiveValue=void 0;const s={remove(){}},a=()=>s;class l{waitForNextUpdate(){return new Promise((e=>{const t=this.onUpdate((o=>{t.remove(),e(o)}))}))}static fromInitialValue(e){return new d(e)}static fromImmutable(e){return{get:()=>e,onUpdate:a,onUpdateAndNow:t=>(t(e),s),waitForNextUpdate:()=>new Promise((()=>{}))}}static fromCallback(e,t){const o=new d(e()),n="undefined"!=typeof WeakRef?new WeakRef(o):{deref:()=>o};for(const o of t){const t=o.onUpdate((()=>{const o=n.deref();o?o.set(e()):t.remove()}))}return o}static map(e,t,o){const n=l.fromInitialValue(t(e.get()));let i=n.get();return e.onUpdate((e=>{i=t(e),n.set(i)})),o&&n.onUpdate((t=>{t!==i&&e.set(o(t))})),n}static union(e){return l.fromCallback((()=>e.map((e=>e.get()))),e)}}t.ReactiveValue=l;class c extends l{static fromProperty(e,t){const o=l.fromInitialValue(e.get()[t]),n="undefined"!=typeof WeakRef?new WeakRef(o):{deref:()=>o},i=e.onUpdate((e=>{const o=n.deref();o?o.set(e[t]):i.remove()}));return o.onUpdate((o=>{e.set({...e.get(),[t]:o})})),o}}t.MutableReactiveValue=c;class d extends c{constructor(e){super(),o.set(this,void 0),n.set(this,void 0),i(this,o,e,"f"),i(this,n,[],"f")}set(e){if(r(this,o,"f")!==e){i(this,o,e,"f");for(const t of r(this,n,"f"))t(e)}}get(){return r(this,o,"f")}onUpdate(e){return r(this,n,"f").push(e),{remove:()=>{i(this,n,r(this,n,"f").filter((t=>t!==e)),"f")}}}onUpdateAndNow(e){return e(this.get()),this.onUpdate(e)}}o=new WeakMap,n=new WeakMap,t.default=l},7026:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(5902));t.default=(e,t)=>{const o="has-long-press-or-hover",n="no-long-press-or-hover";e.classList.add("no-long-press-or-hover");const{removeListeners:r}=(0,i.default)(e,{onStart(){e.classList.remove(n),e.classList.add(o)},onEnd(){e.classList.add(n),e.classList.remove(o)},longPressTimeout:t?.timeout});return{removeEventListeners:()=>{e.classList.remove(n),r()}}}},1880:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755);t.default=(e,t)=>{const o=e.getRootElement(),i=[["--background-color-1","--foreground-color-1",!0,!0],["--background-color-2","--foreground-color-2",!0,!0],["--background-color-3","--foreground-color-3",!0,!0],["--background-color-2","--primary-action-foreground-color",!1,!0],["--selection-background-color","--selection-foreground-color",!1,!0]];if(!t?.dontClearOverrides)for(const[e,t]of i)o.style.setProperty(e,null),o.style.setProperty(t,null);const r=getComputedStyle(o),s=Object.create(null),a=(e,t,i,a,l)=>{let c=s[e]?s[e]:n.Color4.fromString(r.getPropertyValue(e)),d=s[t]?s[t]:n.Color4.fromString(r.getPropertyValue(t));if(c.relativeLuminance()<d.relativeLuminance()){const o=c;c=d,d=o;const n=t;t=e,e=n;const i=a;a=l,l=i}let h=!1,u=n.Color4.contrastRatio(c,d),p=0;for(;u<i&&p<8;){const e=n.Vec3.of(.1,.1,.1);a&&(d.eq(n.Color4.white)&&!l&&(d=n.Color4.black),c=n.Color4.fromRGBVector(c.rgb.plus(e))),l&&(d.eq(n.Color4.black)&&!a&&(d=n.Color4.white),d=n.Color4.fromRGBVector(d.rgb.minus(e))),u=n.Color4.contrastRatio(c,d),h=!0,p++}h&&(o.style.setProperty(e,c.toHexString()),o.style.setProperty(t,d.toHexString()),s[e]=c,s[t]=d)};a("--selection-background-color","--background-color-2",1.29,!0,!1);for(const[e,t,o,n]of i)a(e,t,4.5,o,n)}},5673:(e,t)=>{"use strict";function o(e,t=!1){if("number"!=typeof e||!t&&isNaN(e))throw new Error("Given value is not a number")}function n(e){if("string"!=typeof e)throw new Error("Given value is not a string")}function i(e){if(!Array.isArray(e))throw new Error("Asserting isArray: Given entity is not an array")}Object.defineProperty(t,"__esModule",{value:!0}),t.assertUnreachable=function(e){throw new Error(`Should be unreachable. Key: ${e}.`)},t.assertIsNumber=o,t.assertIsString=n,t.assertIsArray=i,t.assertIsNumberArray=function(e,t=!1){i(e),o(e.length);for(const n of e)o(n,t)},t.assertIsStringArray=function(e){i(e),o(e.length);for(const t of e)n(t)},t.assertIsBoolean=function(e){if("boolean"!=typeof e)throw new Error("Given value is not a boolean")},t.assertTruthy=function(e){if(!e)throw new Error(`${JSON.stringify(e)} is not truthy`)},t.assertIsObject=function(e){if("object"!=typeof e)throw new Error(`AssertIsObject: Given entity is not an object (type = ${typeof e})`)}},8308:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=e/1024,o=t/1024,n=o/1024;let i="B",r=e;return n>=1?(r=n,i="GiB"):o>=1?(r=o,i="MiB"):t>=1&&(r=t,i="KiB"),{size:r,units:i}}},2281:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=(e,o)=>{const n=getComputedStyle(e);for(let e=0;e<n.length;e++){const t=n.item(e),i=n.getPropertyValue(t);o.style?.setProperty(t,i)}for(let n=0;n<e.children.length;n++){const i=e.children.item(n),r=o.children.item(n);i&&r?t(i,r):console.warn("CloneElement: Missing child")}},o=e.cloneNode(!0);return t(e,o),o}},5890:(e,t)=>{"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.createSvgPaths=t.createSvgElements=t.createSvgElement=t.ElementNamespace=void 0,function(e){e.Html="html",e.Svg="svg"}(o||(t.ElementNamespace=o={}));const n=(e,t,n=o.Html)=>{let i;if(n===o.Html)i=document.createElement(e);else{if(n!==o.Svg)throw new Error(`Unknown element type ${n}`);i=document.createElementNS("http://www.w3.org/2000/svg",e)}for(const[e,o]of Object.entries(t))if("children"!==e){if("string"!=typeof o&&"number"!=typeof o)throw new Error("Unsupported value type "+typeof o);i.setAttribute(e,o.toString())}if(t.children)for(const e of t.children)i.appendChild(e);return i};t.createSvgElement=(e,t)=>n(e,t,o.Svg),t.createSvgElements=(e,o)=>o.map((o=>(0,t.createSvgElement)(e,o))),t.createSvgPaths=(...e)=>(0,t.createSvgElements)("path",e),t.default=n},2832:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3755);t.default=(e,t,o,i)=>{const r=t.transformVec3(n.Vec2.unitX),s=t.transformVec2(e),a=r.magnitude(),l=-180/Math.PI*r.angle(),c=s.minus(e),d=[];if(a>1.2?d.push(i.zoomedIn):a<.8&&d.push(i.zoomedOut),Math.floor(Math.abs(l))>0){const e=Math.round(o?-l:l);d.push(i.rotatedBy(e))}const h=1e-4;return c.x>h?d.push(o?i.movedLeft:i.movedRight):c.x<-1e-4&&d.push(o?i.movedRight:i.movedLeft),c.y<-1e-4?d.push(o?i.movedDown:i.movedUp):c.y>h&&d.push(o?i.movedUp:i.movedDown),d.join("; ")}},7311:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async(e,t={})=>{try{const o=new FileReader;return await new Promise(((n,i)=>{o.onload=()=>n(o.result),o.onerror=i,o.onabort=i,o.onprogress=e=>{t.onprogress?.(e)},o.readAsDataURL(e)}))}catch(o){(t.onWarning??console.warn)("Unable to convert file to base64 with a FileReader: ",o);const n=await e.arrayBuffer(),i=new Uint8Array(n),r=30,s=[];for(let e=0;e<i.length;e+=r){const t=String.fromCharCode(...i.slice(e,e+r));s.push(btoa(t))}return`data:${e.type??"image/*"};base64,${s.join("")}`}}},2862:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o={Control:"ControlLeft","=":"Equal","-":"Minus",";":"Semicolon"," ":"Space"};t.default=e=>{const t=e.toUpperCase();return"A"<=t&&t<="Z"?`Key${t}`:"0"<=e&&e<="9"?`Digit${e}`:e in o?o[e]:e}},2857:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutableReactiveValue=t.ReactiveValue=t.adjustEditorThemeForContrast=void 0;var i=o(1880);Object.defineProperty(t,"adjustEditorThemeForContrast",{enumerable:!0,get:function(){return n(i).default}});var r=o(5786);Object.defineProperty(t,"ReactiveValue",{enumerable:!0,get:function(){return r.ReactiveValue}}),Object.defineProperty(t,"MutableReactiveValue",{enumerable:!0,get:function(){return r.MutableReactiveValue}})},6035:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const o=e.length<t.length?e:t,n=o===e?t:e;for(let e=0;e<o.length;e++)if(o[e]!==n[e])return!1;return!0}},724:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{let o=[];const n=(e,t)=>e.key===t.key&&e.code===t.code,i=e=>{if("keydown"===e.type){if(r=e,o.some((e=>n(e,r)))||o.push({code:(i=e).code,key:i.key,ctrlKey:i.ctrlKey,altKey:i.altKey,shiftKey:i.shiftKey,metaKey:i.metaKey}),!t.filter(e))return;t.handleKeyDown(e)}else{if(console.assert("keyup"===e.type),o=o.filter((t=>!n(t,e))),!t.filter(e))return;t.handleKeyUp(e)}var i,r};e.addEventListener("keydown",(e=>{i(e)})),e.addEventListener("keyup",(e=>{i(e)})),e.addEventListener("focusout",(n=>{let i=!1;if(n.relatedTarget){const o=n.relatedTarget;i=e.contains(o)||t.getHandlesKeyEventsFrom(o)}if(!i){for(const e of o)t.handleKeyUp(new KeyboardEvent("keyup",{...e}));o=[]}}));const r=e=>{let t=!1,n=!1,r=!1,s=!1;for(const e of o){const o=e.code;t||=!!o.match(/^Shift(Left|Right)$/),n||=!!o.match(/^Control(Left|Right)$/),r||=!!o.match(/^Alt(Left|Right)$/),s||=!!o.match(/^Meta(Left|Right)$/)}const a=e=>e?"keydown":"keyup",l={shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,ctrlKey:e.ctrlKey};e.shiftKey!==t&&i(new KeyboardEvent(a(e.shiftKey),{...l,key:"Shift",code:"ShiftLeft"})),e.altKey!==r&&i(new KeyboardEvent(a(e.altKey),{...l,key:"Alt",code:"AltLeft"})),e.ctrlKey!==n&&i(new KeyboardEvent(a(e.ctrlKey),{...l,key:"Control",code:"ControlLeft"})),e.metaKey!==s&&i(new KeyboardEvent(a(e.metaKey),{...l,key:"Meta",code:"MetaLeft"}))};e.addEventListener("mousedown",(e=>{r(e)})),e.addEventListener("mousemove",(e=>{r(e)}))}},5902:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const o=new Map;let n=null,i=!1;const r=()=>{if(0===o.size)i?(i=!1,t.onEnd()):null!==n&&(clearTimeout(n),n=null);else{const e=Date.now();let s=0;for(const t of o.values()){const o=e-t.timeEnter;s=Math.max(o,s)}const a=t.longPressTimeout??700;null!==n&&(clearTimeout(n),n=null);const l=a-s;l<=0?(t.onStart(),i=!0):n=setTimeout((()=>{n=null,r()}),l)}},s=e=>{const t={timeEnter:Date.now()};"pointerenter"===e.type?o.set(e.pointerId,t):"pointerleave"!==e.type&&"pointercancel"!==e.type||o.clear(),r()};return e.addEventListener("pointerenter",s),e.addEventListener("pointerleave",s),e.addEventListener("pointercancel",s),{removeListeners:()=>{e.removeEventListener("pointerenter",s),e.removeEventListener("pointerleave",s),e.removeEventListener("pointercancel",s)}}}},8107:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>`\nMIT License\n\nCopyright (c) ${e}\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the "Software"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.`.replace(/([^\n])[\n]([^\n])/g,"$1 $2")},626:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=(e,t,o,n)=>!(t===n||0===e||o+e<=0||o+t+e>n);e.onwheel=o=>{const n=t(o.deltaX,e.clientWidth,e.scrollLeft,e.scrollWidth),i=t(o.deltaY,e.clientHeight,e.scrollTop,e.scrollHeight);(n||i)&&o.stopPropagation()}}},2560:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=()=>new Promise((e=>{requestAnimationFrame((()=>e()))}))},6507:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{if(e.some((e=>e&&e.then)))return Promise.all(e).then((()=>{}))}},3560:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async e=>{e.complete||await new Promise(((t,o)=>{e.onload=e=>t(e),e.onerror=e=>o(e),e.onabort=e=>o(e)}))}},3591:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>new Promise((t=>{setTimeout((()=>t()),e)}))},2749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={number:"1.30.0"}},925:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(7950);t.default=(e,t)=>{for(const o in t)try{console.log("apply shortcut override",o,t[o]);const i=t[o].map((e=>n.KeyBinding.fromString(e)));e.shortcuts.overrideShortcut(o,i)}catch(e){console.error("Invalid keybinding for id",o,". Error: ",e)}}},9175:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(5219),r=o(7950),s=o(5192),a=o(7581),l=o(6100),c=o(925),d=o(8031);t.default=(e,t,o)=>n(void 0,void 0,void 0,(function*(){const h=new r.default(document.body,{iconProvider:new i.default,renderingMode:o?r.RenderingMode.DummyRenderer:void 0,image:{showImagePicker:({setOnCancelCallback:e})=>n(void 0,void 0,void 0,(function*(){const o=yield t.showImagePicker();e((()=>{o.cancel(),o.cleanUp()}));const n=yield o.images;if(!n)return null;const i=[];for(const e of n){const t=yield fetch(e.path),o=yield t.arrayBuffer();i.push(new File([o],e.name,{type:e.mime}))}return o.cleanUp(),i}))},localization:(0,r.getLocalizationTable)((0,d.getLocales)())});h.focus(),yield(0,s.default)(h,e),yield h.dispatchNoAnnounce(h.viewport.zoomTo(h.getImportExportRect()),!1);let u,p=null;return u=(0,a.default)(h,{onSavePress:()=>n(void 0,void 0,void 0,(function*(){(0,l.default)(h,e),t.onSave()})),onExitPress:()=>{t.onExit()}},e),{editor:h,applyStyle:e=>{const t=h.getRootElement();p&&t.classList.remove(e),t.classList.add(e),p=e,(0,r.adjustEditorThemeForContrast)(h)},setToolbarMode:u.setToolbarMode,applyShortcutOverrides:e=>{(0,c.default)(h,e)},loadInitialImage:e=>n(void 0,void 0,void 0,(function*(){u.setLoading(!0),yield h.dispatchNoAnnounce(new r.Erase(h.image.getBackgroundComponents()),!1),yield h.loadFromSVG(e),u.setLoading(!1),u.setSaved()})),hasUnsavedChanges:()=>u.hasUnsavedChanges(),onSaved:()=>u.setSaved()}}))},592:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(1613),r=o(8031),s=o(7127),a=(e,t,o)=>{if(!e)return;const l=e.editor;t({type:i.MessageType.ShowCloseButton,isSaved:!e.hasUnsavedChanges()}),l.getRootElement().style.display="none";const c=document.createElement("div");c.classList.add("save-or-exit-dialog");const d=()=>n(void 0,void 0,void 0,(function*(){l.getRootElement().style.display="",c.remove(),yield t({type:i.MessageType.HideButtons})})),h=document.createElement("div");e.hasUnsavedChanges()?(c.classList.add("has-unsaved-changes"),h.innerText=r.default.discardUnsavedChanges):h.innerText=r.default.exitInstructions;const u=document.createElement("button");u.innerText=r.default.resumeEditing,u.onclick=()=>n(void 0,void 0,void 0,(function*(){yield d(),l.focus()}));const p=document.createElement("button");p.innerText=r.default.saveChanges,p.classList.add("save-changes-button"),p.onclick=()=>n(void 0,void 0,void 0,(function*(){yield d();const n=new Promise((e=>{o((()=>e()))}));(yield(0,s.default)(e,t))&&(yield n,a(e,t,o))}));const f=document.createElement("div");f.classList.add("button-container"),f.replaceChildren(u,p),c.replaceChildren(h,f),document.body.appendChild(c),p.focus()};t.default=a},7127:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(1613),r=o(8031),s=o(1899);t.default=(e,t)=>n(void 0,void 0,void 0,(function*(){if(!e)return;const o=e.editor,a={type:i.MessageType.SaveSVG,data:(0,s.default)(o.toSVG())},l=yield t(Object.assign({},a));if(!0===l||l.type!==i.ResponseType.SaveResponse)throw new Error("Invalid response "+l);if(!l.waitingForSaveType)return!0;o.getRootElement().style.display="none";const c=document.createElement("form");c.className="save-or-exit-dialog",c.name="saveOptions";const d=document.createElement("button");d.innerText=r.default.saveAndResumeEditing,d.onclick=()=>n(void 0,void 0,void 0,(function*(){yield n(void 0,void 0,void 0,(function*(){o.getRootElement().style.display="",c.remove(),yield t({type:i.MessageType.HideButtons})})),yield t(Object.assign({},a)),o.focus()}));const h=document.createElement("div");let u=0;const p=(e,o,r=!1)=>{const s=document.createElement("div"),a=document.createElement("label"),l=document.createElement("input");l.name="saveOption",l.value=o,l.type="radio",l.id="saveOption-"+u++,a.setAttribute("for",l.id),l.checked=r,a.innerText=e,s.replaceChildren(l,a),h.appendChild(s);const c=()=>n(void 0,void 0,void 0,(function*(){l.checked&&(yield t({type:i.MessageType.SetSaveMethod,method:o}))}));c(),l.oninput=c};p(r.default.overwriteExisting,i.SaveMethod.Overwrite,!0),p(r.default.saveAsNewDrawing,i.SaveMethod.SaveAsNew);const f=document.createElement("div");f.innerText=r.default.clickBelowToContinue;const m=document.createElement("div");return m.classList.add("button-container"),m.replaceChildren(d),c.replaceChildren(f,h,m),document.body.appendChild(c),!1}))},381:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(8031);(()=>{let e=null===(t=document.querySelector("input#default-locale-data"))||void 0===t?void 0:t.value;var t;e||(console.warn("Locale information not found"),e="unknown"),(0,n.setLocale)([e,...navigator.languages])})()},9898:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o={updateSetting(e,t){localStorage.setItem(e,t)},getSetting:e=>localStorage.getItem(e)};t.default=o},7581:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(7950),i=o(1613);t.default=(e,t,o)=>{let r,s=null,a=!1,l=!1;const c=()=>{r.setDisabled(a||l)},d="jsdraw-toolbarState";e.notifier.on(n.EditorEventType.ToolUpdated,(()=>{s&&o.updateSetting(d,s.serializeState())}));let h=null;const u=a=>{if(a===h)return;h=a,null==s||s.remove();const l=a===i.ToolbarType.Default||a===i.ToolbarType.Sidebar;s=l?(0,n.makeEdgeToolbar)(e):(0,n.makeDropdownToolbar)(e),s.addDefaults(),s.addSpacer({grow:1,maxSize:"15px"}),s.addExitButton(t.onExitPress),s.addSpacer({grow:1,maxSize:"15px"}),r=s.addSaveButton(t.onSavePress);try{const e=o.getSetting(d);e&&s.deserializeState(e)}catch(e){console.warn("Error restoring toolbar state!",e)}c()};return u(i.ToolbarType.Default),e.notifier.on(n.EditorEventType.UndoRedoStackUpdated,(()=>{a=!1,c()})),{setToolbarMode:u,setSaved:()=>{a=!0,c()},setLoading:e=>{l=e,c()},hasUnsavedChanges:()=>!a}}},8537:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(1613),r=o(1899);t.default=(e,t,o)=>n(void 0,void 0,void 0,(function*(){for(;;){yield new Promise((e=>{setTimeout(e,t)}));const n=yield e.toSVGAsync();yield o({type:i.MessageType.AutosaveSVG,data:(0,r.default)(n)})}}))},1899:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(6668);t.default=e=>{const t=["<svg"];for(const o of e.getAttributeNames())t.push(` ${o}="${(0,n.escapeHtml)(e.getAttribute(o))}"`);return t.push(">"),t.push(e.innerHTML),t.push("</svg>"),t.join("")}},1741:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTemplate=t.templateKey=void 0;const n=o(7950);t.templateKey="jsdraw-image-template",t.defaultTemplate={imageSize:[500,500],autoresize:!0,backgroundData:{name:"image-background",zIndex:0,data:{mainColor:"#ffffff",backgroundType:n.BackgroundComponentBackgroundType.SolidColor}}}},5192:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(7950),r=o(1741);t.default=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=t.getSetting(r.templateKey),n=o?JSON.parse(o):r.defaultTemplate;if("imageSize"in n&&"number"==typeof n.imageSize[0]&&"number"==typeof n.imageSize[1]&&isFinite(n.imageSize[0])&&isFinite(n.imageSize[1])){let t=n.imageSize[0],o=n.imageSize[1];const r=50,s=5e3;t=Math.min(s,Math.max(r,t)),o=Math.min(s,Math.max(r,o));const a=i.Vec2.of(t,o),l=new i.Rect2(0,0,a.x,a.y),c=!1;yield e.dispatchNoAnnounce(e.setImportExportRect(l),c)}if("backgroundData"in n){const t=i.AbstractComponent.deserialize(n.backgroundData),o=!1;yield e.dispatchNoAnnounce(e.image.addElement(t),o)}"autoresize"in n&&"boolean"==typeof n.autoresize&&(yield e.dispatchNoAnnounce(e.image.setAutoresizeEnabled(n.autoresize),!1))}catch(e){console.warn("Error initializing js-draw from template: ",e)}}))},6100:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(7950),i=o(1741);t.default=(e,t)=>{let o=null;for(const t of e.image.getBackgroundComponents())t instanceof n.BackgroundComponent&&(o=t);let r={};o&&(r=o.serialize());const s=e.getImportExportRect().size,a=JSON.stringify({backgroundData:r,imageSize:[s.x,s.y],autoresize:e.image.getAutoresizeEnabled()});t.updateSetting(i.templateKey,a)}},7362:function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),o(6450),o(381);const i=o(1613),r=o(8537),s=o(9175),a=o(9898),l=o(7127),c=o(592),d=e=>webviewApi.postMessage(e);let h=!1,u=[],p=null,f=null;const m=(e,t)=>{e.setToolbarMode(t.toolbarType),e.applyStyle(t.styleMode),e.applyShortcutOverrides(t.keyboardShortcuts),t.initialData&&(h=!0,e.loadInitialImage(t.initialData)),(0,r.default)(e.editor,t.autosaveIntervalMS,(e=>webviewApi.postMessage(e)))},g=e=>{u.push(e)},b=()=>n(void 0,void 0,void 0,(function*(){const e=yield webviewApi.postMessage({type:i.MessageType.ShowImagePicker});if("object"!=typeof e||e.type!==i.ResponseType.ImagePickerTaskResponse)throw new Error(`Invalid response or type ${e}`);return{images:n(void 0,void 0,void 0,(function*(){const t=yield webviewApi.postMessage({type:i.MessageType.GetImagePickerResult,taskId:e.taskId});if("object"!=typeof t||t.type!==i.ResponseType.ImagePickerResponse)throw new Error(`Invalid response or type ${t}`);return t.images})),cancel:()=>{webviewApi.postMessage({type:i.MessageType.CancelImagePicker,taskId:e.taskId})},cleanUp:()=>{webviewApi.postMessage({type:i.MessageType.CleanUpImagePickerResult,taskId:e.taskId})}}}));n(void 0,void 0,void 0,(function*(){p=yield(0,s.default)(a.default,{onSave:()=>(0,l.default)(p,d),onExit:()=>(0,c.default)(p,d,g),showImagePicker:b}),f&&m(p,f)})),webviewApi.onMessage((({message:e})=>n(void 0,void 0,void 0,(function*(){if(e.type===i.MessageType.SaveCompleted){null==p||p.onSaved(),webviewApi.postMessage({type:i.MessageType.SetSaveMethod,method:i.SaveMethod.Overwrite});for(const e of u)e();return u=[],!0}throw console.log("unknown message",e),new Error(`Unknown message: ${e}`)}))));const v={type:i.MessageType.GetInitialData};webviewApi.postMessage(v).then((e=>n(void 0,void 0,void 0,(function*(){!0===e||e.type!==i.ResponseType.InitialDataResponse||h||(p?m(p,e):f=e)}))))},8031:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLocales=t.setLocale=void 0;const o={insertDrawing:"Insert Drawing",insertDrawingInNewWindow:"Insert drawing in new window",restoreFromAutosave:"Restore from autosaved drawing",deleteAutosave:"Delete all autosaved drawings",noSuchAutosaveExists:"No autosave exists",discardChanges:"Discard changes",defaultImageTitle:"Freehand Drawing",edit:"Edit",close:"Close",saveAndClose:"Save and close",overwriteExisting:"Overwrite existing",saveAsNewDrawing:"Save as a new drawing",clickBelowToContinue:"Done! Click below to continue.",discardUnsavedChanges:"Discard unsaved changes?",resumeEditing:"Resume editing",saveAndResumeEditing:"Save and resume editing",saveChanges:"Save changes",exitInstructions:"All changes saved! Click below to exit.",settingsPaneDescription:"Settings for the Freehand Drawing image editor.",setting__disableFullScreen:"Dialog mode",setting__disableFullScreenDescription:"Enabling this setting causes the editor to only partially fill the Joplin window.",setting__autosaveIntervalSettingLabel:"Autosave interval (minutes)",setting__autosaveIntervalSettingDescription:'Adjusts how often a backup copy of the current drawing is created. The most recent autosave can be restored by searching for ":restore autosave" in the command palette (ctrl+shift+p or cmd+shift+p on MacOS) and clicking "Restore from autosaved drawing". If this setting is set to zero, autosaves are created every two minutes.',setting__themeLabel:"Theme",setting__toolbarTypeLabel:"Toolbar type",setting__toolbarTypeDescription:"This setting switches between possible toolbar user interfaces for the image editor.",setting__keyboardShortcuts:"Keyboard shortcuts",toolbarTypeDefault:"Default",toolbarTypeSidebar:"Sidebar",toolbarTypeDropdown:"Dropdown",styleMatchJoplin:"Match Joplin",styleJsDrawLight:"Light",styleJsDrawDark:"Dark",images:"Images",pdfs:"PDFs",allFiles:"All Files",loadLargePdf:e=>`A selected file is a large PDF (${e} pages). Loading it may take some time and increase the size of the current drawing. Continue?`,notAnEditableImage:(e,t)=>`Resource ${e} is not an editable image. Unable to edit resource of type ${t}.`},n={de:{insertDrawing:"Zeichnung einfügen",restoreFromAutosave:"Automatische Sicherung wiederherstellen",deleteAutosave:"Alle automatischen Sicherungen löschen",noSuchAutosaveExists:"Keine automatischen Sicherungen vorhanden",discardChanges:"Änderungen verwerfen",defaultImageTitle:"Freihand-Zeichnen",edit:"Bearbeiten",close:"Schließen",overwriteExisting:"Existierende Zeichnung überschreiben",saveAsNewDrawing:"Als neue Zeichnung speichern",clickBelowToContinue:"Fertig! Klicke auf „Ok“ um fortzufahen.",discardUnsavedChanges:"Ungespeicherte Änderungen verwerfen?",resumeEditing:"Bearbeiten fortfahren",notAnEditableImage:(e,t)=>`Die Ressource ${e} ist kein bearbeitbares Bild. Ressource vom Typ ${t} kann nicht bearbeitet werden.`},en:o,es:{insertDrawing:"Añada dibujo",restoreFromAutosave:"Resturar al autoguardado",deleteAutosave:"Borrar el autoguardado",noSuchAutosaveExists:"No autoguardado existe",discardChanges:"Descartar cambios",defaultImageTitle:"Dibujo",edit:"Editar",close:"Cerrar",saveAndClose:"Guardar y cerrar",overwriteExisting:"Sobrescribir existente",saveAsNewDrawing:"Guardar como dibujo nuevo",clickBelowToContinue:"Guardado. Ponga «ok» para continuar.",discardUnsavedChanges:"¿Descartar cambios no guardados?",resumeEditing:"Continuar editando",saveAndResumeEditing:"Guardar y continuar editando"},ro:{insertDrawing:"Inserează un desen",insertDrawingInNewWindow:"Inserează un desen într-o fereastră nouă",restoreFromAutosave:"Restaurează dintr-un desen salvat automat",deleteAutosave:"Șterge toate desenele salvate automat",noSuchAutosaveExists:"Nicio salvare automată nu există",discardChanges:"Anulează modificările",defaultImageTitle:"Desen liber",edit:"Editează",close:"Închide",saveAndClose:"Salvează și închide",overwriteExisting:"Suprascrie existent",saveAsNewDrawing:"Salvează ca desen nou",clickBelowToContinue:"Gata! Fă clic mai jos pentru a continua.",discardUnsavedChanges:"Anulezi modificările nesalvate?",resumeEditing:"Continuă editarea",saveAndResumeEditing:"Salvează și continuă editarea",saveChanges:"Salvează modificările",exitInstructions:"Toate modificările au fost salvate! Fă clic mai jos pentru a ieși.",settingsPaneDescription:"Setări pentru editorul de imagine liber.",setting__disableFullScreen:"Mod dialog",setting__disableFullScreenDescription:"Activarea acestei opțiuni face ca editorul să acopere doar parțial fereastra Joplin.",setting__autosaveIntervalSettingLabel:"Interval salvare automată (minute)",setting__autosaveIntervalSettingDescription:'Ajustează cât de des se face o copie de siguranță a desenului curent. Cea mai recentă versiune salvată automat poate fi restaurată căutând după ":restore autosave" în paleta de comenzi (Ctrl+Shift+P sau Cmd+Shift+P pe MacOS) și făcând clic pe „Restaurează dintr-un desen salvat automat”. Dacă acestă setare este 0, salvările automate sunt create la fiecare 2 minute.',setting__themeLabel:"Temă",setting__toolbarTypeLabel:"Tip bară de instrumente",setting__toolbarTypeDescription:"Această setare comută între posibilele interfețe pentru editorul de imagine.",setting__keyboardShortcuts:"Scurtături de la tastatură",toolbarTypeDefault:"Implicit",toolbarTypeSidebar:"Bară laterală",toolbarTypeDropdown:"Casete derulante",styleMatchJoplin:"La fel ca Joplin",styleJsDrawLight:"Luminoasă",styleJsDrawDark:"Întunecată",images:"Imagini",pdfs:"PDF-uri",allFiles:"Toate fișierele",loadLargePdf:e=>`Un fișier PDF selectat este un fișier mare (${e} de pagini). Încărcarea lui ar putea dura ceva timp și să crească dimensiunea desenului curent. Continui?`,notAnEditableImage:(e,t)=>`Resursa ${e} nu este o imagine editabilă. Nu se poate edita resursa de tipul ${t}.`}};let i,r=[],s=!1;t.setLocale=e=>{"string"==typeof e&&(e=[e]),(e=>{const t=[...e];for(let o of e){o=o.replace("_","-");const e=o.indexOf("-");-1!==e&&t.push(o.substring(0,e))}for(const e of t)if(e in n){i=n[e];break}r=t})(e),s=!0},(0,t.setLocale)(navigator.languages),t.getLocales=()=>[...r],t.default=new Proxy(o,{get(e,t){var n;s||console.warn("Accessing language data without a localization set. The default Electron locale will be used.");const r=t;return null!==(n=null==i?void 0:i[r])&&void 0!==n?n:o[r]}})},1613:(e,t)=>{"use strict";var o,n,i,r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.EditorStyle=t.ToolbarType=t.ResponseType=t.SaveMethod=t.MessageType=void 0,function(e){e.GetInitialData="getInitialData",e.SaveSVG="saveSVG",e.SaveCompleted="saveCompleted",e.AutosaveSVG="autosaveSVG",e.SetSaveMethod="setSaveMethod",e.ResumeEditing="resumeEditing",e.ShowSaveAndCloseButton="showSaveAndCloseButton",e.ShowCloseButton="showCloseButton",e.HideButtons="removeButtons",e.ShowImagePicker="showImagePicker",e.GetImagePickerResult="getImagePicker",e.CancelImagePicker="cancelImagePicker",e.CleanUpImagePickerResult="cleanUpImagePicker"}(o||(t.MessageType=o={})),function(e){e.SaveAsNew="saveAsNew",e.Overwrite="overwrite"}(n||(t.SaveMethod=n={})),function(e){e.InitialDataResponse="initialDataResponse",e.SaveResponse="saveResponse",e.ImagePickerTaskResponse="imagePickerStartedResponse",e.ImagePickerResponse="imagePickerResponse"}(i||(t.ResponseType=i={})),function(e){e[e.Default=0]="Default",e[e.Sidebar=1]="Sidebar",e[e.Dropdown=2]="Dropdown"}(r||(t.ToolbarType=r={})),function(e){e.MatchJoplin="match-joplin-theme",e.JsDrawLight="js-draw-default-light",e.JsDrawDark="js-draw-default-dark"}(s||(t.EditorStyle=s={}))},6668:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeHtml=void 0,t.escapeHtml=e=>e.replace(/[&]/g,"&amp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;").replace(/["]/g,"&quot;").replace(/[']/g,"&#39;")},2067:(e,t)=>{var o,n;"undefined"!=typeof self&&self,void 0===(n="function"==typeof(o=function(){return((e,t,o,n)=>{const i=t.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1};let s,a,l,c,d,h,u,p,f,m,g,b,v,y,w,x,S={};const T={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>n,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},C={};let P="",k={},E=!1;function z(o){if("object"==typeof o)for(const i in o)switch(i){case"el":L(o.el),!1!==o.wrap&&D(o.el);break;case"parent":s=t.querySelector(o.parent),s&&(s.appendChild(a),T.parent=o.parent,s===t.body&&(s=n));break;case"themeMode":T.themeMode=o.themeMode,"auto"===o.themeMode&&e.matchMedia&&e.matchMedia("(prefers-color-scheme: dark)").matches&&(T.themeMode="dark");case"theme":o.theme&&(T.theme=o.theme),a.className=`clr-picker clr-${T.theme} clr-${T.themeMode}`,T.inline&&O();break;case"rtl":T.rtl=!!o.rtl,t.querySelectorAll(".clr-field").forEach((e=>e.classList.toggle("clr-rtl",T.rtl)));break;case"margin":o.margin*=1,T.margin=isNaN(o.margin)?T.margin:o.margin;break;case"wrap":o.el&&o.wrap&&D(o.el);break;case"formatToggle":T.formatToggle=!!o.formatToggle,G("clr-format").style.display=T.formatToggle?"block":"none",T.formatToggle&&(T.format="auto");break;case"swatches":if(Array.isArray(o.swatches)){const e=[];o.swatches.forEach(((t,o)=>{e.push(`<button type="button" id="clr-swatch-${o}" aria-labelledby="clr-swatch-label clr-swatch-${o}" style="color: ${t};">${t}</button>`)})),G("clr-swatches").innerHTML=e.length?`<div>${e.join("")}</div>`:"",T.swatches=o.swatches.slice()}break;case"swatchesOnly":T.swatchesOnly=!!o.swatchesOnly,a.setAttribute("data-minimal",T.swatchesOnly);break;case"alpha":T.alpha=!!o.alpha,a.setAttribute("data-alpha",T.alpha);break;case"inline":if(T.inline=!!o.inline,a.setAttribute("data-inline",T.inline),T.inline){const e=o.defaultColor||T.defaultColor;y=j(e),O(),A(e)}break;case"clearButton":"object"==typeof o.clearButton&&(o.clearButton.label&&(T.clearLabel=o.clearButton.label,u.innerHTML=T.clearLabel),o.clearButton=o.clearButton.show),T.clearButton=!!o.clearButton,u.style.display=T.clearButton?"block":"none";break;case"clearLabel":T.clearLabel=o.clearLabel,u.innerHTML=T.clearLabel;break;case"closeButton":T.closeButton=!!o.closeButton,T.closeButton?a.insertBefore(p,d):d.appendChild(p);break;case"closeLabel":T.closeLabel=o.closeLabel,p.innerHTML=T.closeLabel;break;case"a11y":const r=o.a11y;let c=!1;if("object"==typeof r)for(const e in r)r[e]&&T.a11y[e]&&(T.a11y[e]=r[e],c=!0);if(c){const e=G("clr-open-label"),t=G("clr-swatch-label");e.innerHTML=T.a11y.open,t.innerHTML=T.a11y.swatch,p.setAttribute("aria-label",T.a11y.close),u.setAttribute("aria-label",T.a11y.clear),f.setAttribute("aria-label",T.a11y.hueSlider),g.setAttribute("aria-label",T.a11y.alphaSlider),h.setAttribute("aria-label",T.a11y.input),l.setAttribute("aria-label",T.a11y.instruction)}break;default:T[i]=o[i]}}function _(e,t){"string"==typeof e&&"object"==typeof t&&(C[e]=t,E=!0)}function M(e){delete C[e],0===Object.keys(C).length&&(E=!1,e===P&&R())}function I(e){if(E){const t=["el","wrap","rtl","inline","defaultColor","a11y"];for(let o in C){const n=C[o];if(e.matches(o)){P=o,k={},t.forEach((e=>delete n[e]));for(let e in n)k[e]=Array.isArray(T[e])?T[e].slice():T[e];z(n);break}}}}function R(){Object.keys(k).length>0&&(z(k),P="",k={})}function L(e){Y(t,"click",e,(e=>{T.inline||(I(e.target),v=e.target,w=v.value,y=j(w),a.classList.add("clr-open"),O(),A(w),(T.focusInput||T.selectInput)&&(h.focus({preventScroll:!0}),h.setSelectionRange(v.selectionStart,v.selectionEnd)),T.selectInput&&h.select(),(x||T.swatchesOnly)&&Z().shift().focus(),v.dispatchEvent(new Event("open",{bubbles:!0})))})),Y(t,"input",e,(e=>{const t=e.target.parentNode;t.classList.contains("clr-field")&&(t.style.color=e.target.value)}))}function O(){if(!a||!v&&!T.inline)return;const o=s,n=e.scrollY,i=a.offsetWidth,r=a.offsetHeight,c={left:!1,top:!1};let d,h,u,p={x:0,y:0};if(o&&(d=e.getComputedStyle(o),h=parseFloat(d.marginTop),u=parseFloat(d.borderTopWidth),p=o.getBoundingClientRect(),p.y+=u+n),!T.inline){const e=v.getBoundingClientRect();let s=e.x,l=n+e.y+e.height+T.margin;o?(s-=p.x,l-=p.y,s+i>o.clientWidth&&(s+=e.width-i,c.left=!0),l+r>o.clientHeight-h&&r+T.margin<=e.top-(p.y-n)&&(l-=e.height+r+2*T.margin,c.top=!0),l+=o.scrollTop):(s+i>t.documentElement.clientWidth&&(s+=e.width-i,c.left=!0),l+r-n>t.documentElement.clientHeight&&r+T.margin<=e.top&&(l=n+e.y-r-T.margin,c.top=!0)),a.classList.toggle("clr-left",c.left),a.classList.toggle("clr-top",c.top),a.style.left=`${s}px`,a.style.top=`${l}px`,p.x+=a.offsetLeft,p.y+=a.offsetTop}S={width:l.offsetWidth,height:l.offsetHeight,x:l.offsetLeft+p.x,y:l.offsetTop+p.y}}function D(e){t.querySelectorAll(e).forEach((e=>{const o=e.parentNode;if(!o.classList.contains("clr-field")){const n=t.createElement("div");let i="clr-field";(T.rtl||e.classList.contains("clr-rtl"))&&(i+=" clr-rtl"),n.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',o.insertBefore(n,e),n.setAttribute("class",i),n.style.color=e.value,n.appendChild(e)}}))}function B(e){if(v&&!T.inline){const t=v;e&&(v=n,w!==t.value&&(t.value=w,t.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout((()=>{w!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))})),a.classList.remove("clr-open"),E&&R(),t.dispatchEvent(new Event("close",{bubbles:!0})),T.focusInput&&t.focus({preventScroll:!0}),v=n}}function A(e){const t=function(e){const t=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;let o,n;return i.fillStyle="#000",i.fillStyle=e,o=t.exec(i.fillStyle),o?(n={r:1*o[3],g:1*o[4],b:1*o[5],a:1*o[6]},n.a=+n.a.toFixed(2)):(o=i.fillStyle.replace("#","").match(/.{2}/g).map((e=>parseInt(e,16))),n={r:o[0],g:o[1],b:o[2],a:1}),n}(e),n=function(e){const t=e.r/255,n=e.g/255,i=e.b/255,r=o.max(t,n,i),s=r-o.min(t,n,i),a=r;let l=0,c=0;return s&&(r===t&&(l=(n-i)/s),r===n&&(l=2+(i-t)/s),r===i&&(l=4+(t-n)/s),r&&(c=s/r)),l=o.floor(60*l),{h:l<0?l+360:l,s:o.round(100*c),v:o.round(100*a),a:e.a}}(t);N(n.s,n.v),U(t,n),f.value=n.h,a.style.color=`hsl(${n.h}, 100%, 50%)`,m.style.left=n.h/360*100+"%",c.style.left=S.width*n.s/100+"px",c.style.top=S.height-S.height*n.v/100+"px",g.value=100*n.a,b.style.left=100*n.a+"%"}function j(e){const t=e.substring(0,3).toLowerCase();return"rgb"===t||"hsl"===t?t:"hex"}function V(o){o=o!==n?o:h.value,v&&(v.value=o,v.dispatchEvent(new Event("input",{bubbles:!0}))),T.onChange&&T.onChange.call(e,o,v),t.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:o,currentEl:v}}))}function F(e,t){const n={h:1*f.value,s:e/S.width*100,v:100-t/S.height*100,a:g.value/100},i=function(e){const t=e.s/100,n=e.v/100;let i=t*n,r=e.h/60,s=i*(1-o.abs(r%2-1)),a=n-i;i+=a,s+=a;const l=o.floor(r)%6,c=[i,s,a,a,s,i][l],d=[s,i,i,s,a,a][l],h=[a,a,s,i,i,s][l];return{r:o.round(255*c),g:o.round(255*d),b:o.round(255*h),a:e.a}}(n);N(n.s,n.v),U(i,n),V()}function N(e,t){let o=T.a11y.marker;e=1*e.toFixed(1),t=1*t.toFixed(1),o=o.replace("{s}",e),o=o.replace("{v}",t),c.setAttribute("aria-label",o)}function $(e){const t=function(e){return{pageX:e.changedTouches?e.changedTouches[0].pageX:e.pageX,pageY:e.changedTouches?e.changedTouches[0].pageY:e.pageY}}(e);let o=t.pageX-S.x,n=t.pageY-S.y;s&&(n+=s.scrollTop),H(o,n),e.preventDefault(),e.stopPropagation()}function H(e,t){e=e<0?0:e>S.width?S.width:e,t=t<0?0:t>S.height?S.height:t,c.style.left=`${e}px`,c.style.top=`${t}px`,F(e,t),c.focus()}function U(e,n){void 0===e&&(e={}),void 0===n&&(n={});let i=T.format;for(const t in e)r[t]=e[t];for(const e in n)r[e]=n[e];const s=function(e){let t=e.r.toString(16),o=e.g.toString(16),n=e.b.toString(16),i="";if(e.r<16&&(t="0"+t),e.g<16&&(o="0"+o),e.b<16&&(n="0"+n),T.alpha&&(e.a<1||T.forceAlpha)){const t=255*e.a|0;i=t.toString(16),t<16&&(i="0"+i)}return"#"+t+o+n+i}(r),a=s.substring(0,7);switch(c.style.color=a,b.parentNode.style.color=a,b.style.color=s,d.style.color=s,l.style.display="none",l.offsetHeight,l.style.display="",b.nextElementSibling.style.display="none",b.nextElementSibling.offsetHeight,b.nextElementSibling.style.display="","mixed"===i?i=1===r.a?"hex":"rgb":"auto"===i&&(i=y),i){case"hex":h.value=s;break;case"rgb":h.value=function(e){return!T.alpha||1===e.a&&!T.forceAlpha?`rgb(${e.r}, ${e.g}, ${e.b})`:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}(r);break;case"hsl":h.value=(u=function(e){const t=e.v/100,n=t*(1-e.s/100/2);let i;return n>0&&n<1&&(i=o.round((t-n)/o.min(n,1-n)*100)),{h:e.h,s:i||0,l:o.round(100*n),a:e.a}}(r),!T.alpha||1===u.a&&!T.forceAlpha?`hsl(${u.h}, ${u.s}%, ${u.l}%)`:`hsla(${u.h}, ${u.s}%, ${u.l}%, ${u.a})`)}var u;t.querySelector(`.clr-format [value="${i}"]`).checked=!0}function W(){const e=1*f.value,t=1*c.style.left.replace("px",""),o=1*c.style.top.replace("px","");a.style.color=`hsl(${e}, 100%, 50%)`,m.style.left=e/360*100+"%",F(t,o)}function K(){const e=g.value/100;b.style.left=100*e+"%",U({a:e}),V()}function q(){t.getElementById("clr-picker")||(s=n,a=t.createElement("div"),a.setAttribute("id","clr-picker"),a.className="clr-picker",a.innerHTML=`<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="${T.a11y.input}"><div id="clr-color-area" class="clr-gradient" role="application" aria-label="${T.a11y.instruction}"><div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue"><input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="${T.a11y.hueSlider}"><div id="clr-hue-marker"></div></div><div class="clr-alpha"><input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="${T.a11y.alphaSlider}"><div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented"><legend>${T.a11y.format}</legend><input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div><button type="button" id="clr-clear" class="clr-clear" aria-label="${T.a11y.clear}">${T.clearLabel}</button><div id="clr-color-preview" class="clr-preview"><button type="button" id="clr-close" class="clr-close" aria-label="${T.a11y.close}">${T.closeLabel}</button></div><span id="clr-open-label" hidden>${T.a11y.open}</span><span id="clr-swatch-label" hidden>${T.a11y.swatch}</span>`,t.body.appendChild(a),l=G("clr-color-area"),c=G("clr-color-marker"),u=G("clr-clear"),p=G("clr-close"),d=G("clr-color-preview"),h=G("clr-color-value"),f=G("clr-hue-slider"),m=G("clr-hue-marker"),g=G("clr-alpha-slider"),b=G("clr-alpha-marker"),L(T.el),D(T.el),Y(a,"mousedown",(e=>{a.classList.remove("clr-keyboard-nav"),e.stopPropagation()})),Y(l,"mousedown",(e=>{Y(t,"mousemove",$)})),Y(l,"touchstart",(e=>{t.addEventListener("touchmove",$,{passive:!1})})),Y(c,"mousedown",(e=>{Y(t,"mousemove",$)})),Y(c,"touchstart",(e=>{t.addEventListener("touchmove",$,{passive:!1})})),Y(h,"change",(e=>{const t=h.value;(v||T.inline)&&V(""===t?t:A(t))})),Y(u,"click",(e=>{V(""),B()})),Y(p,"click",(e=>{V(),B()})),Y(G("clr-format"),"click",".clr-format input",(e=>{y=e.target.value,U(),V()})),Y(a,"click",".clr-swatches button",(e=>{A(e.target.textContent),V(),T.swatchesOnly&&B()})),Y(t,"mouseup",(e=>{t.removeEventListener("mousemove",$)})),Y(t,"touchend",(e=>{t.removeEventListener("touchmove",$)})),Y(t,"mousedown",(e=>{x=!1,a.classList.remove("clr-keyboard-nav"),B()})),Y(t,"keydown",(e=>{const t=e.key,o=e.target,n=e.shiftKey;if("Escape"===t?B(!0):["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)&&(x=!0,a.classList.add("clr-keyboard-nav")),"Tab"===t&&o.matches(".clr-picker *")){const t=Z(),i=t.shift(),r=t.pop();n&&o===i?(r.focus(),e.preventDefault()):n||o!==r||(i.focus(),e.preventDefault())}})),Y(t,"click",".clr-field button",(e=>{E&&R(),e.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))})),Y(c,"keydown",(e=>{const t={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(t).includes(e.key)&&(function(e,t){H(1*c.style.left.replace("px","")+e,1*c.style.top.replace("px","")+t)}(...t[e.key]),e.preventDefault())})),Y(l,"click",$),Y(f,"input",W),Y(g,"input",K))}function Z(){return Array.from(a.querySelectorAll("input, button")).filter((e=>!!e.offsetWidth))}function G(e){return t.getElementById(e)}function Y(e,t,o,n){const i=Element.prototype.matches||Element.prototype.msMatchesSelector;"string"==typeof o?e.addEventListener(t,(e=>{i.call(e.target,o)&&n.call(e.target,e)})):(n=o,e.addEventListener(t,n))}function X(e,o){o=o!==n?o:[],"loading"!==t.readyState?e(...o):t.addEventListener("DOMContentLoaded",(()=>{e(...o)}))}function J(e,t){v=t,w=v.value,I(t),y=j(e),O(),A(e),V(),w!==e&&v.dispatchEvent(new Event("change",{bubbles:!0}))}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);const Q=(()=>{const t={init:q,set:z,wrap:D,close:B,setInstance:_,setColor:J,removeInstance:M,updatePosition:O,ready:X};function o(e){X((()=>{e&&("string"==typeof e?L(e):z(e))}))}for(const e in t)o[e]=function(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];X(t[e],n)};return X((()=>{e.addEventListener("resize",(e=>{o.updatePosition()})),e.addEventListener("scroll",(e=>{o.updatePosition()}))})),o})();return Q.coloris=Q,Q})(window,document,Math)})?o.apply(t,[]):o)||(e.exports=n)},1434:e=>{var o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,s=(e=>(t,s)=>e&&e.get(t)||(s=((e,t,s,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of i(t))r.call(e,s)||o(e,s,{get:()=>t[s],enumerable:!(a=n(t,s))||a.enumerable});return e})(o({},"__esModule",{value:!0}),t),e&&e.set(t,s),s))("undefined"!=typeof WeakMap?new WeakMap:0),a={};((e,t)=>{for(var n in t)o(e,n,{get:t[n],enumerable:!0})})(a,{Bezier:()=>R});var{abs:l,cos:c,sin:d,acos:h,atan2:u,sqrt:p,pow:f}=Math;function m(e){return e<0?-f(-e,1/3):f(e,1/3)}var g=Math.PI,b=2*g,v=g/2,y=Number.MAX_SAFE_INTEGER||9007199254740991,w=Number.MIN_SAFE_INTEGER||-9007199254740991,x={x:0,y:0,z:0},S={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,t){const o=t(e);let n=o.x*o.x+o.y*o.y;return void 0!==o.z&&(n+=o.z*o.z),p(n)},compute:function(e,t,o){if(0===e)return t[0].t=0,t[0];const n=t.length-1;if(1===e)return t[n].t=1,t[n];const i=1-e;let r=t;if(0===n)return t[0].t=e,t[0];if(1===n){const t={x:i*r[0].x+e*r[1].x,y:i*r[0].y+e*r[1].y,t:e};return o&&(t.z=i*r[0].z+e*r[1].z),t}if(n<4){let t,s,a,l=i*i,c=e*e,d=0;2===n?(r=[r[0],r[1],r[2],x],t=l,s=i*e*2,a=c):3===n&&(t=l*i,s=l*e*3,a=i*c*3,d=e*c);const h={x:t*r[0].x+s*r[1].x+a*r[2].x+d*r[3].x,y:t*r[0].y+s*r[1].y+a*r[2].y+d*r[3].y,t:e};return o&&(h.z=t*r[0].z+s*r[1].z+a*r[2].z+d*r[3].z),h}const s=JSON.parse(JSON.stringify(t));for(;s.length>1;){for(let t=0;t<s.length-1;t++)s[t]={x:s[t].x+(s[t+1].x-s[t].x)*e,y:s[t].y+(s[t+1].y-s[t].y)*e},void 0!==s[t].z&&(s[t]=s[t].z+(s[t+1].z-s[t].z)*e);s.splice(s.length-1,1)}return s[0].t=e,s[0]},computeWithRatios:function(e,t,o,n){const i=1-e,r=o,s=t;let a,l=r[0],c=r[1],d=r[2],h=r[3];return l*=i,c*=e,2===s.length?(a=l+c,{x:(l*s[0].x+c*s[1].x)/a,y:(l*s[0].y+c*s[1].y)/a,z:!!n&&(l*s[0].z+c*s[1].z)/a,t:e}):(l*=i,c*=2*i,d*=e*e,3===s.length?(a=l+c+d,{x:(l*s[0].x+c*s[1].x+d*s[2].x)/a,y:(l*s[0].y+c*s[1].y+d*s[2].y)/a,z:!!n&&(l*s[0].z+c*s[1].z+d*s[2].z)/a,t:e}):(l*=i,c*=1.5*i,d*=3*i,h*=e*e*e,4===s.length?(a=l+c+d+h,{x:(l*s[0].x+c*s[1].x+d*s[2].x+h*s[3].x)/a,y:(l*s[0].y+c*s[1].y+d*s[2].y+h*s[3].y)/a,z:!!n&&(l*s[0].z+c*s[1].z+d*s[2].z+h*s[3].z)/a,t:e}):void 0))},derive:function(e,t){const o=[];for(let n=e,i=n.length,r=i-1;i>1;i--,r--){const e=[];for(let o,i=0;i<r;i++)o={x:r*(n[i+1].x-n[i].x),y:r*(n[i+1].y-n[i].y)},t&&(o.z=r*(n[i+1].z-n[i].z)),e.push(o);o.push(e),n=e}return o},between:function(e,t,o){return t<=e&&e<=o||S.approximately(e,t)||S.approximately(e,o)},approximately:function(e,t,o){return l(e-t)<=(o||1e-6)},length:function(e){const t=S.Tvalues.length;let o=0;for(let n,i=0;i<t;i++)n=.5*S.Tvalues[i]+.5,o+=S.Cvalues[i]*S.arcfn(n,e);return.5*o},map:function(e,t,o,n,i){return n+(e-t)/(o-t)*(i-n)},lerp:function(e,t,o){const n={x:t.x+e*(o.x-t.x),y:t.y+e*(o.y-t.y)};return void 0!==t.z&&void 0!==o.z&&(n.z=t.z+e*(o.z-t.z)),n},pointToString:function(e){let t=e.x+"/"+e.y;return void 0!==e.z&&(t+="/"+e.z),t},pointsToString:function(e){return"["+e.map(S.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,t,o){const n=t.x-e.x,i=t.y-e.y,r=o.x-e.x,s=o.y-e.y;return u(n*s-i*r,n*r+i*s)},round:function(e,t){const o=""+e,n=o.indexOf(".");return parseFloat(o.substring(0,n+1+t))},dist:function(e,t){const o=e.x-t.x,n=e.y-t.y;return p(o*o+n*n)},closest:function(e,t){let o,n,i=f(2,63);return e.forEach((function(e,r){n=S.dist(t,e),n<i&&(i=n,o=r)})),{mdist:i,mpos:o}},abcratio:function(e,t){if(2!==t&&3!==t)return!1;if(void 0===e)e=.5;else if(0===e||1===e)return e;const o=f(e,t)+f(1-e,t);return l((o-1)/o)},projectionratio:function(e,t){if(2!==t&&3!==t)return!1;if(void 0===e)e=.5;else if(0===e||1===e)return e;const o=f(1-e,t);return o/(f(e,t)+o)},lli8:function(e,t,o,n,i,r,s,a){const l=(e-o)*(r-a)-(t-n)*(i-s);return 0!=l&&{x:((e*n-t*o)*(i-s)-(e-o)*(i*a-r*s))/l,y:((e*n-t*o)*(r-a)-(t-n)*(i*a-r*s))/l}},lli4:function(e,t,o,n){const i=e.x,r=e.y,s=t.x,a=t.y,l=o.x,c=o.y,d=n.x,h=n.y;return S.lli8(i,r,s,a,l,c,d,h)},lli:function(e,t){return S.lli4(e,e.c,t,t.c)},makeline:function(e,t){return new R(e.x,e.y,(e.x+t.x)/2,(e.y+t.y)/2,t.x,t.y)},findbbox:function(e){let t=y,o=y,n=w,i=w;return e.forEach((function(e){const r=e.bbox();t>r.x.min&&(t=r.x.min),o>r.y.min&&(o=r.y.min),n<r.x.max&&(n=r.x.max),i<r.y.max&&(i=r.y.max)})),{x:{min:t,mid:(t+n)/2,max:n,size:n-t},y:{min:o,mid:(o+i)/2,max:i,size:i-o}}},shapeintersections:function(e,t,o,n,i){if(!S.bboxoverlap(t,n))return[];const r=[],s=[e.startcap,e.forward,e.back,e.endcap],a=[o.startcap,o.forward,o.back,o.endcap];return s.forEach((function(t){t.virtual||a.forEach((function(n){if(n.virtual)return;const s=t.intersects(n,i);s.length>0&&(s.c1=t,s.c2=n,s.s1=e,s.s2=o,r.push(s))}))})),r},makeshape:function(e,t,o){const n=t.points.length,i=e.points.length,r=S.makeline(t.points[n-1],e.points[0]),s=S.makeline(e.points[i-1],t.points[0]),a={startcap:r,forward:e,back:t,endcap:s,bbox:S.findbbox([r,e,t,s]),intersections:function(e){return S.shapeintersections(a,a.bbox,e,e.bbox,o)}};return a},getminmax:function(e,t,o){if(!o)return{min:0,max:0};let n,i,r=y,s=w;-1===o.indexOf(0)&&(o=[0].concat(o)),-1===o.indexOf(1)&&o.push(1);for(let a=0,l=o.length;a<l;a++)n=o[a],i=e.get(n),i[t]<r&&(r=i[t]),i[t]>s&&(s=i[t]);return{min:r,mid:(r+s)/2,max:s,size:s-r}},align:function(e,t){const o=t.p1.x,n=t.p1.y,i=-u(t.p2.y-n,t.p2.x-o);return e.map((function(e){return{x:(e.x-o)*c(i)-(e.y-n)*d(i),y:(e.x-o)*d(i)+(e.y-n)*c(i)}}))},roots:function(e,t){t=t||{p1:{x:0,y:0},p2:{x:1,y:0}};const o=e.length-1,n=S.align(e,t),i=function(e){return 0<=e&&e<=1};if(2===o){const e=n[0].y,t=n[1].y,o=n[2].y,r=e-2*t+o;if(0!==r){const n=-p(t*t-e*o),s=-e+t;return[-(n+s)/r,-(-n+s)/r].filter(i)}return t!==o&&0===r?[(2*t-o)/(2*t-2*o)].filter(i):[]}const r=n[0].y,s=n[1].y,a=n[2].y;let l=3*s-r-3*a+n[3].y,d=3*r-6*s+3*a,u=-3*r+3*s,f=r;if(S.approximately(l,0)){if(S.approximately(d,0))return S.approximately(u,0)?[]:[-f/u].filter(i);const e=p(u*u-4*d*f),t=2*d;return[(e-u)/t,(-u-e)/t].filter(i)}d/=l,u/=l,f/=l;const g=(3*u-d*d)/3,v=g/3,y=(2*d*d*d-9*d*u+27*f)/27,w=y/2,x=w*w+v*v*v;let T,C,P,k,E;if(x<0){const e=-g/3,t=p(e*e*e),o=-y/(2*t),n=h(o<-1?-1:o>1?1:o),r=2*m(t);return P=r*c(n/3)-d/3,k=r*c((n+b)/3)-d/3,E=r*c((n+2*b)/3)-d/3,[P,k,E].filter(i)}if(0===x)return T=w<0?m(-w):-m(w),P=2*T-d/3,k=-T-d/3,[P,k].filter(i);{const e=p(x);return T=m(-w+e),C=m(w+e),[T-C-d/3].filter(i)}},droots:function(e){if(3===e.length){const t=e[0],o=e[1],n=e[2],i=t-2*o+n;if(0!==i){const e=-p(o*o-t*n),r=-t+o;return[-(e+r)/i,-(-e+r)/i]}return o!==n&&0===i?[(2*o-n)/(2*(o-n))]:[]}if(2===e.length){const t=e[0],o=e[1];return t!==o?[t/(t-o)]:[]}return[]},curvature:function(e,t,o,n,i){let r,s,a,c,d=0,h=0;const u=S.compute(e,t),m=S.compute(e,o),g=u.x*u.x+u.y*u.y;if(n?(r=p(f(u.y*m.z-m.y*u.z,2)+f(u.z*m.x-m.z*u.x,2)+f(u.x*m.y-m.x*u.y,2)),s=f(g+u.z*u.z,1.5)):(r=u.x*m.y-u.y*m.x,s=f(g,1.5)),0===r||0===s)return{k:0,r:0};if(d=r/s,h=s/r,!i){const i=S.curvature(e-.001,t,o,n,!0).k,r=S.curvature(e+.001,t,o,n,!0).k;c=(r-d+(d-i))/2,a=(l(r-d)+l(d-i))/2}return{k:d,r:h,dk:c,adk:a}},inflections:function(e){if(e.length<4)return[];const t=S.align(e,{p1:e[0],p2:e.slice(-1)[0]}),o=t[2].x*t[1].y,n=t[3].x*t[1].y,i=t[1].x*t[2].y,r=18*(-3*o+2*n+3*i-t[3].x*t[2].y),s=18*(3*o-n-3*i),a=18*(i-o);if(S.approximately(r,0)){if(!S.approximately(s,0)){let e=-a/s;if(0<=e&&e<=1)return[e]}return[]}const l=2*r;if(S.approximately(l,0))return[];const c=s*s-4*r*a;if(c<0)return[];const d=Math.sqrt(c);return[(d-s)/l,-(s+d)/l].filter((function(e){return 0<=e&&e<=1}))},bboxoverlap:function(e,t){const o=["x","y"],n=o.length;for(let i,r,s,a,c=0;c<n;c++)if(i=o[c],r=e[i].mid,s=t[i].mid,a=(e[i].size+t[i].size)/2,l(r-s)>=a)return!1;return!0},expandbox:function(e,t){t.x.min<e.x.min&&(e.x.min=t.x.min),t.y.min<e.y.min&&(e.y.min=t.y.min),t.z&&t.z.min<e.z.min&&(e.z.min=t.z.min),t.x.max>e.x.max&&(e.x.max=t.x.max),t.y.max>e.y.max&&(e.y.max=t.y.max),t.z&&t.z.max>e.z.max&&(e.z.max=t.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,t,o){const n=e.bbox(),i=t.bbox(),r=1e5,s=o||.5;if(n.x.size+n.y.size<s&&i.x.size+i.y.size<s)return[(r*(e._t1+e._t2)/2|0)/r+"/"+(r*(t._t1+t._t2)/2|0)/r];let a=e.split(.5),l=t.split(.5),c=[{left:a.left,right:l.left},{left:a.left,right:l.right},{left:a.right,right:l.right},{left:a.right,right:l.left}];c=c.filter((function(e){return S.bboxoverlap(e.left.bbox(),e.right.bbox())}));let d=[];return 0===c.length||(c.forEach((function(e){d=d.concat(S.pairiteration(e.left,e.right,s))})),d=d.filter((function(e,t){return d.indexOf(e)===t}))),d},getccenter:function(e,t,o){const n=t.x-e.x,i=t.y-e.y,r=o.x-t.x,s=o.y-t.y,a=n*c(v)-i*d(v),l=n*d(v)+i*c(v),h=r*c(v)-s*d(v),p=r*d(v)+s*c(v),f=(e.x+t.x)/2,m=(e.y+t.y)/2,g=(t.x+o.x)/2,y=(t.y+o.y)/2,w=f+a,x=m+l,T=g+h,C=y+p,P=S.lli8(f,m,w,x,g,y,T,C),k=S.dist(P,e);let E,z=u(e.y-P.y,e.x-P.x),_=u(t.y-P.y,t.x-P.x),M=u(o.y-P.y,o.x-P.x);return z<M?((z>_||_>M)&&(z+=b),z>M&&(E=M,M=z,z=E)):M<_&&_<z?(E=M,M=z,z=E):M+=b,P.s=z,P.e=M,P.r=k,P},numberSort:function(e,t){return e-t}},T=class{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(e){return S.pointsToString(e.points)})).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map((function(e){return e.length()})).reduce((function(e,t){return e+t}))}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var t=e[0].bbox(),o=1;o<e.length;o++)S.expandbox(t,e[o].bbox());return t}offset(e){const t=[];return this.curves.forEach((function(o){t.push(...o.offset(e))})),new T(t)}},{abs:C,min:P,max:k,cos:E,sin:z,acos:_,sqrt:M}=Math,I=Math.PI,R=class{constructor(e){let t=e&&e.forEach?e:Array.from(arguments).slice(),o=!1;if("object"==typeof t[0]){o=t.length;const e=[];t.forEach((function(t){["x","y","z"].forEach((function(o){void 0!==t[o]&&e.push(t[o])}))})),t=e}let n=!1;const i=t.length;if(o){if(o>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");n=!0}}else if(6!==i&&8!==i&&9!==i&&12!==i&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const r=this._3d=!n&&(9===i||12===i)||e&&e[0]&&void 0!==e[0].z,s=this.points=[];for(let e=0,o=r?3:2;e<i;e+=o){var a={x:t[e],y:t[e+1]};r&&(a.z=t[e+2]),s.push(a)}const l=this.order=s.length-1,c=this.dims=["x","y"];r&&c.push("z"),this.dimlen=c.length;const d=S.align(s,{p1:s[0],p2:s[l]}),h=S.dist(s[0],s[l]);this._linear=d.reduce(((e,t)=>e+C(t.y)),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,t,o,n){if(void 0===n&&(n=.5),0===n)return new R(t,t,o);if(1===n)return new R(e,t,t);const i=R.getABC(2,e,t,o,n);return new R(e,i.A,o)}static cubicFromPoints(e,t,o,n,i){void 0===n&&(n=.5);const r=R.getABC(3,e,t,o,n);void 0===i&&(i=S.dist(t,r.C));const s=i*(1-n)/n,a=S.dist(e,o),l=(o.x-e.x)/a,c=(o.y-e.y)/a,d=i*l,h=i*c,u=s*l,p=s*c,f=t.x-d,m=t.y-h,g=t.x+u,b=t.y+p,v=r.A,y=v.x+(f-v.x)/(1-n),w=v.y+(m-v.y)/(1-n),x=v.x+(g-v.x)/n,T=v.y+(b-v.y)/n,C={x:e.x+(y-e.x)/n,y:e.y+(w-e.y)/n},P={x:o.x+(x-o.x)/(1-n),y:o.y+(T-o.y)/(1-n)};return new R(e,C,P,o)}static getUtils(){return S}getUtils(){return R.getUtils()}static get PolyBezier(){return T}valueOf(){return this.toString()}toString(){return S.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,t=["M",e[0].x,e[0].y,2===this.order?"Q":"C"];for(let o=1,n=e.length;o<n;o++)t.push(e[o].x),t.push(e[o].y);return t.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map((function(e,t){return""+t+e.x+e.y+(e.z?e.z:0)})).join("")}update(){this._lut=[],this.dpoints=S.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,t=S.angle(e[0],e[this.order],e[1]);this.clockwise=t>0}length(){return S.length(this.derivative.bind(this))}static getABC(e=2,t,o,n,i=.5){const r=S.projectionratio(i,e),s=1-r,a={x:r*t.x+s*n.x,y:r*t.y+s*n.y},l=S.abcratio(i,e);return{A:{x:o.x+(o.x-a.x)/l,y:o.y+(o.y-a.y)/l},B:o,C:a,S:t,E:n}}getABC(e,t){t=t||this.get(e);let o=this.points[0],n=this.points[this.order];return R.getABC(this.order,o,t,n,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let t,o,n=0;n<e;n++)o=n/(e-1),t=this.compute(o),t.t=o,this._lut.push(t);return this._lut}on(e,o){o=o||5;const n=this.getLUT(),i=[];for(let t,r=0,s=0;r<n.length;r++)t=n[r],S.dist(t,e)<o&&(i.push(t),s+=r/n.length);return!!i.length&&(t/=i.length)}project(e){const t=this.getLUT(),o=t.length-1,n=S.closest(t,e),i=n.mpos,r=(i-1)/o,s=(i+1)/o,a=.1/o;let l,c=n.mdist,d=r,h=d;c+=1;for(let t;d<s+a;d+=a)l=this.compute(d),t=S.dist(e,l),t<c&&(c=t,h=d);return h=h<0?0:h>1?1:h,l=this.compute(h),l.t=h,l.d=c,l}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?S.computeWithRatios(e,this.points,this.ratios,this._3d):S.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,t=[e[0]],o=e.length;for(let n,i,r=1;r<o;r++)n=e[r],i=e[r-1],t[r]={x:(o-r)/o*n.x+r/o*i.x,y:(o-r)/o*n.y+r/o*i.y};return t[o]=e[o-1],new R(t)}derivative(e){return S.compute(e,this.dpoints[0],this._3d)}dderivative(e){return S.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new R(S.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return S.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return S.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const t=this.derivative(e),o=M(t.x*t.x+t.y*t.y);return{t:e,x:-t.y/o,y:t.x/o}}__normal3(e){const t=this.derivative(e),o=this.derivative(e+.01),n=M(t.x*t.x+t.y*t.y+t.z*t.z),i=M(o.x*o.x+o.y*o.y+o.z*o.z);t.x/=n,t.y/=n,t.z/=n,o.x/=i,o.y/=i,o.z/=i;const r={x:o.y*t.z-o.z*t.y,y:o.z*t.x-o.x*t.z,z:o.x*t.y-o.y*t.x},s=M(r.x*r.x+r.y*r.y+r.z*r.z);r.x/=s,r.y/=s,r.z/=s;const a=[r.x*r.x,r.x*r.y-r.z,r.x*r.z+r.y,r.x*r.y+r.z,r.y*r.y,r.y*r.z-r.x,r.x*r.z-r.y,r.y*r.z+r.x,r.z*r.z];return{t:e,x:a[0]*t.x+a[1]*t.y+a[2]*t.z,y:a[3]*t.x+a[4]*t.y+a[5]*t.z,z:a[6]*t.x+a[7]*t.y+a[8]*t.z}}hull(e){let t=this.points,o=[],n=[],i=0;for(n[i++]=t[0],n[i++]=t[1],n[i++]=t[2],3===this.order&&(n[i++]=t[3]);t.length>1;){o=[];for(let r,s=0,a=t.length-1;s<a;s++)r=S.lerp(e,t[s],t[s+1]),n[i++]=r,o.push(r);t=o}return n}split(e,t){if(0===e&&t)return this.split(t).left;if(1===t)return this.split(e).right;const o=this.hull(e),n={left:2===this.order?new R([o[0],o[3],o[5]]):new R([o[0],o[4],o[7],o[9]]),right:2===this.order?new R([o[5],o[4],o[2]]):new R([o[9],o[8],o[6],o[3]]),span:o};return n.left._t1=S.map(0,0,1,this._t1,this._t2),n.left._t2=S.map(e,0,1,this._t1,this._t2),n.right._t1=S.map(e,0,1,this._t1,this._t2),n.right._t2=S.map(1,0,1,this._t1,this._t2),t?(t=S.map(t,e,1,0,1),n.right.split(t).left):n}extrema(){const e={};let t=[];return this.dims.forEach(function(o){let n=function(e){return e[o]},i=this.dpoints[0].map(n);e[o]=S.droots(i),3===this.order&&(i=this.dpoints[1].map(n),e[o]=e[o].concat(S.droots(i))),e[o]=e[o].filter((function(e){return e>=0&&e<=1})),t=t.concat(e[o].sort(S.numberSort))}.bind(this)),e.values=t.sort(S.numberSort).filter((function(e,o){return t.indexOf(e)===o})),e}bbox(){const e=this.extrema(),t={};return this.dims.forEach(function(o){t[o]=S.getminmax(this,o,e[o])}.bind(this)),t}overlaps(e){const t=this.bbox(),o=e.bbox();return S.bboxoverlap(t,o)}offset(e,t){if(void 0!==t){const o=this.get(e),n=this.normal(e),i={c:o,n,x:o.x+n.x*t,y:o.y+n.y*t};return this._3d&&(i.z=o.z+n.z*t),i}if(this._linear){const t=this.normal(0),o=this.points.map((function(o){const n={x:o.x+e*t.x,y:o.y+e*t.y};return o.z&&t.z&&(n.z=o.z+e*t.z),n}));return[new R(o)]}return this.reduce().map((function(t){return t._linear?t.offset(e)[0]:t.scale(e)}))}simple(){if(3===this.order){const e=S.angle(this.points[0],this.points[3],this.points[1]),t=S.angle(this.points[0],this.points[3],this.points[2]);if(e>0&&t<0||e<0&&t>0)return!1}const e=this.normal(0),t=this.normal(1);let o=e.x*t.x+e.y*t.y;return this._3d&&(o+=e.z*t.z),C(_(o))<I/3}reduce(){let e,t,o=0,n=0,i=.01,r=[],s=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),o=a[0],e=1;e<a.length;e++)n=a[e],t=this.split(o,n),t._t1=o,t._t2=n,r.push(t),o=n;return r.forEach((function(e){for(o=0,n=0;n<=1;)for(n=o+i;n<=1.01;n+=i)if(t=e.split(o,n),!t.simple()){if(n-=i,C(o-n)<i)return[];t=e.split(o,n),t._t1=S.map(o,0,1,e._t1,e._t2),t._t2=S.map(n,0,1,e._t1,e._t2),s.push(t),o=n;break}o<1&&(t=e.split(o,1),t._t1=S.map(o,0,1,e._t1,e._t2),t._t2=e._t2,s.push(t))})),s}translate(e,t,o){o="number"==typeof o?o:t;const n=this.order;let i=this.points.map(((e,i)=>(1-i/n)*t+i/n*o));return new R(this.points.map(((t,o)=>({x:t.x+e.x*i[o],y:t.y+e.y*i[o]}))))}scale(e){const t=this.order;let o=!1;if("function"==typeof e&&(o=e),o&&2===t)return this.raise().scale(o);const n=this.clockwise,i=this.points;if(this._linear)return this.translate(this.normal(0),o?o(0):e,o?o(1):e);const r=o?o(0):e,s=o?o(1):e,a=[this.offset(0,10),this.offset(1,10)],l=[],c=S.lli4(a[0],a[0].c,a[1],a[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(e){const o=l[e*t]=S.copy(i[e*t]);o.x+=(e?s:r)*a[e].n.x,o.y+=(e?s:r)*a[e].n.y})),o?([0,1].forEach((function(r){if(2!==t||!r){var s=i[r+1],a={x:s.x-c.x,y:s.y-c.y},d=o?o((r+1)/t):e;o&&!n&&(d=-d);var h=M(a.x*a.x+a.y*a.y);a.x/=h,a.y/=h,l[r+1]={x:s.x+d*a.x,y:s.y+d*a.y}}})),new R(l)):([0,1].forEach((e=>{if(2===t&&e)return;const o=l[e*t],n=this.derivative(e),r={x:o.x+n.x,y:o.y+n.y};l[e+1]=S.lli4(o,r,c,i[e+1])})),new R(l))}outline(e,t,o,n){if(t=void 0===t?e:t,this._linear){const i=this.normal(0),r=this.points[0],s=this.points[this.points.length-1];let a,l,c;void 0===o&&(o=e,n=t),a={x:r.x+i.x*e,y:r.y+i.y*e},c={x:s.x+i.x*o,y:s.y+i.y*o},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const d=[a,l,c];a={x:r.x-i.x*t,y:r.y-i.y*t},c={x:s.x-i.x*n,y:s.y-i.y*n},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const h=[c,l,a],u=S.makeline(h[2],d[0]),p=S.makeline(d[2],h[0]),f=[u,new R(d),p,new R(h)];return new T(f)}const i=this.reduce(),r=i.length,s=[];let a,l=[],c=0,d=this.length();const h=void 0!==o&&void 0!==n;function u(e,t,o,n,i){return function(r){const s=n/o,a=(n+i)/o,l=t-e;return S.map(r,0,1,e+s*l,e+a*l)}}i.forEach((function(i){const r=i.length();h?(s.push(i.scale(u(e,o,d,c,r))),l.push(i.scale(u(-t,-n,d,c,r)))):(s.push(i.scale(e)),l.push(i.scale(-t))),c+=r})),l=l.map((function(e){return a=e.points,a[3]?e.points=[a[3],a[2],a[1],a[0]]:e.points=[a[2],a[1],a[0]],e})).reverse();const p=s[0].points[0],f=s[r-1].points[s[r-1].points.length-1],m=l[r-1].points[l[r-1].points.length-1],g=l[0].points[0],b=S.makeline(m,p),v=S.makeline(f,g),y=[b].concat(s).concat([v]).concat(l);return new T(y)}outlineshapes(e,t,o){t=t||e;const n=this.outline(e,t).curves,i=[];for(let e=1,t=n.length;e<t/2;e++){const r=S.makeshape(n[e],n[t-e],o);r.startcap.virtual=e>1,r.endcap.virtual=e<t/2-1,i.push(r)}return i}intersects(e,t){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof R&&(e=e.reduce()),this.curveintersects(this.reduce(),e,t)):this.selfintersects(t)}lineIntersects(e){const t=P(e.p1.x,e.p2.x),o=P(e.p1.y,e.p2.y),n=k(e.p1.x,e.p2.x),i=k(e.p1.y,e.p2.y);return S.roots(this.points,e).filter((e=>{var r=this.get(e);return S.between(r.x,t,n)&&S.between(r.y,o,i)}))}selfintersects(e){const t=this.reduce(),o=t.length-2,n=[];for(let i,r,s,a=0;a<o;a++)r=t.slice(a,a+1),s=t.slice(a+2),i=this.curveintersects(r,s,e),n.push(...i);return n}curveintersects(e,t,o){const n=[];e.forEach((function(e){t.forEach((function(t){e.overlaps(t)&&n.push({left:e,right:t})}))}));let i=[];return n.forEach((function(e){const t=S.pairiteration(e.left,e.right,o);t.length>0&&(i=i.concat(t))})),i}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,t,o,n){const i=(n-o)/4,r=this.get(o+i),s=this.get(n-i),a=S.dist(e,t),l=S.dist(e,r),c=S.dist(e,s);return C(l-a)+C(c-a)}_iterate(e,t){let o,n=0,i=1;do{o=0,i=1;let r,s,a,l,c,d=this.get(n),h=!1,u=!1,p=i,f=1,m=0;do{if(u=h,l=a,p=(n+i)/2,m++,r=this.get(p),s=this.get(i),a=S.getccenter(d,r,s),a.interval={start:n,end:i},h=this._error(a,d,n,i)<=e,c=u&&!h,c||(f=i),h){if(i>=1){if(a.interval.end=f=1,l=a,i>1){let e={x:a.x+a.r*E(a.e),y:a.y+a.r*z(a.e)};a.e+=S.angle({x:a.x,y:a.y},e,this.get(1))}break}i+=(i-n)/2}else i=p}while(!c&&o++<100);if(o>=100)break;l=l||a,t.push(l),n=f}while(i<1);return t}};e.exports=s(a)}},o={};!function t(n){var i=o[n];if(void 0!==i)return i.exports;var r=o[n]={exports:{}};return e[n].call(r.exports,r,r.exports,t),r.exports}(7362)})();